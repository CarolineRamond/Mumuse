webpackJsonp([0],{108:function(e,t,i){var r=i(838);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},12:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.mapConfig=t.actions=t.selectors=t.default=void 0;var r=i(33),n=i(58),o=_interopRequireDefault(i(431)),a=_interopRequireDefault(i(459)),s=_interopRequireDefault(i(476)),l=_interopRequireDefault(i(480)),c=_interopRequireDefault(i(489)),u=_interopRequireDefault(i(493)),h=[o.default,a.default,s.default,l.default,c.default,u.default],d=(0,r.combineReducers)({world:c.default.reducer,medias:a.default.reducer,auth:o.default.reducer,users:l.default.reducer,rastertiles:s.default.reducer,potree:u.default.reducer}),p=h.reduce(function(e,t){return(0,n.forIn)(t.selectors,function(i){"getLayersState"!==i.name&&"getSourcesState"!==i.name&&(e[i.name]=function(e){return i(e[t.name])})}),e},{});t.selectors=p;p.getSourcesState=function getSourcesState(e){return h.reduce(function(t,i){if(i.selectors.getSourcesState){var r=i.selectors.getSourcesState(e[i.name]);t.pending=t.pending||r.pending,t.data&&r.data?t.data=Object.assign({},t.data,r.data):!t.data&&r.data&&(t.data=r.data)}return t},{pending:!1,error:null,data:null})},p.getLayersState=function getLayersState(e){return h.reduce(function(t,i){if(i.selectors.getLayersState){var r=i.selectors.getLayersState(e[i.name]);t.pending=t.pending||r.pending,t.data&&r.data?t.data=Object.assign({},t.data,r.data):!t.data&&r.data&&(t.data=r.data)}return t},{pending:!1,error:null,data:null})};var f=h.reduce(function(e,t){return(0,n.forIn)(t.actions,function(t){e[t.name]=t}),e},{});t.actions=f;var m=h.reduce(function(e,t){return t.mapConfig&&(e.events=t.mapConfig.events.concat(e.events),e.click=t.mapConfig.click.concat(e.click),e.dragndrop=t.mapConfig.dragndrop.concat(e.dragndrop),e.renderedFeatures=t.mapConfig.renderedFeatures.concat(e.renderedFeatures)),e},{events:[],click:[],dragndrop:[],renderedFeatures:[]});t.mapConfig=m;var g=d;t.default=g},158:function(e,t,i){var r=i(700);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},209:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _uploadMedia(e,t){return new Promise(function(i,o){if(!e instanceof Blob)return console.warn("Error : file is not an instance of Blob"),o({type:"File not and instance of Blob"});if(!function isFileSizeRespectLimit(e){return"number"==typeof e&&e<52428800}(e.size))return console.warn("Error : File size limit is not respected ("+e.size+")"),o({type:"File size out of bounds",value:{size:e.size}});var a=new FileReader;a.onloadend=function(a){var s=function getMediaPosition(e){try{if(e){var t=n.default.create(e);t.enableTagNames(!0),t.enableImageSize(!1);var i=t.parse();return{position:function getMediaPositionFromExif(e){var t=null;e&&"number"==typeof e.GPSLongitude&&"number"==typeof e.GPSLatitude&&(t={lng:ConvertDMSToDD(e.GPSLongitude,e.GPSLongitudeRef),lat:ConvertDMSToDD(e.GPSLatitude,e.GPSGPSLatitudeRef)});return t}(i.tags)}}}catch(e){return console.warn("error while reading exif data"),{error:e}}}(a.target.result).position||t,l=new FormData;return l.append("longitude",s.lng),l.append("latitude",s.lat),l.append("size",e.size),l.append("file",e),r.default.post("/userdrive/media",l).then(function(){return i()}).catch(function(e){return o(e)})},a.onerror=function(e){return console.error(e),o({type:"Could not read file",value:e})},a.readAsArrayBuffer(e.slice(0,9e4,e.type))})}function ConvertDMSToDD(e,t){return"S"===t||"W"===t?-1*e:e}Object.defineProperty(t,"__esModule",{value:!0}),t.resetUploadMediasState=t.uploadMedias=t.resetDeleteMediasState=t.deleteMedias=t.initSelectedMedia=t.updateTimelineMedias=t.updateFeaturesGridMedias=t.updateFeaturesMedias=t.endDragMapMedias=t.dragMapMedias=t.startDragMapMedias=t.selectMediaById=t.clickMedias=void 0;var r=_interopRequireDefault(i(88)),n=_interopRequireDefault(i(467)),o=function isArrayOfFeatures(e){if(Array.isArray(e)){return e.reduce(function(e,t){return e&&"Feature"===t.constructor.name},!0)}return!1};t.clickMedias=function clickMedias(e){return{type:"MEDIAS_CLICK",payload:{features:e.features,ctrlKey:e.ctrlKey,isAdmin:e.isAdmin},meta:{validator:{features:{func:function func(e){return o(e)},msg:"features must be an array of mapbox features"}}}}};t.selectMediaById=function selectMediaById(e){return{type:"MEDIAS_SELECT_BY_ID",payload:{mediaId:e.mediaId,ctrlKey:e.ctrlKey,isAdmin:e.isAdmin},meta:{validator:{mediaId:{func:function func(e){return"string"==typeof e},msg:"mediaId should be a string"}}}}};t.startDragMapMedias=function startDragMapMedias(e){return{type:"MEDIAS_MAP_START_DRAG",payload:{features:e.features,isAdmin:e.isAdmin},meta:{validator:{features:{func:function func(e){return o(e)},msg:"features must be an array of mapbox features"}}}}};t.dragMapMedias=function dragMapMedias(e){return{type:"MEDIAS_MAP_DRAG",payload:{lat:e.lat,lng:e.lng,isAdmin:e.isAdmin},meta:{validator:{lat:{func:function func(e){return"number"==typeof e},msg:"lat must be a number"},lng:{func:function func(e){return"number"==typeof e},msg:"lng must be a number"}}}}};t.endDragMapMedias=function endDragMapMedias(e){var t=e.lat,i=e.lng,n=e.feature;if(e.isAdmin&&n&&"Feature"===n.constructor.name){var o=n.properties._id,a={loc:[i,t]};return{type:"MEDIAS_MAP_END_DRAG",payload:r.default.put("/userdrive/media/"+o,a)}}return{type:"NULL_ACTION"}};t.updateFeaturesMedias=function updateFeaturesMedias(e){return{type:"MEDIAS_UPDATE_FEATURES",payload:{features:e.features,zoom:e.zoom},meta:{validator:{features:{func:function func(e){return o(e)},msg:"features must be an array of mapbox features"},zoom:{func:function func(e){return"number"==typeof e},msg:"zoom must be a number"}}}}};t.updateFeaturesGridMedias=function updateFeaturesGridMedias(e){return{type:"MEDIAS_GRID_UPDATE_FEATURES",payload:{features:e.features,zoom:e.zoom},meta:{validator:{features:{func:function func(e){return o(e)},msg:"features must be an array of mapbox features"},zoom:{func:function func(e){return"number"==typeof e},msg:"zoom must be a number"}}}}};t.updateTimelineMedias=function updateTimelineMedias(e){return{type:"MEDIAS_TIMELINE_UPDATE",payload:{value:e.value},meta:{validator:{value:{func:function func(e){return"number"==typeof e},msg:"value must be a number"}}}}};t.initSelectedMedia=function initSelectedMedia(e){var t=e.mediaId;return{type:"MEDIAS_INIT_SELECTED",payload:r.default.get("/userdrive/media/"+t+"/?geojson=true")}};t.deleteMedias=function deleteMedias(e){return function(t){var i=[],n=[],o=[];return e.reduce(function(e,a,s){return e.then(function(){return t({type:"MEDIAS_DELETE_PENDING",payload:{index:s}}),function _deleteMedia(e){var t=e.properties._id;return r.default.delete("/userdrive/media/"+t)}(a)}).then(function(){o.push(a)}).catch(function(e){var t=e.response,r="Error deleting media ["+a.properties.name+"]";t&&t.data&&t.data.message&&(r+=" : "+e.response.data.message),n.push(a),i.push(r)})},Promise.resolve()).then(function(){var e=n.length>0?{medias:n,messages:i}:null;t({type:"MEDIAS_DELETE_FULFILLED",payload:{data:o,error:e}})})}};t.resetDeleteMediasState=function resetDeleteMediasState(){return{type:"RESET_MEDIAS_DELETE"}};t.uploadMedias=function uploadMedias(e,t){return function(i){var r=[],n=[],o=[];return new Array(e.length).fill(1).reduce(function(a,s,l){return a.then(function(){return i({type:"MEDIAS_UPLOAD_PENDING",payload:{index:l}}),_uploadMedia(e[l],t)}).then(function(){o.push(e[l])}).catch(function(t){var i=t.response,o="Error uploading file ["+e[l].name+"]";i&&i.data&&i.data.message&&(o+=" : "+t.response.data.message),n.push(e[l]),r.push(o)})},Promise.resolve()).then(function(){var e=n.length>0?{files:n,messages:r}:null;i({type:"MEDIAS_UPLOAD_FULFILLED",payload:{data:o,error:e}})})}};t.resetUploadMediasState=function resetUploadMediasState(){return{type:"RESET_MEDIAS_UPLOAD"}}},211:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateWorldState=function updateWorldState(e){var t=e.lng;return{type:"UPDATE_WORLD_STATE",payload:{lat:e.lat,lng:t,zoom:e.zoom,bounds:e.bounds},meta:{validator:{lat:{func:function func(e){return"number"==typeof e},msg:"lat must be a number"},lng:{func:function func(e){return"number"==typeof e},msg:"lng must be a number"},zoom:{func:function func(e){return"number"==typeof e},msg:"zoom must be a number"},bounds:{func:function func(e){return!(!Array.isArray(e)||4!==e.length)&&e.reduce(function(e,t){return e&&"number"==typeof t},!0)},msg:"bounds must be an array of four numbers"}}}}},t.resizeMap=function resizeMap(){return{type:"RESIZE_MAP"}},t.switchPreviewMode=function switchPreviewMode(){return{type:"SWITCH_PREVIEW_MODE"}},t.toggleLayer=void 0;t.toggleLayer=function toggleLayer(e){return{type:"TOGGLE_LAYER",payload:{layerId:e.layerId},meta:{validator:{layerId:{func:function func(e){return"string"==typeof e},msg:"LayerId must be a string"}}}}}},212:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clickPointCloud=void 0;t.clickPointCloud=function clickPointCloud(e){return{type:"POINTCLOUD_CLICK",payload:{features:e.features,ctrlKey:e.ctrlKey,isAdmin:e.isAdmin}}}},301:function(e,t,i){var r=i(760);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},302:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var r=_interopRequireDefault(i(0)),n=_interopRequireDefault(i(31)),o=i(11),a=_interopRequireDefault(i(426)),s=_interopRequireDefault(i(500));n.default.render(r.default.createElement(o.Provider,{store:a.default},r.default.createElement(s.default,null)),document.getElementById("app"))},426:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(33),n=_interopRequireDefault(i(427)),o=_interopRequireDefault(i(429)),a=_interopRequireDefault(i(430)),s=function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(12)),l=s.actions.fetchAuthUser,c=s.actions.fetchRastertilesets,u=new a.default,h=(0,r.applyMiddleware)(u,o.default,(0,n.default)()),d=(0,r.createStore)(s.default,h);d.dispatch(l()),d.dispatch(c());var p=d;t.default=p},430:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function _default(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{validatorKey:"meta",paramKey:"payload"};return function validatorMiddleware(t){return function(i){return function(r){if(!r[e.validatorKey]||!r[e.validatorKey].validator||r[e.validatorKey].disableValidate)return r[e.paramKey]&&r[e.paramKey].thunk?i(r[e.paramKey].thunk):i(r);var n,o,a,s=!0,l=r[e.validatorKey].validator||{},c=function runValidator(e,i,s,l,c){var u;if(!i)throw new Error("validator func is needed");if("boolean"!=typeof(u=i(e,t.getState(),r.payload)))throw new Error("validator func must return boolean type");return u||(n=c,o=l,a=s||""),u},u=function runValidatorContainer(e,t,i){var r;if(Array.prototype.isPrototypeOf(e)){for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];if(!(r=c(t,o.func,o.msg,n,i)))break}}else r=c(t,e.func,e.msg,0,i);return r},h=r[e.paramKey]||{};for(var d in l)if(l.hasOwnProperty(d)&&d!==e.paramKey&&"thunk"!==d&&!(s=u(l[d],h[d],d)))break;var p=l[e.paramKey];return p&&s&&(s=u(p,r[e.paramKey],e.paramKey)),s?r[e.paramKey]&&r[e.paramKey].thunk?i(r[e.paramKey].thunk):i(r):(console.error("Abort ".concat(r.type," : ").concat(a)),{err:"validator",msg:a,param:n,id:o})}}}}},431:function(e,t,i){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(432)),n=_interopRequireWildcard(i(439)),o=_interopRequireWildcard(i(440)),a={name:"auth",reducer:r.default,selectors:n,actions:o};t.default=a},432:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(33),n=_interopRequireDefault(i(433)),o=_interopRequireDefault(i(434)),a=_interopRequireDefault(i(435)),s=_interopRequireDefault(i(436)),l=_interopRequireDefault(i(437)),c=_interopRequireDefault(i(438)),u=(0,r.combineReducers)({authUser:n.default,login:o.default,logout:a.default,register:s.default,forgotPassword:l.default,resetPassword:c.default});t.default=u},433:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function authUserReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"FETCH_AUTH_USER_PENDING":return _extends({},e,{pending:!0,data:null,error:null});case"FETCH_AUTH_USER_FULFILLED":case"LOGIN_FULFILLED":return _extends({},e,{pending:!1,data:t.payload.data,error:null});case"FETCH_AUTH_USER_REJECTED":case"LOGIN_REJECTED":var i=t.payload.response,n="Error ".concat(i.status," (").concat(i.statusText,")");return i.data&&i.data.message&&(n+=" : ".concat(i.data.message)),_extends({},e,{pending:!1,data:null,error:n});case"LOGOUT_FULFILLED":return r;default:return e}};t.default=n},434:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function loginReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"LOGIN_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"LOGIN_FULFILLED":return _extends({},e,{pending:!1,error:null,data:t.payload.data});case"LOGIN_REJECTED":return _extends({},e,{pending:!1,error:"Error : Bad username or password.",data:null});case"LOGIN_RESET":return r;default:return e}};t.default=n},435:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function logoutReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"LOGOUT_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"LOGOUT_FULFILLED":return _extends({},e,{pending:!1,error:null,data:t.payload.data});case"LOGOUT_REJECTED":var i=t.payload.response,n="Error ".concat(i.status," (").concat(i.statusText,")");return i.data&&i.data.message&&(n+=" : ".concat(i.data.message)),_extends({},e,{pending:!1,data:null,error:n});default:return e}};t.default=n},436:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function registerReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;switch(arguments[1].type){case"REGISTER_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"REGISTER_FULFILLED":return _extends({},e,{pending:!1,error:null,data:"Your account was successfully created. Please check your emails to validate it."});case"REGISTER_REJECTED":return _extends({},e,{pending:!1,error:"Error creating your account. Please try again later.",data:null});case"REGISTER_RESET":return r;default:return e}};t.default=n},437:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function registerReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;switch(arguments[1].type){case"FORGOT_PASSWORD_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"FORGOT_PASSWORD_FULFILLED":return _extends({},e,{pending:!1,error:null,data:"Success : an email was sent to your address with further instructions."});case"FORGOT_PASSWORD_REJECTED":return _extends({},e,{pending:!1,error:"Error retrieving your account. Please try again later.",data:null});case"FORGOT_PASSWORD_RESET":return r;default:return e}};t.default=n},438:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function resetPasswordReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;switch(arguments[1].type){case"RESET_PASSWORD_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"RESET_PASSWORD_FULFILLED":return _extends({},e,{pending:!1,error:null,data:"Success : Your password was successfully reset."});case"RESET_PASSWORD_REJECTED":return _extends({},e,{pending:!1,error:"Error resetting your password. Please try again later.",data:null});case"RESET_PASSWORD_RESET":return r;default:return e}};t.default=n},439:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getResetPasswordState=t.getForgotPasswordState=t.getLogoutState=t.getRegisterState=t.getLoginState=t.getAuthUserState=t.isAuthUserAdmin=t.getAuthUser=void 0;t.getAuthUser=function getAuthUser(e){return e.authUser.data};t.isAuthUserAdmin=function isAuthUserAdmin(e){return e.authUser.data&&e.authUser.data.roles.indexOf("admin")>-1};t.getAuthUserState=function getAuthUserState(e){return e.authUser};t.getLoginState=function getLoginState(e){return e.login};t.getRegisterState=function getRegisterState(e){return e.register};t.getLogoutState=function getLogoutState(e){return e.logout};t.getForgotPasswordState=function getForgotPasswordState(e){return e.forgotPassword};t.getResetPasswordState=function getResetPasswordState(e){return e.resetPassword}},440:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetResetPasswordState=t.resetPassword=t.resetForgotPasswordState=t.forgotPassword=t.logout=t.resetRegisterState=t.register=t.resetLoginState=t.login=t.fetchAuthUser=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(88));t.fetchAuthUser=function fetchAuthUser(){return{type:"FETCH_AUTH_USER",payload:r.default.get("/userdrive/auth/me")}};t.login=function login(e){return{type:"LOGIN",payload:r.default.post("/userdrive/auth/login",e)}};t.resetLoginState=function resetLoginState(){return{type:"LOGIN_RESET"}};t.register=function register(e){return{type:"REGISTER",payload:r.default.post("/userdrive/auth/register",e)}};t.resetRegisterState=function resetRegisterState(){return{type:"REGISTER_RESET"}};t.logout=function logout(){return{type:"LOGOUT",payload:r.default.get("/userdrive/auth/logout")}};t.forgotPassword=function forgotPassword(e){return{type:"FORGOT_PASSWORD",payload:r.default.post("/userdrive/auth/forgot",e)}};t.resetForgotPasswordState=function resetForgotPasswordState(){return{type:"FORGOT_PASSWORD_RESET"}};t.resetPassword=function resetPassword(e,t){var i="/userdrive/auth/reset/"+t;return{type:"RESET_PASSWORD",payload:r.default.post(i,e)}};t.resetResetPasswordState=function resetResetPasswordState(){return{type:"RESET_PASSWORD_RESET"}}},459:function(e,t,i){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(460)),n=_interopRequireWildcard(i(466)),o=_interopRequireWildcard(i(209)),a=_interopRequireDefault(i(475)),s={name:"medias",reducer:r.default,selectors:n,actions:o,mapConfig:a.default};t.default=s},460:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(33),n=_interopRequireDefault(i(461)),o=_interopRequireDefault(i(462)),a=_interopRequireDefault(i(463)),s=_interopRequireDefault(i(464)),l=_interopRequireDefault(i(465)),c=(0,r.combineReducers)({layers:n.default,sources:o.default,timeline:a.default,uploadMedias:s.default,deleteMedias:l.default});t.default=c},461:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.selectedMediasLayerReducer=t.selectedMediasLayerInitialState=t.gridLayerReducer=t.gridLayerInitialState=t.mediasLayerReducer=t.mediasLayerInitialState=t.defaultLayerReducer=void 0;var r=i(33),n=function defaultLayerReducer(e){return _extends({},e,{metadata:_extends({},e.metadata,{didChange:void 0})})};t.defaultLayerReducer=n;var o={id:"medias-layer",type:"circle",source:"medias-source","source-layer":"user-space-tile-media-source",layout:{visibility:"visible"},paint:{"circle-radius":7,"circle-color":"red"},filter:["all",["has","loc"]],minzoom:13,maxzoom:24,metadata:{name:"Medias",isLocked:!0,isShown:!1,wasShownBeforeLock:!0,priority:5e3}};t.mediasLayerInitialState=o;var a=function mediasLayerReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=arguments[1];switch(t.type){case"MEDIAS_INIT_SELECTED_FULFILLED":var i=e.filter||["all"],r=t.payload.data;return _extends({},e,{filter:i.concat([["!in","_id",r.properties._id]]),metadata:_extends({},e.metadata,{didChange:{filter:!0}})});case"MEDIAS_CLICK":case"MEDIAS_SELECT_BY_ID":var a=e.filter||["all"];t.payload.isAdmin&&t.payload.ctrlKey||(a=a.filter(function(e){return-1===e.indexOf("_id")}));var s;s=t.payload.features?t.payload.features.map(function(e){return e.properties._id}):[t.payload.mediaId];var l=["!in","_id"].concat(s);return a=a.concat([l]),_extends({},e,{filter:a,metadata:_extends({},e.metadata,{didChange:{filter:!0}})});case"TOGGLE_LAYER":if(t.payload.layerId===e.id){var c={visibility:e.metadata.isShown?"none":"visible"};return _extends({},e,{layout:c,metadata:_extends({},e.metadata,{isShown:!e.metadata.isShown,wasShownBeforeLock:!e.metadata.isShown,didChange:{layout:c}})})}return n(e);case"MEDIAS_GRID_UPDATE_FEATURES":var u=t.payload.features.reduce(function(e,t){return e+t.properties.allMediaCount},0),h=e.metadata.isLocked,d=e.metadata.wasShownBeforeLock,p=t.payload.zoom<=14&&u>2e3;if(!p&&!h){var f=e.minzoom;return _extends({},e,{metadata:_extends({},e.metadata,{didChange:{zoom:!0}}),minzoom:Math.min(f,parseInt(t.payload.zoom))})}if(!p&&h){var m=(e.filter||["all"]).filter(function(e){return-1===e.indexOf("loc")}),g={"circle-opacity":1};return _extends({},e,{metadata:_extends({},e.metadata,{isShown:d,isLocked:!1,didChange:{filter:!0,zoom:!0,paint:g}}),filter:m,minzoom:Math.min(parseInt(t.payload.zoom),14),paint:_extends({},e.paint,g)})}if(p&&!h){var v=["has","loc"],y=e.filter||["all"],b={"circle-opacity":0};return _extends({},e,{metadata:_extends({},e.metadata,{isShown:!1,wasShownBeforeLock:e.metadata.isShown,isLocked:!0,didChange:{filter:!0,zoom:!0,paint:b}}),filter:y.concat([v]),minzoom:13,paint:_extends({},e.paint,b)})}return n(e);case"MEDIAS_TIMELINE_UPDATE":var x=(e.filter||["all"]).filter(function(e){return-1===e.indexOf("date")}),w=["<=","date",t.payload.value];return _extends({},e,{filter:x.concat([w]),metadata:_extends({},e.metadata,{didChange:{filter:!0}})});default:return n(e)}};t.mediasLayerReducer=a;var s={id:"grid-medias-layer",type:"fill",source:"grid-medias-source","source-layer":"user-space-grid-tile-media-source",layout:{visibility:"visible"},paint:{"fill-color":"#c53a4f","fill-outline-color":"rgba(0, 0, 0, 0.3)","fill-opacity":{property:"allMediaOpacity",type:"exponential",stops:[[0,0],[1,.2],[100,.8]]}},minzoom:0,maxzoom:24,metadata:{name:"Medias Grid",isLocked:!1,isShown:!0,wasShownBeforeLock:!0,priority:4e3,before:"medias-layer"}};t.gridLayerInitialState=s;var l=function gridLayerReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments[1];switch(t.type){case"TOGGLE_LAYER":if(t.payload.layerId===e.id){var i={"fill-opacity":_extends({},e.paint["fill-opacity"],{property:e.metadata.isShown?"zeroMediaOpacity":"allMediaOpacity"})};return _extends({},e,{paint:_extends({},e.paint,i),metadata:_extends({},e.metadata,{isShown:!e.metadata.isShown,didChange:{paint:i}})})}return n(e);case"MEDIAS_TIMELINE_UPDATE":var r=(e.filter||["all"]).filter(function(e){return-1===e.indexOf("minDate")}),o=["<=","minDate",t.payload.value];return _extends({},e,{filter:r.concat([o]),metadata:_extends({},e.metadata,{didChange:{filter:!0}})});default:return n(e)}};t.gridLayerReducer=l;var c={id:"selected-medias-layer",type:"circle",source:"selected-medias-source",layout:{visibility:"visible"},paint:{"circle-radius":8,"circle-color":"blue"},metadata:{name:"Selected Medias",isLocked:!1,isShown:!0,wasShownBeforeLock:!0,priority:6e3}};t.selectedMediasLayerInitialState=c;var u=function selectedMediasLayerReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,t=arguments[1];switch(t.type){case"TOGGLE_LAYER":if(t.payload.layerId===e.id){var i={visibility:e.metadata.isShown?"none":"visible"};return _extends({},e,{layout:i,metadata:_extends({},e.metadata,{isShown:!e.metadata.isShown,didChange:{layout:i}})})}return n(e);default:return n(e)}};t.selectedMediasLayerReducer=u;var h=(0,r.combineReducers)({"medias-layer":a,"grid-medias-layer":l,"selected-medias-layer":u});t.default=h},462:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.sourcesInitialState=t.selectedMediasSourceReducer=t.selectedMediasSourceInitialState=t.gridMediasSourceReducer=t.gridMediasSourceInitialState=t.mediasSourceReducer=t.mediasSourceInitialState=t.defaultSourceReducer=void 0;var r="null"!==window.location.origin?window.location.origin:"http://localhost:8080",n=function defaultSourceReducer(e){return _extends({},e,{metadata:_extends({},e.metadata,{didChange:!1})})};t.defaultSourceReducer=n;var o={type:"vector",tiles:["".concat(r,"/userdrive/tile/{z}/{x}/{y}.pbf")],metadata:{loaded:!1,renderedFeatures:[],didChange:!1}};t.mediasSourceInitialState=o;var a=function mediasSourceReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=arguments[1];switch(t.type){case"MEDIAS_UPDATE_FEATURES":return _extends({},e,{metadata:_extends({},e.metadata,{loaded:!0,renderedFeatures:t.payload.features,didChange:!1})});case"LOGOUT_FULFILLED":case"FETCH_USER_FULFILLED":case"LOGIN_FULFILLED":case"MEDIAS_MAP_END_DRAG_FULFILLED":return _extends({},e,{metadata:_extends({},e.metadata,{didChange:!0})});case"MEDIAS_UPLOAD_FULFILLED":case"MEDIAS_DELETE_FULFILLED":return t.payload.data.length>0?_extends({},e,{metadata:_extends({},e.metadata,{didChange:!0})}):n(e);default:return n(e)}};t.mediasSourceReducer=a;var s={type:"vector",tiles:["".concat(r,"/userdrive/tile/grid/{z}/{x}/{y}.pbf")],metadata:{loaded:!1,renderedFeatures:[],didChange:!1}};t.gridMediasSourceInitialState=s;var l=function gridMediasSourceReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments[1];switch(t.type){case"MEDIAS_GRID_UPDATE_FEATURES":return _extends({},e,{metadata:_extends({},e.metadata,{loaded:!0,renderedFeatures:t.payload.features,didChange:!1})});case"LOGOUT_FULFILLED":case"FETCH_USER_FULFILLED":case"LOGIN_FULFILLED":case"MEDIAS_MAP_END_DRAG_FULFILLED":return _extends({},e,{metadata:_extends({},e.metadata,{didChange:!0})});case"MEDIAS_UPLOAD_FULFILLED":case"MEDIAS_DELETE_FULFILLED":return t.payload.data.length>0?_extends({},e,{metadata:_extends({},e.metadata,{didChange:!0})}):n(e);default:return n(e)}};t.gridMediasSourceReducer=l;var c={type:"geojson",data:{type:"FeatureCollection",features:[]},metadata:{didChange:!1,selectFilterPending:!1,stillFiltered:[]}};t.selectedMediasSourceInitialState=c;var u=function selectedMediasSourceReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,t=arguments[1];switch(t.type){case"MEDIAS_INIT_SELECTED_FULFILLED":var i=t.payload.data;return _extends({},e,{data:_extends({},e.data,{features:[i]}),metadata:_extends({},e.metadata,{didChange:!0})});case"MEDIAS_CLICK":case"MEDIAS_SELECT_BY_ID":var r=[];t.payload.isAdmin&&t.payload.ctrlKey&&(r=r.concat(e.data.features)),r=r.concat(t.payload.features);var o=[];return o=e.metadata.selectFilterPending?e.metadata.stillFiltered:e.data.features,_extends({},e,{data:_extends({},e.data,{features:r}),metadata:_extends({},e.metadata,{didChange:!0,selectFilterPending:!0,stillFiltered:o})});case"MEDIAS_UPDATE_FEATURES":return e.metadata.selectFilterPending?_extends({},e,{metadata:_extends({},e.metadata,{didChange:!1,selectFilterPending:!1,stillFiltered:[]})}):n(e);case"MEDIAS_MAP_START_DRAG":return t.payload.isAdmin?_extends({},e,{metadata:_extends({},e.metadata,{draggingFeatureId:t.payload.features[0].properties._id})}):n(e);case"MEDIAS_MAP_DRAG":if(e.metadata.draggingFeatureId&&t.payload.isAdmin){var a=t.payload.lat,s=t.payload.lng,l=e.data.features.map(function(t){return t.properties._id===e.metadata.draggingFeatureId?_extends({},t,{geometry:_extends({},t.geometry,{coordinates:[s,a]})}):t});return _extends({},e,{data:_extends({},e.data,{features:l}),metadata:_extends({},e.metadata,{didChange:!0})})}return n(e);case"MEDIAS_MAP_END_DRAG_PENDING":return _extends({},e,{metadata:_extends({},e.metadata,{draggingFeatureId:null,didChange:!1})});case"MEDIAS_MAP_END_DRAG_FULFILLED":return _extends({},e,{metadata:_extends({},e.metadata,{didChange:!0})});case"MEDIAS_DELETE_FULFILLED":if(t.payload.data.length>0){var u=t.payload.data.map(function(e){return e.properties._id}),h=e.data.features.filter(function(e){return-1===u.indexOf(e.properties._id)});return _extends({},e,{data:_extends({},e.data,{features:h}),metadata:_extends({},e.metadata,{didChange:!0})})}return n(e);default:return n(e)}};t.selectedMediasSourceReducer=u;var h={"medias-source":o,"selected-medias-source":c,"grid-medias-source":s};t.sourcesInitialState=h;t.default=function _default(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments[1];switch(t.type){case"MEDIAS_SELECT_BY_ID":var i=e["medias-source"].metadata.renderedFeatures.find(function(e){return e.properties._id===t.payload.mediaId});return t.payload.features=[i],{"medias-source":a(e["medias-source"],t),"selected-medias-source":u(e["selected-medias-source"],t),"grid-medias-source":l(e["grid-medias-source"],t)};default:return{"medias-source":a(e["medias-source"],t),"selected-medias-source":u(e["selected-medias-source"],t),"grid-medias-source":l(e["grid-medias-source"],t)}}}},463:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function timelineReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=arguments[1];switch(t.type){case"MEDIAS_TIMELINE_UPDATE":return t.payload.value;default:return e}};t.default=r},464:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function uploadMediasReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"MEDIAS_UPLOAD_PENDING":return _extends({},e,{pending:t.payload.index,error:null,data:null});case"MEDIAS_UPLOAD_FULFILLED":return _extends({},e,{pending:!1,error:t.payload.error,data:t.payload.data});case"RESET_MEDIAS_UPLOAD":return r;default:return e}};t.default=n},465:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function deleteMediasReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"MEDIAS_DELETE_PENDING":return _extends({},e,{pending:t.payload.index,error:null,data:null});case"MEDIAS_DELETE_FULFILLED":return _extends({},e,{pending:!1,error:t.payload.error,data:t.payload.data});case"RESET_MEDIAS_DELETE":return r;default:return e}};t.default=n},466:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSourcesState=t.getLayersState=t.getDeleteMediasState=t.getUploadMediasState=t.areMediasLocked=t.getSelectFilterPending=t.getTimelineValue=t.getMediasMinDate=t.getViewportMediaCount=t.getSelectedMedias=t.getVisibleMedias=void 0;t.getVisibleMedias=function getVisibleMedias(e){var t,i=e.sources["medias-source"].metadata.renderedFeatures.map(function(e){var t=Object.assign(Object.create(Object.getPrototypeOf(e)),e);return t.properties.selected=!1,t}),r=e.sources["selected-medias-source"].data.features.map(function(e){return e.properties._id});if(e.sources["selected-medias-source"].metadata.selectFilterPending){var n=e.sources["selected-medias-source"].metadata.stillFiltered.map(function(e){var t=Object.assign(Object.create(Object.getPrototypeOf(e)),e);return t.properties.selected=!1,t});t=i.concat(n)}else{var o=e.sources["selected-medias-source"].data.features.map(function(e){return Object.assign(Object.create(Object.getPrototypeOf(e)),e)});t=i.concat(o)}return t=t.map(function(e){return r.indexOf(e.properties._id)>-1&&(e.properties.selected=!0),e}).sort(function(e,t){return e.properties.date===t.properties.date?e.properties.name?e.properties.name.localeCompare(t.properties.name):1:e.properties.date-t.properties.date})};t.getSelectedMedias=function getSelectedMedias(e){return e.sources["selected-medias-source"].data.features};t.getViewportMediaCount=function getViewportMediaCount(e){if(!e.layers["medias-layer"].metadata.isLocked&&e.sources["medias-source"].metadata.renderedFeatures.length>0)return e.sources["medias-source"].metadata.renderedFeatures.length+e.sources["selected-medias-source"].data.features.length;return"~"+e.sources["grid-medias-source"].metadata.renderedFeatures.reduce(function(e,t){return e+t.properties.allMediaCount},0).toString()};t.getMediasMinDate=function getMediasMinDate(e){return!e.layers["medias-layer"].metadata.isLocked&&e.sources["medias-source"].metadata.renderedFeatures.length>0?e.sources["medias-source"].metadata.renderedFeatures.reduce(function(e,t){return Math.min(e,new Date(t.properties.date).getTime())},Date.now()):e.sources["grid-medias-source"].metadata.renderedFeatures.reduce(function(e,t){return Math.min(e,new Date(t.properties.minDate).getTime())},Date.now())};t.getTimelineValue=function getTimelineValue(e){return e.timeline};t.getSelectFilterPending=function getSelectFilterPending(e){return e.sources["selected-medias-source"].metadata.selectFilterPending};t.areMediasLocked=function areMediasLocked(e){return e.layers["medias-layer"].metadata.isLocked};t.getUploadMediasState=function getUploadMediasState(e){return e.uploadMedias};t.getDeleteMediasState=function getDeleteMediasState(e){return e.deleteMedias};t.getLayersState=function getLayersState(e){return{pending:!1,error:null,data:e.layers}};t.getSourcesState=function getSourcesState(e){return{pending:!1,error:null,data:e.sources}}},475:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(209),n={click:[{layerIds:["medias-layer"],action:r.clickMedias}],dragndrop:[{layerId:"selected-medias-layer",mousedown:r.startDragMapMedias,mousemove:r.dragMapMedias,mouseup:r.endDragMapMedias}],renderedFeatures:[{layerIds:["medias-layer"],source:"medias-source",uniqueKey:"_id",action:r.updateFeaturesMedias},{layerIds:["grid-medias-layer"],source:"grid-medias-source",uniqueKey:"quadkey",action:r.updateFeaturesGridMedias}],events:[]};t.default=n},476:function(e,t,i){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(477)),n=_interopRequireWildcard(i(478)),o=_interopRequireWildcard(i(479)),a={name:"rastertiles",reducer:r.default,selectors:n,actions:o};t.default=a},477:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r=i(58),n="null"!==window.location.origin?window.location.origin:"http://localhost:8080",o={pending:!1,error:null,layers:null,sources:null};t.initialState=o;var a=function rastertilesReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=arguments[1];switch(t.type){case"FETCH_RASTERTILESETS_PENDING":return _extends({},e,{pending:!0,error:null,layers:null,sources:null});case"FETCH_RASTERTILESETS_FULFILLED":var i=function _formatTilesData(e){var t={},i={};return e.map(function(e){var r=e._id+"-source",o=e._id+"-layer",a="".concat(n,"/map/rastertile/").concat(e._id,"/{z}/{x}/{y}");t[r]={type:"raster",tiles:[a],tileSize:e.tileSize||256,minzoom:e.minzoom||10,maxzoom:e.maxzoom||22,bounds:e.bounds},i[o]={id:o,type:"raster",source:r,minzoom:e.minzoom||10,maxzoom:e.maxzoom||22,layout:{visibility:"visible"},metadata:{name:e.name,bounds:e.bounds,isShown:!0,isInBounds:!1,priority:e.priority||0}}}),{sources:t,layers:i}}(t.payload.data);return _extends({},e,{pending:!1,sources:i.sources,layers:i.layers});case"FETCH_RASTERTILESETS_REJECTED":var a=t.payload.response,s="Error ".concat(a.status," (").concat(a.statusText,")");return a.data&&a.data.message&&(s+=" : ".concat(a.data.message)),_extends({},e,{pending:!1,sources:null,layers:null,error:s});case"TOGGLE_LAYER":if(e.layers[t.payload.layerId]){var l=e.layers[t.payload.layerId],c=l.metadata.isShown,u={visibility:c?"none":"visible"},h=_extends({},l,{layout:u,metadata:_extends({},l.metadata,{isShown:!c,didChange:{layout:u}})});return _extends({},e,{layers:_extends({},e.layers,function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},t.payload.layerId,h))})}return e;case"UPDATE_WORLD_STATE":var d=t.payload.bounds,p={};return(0,r.forIn)(e.layers,function(e,t){p[t]=_extends({},e,{metadata:_extends({},e.metadata,{isInBounds:function _boundsIntersect(e,t){var i=!(e[2]<t[0]||e[0]>t[2]),r=!(e[3]<t[1]||e[1]>t[3]);return i&&r}(e.metadata.bounds,d)})})}),_extends({},e,{layers:p});default:return e}};t.default=a},478:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSourcesState=t.getLayersState=t.getRasterLayersInBounds=void 0;var r=i(58);t.getRasterLayersInBounds=function getRasterLayersInBounds(e){var t={};return(0,r.forIn)(e.layers,function(e,i){e.metadata.isInBounds&&(t[i]=e)}),t};t.getLayersState=function getLayersState(e){return{pending:e.pending,error:e.error,data:e.layers}};t.getSourcesState=function getSourcesState(e){return{pending:e.pending,error:e.error,data:e.sources}}},479:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchRastertilesets=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(88));t.fetchRastertilesets=function fetchRastertilesets(){return{type:"FETCH_RASTERTILESETS",payload:r.default.get("/map/rastertile")}}},480:function(e,t,i){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(481)),n=_interopRequireWildcard(i(487)),o=_interopRequireWildcard(i(488)),a={name:"users",reducer:r.default,selectors:n,actions:o};t.default=a},481:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(33),n=_interopRequireDefault(i(482)),o=_interopRequireDefault(i(483)),a=_interopRequireDefault(i(484)),s=_interopRequireDefault(i(485)),l=_interopRequireDefault(i(486)),c=(0,r.combineReducers)({usersList:n.default,currentUser:o.default,createUser:a.default,updateUser:s.default,deleteUsers:l.default});t.default=c},482:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function usersListReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"FETCH_USERS_LIST_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"FETCH_USERS_LIST_FULFILLED":return _extends({},e,{pending:!1,error:null,data:t.payload.data});case"FETCH_USERS_LIST_REJECTED":var i=t.payload.response,n="Error ".concat(i.status," (").concat(i.statusText,")");return i.data&&i.data.message&&(n+=" : ".concat(i.data.message)),_extends({},e,{pending:!1,data:null,error:n});case"CREATE_USER_FULFILLED":return _extends({},e,{data:e.data.concat(t.payload.data)});case"UPDATE_USER_FULFILLED":var o=t.payload.data;return _extends({},e,{data:e.data.map(function(e){return e._id===o._id?o:e})});case"DELETE_USERS_FULFILLED":var a=t.payload.data;return _extends({},e,{data:e.data.filter(function(e){return-1===a.indexOf(e._id)})});default:return e}};t.default=n},483:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function currentUserReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"FETCH_USER_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"FETCH_USER_FULFILLED":return _extends({},e,{pending:!1,error:null,data:t.payload.data});case"FETCH_USER_REJECTED":var i=t.payload.response,n="Error ".concat(i.status," (").concat(i.statusText,")");return i.data&&i.data.message&&(n+=" : ".concat(i.data.message)),_extends({},e,{pending:!1,data:null,error:n});default:return e}};t.default=n},484:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function createUserReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"CREATE_USER_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"CREATE_USER_FULFILLED":return _extends({},e,{pending:!1,error:null,data:t.payload.data});case"CREATE_USER_REJECTED":var i=t.payload.response,n="Error ".concat(i.status," (").concat(i.statusText,")");return i.data&&i.data.message&&(n+=" : ".concat(i.data.message)),_extends({},e,{pending:!1,data:null,error:n});case"RESET_CREATE_STATE":return r;default:return e}};t.default=n},485:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function udpateUserReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"UPDATE_USER_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"UPDATE_USER_FULFILLED":return _extends({},e,{pending:!1,error:null,data:t.payload.data});case"UPDATE_USER_REJECTED":var i=t.payload.response,n="Error ".concat(i.status," (").concat(i.statusText,")");return i.data&&i.data.message&&(n+=" : ".concat(i.data.message)),_extends({},e,{pending:!1,data:null,error:n});case"RESET_UPDATE_STATE":return r;default:return e}};t.default=n},486:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.initialState=void 0;var r={pending:!1,data:null,error:null};t.initialState=r;var n=function deleteUsersReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"DELETE_USERS_PENDING":return _extends({},e,{pending:!0,error:null,data:null});case"DELETE_USERS_FULFILLED":return _extends({},e,{pending:!1,error:null,data:t.payload.data});case"DELETE_USERS_REJECTED":var i=t.payload.response,n="Error ".concat(i.status," (").concat(i.statusText,")");return i.data&&i.data.message&&(n+=" : ".concat(i.data.message)),_extends({},e,{pending:!1,data:null,error:n});case"RESET_DELETE_STATE":return r;default:return e}};t.default=n},487:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUsersList=function getUsersList(e){return e.usersList.data},t.getUsersListState=function getUsersListState(e){return e.usersList},t.getCurrentUser=function getCurrentUser(e){return e.currentUser.data},t.getCurrentUserState=function getCurrentUserState(e){return e.currentUser},t.getCreateUserState=function getCreateUserState(e){return e.createUser},t.getUpdateUserState=function getUpdateUserState(e){return e.updateUser},t.getDeleteUsersState=function getDeleteUsersState(e){return e.deleteUsers}},488:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchUsersList=function fetchUsersList(){return{type:"FETCH_USERS_LIST",payload:r.default.get("/userdrive/users")}},t.createUser=function createUser(e){return{type:"CREATE_USER",payload:r.default.post("/userdrive/users",e)}},t.resetCreateState=function resetCreateState(){return{type:"RESET_CREATE_STATE"}},t.fetchUser=function fetchUser(e){return{type:"FETCH_USER",payload:r.default.get("/userdrive/users/"+e)}},t.updateUser=function updateUser(e,t){return{type:"UPDATE_USER",payload:r.default.put("/userdrive/users/"+t,e)}},t.resetUpdateState=function resetUpdateState(){return{type:"RESET_UPDATE_STATE"}},t.deleteUsers=function deleteUsers(e){return{type:"DELETE_USERS",payload:new Promise(function(t){e.reduce(function(e,t){return e.then(function(){return function _deleteUser(e){return r.default.delete("/userdrive/users/"+e)}(t)})},Promise.resolve()).then(function(){return t({data:e})})})}},t.resetDeleteState=function resetDeleteState(){return{type:"RESET_DELETE_STATE"}};var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(88))},489:function(e,t,i){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(490)),n=_interopRequireWildcard(i(491)),o=_interopRequireWildcard(i(211)),a=_interopRequireDefault(i(492)),s={name:"world",reducer:r.default,selectors:n,actions:o,mapConfig:a.default};t.default=s},490:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.defaultReducer=t.initialState=void 0;var r={lng:0,lat:0,zoom:0,previewMode:!1,shouldMapResize:!1};t.initialState=r;var n=function defaultReducer(e){return _extends({},e,{shouldMapResize:!1})};t.defaultReducer=n;var o=function worldReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1];switch(t.type){case"UPDATE_WORLD_STATE":return _extends({},e,{lat:t.payload.lat,lng:t.payload.lng,zoom:t.payload.zoom,bounds:t.payload.bounds,shouldMapResize:!1});case"RESIZE_MAP":return _extends({},e,{shouldMapResize:!0});case"SWITCH_PREVIEW_MODE":return _extends({},e,{previewMode:!e.previewMode,shouldMapResize:!0});default:return n(e)}};t.default=o},491:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMapPreviewMode=t.getRootUrl=void 0;t.getRootUrl=function getRootUrl(e){return"/"+[e.lng,e.lat,e.zoom].join(",")};t.getMapPreviewMode=function getMapPreviewMode(e){return e.previewMode}},492:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={events:[{type:"moveend",layer:null,action:i(211).updateWorldState}],click:[],dragndrop:[],renderedFeatures:[]};t.default=r},493:function(e,t,i){"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(494)),n=_interopRequireWildcard(i(498)),o=_interopRequireWildcard(i(212)),a=_interopRequireDefault(i(499)),s={name:"potree",reducer:r.default,selectors:n,actions:o,mapConfig:a.default};t.default=s},494:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(33),n=_interopRequireDefault(i(495)),o=_interopRequireDefault(i(496)),a=_interopRequireDefault(i(497)),s=(0,r.combineReducers)({layers:n.default,sources:o.default,pointCloud:a.default});t.default=s},495:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pointCloudsLayerReducer=t.pointCloudsLayerInitialState=t.defaultLayerReducer=void 0;var r=i(33),n=function defaultLayerReducer(e){return _extends({},e,{metadata:_extends({},e.metadata,{didChange:void 0})})};t.defaultLayerReducer=n;var o={id:"pointClouds-layer",type:"fill",source:"pointClouds-source",layout:{visibility:"visible"},paint:{"fill-outline-color":"#22a37a ","fill-color":"#22a37a ","fill-opacity":.6},metadata:{name:"Pointcloud",isLocked:!1,isShown:!0,wasShownBeforeLock:!0}};t.pointCloudsLayerInitialState=o;var a=function pointCloudsLayerReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=arguments[1];switch(t.type){case"POINTCLOUDS_INIT_SELECTED_FULFILLED":return n(e);case"POINTCLOUDS_CLICK":return _extends({},e,{metadata:_extends({},e.metadata,{didChange:{}})});case"TOGGLE_LAYER":if(t.payload.layerId===e.id){var i={visibility:e.metadata.isShown?"none":"visible"};return _extends({},e,{layout:i,metadata:_extends({},e.metadata,{isShown:!e.metadata.isShown,wasShownBeforeLock:!e.metadata.isShown,didChange:{layout:i}})})}return n(e);case"POINTCLOUDS_UPDATE_FEATURES":case"POINTCLOUDS_GRID_UPDATE_FEATURES":case"POINTCLOUDS_TIMELINE_UPDATE":default:return n(e)}};t.pointCloudsLayerReducer=a;var s=(0,r.combineReducers)({"pointClouds-layer":a});t.default=s},496:function(e,t,i){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pointCloudsSourceReducer=t.pointCloudsSourceInitialState=t.defaultSourceReducer=void 0;var r=i(33),n="null"!==window.location.origin?window.location.origin:"http://localhost:8080",o=function defaultSourceReducer(e){return _extends({},e,{metadata:_extends({},e.metadata,{didChange:!1})})};t.defaultSourceReducer=o;var a={type:"geojson",data:"".concat(n,"/potreeviewer/potreedataset"),metadata:{didChange:!1,selectFilterPending:!1,stillFiltered:[]}};t.pointCloudsSourceInitialState=a;var s=function pointCloudsSourceReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;switch(arguments[1].type){case"LOGOUT_FULFILLED":case"FETCH_USER_FULFILLED":case"LOGIN_FULFILLED":case"POINTCLOUDS_UPLOAD_FULFILLED":case"POINTCLOUDS_DELETE_FULFILLED":case"POINTCLOUDS_MAP_END_DRAG_FULFILLED":default:return o(e)}};t.pointCloudsSourceReducer=s;var l=(0,r.combineReducers)({"pointClouds-source":s});t.default=l},497:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function potreeReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments[1];switch(t.type){case"POINTCLOUD_CLICK":return t.payload.features.length?Object.assign({},e,{metaData:t.payload.features.length?t.payload.features[0].properties:null}):null;default:return e}};t.default=r},498:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelectedPointCloud=t.getSourcesState=t.getLayersState=void 0;t.getLayersState=function getLayersState(e){return{pending:!1,error:null,data:e.layers}};t.getSourcesState=function getSourcesState(e){return{pending:!1,error:null,data:e.sources}};t.getSelectedPointCloud=function getSelectedPointCloud(e){return e.pointCloud}},499:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={click:[{layerIds:["pointClouds-layer"],action:i(212).clickPointCloud}],dragndrop:[],renderedFeatures:[],events:[]};t.default=r},500:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(59),o=_interopRequireDefault(i(520)),a=_interopRequireDefault(i(706)),s=_interopRequireDefault(i(712)),l=_interopRequireDefault(i(844)),c=function App(){return r.default.createElement(n.HashRouter,null,r.default.createElement(n.Switch,null,r.default.createElement(n.Route,{path:"/admin*",component:o.default}),r.default.createElement(n.Route,{path:"/:loc",component:function component(){return r.default.createElement("div",null,r.default.createElement(n.Route,{path:"/:loc/auth",component:a.default}),r.default.createElement(s.default,null),r.default.createElement(l.default,null))}}),r.default.createElement(n.Redirect,{to:"/21,6,1"})))};t.default=c},52:function(e,t,i){var r=i(704);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},520:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(521)).default;t.default=r},521:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=i(59),a=i(225),s=_interopRequireDefault(i(1)),l=i(12),c=_interopRequireDefault(i(696)),u=_interopRequireDefault(i(158)),h=l.actions.fetchAuthUser,d=l.selectors.getAuthUserState,p=function(e){function Admin(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Admin),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Admin.__proto__||Object.getPrototypeOf(Admin)).call(this,e)),t.handleTabChange=t.handleTabChange.bind(t),t.state={authorized:!1},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Admin,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Admin,[{key:"componentDidMount",value:function componentDidMount(){this.props.dispatch(h())}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){if(!e.authUserState.pending&&this.props.authUserState.pending)if(e.authUserState.data&&e.authUserState.data.roles.indexOf("admin")>-1){var t;this.props.location.pathname.indexOf("/admin/users")>-1?t=0:this.props.location.pathname.indexOf("/admin/test")>-1?t=1:(t=0,this.props.history.replace("/admin/users")),this.setState({authorized:!0,index:t})}else this.setState({authorized:!1})}},{key:"handleTabChange",value:function handleTabChange(e){switch(this.setState({index:e}),e){case 0:this.props.history.push("/admin/users");break;case 1:this.props.history.push("/admin/test")}}},{key:"render",value:function render(){return this.props.authUserState.pending?r.default.createElement("div",null,"Loading..."):this.state.authorized?r.default.createElement("div",{className:u.default.adminPanel},r.default.createElement("h1",{className:u.default.adminTitle},"Admin"),r.default.createElement(a.Tabs,{className:u.default.adminTabs,index:this.state.index,onChange:this.handleTabChange,theme:{navigationContainer:u.default.adminNavigationContainer,tab:u.default.adminTab}},r.default.createElement(a.Tab,{label:"Users"},r.default.createElement(o.Route,{path:"/admin/users",component:c.default})),r.default.createElement(a.Tab,{label:"Test"},r.default.createElement(o.Route,{path:"/admin/test",component:function component(){return r.default.createElement("div",null,"TEST")}})))):r.default.createElement("div",null,"Forbidden")}}]),Admin}();p.propTypes={authUserState:s.default.shape({pending:s.default.bool,data:s.default.object,error:s.default.string}).isRequired,dispatch:s.default.func.isRequired,history:s.default.object.isRequired,location:s.default.object.isRequired,match:s.default.object};var f=(0,n.connect)(function(e){return{authUserState:d(e)}})(p);t.default=f},64:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(59),o=_interopRequireDefault(i(21)),a=_interopRequireDefault(i(47)),s=_interopRequireDefault(i(245)),l=i(58),c=_interopRequireDefault(i(1)),u=_interopRequireDefault(i(52)),h=function(e){function Form(e){var t;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Form),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Form.__proto__||Object.getPrototypeOf(Form)).call(this,e));var i={fieldValues:{},formErrors:{},validFields:{},formValid:!1,submitted:!1};return(0,l.forIn)(t.props.fields,function(e,t){if(e.value){i.fieldValues[t]=e.value;var r=e.validate(e.value);i.formErrors[t]=r.error,i.validFields[t]=r.isValid}else i.fieldValues[t]="",i.formErrors[t]="",i.validFields[t]=!1}),t.state=i,t.handleKeyPress=t.handleKeyPress.bind(t),t.submit=t.submit.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Form,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Form,[{key:"componentDidMount",value:function componentDidMount(){this.validateForm(),document.addEventListener("keypress",this.handleKeyPress)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){this.state.submitted&&e.error&&this.setState({submitted:!1})}},{key:"componentWillUnmount",value:function componentWillUnmount(){document.removeEventListener("keypress",this.handleKeyPress)}},{key:"handleUserInput",value:function handleUserInput(e,t){var i=Object.assign({},this.state.fieldValues,_defineProperty({},e,t));this.setState({fieldValues:i},this.validateField(e,t))}},{key:"handleKeyPress",value:function handleKeyPress(e){13===e.keyCode&&this.state.formValid&&this.submit()}},{key:"submit",value:function submit(){this.setState({submitted:!0,error:null,success:null}),this.props.submit(this.state.fieldValues)}},{key:"validateField",value:function validateField(e,t){var i,r;if(this.props.fields[e].refValue){var n=this.state.fieldValues[this.props.fields[e].refValue],o=this.props.fields[e].validate(t,n);i=o.isValid,r=o.error}else{var a=this.props.fields[e].validate(t);i=a.isValid,r=a.error}var s=Object.assign({},this.state.formErrors,_defineProperty({},e,r)),l=Object.assign({},this.state.validFields,_defineProperty({},e,i));this.setState({formErrors:s,validFields:l},this.validateForm)}},{key:"validateForm",value:function validateForm(){var e=this,t=!0;(0,l.forIn)(this.props.fields,function(i,r){t=t&&e.state.validFields[r]}),this.setState({formValid:t})}},{key:"render",value:function render(){var e=this,t=[];(0,l.forIn)(this.props.fields,function(i,n){"dropdown"===i.type?t.push(r.default.createElement(s.default,{key:n,auto:!0,label:i.label,name:n,source:i.options,value:e.state.fieldValues[n],onChange:e.handleUserInput.bind(e,n),style:{width:"250px"}})):t.push(r.default.createElement(a.default,{key:n,type:i.type,label:i.label,name:n,required:i.required,value:e.state.fieldValues[n],error:e.state.formErrors[n],onChange:e.handleUserInput.bind(e,n),style:{width:"250px"}}))});var i=r.default.createElement("div",null);return this.props.links&&(i=this.props.links.map(function(e,t){return r.default.createElement(n.Link,{key:"link-".concat(t),to:e.to},e.text)})),r.default.createElement("div",{className:u.default.formDialog},r.default.createElement("div",{className:u.default.formDialogContent},this.props.error&&r.default.createElement("div",{className:u.default.formDialogError},this.props.error),this.props.success&&r.default.createElement("div",{className:u.default.formDialogSuccess},this.props.success),!this.props.success&&this.props.helper&&r.default.createElement("div",{className:u.default.formDialogHelper},this.props.helper),r.default.createElement("div",{className:u.default.formDialogForm},t),r.default.createElement("div",{className:u.default.formDialogLinks},i)),r.default.createElement("div",{className:u.default.formDialogActions},r.default.createElement(o.default,{primary:!0,id:"submit-button",disabled:!this.state.formValid||this.state.submitted,onClick:this.submit},"Submit"),r.default.createElement(o.default,{onClick:this.props.cancel},"Cancel")))}}]),Form}();h.propTypes={cancel:c.default.func.isRequired,error:c.default.string,fields:c.default.objectOf(c.default.shape({label:c.default.string.isRequired,type:c.default.string.isRequired,required:c.default.boolean,refValue:c.default.string,validate:c.default.func.isRequired})).isRequired,helper:c.default.string,links:c.default.arrayOf(c.default.shape({to:c.default.string,text:c.default.string})),submit:c.default.func.isRequired,success:c.default.string};var d=h;t.default=d},696:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(697)).default;t.default=r},697:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(59),o=_interopRequireDefault(i(1)),a=_interopRequireDefault(i(698)),s=_interopRequireDefault(i(701)),l=_interopRequireDefault(i(705)),c=function(e){function Users(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Users),function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Users.__proto__||Object.getPrototypeOf(Users)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Users,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Users,[{key:"render",value:function render(){return r.default.createElement("div",null,r.default.createElement(a.default,null),r.default.createElement(n.Switch,{key:this.props.location.pathname,location:this.props.location},r.default.createElement(n.Route,{path:"/admin/users/create",component:s.default}),r.default.createElement(n.Route,{path:"/admin/users/edit/:userId",component:l.default})))}}]),Users}();c.propTypes={history:o.default.object,location:o.default.object.isRequired,match:o.default.object};var u=c;t.default=u},698:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(1)),a=i(59),s=i(263),l=i(21),c=_interopRequireDefault(i(157)),u=i(12),h=_interopRequireDefault(i(699)),d=_interopRequireDefault(i(158)),p=(0,c.default)(l.Button),f=u.actions.fetchUsersList,m=u.actions.resetDeleteState,g=u.selectors.getUsersListState,v=function(e){function UsersTable(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,UsersTable),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(UsersTable.__proto__||Object.getPrototypeOf(UsersTable)).call(this,e)),t.state={selected:[],confirmDelete:!1,confirmDeleteUsers:[]},t.handleUserSelect=t.handleUserSelect.bind(t),t.toggleDeleteConfirmation=t.toggleDeleteConfirmation.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(UsersTable,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(UsersTable,[{key:"componentDidMount",value:function componentDidMount(){this.props.dispatch(f())}},{key:"handleUserSelect",value:function handleUserSelect(e){var t=this,i=e.map(function(e){return t.props.usersListState.data[e]._id});this.setState({selected:i})}},{key:"toggleDeleteConfirmation",value:function toggleDeleteConfirmation(e){var t=e&&e._id?[e._id]:this.state.selected;this.props.dispatch(m()),this.setState({confirmDelete:!this.state.confirmDelete,confirmDeleteUsers:t})}},{key:"render",value:function render(){var e=this;return this.props.usersListState.pending?r.default.createElement("div",null,"Loading..."):this.props.usersListState.error?r.default.createElement("div",null,this.props.usersListState.error):r.default.createElement("div",{className:d.default.adminTabContent},r.default.createElement("div",{className:d.default.adminTabScrollableContent},r.default.createElement(s.Table,{multiSelectable:!0,onRowSelect:this.handleUserSelect},r.default.createElement(s.TableHead,null,r.default.createElement(s.TableCell,null,"Email"),r.default.createElement(s.TableCell,null,"First Name"),r.default.createElement(s.TableCell,null,"Last Name"),r.default.createElement(s.TableCell,null,"Created"),r.default.createElement(s.TableCell,null,"Email verified"),r.default.createElement(s.TableCell,null,"Roles"),r.default.createElement(s.TableCell,null," ")),this.props.usersListState.data&&this.props.usersListState.data.map(function(t){return r.default.createElement(s.TableRow,{key:t._id,selected:e.state.selected.indexOf(t._id)>-1},r.default.createElement(s.TableCell,null,t.email),r.default.createElement(s.TableCell,null,t.firstname),r.default.createElement(s.TableCell,null,t.lastname),r.default.createElement(s.TableCell,null,t.createdAt),r.default.createElement(s.TableCell,null,t.emailVerified.toString()),r.default.createElement(s.TableCell,null,t.roles.join(",")),r.default.createElement(s.TableCell,null,r.default.createElement(a.Link,{to:"/admin/users/edit/".concat(t._id)},r.default.createElement(p,{primary:!0,mini:!0,floating:!0,className:d.default.actionButton,icon:"edit",tooltip:"Edit user"})),r.default.createElement(p,{primary:!0,mini:!0,floating:!0,className:d.default.actionButton,icon:"delete",tooltip:"Delete user",onClick:function onClick(){return e.toggleDeleteConfirmation(t)}})))}))),r.default.createElement("div",{className:d.default.adminTabActions},r.default.createElement(a.Link,{to:"/admin/users/create"},r.default.createElement(l.Button,{className:d.default.actionButton,raised:!0,primary:!0},"Add User")),r.default.createElement(l.Button,{className:d.default.actionButton,raised:!0,accent:!0,disabled:0===this.state.selected.length,onClick:this.toggleDeleteConfirmation},"Delete Users")),r.default.createElement(h.default,{active:this.state.confirmDelete,users:this.state.confirmDeleteUsers,cancel:this.toggleDeleteConfirmation}))}}]),UsersTable}();v.propTypes={dispatch:o.default.func.isRequired,usersListState:o.default.shape({pending:o.default.bool,data:o.default.arrayOf(o.default.object),error:o.default.string}).isRequired};var y=(0,n.connect)(function(e){return{usersListState:g(e)}})(v);t.default=y},699:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(1)),a=_interopRequireDefault(i(25)),s=i(12),l=_interopRequireDefault(i(158)),c=s.actions.deleteUsers,u=s.selectors.getDeleteUsersState,h=function(e){function UsersDelete(){var e,t,i;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,UsersDelete);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return _possibleConstructorReturn(i,(t=i=_possibleConstructorReturn(this,(e=UsersDelete.__proto__||Object.getPrototypeOf(UsersDelete)).call.apply(e,[this].concat(n))),i.actions=[{label:"Delete",onClick:i.deleteUsers.bind(i)},{label:"Cancel",onClick:i.props.cancel}],t))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(UsersDelete,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(UsersDelete,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){e.active&&e.serverState.data&&this.props.cancel()}},{key:"deleteUsers",value:function deleteUsers(){this.props.dispatch(c(this.props.users))}},{key:"render",value:function render(){var e;return e=this.props.serverState.error?r.default.createElement("div",null,this.props.serverState.error):r.default.createElement("div",null,"Are you sure you want the selected user(s) ?"),r.default.createElement(a.default,{title:"Delete User",active:this.props.active,onEscKeyDown:this.props.cancel,onOverlayClick:this.props.cancel,theme:{dialog:l.default.formDialogContainer,body:l.default.formDialog,title:l.default.formDialogTitle},actions:this.actions},e)}}]),UsersDelete}();h.propTypes={active:o.default.bool.isRequired,cancel:o.default.func.isRequired,dispatch:o.default.func.isRequired,serverState:o.default.shape({pending:o.default.bool,data:o.default.arrayOf(o.default.string),error:o.default.string}).isRequired,users:o.default.arrayOf(o.default.string).isRequired};var d=(0,n.connect)(function(e){return{serverState:u(e)}})(h);t.default=d},700:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".admin--adminPanel--26oxBfA9 {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n\t-ms-flex-negative: 1;\n\t    flex-shrink: 1;\n\t-ms-flex-preferred-size: 0%;\n\t    flex-basis: 0%;\n\theight: 100%;\n\twidth: 100%;\n\tposition:absolute;\n\tleft: 0;\n\ttop: 0;\n\t-webkit-box-orient: vertical;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: column;\n\t        flex-direction: column;\n}\n\n.admin--adminTitle--u2_JVROr {\n\tpadding: 16px;\n\t-ms-flex-negative: 0;\n\t    flex-shrink: 0;\n}\n\n.admin--adminTabs--1M3tuXI0 {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: vertical;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: column;\n\t        flex-direction: column;\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n\tmin-height: 0;\n\tpadding: 0 16px;\n}\n\n.admin--adminNavigationContainer--lqSPykrA {\n\t-ms-flex-negative: 0;\n\t    flex-shrink: 0;\n}\n\n.admin--adminTab--236GlhH8 {\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: vertical;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: column;\n\t        flex-direction: column;\n}\n\n.admin--adminTab--236GlhH8:focus {\n\toutline: none;\n}\n\n.admin--adminTabContent--3NnXna_Q {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: vertical;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: column;\n\t        flex-direction: column;\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n\tmin-height: 0;\n}\n\n.admin--adminTabScrollableContent--1F__88YT {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\toverflow: auto;\n}\n\n.admin--adminTabActions--23zx92eJ {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-pack: end;\n\t    -ms-flex-pack: end;\n\t        justify-content: flex-end;\n\tpadding: 16px;\n\tmargin-top: 30px;\n\t-ms-flex-negative: 0;\n\t    flex-shrink: 0;\n}\n\n.admin--actionButton--1Ahw8RBV {\n\tmargin: 0 6px;\n}","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Admin/admin.css"],names:[],mappings:"AAAA;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb,qBAAe;KAAf,eAAe;CACf,4BAAe;KAAf,eAAe;CACf,aAAa;CACb,YAAY;CACZ,kBAAkB;CAClB,QAAQ;CACR,OAAO;CACP,6BAAuB;CAAvB,8BAAuB;KAAvB,2BAAuB;SAAvB,uBAAuB;CACvB;;AAED;CACC,cAAc;CACd,qBAAe;KAAf,eAAe;CACf;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,6BAAuB;CAAvB,8BAAuB;KAAvB,2BAAuB;SAAvB,uBAAuB;CACvB,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb,cAAc;CACd,gBAAgB;CAChB;;AAED;CACC,qBAAe;KAAf,eAAe;CACf;;AAED;CACC,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,6BAAuB;CAAvB,8BAAuB;KAAvB,2BAAuB;SAAvB,uBAAuB;CACvB;;AAED;CACC,cAAc;CACd;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,6BAAuB;CAAvB,8BAAuB;KAAvB,2BAAuB;SAAvB,uBAAuB;CACvB,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb,cAAc;CACd;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,eAAe;CACf;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,sBAA0B;KAA1B,mBAA0B;SAA1B,0BAA0B;CAC1B,cAAc;CACd,iBAAiB;CACjB,qBAAe;KAAf,eAAe;CACf;;AAED;CACC,cAAc;CACd",file:"admin.css",sourcesContent:[".adminPanel {\n\tdisplay: flex;\n\tflex-grow: 1;\n\tflex-shrink: 1;\n\tflex-basis: 0%;\n\theight: 100%;\n\twidth: 100%;\n\tposition:absolute;\n\tleft: 0;\n\ttop: 0;\n\tflex-direction: column;\n}\n\n.adminTitle {\n\tpadding: 16px;\n\tflex-shrink: 0;\n}\n\n.adminTabs {\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\tmin-height: 0;\n\tpadding: 0 16px;\n}\n\n.adminNavigationContainer {\n\tflex-shrink: 0;\n}\n\n.adminTab {\n\tflex-grow: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.adminTab:focus {\n\toutline: none;\n}\n\n.adminTabContent {\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\tmin-height: 0;\n}\n\n.adminTabScrollableContent {\n\tdisplay: flex;\n\toverflow: auto;\n}\n\n.adminTabActions {\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: flex-end;\n\tpadding: 16px;\n\tmargin-top: 30px;\n\tflex-shrink: 0;\n}\n\n.actionButton {\n\tmargin: 0 6px;\n}"],sourceRoot:""}]),t.locals={adminPanel:"admin--adminPanel--26oxBfA9",adminTitle:"admin--adminTitle--u2_JVROr",adminTabs:"admin--adminTabs--1M3tuXI0",adminNavigationContainer:"admin--adminNavigationContainer--lqSPykrA",adminTab:"admin--adminTab--236GlhH8",adminTabContent:"admin--adminTabContent--3NnXna_Q",adminTabScrollableContent:"admin--adminTabScrollableContent--1F__88YT",adminTabActions:"admin--adminTabActions--23zx92eJ",actionButton:"admin--actionButton--1Ahw8RBV"}},701:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(1)),a=_interopRequireDefault(i(78)),s=_interopRequireDefault(i(107)),l=_interopRequireDefault(i(25)),c=i(12),u=_interopRequireDefault(i(64)),h=_interopRequireDefault(i(52)),d=c.actions.resetCreateState,p=c.actions.createUser,f=c.selectors.getCreateUserState,m=function(e){function UsersCreate(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,UsersCreate),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(UsersCreate.__proto__||Object.getPrototypeOf(UsersCreate)).call(this,e)),t.state={active:!1},t.cancel=t.cancel.bind(t),t.submit=t.submit.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(UsersCreate,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(UsersCreate,[{key:"componentDidMount",value:function componentDidMount(){this.setState({active:!0})}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){e.serverState.data&&this.cancel.bind(this)()}},{key:"cancel",value:function cancel(){var e=this;this.props.dispatch(d());this.setState({active:!1}),setTimeout(function(){e.props.history.push("/admin/users")},500)}},{key:"submit",value:function submit(e){this.props.dispatch(p(e))}},{key:"render",value:function render(){var e={firstname:{label:"First Name",type:"text",required:!0,validate:function validate(e){var t=e.length>0;return{isValid:t,error:t?"":"First name is required"}}},lastname:{label:"Last Name",type:"text",required:!0,validate:function validate(e){var t=e.length>0;return{isValid:t,error:t?"":"Last name is required"}}},email:{label:"Email",type:"email",required:!0,validate:function validate(e){var t=(0,a.default)(e);return{isValid:t,error:t?"":"Email is invalid"}}},roles:{label:"Role",type:"dropdown",value:"user",options:[{label:"User",value:"user"},{label:"Superuser",value:"superuser"},{label:"Admin",value:"admin"}],validate:function validate(){return{isValid:!0,error:null}}},password:{label:"Password",type:"password",required:!0,validate:function validate(e){var t=[],i=!0;(0,s.default)(e,{min:8})||(i=!1,t.push(r.default.createElement("div",{key:"error-length",style:{width:"250px"}},"Password is too short"))),/\d/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-digit",style:{width:"250px"}},"Password should contain at least one number"))),/[a-z]/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-lc",style:{width:"250px"}},"Password should contain at least one lowercase character"))),/[A-Z]/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-uc",style:{width:"250px"}},"Password should contain at least one uppercase character"))),/[$&+,:;=?@#|'<>.^*()%!-]/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-special",style:{width:"250px"}},"Password should contain at least one special character (*,!,etc)")));var n="";return t.length>0&&(n=r.default.createElement("div",null,t)),{isValid:i,error:n}}},confirmPassword:{label:"Confirm Password",type:"password",required:!0,refValue:"password",validate:function validate(e,t){var i=e===t;return{isValid:i,error:i?"":"Passwords do not match"}}}};return r.default.createElement(l.default,{title:"Create User",active:this.state.active,onEscKeyDown:this.cancel,onOverlayClick:this.cancel,theme:{dialog:h.default.formDialogContainer,body:h.default.formDialog,title:h.default.formDialogTitle}},r.default.createElement(u.default,{fields:e,helper:"",error:this.props.serverState.error,links:[],cancel:this.cancel,submit:this.submit}))}}]),UsersCreate}();m.propTypes={dispatch:o.default.func.isRequired,history:o.default.object.isRequired,location:o.default.object,match:o.default.object,serverState:o.default.shape({pending:o.default.bool,data:o.default.object,error:o.default.string}).isRequired};var g=(0,n.connect)(function(e){return{serverState:f(e)}})(m);t.default=g},704:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".form--formDialogEnter--1uM_rgof {\n  opacity: 0;\n  z-index: 1;\n}\n\n.form--formDialogEnterActive--3C3hqYRC {\n  opacity: 1;\n  transition: opacity 300ms ease-in;\n}\n\n.form--formDialogLeave--mMBYw43j {\n  opacity: 1\n}\n\n.form--formDialogLeaveActive--1Dtvn4xY {\n  opacity: 0;\n  transition: opacity 300ms ease-in;\n}\n\n.form--formDialogBackground--1akFuD7A {\n\tposition:absolute;\n\ttop: 0;\n\tleft: 0;\n\tz-index: 2;\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: rgba(0, 0, 0, .5);\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-align: center;\n\t    -ms-flex-align: center;\n\t        align-items: center;\n\t-webkit-box-pack: center;\n\t    -ms-flex-pack: center;\n\t        justify-content: center;\n}\n\n.form--formDialogContainer--1PUaqL_j {\n\tbackground-color:white;\n\twidth: 500px;\n\theight: 620px;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: vertical;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: column;\n\t        flex-direction: column;\n}\n\n.form--formDialog--3mD1jLwL {\n\tmin-height: 0;\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: vertical;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: column;\n\t        flex-direction: column;\n\tpadding: 8px;\n}\n\n.form--formDialogTitle--inImfMq6 {\n\ttext-align:center;\n\tfont-weight: bold;\n\tfont-size: 24px;\n\tpadding: 16px;\n}\n\n.form--formDialogContent--oUURctdb {\n\tmin-height: 0;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient:vertical;\n\t-webkit-box-direction:normal;\n\t    -ms-flex-direction:column;\n\t        flex-direction:column;\n\t-webkit-box-pack: justify;\n\t    -ms-flex-pack: justify;\n\t        justify-content: space-between;\n\t-webkit-box-align: center;\n\t    -ms-flex-align: center;\n\t        align-items: center;\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n\toverflow-y: scroll;\n}\n\n.form--formDialogError--1icY9aO9 {\n\tcolor:red;\n\tpadding: 10px;\n\ttext-align: center;\n}\n\n.form--formDialogSuccess--hWmDQZWk {\n\tcolor:green;\n\tpadding: 10px;\n\ttext-align: center;\n}\n\n.form--formDialogForm--1LLea-Q4 {\n\tmin-height: 0;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient:vertical;\n\t-webkit-box-direction:normal;\n\t    -ms-flex-direction:column;\n\t        flex-direction:column;\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n\tpadding: 10px;\n}\n\n.form--formDialogLinks--2tgcSatS {\n\tmin-height: 0;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient:vertical;\n\t-webkit-box-direction:normal;\n\t    -ms-flex-direction:column;\n\t        flex-direction:column;\n\t-webkit-box-pack: center;\n\t    -ms-flex-pack: center;\n\t        justify-content: center;\n\t-webkit-box-align: center;\n\t    -ms-flex-align: center;\n\t        align-items: center;\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n}\n\n.form--formDialogActions--3y6E1ee_ {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-pack: end;\n\t    -ms-flex-pack: end;\n\t        justify-content: flex-end;\n\tpadding: 10px;\n}\n\n.form--formDialogActions--3y6E1ee_ a:hover {\n\ttext-decoration: none;\n}\n\n.form--formDialogActions--3y6E1ee_ button {\n\tmargin-left: 10px;\n}\n\n","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Common/form.css"],names:[],mappings:"AAAA;EACE,WAAW;EACX,WAAW;CACZ;;AAED;EACE,WAAW;EACX,kCAAkC;CACnC;;AAED;EACE,UAAU;CACX;;AAED;EACE,WAAW;EACX,kCAAkC;CACnC;;AAED;CACC,kBAAkB;CAClB,OAAO;CACP,QAAQ;CACR,WAAW;CACX,YAAY;CACZ,aAAa;CACb,oCAAkC;CAClC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,0BAAoB;KAApB,uBAAoB;SAApB,oBAAoB;CACpB,yBAAwB;KAAxB,sBAAwB;SAAxB,wBAAwB;CACxB;;AACD;CACC,uBAAuB;CACvB,aAAa;CACb,cAAc;CACd,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,6BAAuB;CAAvB,8BAAuB;KAAvB,2BAAuB;SAAvB,uBAAuB;CACvB;;AAED;CACC,cAAc;CACd,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,6BAAuB;CAAvB,8BAAuB;KAAvB,2BAAuB;SAAvB,uBAAuB;CACvB,aAAa;CACb;;AAED;CACC,kBAAkB;CAClB,kBAAkB;CAClB,gBAAgB;CAChB,cAAc;CACd;;AAED;CACC,cAAc;CACd,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,4BAAsB;CAAtB,6BAAsB;KAAtB,0BAAsB;SAAtB,sBAAsB;CACtB,0BAA+B;KAA/B,uBAA+B;SAA/B,+BAA+B;CAC/B,0BAAoB;KAApB,uBAAoB;SAApB,oBAAoB;CACpB,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb,mBAAmB;CACnB;;AAED;CACC,UAAU;CACV,cAAc;CACd,mBAAmB;CACnB;;AAED;CACC,YAAY;CACZ,cAAc;CACd,mBAAmB;CACnB;;AAED;CACC,cAAc;CACd,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,4BAAsB;CAAtB,6BAAsB;KAAtB,0BAAsB;SAAtB,sBAAsB;CACtB,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb,cAAc;CACd;;AAED;CACC,cAAc;CACd,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,4BAAsB;CAAtB,6BAAsB;KAAtB,0BAAsB;SAAtB,sBAAsB;CACtB,yBAAwB;KAAxB,sBAAwB;SAAxB,wBAAwB;CACxB,0BAAoB;KAApB,uBAAoB;SAApB,oBAAoB;CACpB,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,sBAA0B;KAA1B,mBAA0B;SAA1B,0BAA0B;CAC1B,cAAc;CACd;;AAED;CACC,sBAAsB;CACtB;;AAED;CACC,kBAAkB;CAClB",file:"form.css",sourcesContent:[".formDialogEnter {\n  opacity: 0;\n  z-index: 1;\n}\n\n.formDialogEnterActive {\n  opacity: 1;\n  transition: opacity 300ms ease-in;\n}\n\n.formDialogLeave {\n  opacity: 1\n}\n\n.formDialogLeaveActive {\n  opacity: 0;\n  transition: opacity 300ms ease-in;\n}\n\n.formDialogBackground {\n\tposition:absolute;\n\ttop: 0;\n\tleft: 0;\n\tz-index: 2;\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: rgba(0,0,0,0.5);\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: center;\n}\n.formDialogContainer {\n\tbackground-color:white;\n\twidth: 500px;\n\theight: 620px;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.formDialog {\n\tmin-height: 0;\n\tflex-grow: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding: 8px;\n}\n\n.formDialogTitle {\n\ttext-align:center;\n\tfont-weight: bold;\n\tfont-size: 24px;\n\tpadding: 16px;\n}\n\n.formDialogContent {\n\tmin-height: 0;\n\tdisplay: flex;\n\tflex-direction:column;\n\tjustify-content: space-between;\n\talign-items: center;\n\tflex-grow: 1;\n\toverflow-y: scroll;\n}\n\n.formDialogError {\n\tcolor:red;\n\tpadding: 10px;\n\ttext-align: center;\n}\n\n.formDialogSuccess {\n\tcolor:green;\n\tpadding: 10px;\n\ttext-align: center;\n}\n\n.formDialogForm {\n\tmin-height: 0;\n\tdisplay: flex;\n\tflex-direction:column;\n\tflex-grow: 1;\n\tpadding: 10px;\n}\n\n.formDialogLinks {\n\tmin-height: 0;\n\tdisplay: flex;\n\tflex-direction:column;\n\tjustify-content: center;\n\talign-items: center;\n\tflex-grow: 1;\n}\n\n.formDialogActions {\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: flex-end;\n\tpadding: 10px;\n}\n\n.formDialogActions a:hover {\n\ttext-decoration: none;\n}\n\n.formDialogActions button {\n\tmargin-left: 10px;\n}\n\n"],sourceRoot:""}]),t.locals={formDialogEnter:"form--formDialogEnter--1uM_rgof",formDialogEnterActive:"form--formDialogEnterActive--3C3hqYRC",formDialogLeave:"form--formDialogLeave--mMBYw43j",formDialogLeaveActive:"form--formDialogLeaveActive--1Dtvn4xY",formDialogBackground:"form--formDialogBackground--1akFuD7A",formDialogContainer:"form--formDialogContainer--1PUaqL_j",formDialog:"form--formDialog--3mD1jLwL",formDialogTitle:"form--formDialogTitle--inImfMq6",formDialogContent:"form--formDialogContent--oUURctdb",formDialogError:"form--formDialogError--1icY9aO9",formDialogSuccess:"form--formDialogSuccess--hWmDQZWk",formDialogForm:"form--formDialogForm--1LLea-Q4",formDialogLinks:"form--formDialogLinks--2tgcSatS",formDialogActions:"form--formDialogActions--3y6E1ee_"}},705:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(1)),a=_interopRequireDefault(i(78)),s=_interopRequireDefault(i(25)),l=i(12),c=_interopRequireDefault(i(64)),u=_interopRequireDefault(i(52)),h=l.actions.fetchUser,d=l.actions.updateUser,p=l.actions.resetUpdateState,f=l.selectors.getCurrentUserState,m=l.selectors.getUpdateUserState,g=function(e){function UsersEdit(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,UsersEdit),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(UsersEdit.__proto__||Object.getPrototypeOf(UsersEdit)).call(this,e)),t.state={active:!1},t.cancel=t.cancel.bind(t),t.submit=t.submit.bind(t),t.userId=t.props.match.params.userId,t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(UsersEdit,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(UsersEdit,[{key:"componentDidMount",value:function componentDidMount(){this.setState({active:!0}),this.props.dispatch(h(this.userId))}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){e.updateUserState.data&&this.cancel.bind(this)()}},{key:"cancel",value:function cancel(){var e=this;this.props.dispatch(p()),this.setState({active:!1}),setTimeout(function(){e.props.history.push("/admin/users")},500)}},{key:"submit",value:function submit(e){this.props.dispatch(d(e,this.userId))}},{key:"render",value:function render(){var e;if(this.props.currentUserState.pending||!this.props.currentUserState.data&&!this.props.currentUserState.error)e=r.default.createElement("div",null,"Loading...");else if(this.props.currentUserState.error)e=r.default.createElement("div",null,this.props.currentUserState.error);else{var t={firstname:{label:"First Name",type:"text",value:this.props.currentUserState.data.firstname,required:!0,validate:function validate(e){var t=e.length>0;return{isValid:t,error:t?"":"First name is required"}}},lastname:{label:"Last Name",type:"text",value:this.props.currentUserState.data.lastname,required:!0,validate:function validate(e){var t=e.length>0;return{isValid:t,error:t?"":"Last name is required"}}},email:{label:"Email",type:"email",value:this.props.currentUserState.data.email,required:!0,validate:function validate(e){var t=(0,a.default)(e);return{isValid:t,error:t?"":"Email is invalid"}}},roles:{label:"Role",type:"dropdown",value:this.props.currentUserState.data.roles[0],options:[{label:"User",value:"user"},{label:"Superuser",value:"superuser"},{label:"Admin",value:"admin"}],validate:function validate(){return{isValid:!0,error:null}}}};e=r.default.createElement(c.default,{fields:t,helper:"",error:this.props.updateUserState.error,links:[],cancel:this.cancel,submit:this.submit})}return r.default.createElement(s.default,{title:"Edit User",active:this.state.active,onEscKeyDown:this.cancel,onOverlayClick:this.cancel,theme:{dialog:u.default.formDialogContainer,body:u.default.formDialog,title:u.default.formDialogTitle}},e)}}]),UsersEdit}();g.propTypes={currentUserState:o.default.shape({pending:o.default.bool,data:o.default.object,error:o.default.string}).isRequired,dispatch:o.default.func.isRequired,history:o.default.object.isRequired,location:o.default.object,match:o.default.object.isRequired,updateUserState:o.default.shape({pending:o.default.bool,data:o.default.object,error:o.default.string}).isRequired};var v=(0,n.connect)(function(e){return{currentUserState:f(e),updateUserState:m(e)}})(g);t.default=v},706:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(707)).default;t.default=r},707:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(59),o=_interopRequireDefault(i(1)),a=_interopRequireDefault(i(708)),s=_interopRequireDefault(i(709)),l=_interopRequireDefault(i(710)),c=_interopRequireDefault(i(711)),u=function(e){function Auth(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Auth),function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Auth.__proto__||Object.getPrototypeOf(Auth)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Auth,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Auth,[{key:"render",value:function render(){return r.default.createElement(n.Switch,null,r.default.createElement(n.Route,{path:"/:loc/auth/login",component:a.default}),r.default.createElement(n.Route,{path:"/:loc/auth/register",component:s.default}),r.default.createElement(n.Route,{path:"/:loc/auth/forgot",component:l.default}),r.default.createElement(n.Route,{path:"/:loc/auth/reset",component:c.default}))}}]),Auth}();u.propTypes={history:o.default.object,location:o.default.object.isRequired,match:o.default.object};var h=u;t.default=h},708:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(78)),a=_interopRequireDefault(i(107)),s=_interopRequireDefault(i(1)),l=_interopRequireDefault(i(25)),c=i(12),u=_interopRequireDefault(i(64)),h=_interopRequireDefault(i(52)),d=c.actions.login,p=c.actions.resetLoginState,f=c.selectors.getLoginState,m=c.selectors.getRootUrl,g=function(e){function Login(e){var t;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Login);var i=(t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Login.__proto__||Object.getPrototypeOf(Login)).call(this,e))).props.location.search;return t.state={active:!1,verifySuccess:/verifySuccess=true/.test(i)},t.cancel=t.cancel.bind(t),t.submit=t.submit.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Login,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Login,[{key:"componentDidMount",value:function componentDidMount(){this.setState({active:!0})}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){e.serverState.data&&this.cancel.bind(this)()}},{key:"cancel",value:function cancel(){var e=this;this.setState({active:!1}),setTimeout(function(){e.props.history.push(e.props.rootUrl),e.props.dispatch(p())},500)}},{key:"submit",value:function submit(e){this.props.dispatch(d(e))}},{key:"render",value:function render(){var e={email:{label:"Email",type:"email",required:!0,validate:function validate(e){var t=(0,o.default)(e);return{isValid:t,error:t?"":"Email is invalid"}}},password:{label:"Password",type:"password",required:!0,validate:function validate(e){var t=(0,a.default)(e,{min:8});return{isValid:t,error:t?"":"Password is too short"}}}},t=[{to:this.props.rootUrl+"/auth/register",text:"Create Account"},{to:this.props.rootUrl+"/auth/forgot",text:"Forgot Password ?"}],i=this.state.verifySuccess?"Your account was successfully verified. You can now login.":null;return r.default.createElement(l.default,{title:"Login",active:this.state.active,onEscKeyDown:this.cancel,onOverlayClick:this.cancel,theme:{dialog:h.default.formDialogContainer,body:h.default.formDialog,title:h.default.formDialogTitle}},r.default.createElement(u.default,{fields:e,helper:"",success:i,error:this.props.serverState.error,links:t,cancel:this.cancel,submit:this.submit}))}}]),Login}();g.propTypes={dispatch:s.default.func.isRequired,history:s.default.object.isRequired,location:s.default.object.isRequired,match:s.default.object,rootUrl:s.default.string.isRequired,serverState:s.default.shape({pending:s.default.bool,data:s.default.object,error:s.default.string}).isRequired};var v=(0,n.connect)(function(e){return{rootUrl:m(e),serverState:f(e)}})(g);t.default=v},709:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(78)),a=_interopRequireDefault(i(107)),s=_interopRequireDefault(i(1)),l=_interopRequireDefault(i(25)),c=i(12),u=_interopRequireDefault(i(64)),h=_interopRequireDefault(i(52)),d=c.actions.register,p=c.actions.resetRegisterState,f=c.selectors.getRegisterState,m=c.selectors.getRootUrl,g=function(e){function Register(e){var t;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Register);var i=(t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Register.__proto__||Object.getPrototypeOf(Register)).call(this,e))).props.location.search;return t.state={active:!1,verifyError:/verifyError=true/.test(i)},t.cancel=t.cancel.bind(t),t.submit=t.submit.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Register,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Register,[{key:"componentDidMount",value:function componentDidMount(){this.setState({active:!0})}},{key:"cancel",value:function cancel(){var e=this;this.setState({active:!1}),setTimeout(function(){e.props.history.push(e.props.rootUrl),e.props.dispatch(p())},500)}},{key:"submit",value:function submit(e){this.props.dispatch(d(e))}},{key:"render",value:function render(){var e={firstname:{label:"First Name",type:"text",required:!0,validate:function validate(e){var t=e.length>0;return{isValid:t,error:t?"":"First name is required"}}},lastname:{label:"Last Name",type:"text",required:!0,validate:function validate(e){var t=e.length>0;return{isValid:t,error:t?"":"Last name is required"}}},email:{label:"Email",type:"email",required:!0,validate:function validate(e){var t=(0,o.default)(e);return{isValid:t,error:t?"":"Email is invalid"}}},password:{label:"Password",type:"password",required:!0,validate:function validate(e){var t=[],i=!0;(0,a.default)(e,{min:8})||(i=!1,t.push(r.default.createElement("div",{key:"error-length",style:{width:"250px"}},"Password is too short"))),/\d/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-digit",style:{width:"250px"}},"Password should contain at least one number"))),/[a-z]/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-lc",style:{width:"250px"}},"Password should contain at least one lowercase character"))),/[A-Z]/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-uc",style:{width:"250px"}},"Password should contain at least one uppercase character"))),/[$&+,:;=?@#|'<>.^*()%!-]/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-special",style:{width:"250px"}},"Password should contain at least one special character (*,!,etc)")));var n="";return t.length>0&&(n=r.default.createElement("div",null,t)),{isValid:i,error:n}}},confirmPassword:{label:"Confirm Password",type:"password",required:!0,refValue:"password",validate:function validate(e,t){var i=e===t;return{isValid:i,error:i?"":"Passwords do not match"}}}},t=this.props.serverState.error||(this.state.verifyError?"Your verification session has expired. Please register again.":null);return r.default.createElement(l.default,{title:"Register",active:this.state.active,onEscKeyDown:this.cancel,onOverlayClick:this.cancel,theme:{dialog:h.default.formDialogContainer,body:h.default.formDialog,title:h.default.formDialogTitle}},r.default.createElement(u.default,{fields:e,helper:"",error:t,success:this.props.serverState.data,links:[],cancel:this.cancel,submit:this.submit}))}}]),Register}();g.propTypes={dispatch:s.default.func.isRequired,history:s.default.object.isRequired,location:s.default.object.isRequired,match:s.default.object,rootUrl:s.default.string.isRequired,serverState:s.default.shape({pending:s.default.bool,data:s.default.string,error:s.default.string}).isRequired};var v=(0,n.connect)(function(e){return{serverState:f(e),rootUrl:m(e)}})(g);t.default=v},710:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(78)),a=_interopRequireDefault(i(1)),s=_interopRequireDefault(i(25)),l=i(12),c=_interopRequireDefault(i(64)),u=_interopRequireDefault(i(52)),h=l.actions.forgotPassword,d=l.actions.resetForgotPasswordState,p=l.selectors.getRootUrl,f=l.selectors.getForgotPasswordState,m=l.selectors.getAuthUser,g=function(e){function ForgotPassword(e){var t;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ForgotPassword);var i=(t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(ForgotPassword.__proto__||Object.getPrototypeOf(ForgotPassword)).call(this,e))).props.location.search;return t.state={active:!1,verifyError:/verifyError=true/.test(i)},t.cancel=t.cancel.bind(t),t.submit=t.submit.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ForgotPassword,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(ForgotPassword,[{key:"componentDidMount",value:function componentDidMount(){this.setState({active:!0})}},{key:"cancel",value:function cancel(){var e=this;this.setState({active:!1}),setTimeout(function(){e.props.history.push(e.props.rootUrl),e.props.dispatch(d())},500)}},{key:"submit",value:function submit(e){this.props.dispatch(h(e))}},{key:"render",value:function render(){var e={email:{label:"Email",type:"email",required:!0,validate:function validate(e){var t=(0,o.default)(e);return{isValid:t,error:t?"":"Email is invalid"}}}},t=this.props.serverState.error||(this.state.verifyError&&!this.props.serverState.data?"Your reset session has expired. Please ask for a new session below.":null);return r.default.createElement(s.default,{title:"Forgot Password",active:this.state.active,onEscKeyDown:this.cancel,onOverlayClick:this.cancel,theme:{dialog:u.default.formDialogContainer,body:u.default.formDialog,title:u.default.formDialogTitle}},r.default.createElement(c.default,{fields:e,helper:"Please enter your email to reset your password",error:t,success:this.props.serverState.data,links:[],cancel:this.cancel,submit:this.submit}))}}]),ForgotPassword}();g.propTypes={dispatch:a.default.func.isRequired,history:a.default.object.isRequired,location:a.default.object.isRequired,match:a.default.object,rootUrl:a.default.string.isRequired,serverState:a.default.shape({pending:a.default.bool,data:a.default.string,error:a.default.string}).isRequired,user:a.default.object};var v=(0,n.connect)(function(e){return{rootUrl:p(e),serverState:f(e),user:m(e)}})(g);t.default=v},711:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(107)),a=_interopRequireDefault(i(1)),s=_interopRequireDefault(i(25)),l=i(12),c=_interopRequireDefault(i(64)),u=_interopRequireDefault(i(52)),h=l.actions.resetPassword,d=l.actions.resetResetPasswordState,p=l.selectors.getRootUrl,f=l.selectors.getResetPasswordState,m=function(e){function ResetPassword(e){var t;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ResetPassword);var i=(t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(ResetPassword.__proto__||Object.getPrototypeOf(ResetPassword)).call(this,e))).props.location.search;return t.state={active:!1},t.token=i.slice(7,i.length),t.cancel=t.cancel.bind(t),t.submit=t.submit.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ResetPassword,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(ResetPassword,[{key:"componentDidMount",value:function componentDidMount(){this.setState({active:!0})}},{key:"cancel",value:function cancel(){var e=this;this.setState({active:!1}),setTimeout(function(){e.props.history.push(e.props.rootUrl),e.props.dispatch(d())},500)}},{key:"submit",value:function submit(e){this.props.dispatch(h(e,this.token))}},{key:"render",value:function render(){var e={password:{label:"New Password",type:"password",required:!0,validate:function validate(e){var t=[],i=!0;(0,o.default)(e,{min:8})||(i=!1,t.push(r.default.createElement("div",{key:"error-length",style:{width:"250px"}},"Password is too short"))),/\d/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-digit",style:{width:"250px"}},"Password should contain at least one number"))),/[a-z]/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-lc",style:{width:"250px"}},"Password should contain at least one lowercase character"))),/[A-Z]/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-uc",style:{width:"250px"}},"Password should contain at least one uppercase character"))),/[$&+,:;=?@#|'<>.^*()%!-]/.test(e)||(i=!1,t.push(r.default.createElement("div",{key:"error-special",style:{width:"250px"}},"Password should contain at least one special character (*,!,etc)")));var n="";return t.length>0&&(n=r.default.createElement("div",null,t)),{isValid:i,error:n}}},confirmPassword:{label:"Confirm New Password",type:"password",required:!0,refValue:"password",validate:function validate(e,t){var i=e===t;return{isValid:i,error:i?"":"Passwords do not match"}}}};return r.default.createElement(s.default,{title:"Reset Password",active:this.state.active,onEscKeyDown:this.cancel,onOverlayClick:this.cancel,theme:{dialog:u.default.formDialogContainer,body:u.default.formDialog,title:u.default.formDialogTitle}},r.default.createElement(c.default,{fields:e,helper:"Please enter your new password below",error:this.props.serverState.error,success:this.props.serverState.data,links:[],cancel:this.cancel,submit:this.submit}))}}]),ResetPassword}();m.propTypes={dispatch:a.default.func.isRequired,history:a.default.object.isRequired,location:a.default.object.isRequired,match:a.default.object,rootUrl:a.default.string.isRequired,serverState:a.default.shape({pending:a.default.bool,data:a.default.string,error:a.default.string}).isRequired};var g=(0,n.connect)(function(e){return{serverState:f(e),rootUrl:p(e)}})(m);t.default=g},712:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(713)).default;t.default=r},713:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(296)),a=_interopRequireDefault(i(1)),s=i(12),l=_interopRequireDefault(i(748)),c=_interopRequireDefault(i(751)),u=_interopRequireDefault(i(824)),h=s.actions.resizeMap,d=s.selectors.getMapPreviewMode,p=function(e){function Main(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Main),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Main.__proto__||Object.getPrototypeOf(Main)).call(this,e)),t.handleDragStarted=t.handleDragStarted.bind(t),t.handleDragFinished=t.handleDragFinished.bind(t),t.state={isResizing:!1},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Main,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Main,[{key:"handleDragStarted",value:function handleDragStarted(){this.setState({isResizing:!0})}},{key:"handleDragFinished",value:function handleDragFinished(){this.props.mapPreviewMode||this.props.dispatch(h()),this.setState({isResizing:!1})}},{key:"render",value:function render(){var e={width:"12px",background:"transparent",borderLeft:"5px solid #ccc",cursor:"ew-resize",zIndex:"1"},t=Object.assign({},e,{borderLeft:"5px solid blue"});return r.default.createElement("div",null,r.default.createElement(l.default,null),r.default.createElement(o.default,{split:"vertical",defaultSize:"70%",minSize:750,resizerStyle:this.state.isResizing?t:e,onDragStarted:this.handleDragStarted,onDragFinished:this.handleDragFinished},r.default.createElement(c.default,null),r.default.createElement(u.default,null)))}}]),Main}();p.propTypes={dispatch:a.default.func.isRequired,mapPreviewMode:a.default.bool.isRequired};var f=(0,n.connect)(function(e){return{mapPreviewMode:d(e)}})(p);t.default=f},748:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=i(161),a=_interopRequireDefault(i(21)),s=_interopRequireDefault(i(157)),l=_interopRequireDefault(i(1)),c=i(12),u=i(749),h=(0,s.default)(a.default),d=c.actions.logout,p=c.selectors.getAuthUser,f=c.selectors.getRootUrl,m=function(e){function AuthButton(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,AuthButton),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(AuthButton.__proto__||Object.getPrototypeOf(AuthButton)).call(this,e)),t.login=t.login.bind(t),t.logout=t.logout.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(AuthButton,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(AuthButton,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e){return e.user&&!this.props.user||!e.user&&this.props.user||e.user&&this.props.user&&e.user.email!==this.props.user.email}},{key:"login",value:function login(){var e=this.props.rootUrl+"/auth/login";this.props.history.push(e)}},{key:"logout",value:function logout(){this.props.dispatch(d())}},{key:"render",value:function render(){return this.props.user?r.default.createElement(h,{icon:"directions_run",onClick:this.logout,floating:!0,className:u.authButton,tooltip:"Logout"}):r.default.createElement(h,{icon:"account_box",floating:!0,className:u.authButton,tooltip:"Login",onClick:this.login})}}]),AuthButton}();m.propTypes={dispatch:l.default.func.isRequired,history:l.default.object.isRequired,location:l.default.object,match:l.default.object,rootUrl:l.default.string.isRequired,user:l.default.object};var g=(0,n.connect)(function(e){return{user:p(e),rootUrl:f(e)}})(m),v=(0,o.withRouter)(g);t.default=v},749:function(e,t,i){var r=i(750);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},750:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".auth--authButton--2_0G9c5i {\n\tposition:absolute;\n\tz-index:1;\n\ttop: 20px;\n\tleft: 20px;\n}\n\n","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Auth/auth.css"],names:[],mappings:"AAAA;CACC,kBAAkB;CAClB,UAAU;CACV,UAAU;CACV,WAAW;CACX",file:"auth.css",sourcesContent:[".authButton {\n\tposition:absolute;\n\tz-index:1;\n\ttop: 20px;\n\tleft: 20px;\n}\n\n"],sourceRoot:""}]),t.locals={authButton:"auth--authButton--2_0G9c5i"}},751:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(1)),a=i(12),s=_interopRequireDefault(i(752)),l=_interopRequireDefault(i(759)),c=_interopRequireDefault(i(761)),u=_interopRequireDefault(i(819)),h=_interopRequireDefault(i(822)),d=a.selectors.getSelectedMedias,p=a.selectors.getMapPreviewMode,f=a.selectors.getSelectedPointCloud,m=function(e){function MainPanel(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MainPanel),function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(MainPanel.__proto__||Object.getPrototypeOf(MainPanel)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(MainPanel,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(MainPanel,[{key:"render",value:function render(){var e=this.props.previewMode?h.default.preview:h.default.main,t=this.props.previewMode?h.default.main:h.default.preview;return r.default.createElement("div",{className:h.default.mainContainer},r.default.createElement("div",{className:e},r.default.createElement(s.default,null),this.props.previewMode&&r.default.createElement(l.default,null)),!this.props.previewMode&&r.default.createElement("div",{className:h.default.timelineContainer},this.props.showPreviewer&&r.default.createElement("div",{className:h.default.dummyPreview}),r.default.createElement(u.default,null)),this.props.showPreviewer&&r.default.createElement("div",{className:t},!this.props.previewMode&&r.default.createElement(l.default,null),r.default.createElement(c.default,null)))}}]),MainPanel}();m.propTypes={previewMode:o.default.bool.isRequired,showPreviewer:o.default.bool.isRequired};var g=(0,n.connect)(function(e){var t=d(e),i=f(e);return{previewMode:p(e),showPreviewer:1===t.length||null!==i}})(m);t.default=g},752:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(i(753)).default;t.default=r},753:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(58),o=i(11),a=i(161),s=_interopRequireDefault(i(754));i(755);var l=_interopRequireDefault(i(1)),c=i(12),u=_interopRequireDefault(i(757));s.default.accessToken="pk.eyJ1IjoiaWNvbmVtIiwiYSI6ImNpbXJycDBqODAwNG12cW0ydGF1NXZxa2sifQ.hgPcQvgkzpfYkHgfMRqcpw";var h=c.selectors.isAuthUserAdmin,d=c.selectors.getLayersState,p=c.selectors.getSourcesState,f=function(e){function Map(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Map),function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Map.__proto__||Object.getPrototypeOf(Map)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Map,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Map,[{key:"componentDidMount",value:function componentDidMount(){this.props.layersState.pending||this._initMap()}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){e.world.shouldMapResize&&this._resizeMap(),!e.layersState.pending&&this.props.layersState.pending?this._initMap():e.layersState.pending||(this._reloadSourcesData(e),this._updateLayersStyle(e))}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e){return!e.layersState.pending&&this.props.layersState.pending}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.map.remove()}},{key:"_initMap",value:function _initMap(){var e=this,t=this.props.location.pathname.split("/")[1].split(","),i=t.slice(0,2),r=t[2];this.renderHandlers={},this.map=new s.default.Map({container:this.mapContainer,style:"mapbox://styles/iconem/cio487j79006hc7m7wu00w6hw",center:i,zoom:r,renderWorldCopies:!1,maxBounds:[[-180,-85],[180,85]],transformRequest:function transformRequest(t){if(t.match(/\/userdrive\/tile\/grid\/\d+\/\d+\/\d+.pbf$/)){return{url:t+"/?viewport="+e.map.getBounds().toArray().toString()}}}}),this.draggingLayerId=null,this.map.on("load",function(){e._loadSources(),e._loadLayers(),e._addSimpleEventsHandling(),e._addClickHandling(),e._addDragndropHandling(),e._addViewportChangeHandling(),e._resizeMap()})}},{key:"_loadSources",value:function _loadSources(){var e=this;(0,n.forIn)(this.props.sourcesState.data,function(t,i){e.map.addSource(i,(0,n.omit)(t,["metadata"]))})}},{key:"_loadLayers",value:function _loadLayers(){var e=this,t=[];(0,n.forIn)(this.props.layersState.data,function(e){t.push(e)}),t.sort(function(e,t){return e.metadata.priority-t.metadata.priority}),t.map(function(t){e.map.addLayer(t)})}},{key:"_addSimpleEventsHandling",value:function _addSimpleEventsHandling(){var e=this;c.mapConfig.events.map(function(t){var i=function eventHandler(){var i=e.map.getCenter(),r=i.lng,n=i.lat,o=e.map.getZoom(),a=e.map.getBounds().toArray().reduce(function(e,t){return e.concat(t)},[]);e.props.dispatch(t.action({lng:r,lat:n,zoom:o,bounds:a,isAdmin:e.props.isAdmin}))};t.layerId?e.map.on(t.type,t.layerId,i):e.map.on(t.type,i)})}},{key:"_addClickHandling",value:function _addClickHandling(){var e=this;c.mapConfig.click.length>0&&this.map.on("click",function(t){c.mapConfig.click.map(function(i){var r=e.map.queryRenderedFeatures(t.point,{layers:i.layerIds}),n=t.originalEvent.ctrlKey;e.props.dispatch(i.action({features:r,ctrlKey:n,isAdmin:e.props.isAdmin}))})})}},{key:"_addDragndropHandling",value:function _addDragndropHandling(){var e=this;c.mapConfig.dragndrop.map(function(t){e.map.on("mouseenter",t.layerId,function(){e.map.dragPan.disable()}),e.map.on("mouseleave",t.layerId,function(){e.map.dragPan.enable()}),e.map.on("mousedown",t.layerId,function(i){e.props.dispatch(t.mousedown({features:i.features,isAdmin:e.props.isAdmin})),e.draggingLayerId=t.layerId,e.map.once("mouseup",function(i){var r=e.map.queryRenderedFeatures(i.point,{layers:[t.layerId]});e.props.dispatch(t.mouseup({feature:r[0],lat:i.lngLat.lat,lng:i.lngLat.lng,isAdmin:e.props.isAdmin})),e.draggingLayerId=null})})}),c.mapConfig.dragndrop.length>0&&this.map.on("mousemove",function(t){e.draggingLayerId&&c.mapConfig.dragndrop.map(function(i){i.layerId===e.draggingLayerId&&e.props.dispatch(i.mousemove({lat:t.lngLat.lat,lng:t.lngLat.lng,isAdmin:e.props.isAdmin}))})})}},{key:"_addViewportChangeHandling",value:function _addViewportChangeHandling(){var e=this;this.map.on("moveend",function(){var t=e.props.location.pathname.split("/"),i=e.map.getCenter(),r=i.lng,n=i.lat,o=e.map.getZoom();t[1]=[r,n,o].join(",");var a=t.join("/");e.props.history.replace(a)}),c.mapConfig.renderedFeatures.map(function(t){e._setRenderedFeaturesHandler(t,!0)})}},{key:"_setRenderedFeaturesHandler",value:function _setRenderedFeaturesHandler(e,t){var i=this;if(!this.renderHandlers[e.layerIds.toString()]){var r=function renderHandler(){i.map.isSourceLoaded(e.source)&&(!function getRenderedFeatures(){var t=function getUniqueFeatures(e,t){var i={};return e.filter(function(e){return!i[e.properties[t]]&&(i[e.properties[t]]=!0,!0)})}(i.map.queryRenderedFeatures({layers:e.layerIds}),e.uniqueKey);i.props.dispatch(e.action({features:t,zoom:i.map.getZoom()}))}(),i.map.off("render",renderHandler))};this.renderHandlers[e.layerIds.toString()]=r}this.map.off("render",this.renderHandlers[e.layerIds.toString()]),this.map.on("render",this.renderHandlers[e.layerIds.toString()]),t&&this.map.on("moveend",function(){i.map.on("render",i.renderHandlers[e.layerIds.toString()])})}},{key:"_resizeMap",value:function _resizeMap(){this.map.resize()}},{key:"_reloadSourcesData",value:function _reloadSourcesData(e){var t=this;(0,n.forIn)(e.sourcesState.data,function(e,i){e.metadata&&e.metadata.didChange&&t.map.getSource(i)&&("geojson"===e.type&&t.map.getSource(i).setData(e.data),"vector"===e.type&&(t.map.removeSource(i),t.map.addSource(i,(0,n.omit)(e,["metadata"])),c.mapConfig.renderedFeatures.map(function(e){e.source===i&&t._setRenderedFeaturesHandler(e)})))})}},{key:"_updateLayersStyle",value:function _updateLayersStyle(e){var t=this;(0,n.forIn)(e.layersState.data,function(e){var i=e.metadata&&e.metadata.didChange||{};t.map.getLayer(e.id)&&i.filter&&(t.map.setFilter(e.id,e.filter),c.mapConfig.renderedFeatures.map(function(i){i.layerIds.indexOf(e.id)>-1&&t._setRenderedFeaturesHandler(i)})),t.map.getLayer(e.id)&&i.zoom&&t.map.setLayerZoomRange(e.id,e.minzoom,e.maxzoom),t.map.getLayer(e.id)&&i.layout&&(0,n.forIn)(i.layout,function(i,r){t.map.setLayoutProperty(e.id,r,i)}),t.map.getLayer(e.id)&&i.paint&&(0,n.forIn)(i.paint,function(i,r){t.map.setPaintProperty(e.id,r,i)})})}},{key:"render",value:function render(){var e=this;return r.default.createElement("div",null,r.default.createElement("div",{style:{position:"absolute",width:"100%",height:"100%"},ref:function ref(t){e.mapContainer=t}}),this.props.layersState.pending&&r.default.createElement("div",{className:u.default.mapLoader},"Loading..."))}}]),Map}();f.propTypes={dispatch:l.default.func.isRequired,history:l.default.object.isRequired,isAdmin:l.default.bool,layersState:l.default.shape({pending:l.default.bool.isRequired,error:l.default.object,data:l.default.object}).isRequired,location:l.default.object.isRequired,match:l.default.object,sourcesState:l.default.shape({pending:l.default.bool.isRequired,error:l.default.object,data:l.default.object}).isRequired,world:l.default.shape({lat:l.default.number.isRequired,lng:l.default.number.isRequired,zoom:l.default.number.isRequired,shouldMapResize:l.default.bool}).isRequired};var m=(0,o.connect)(function(e){return{world:e.world,layersState:d(e),sourcesState:p(e),isAdmin:h(e)}})(f),g=(0,a.withRouter)(m);t.default=g},757:function(e,t,i){var r=i(758);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},758:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".map--mapLoader--19jlMfTX {\n\tposition:absolute;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-pack: center;\n\t    -ms-flex-pack: center;\n\t        justify-content: center;\n\t-webkit-box-align: center;\n\t    -ms-flex-align: center;\n\t        align-items: center;\n}","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Map/map.css"],names:[],mappings:"AAAA;CACC,kBAAkB;CAClB,YAAY;CACZ,aAAa;CACb,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,yBAAwB;KAAxB,sBAAwB;SAAxB,wBAAwB;CACxB,0BAAoB;KAApB,uBAAoB;SAApB,oBAAoB;CACpB",file:"map.css",sourcesContent:[".mapLoader {\n\tposition:absolute;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: center;\n\talign-items: center;\n}"],sourceRoot:""}]),t.locals={mapLoader:"map--mapLoader--19jlMfTX"}},759:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(1)),a=i(12),s=_interopRequireDefault(i(301)),l=a.actions.switchPreviewMode,c=function(e){function PreviewSwitch(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,PreviewSwitch),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(PreviewSwitch.__proto__||Object.getPrototypeOf(PreviewSwitch)).call(this,e)),t.switchPreviewMode=t.switchPreviewMode.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(PreviewSwitch,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(PreviewSwitch,[{key:"switchPreviewMode",value:function switchPreviewMode(){this.props.dispatch(l())}},{key:"render",value:function render(){return r.default.createElement("button",{className:s.default.previewSwitch,onClick:this.switchPreviewMode})}}]),PreviewSwitch}();c.propTypes={dispatch:o.default.func.isRequired};var u=(0,n.connect)(function(){return{}})(c);t.default=u},760:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".preview--previewSwitch--3SLwZsOQ {\n\tposition:absolute;\n\ttop: 5px;\n\tright: 5px;\n\theight: 25px;\n\twidth: 25px;\n\tborder: none;\n\tborder-top-right-radius: 10px;\n\tborder-right: 3px solid black;\n\tborder-top: 3px solid black;\n\tbackground: none;\n\tcursor: pointer;\n\tz-index: 3;\n}\n\n.preview--previewSwitch--3SLwZsOQ:focus {\n\toutline: none;\n}\n\n.preview--previewImageContainer--pIo1iRNc {\n\twidth: 100%;\n\theight: 100%;\n\tposition:relative;\n\tbackground-image: radial-gradient(ellipse, #1f2f35 0%, #0d1417 100%);\n}\n\n.preview--previewImage--2BnnNqoC {\n\twidth: 100%;\n\theight: 100%;\n\t-o-object-fit: scale-down;\n\t   object-fit: scale-down;\n}\n\n.preview--previewLoaderContainer--5Ll20JCn {\n\tposition:absolute;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-pack: center;\n\t    -ms-flex-pack: center;\n\t        justify-content: center;\n\t-webkit-box-align: center;\n\t    -ms-flex-align: center;\n\t        align-items: center;\n\tz-index: 2;\n}","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Medias/preview.css"],names:[],mappings:"AAAA;CACC,kBAAkB;CAClB,SAAS;CACT,WAAW;CACX,aAAa;CACb,YAAY;CACZ,aAAa;CACb,8BAA8B;CAC9B,8BAA8B;CAC9B,4BAA4B;CAC5B,iBAAiB;CACjB,gBAAgB;CAChB,WAAW;CACX;;AAED;CACC,cAAc;CACd;;AAED;CACC,YAAY;CACZ,aAAa;CACb,kBAAkB;CAClB,qEAAqE;CACrE;;AAED;CACC,YAAY;CACZ,aAAa;CACb,0BAAuB;IAAvB,uBAAuB;CACvB;;AAED;CACC,kBAAkB;CAClB,YAAY;CACZ,aAAa;CACb,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,yBAAwB;KAAxB,sBAAwB;SAAxB,wBAAwB;CACxB,0BAAoB;KAApB,uBAAoB;SAApB,oBAAoB;CACpB,WAAW;CACX",file:"preview.css",sourcesContent:[".previewSwitch {\n\tposition:absolute;\n\ttop: 5px;\n\tright: 5px;\n\theight: 25px;\n\twidth: 25px;\n\tborder: none;\n\tborder-top-right-radius: 10px;\n\tborder-right: 3px solid black;\n\tborder-top: 3px solid black;\n\tbackground: none;\n\tcursor: pointer;\n\tz-index: 3;\n}\n\n.previewSwitch:focus {\n\toutline: none;\n}\n\n.previewImageContainer {\n\twidth: 100%;\n\theight: 100%;\n\tposition:relative;\n\tbackground-image: radial-gradient(ellipse, #1f2f35 0%, #0d1417 100%);\n}\n\n.previewImage {\n\twidth: 100%;\n\theight: 100%;\n\tobject-fit: scale-down;\n}\n\n.previewLoaderContainer {\n\tposition:absolute;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tz-index: 2;\n}"],sourceRoot:""}]),t.locals={previewSwitch:"preview--previewSwitch--3SLwZsOQ",previewImageContainer:"preview--previewImageContainer--pIo1iRNc",previewImage:"preview--previewImage--2BnnNqoC",previewLoaderContainer:"preview--previewLoaderContainer--5Ll20JCn"}},761:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(1)),a=_interopRequireDefault(i(72)),s=_interopRequireDefault(i(296)),l=_interopRequireDefault(i(301)),c=_interopRequireDefault(i(762)),u=i(12),h=u.actions.switchPreviewMode,d=u.selectors.getMapPreviewMode,p=u.selectors.getSelectedMedias,f=u.selectors.getSelectedPointCloud,m=function(e){function ImagePreviewer(e){var t;return _classCallCheck(this,ImagePreviewer),t=_possibleConstructorReturn(this,(ImagePreviewer.__proto__||Object.getPrototypeOf(ImagePreviewer)).call(this,e)),t.state={loading:!0},t.handleLoadComplete=t.handleLoadComplete.bind(t),t.handleLoadError=t.handleLoadError.bind(t),t}return _inherits(ImagePreviewer,r.default.Component),_createClass(ImagePreviewer,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){e.media.properties._id!==this.props.media.properties._id&&this.setState({loading:!0}),e.previewMode!==this.props.previewMode&&this.setState({loading:!0})}},{key:"handleLoadError",value:function handleLoadError(e){e.target.src===this.props.media.properties.preview_url&&(e.target.src=this.props.media.properties.url),this.setState({loading:!1})}},{key:"handleLoadComplete",value:function handleLoadComplete(){this.setState({loading:!1})}},{key:"render",value:function render(){var e=this,t=this.props.previewMode?this.props.media.properties.preview_url:this.props.media.properties.url;return r.default.createElement("div",{className:l.default.previewImageContainer},this.state.loading&&r.default.createElement("div",{className:l.default.previewLoaderContainer},r.default.createElement(a.default,{type:"circular",mode:"indeterminate"})),r.default.createElement("img",{className:l.default.previewImage,src:t,onLoad:this.handleLoadComplete,onError:function onError(t){return e.handleLoadError(t)}}))}}]),ImagePreviewer}();m.propTypes={media:o.default.shape({properties:o.default.object,geometry:o.default.object}).isRequired,previewMode:o.default.bool};var g=function(e){function PointCloudPreviewer(e){var t;_classCallCheck(this,PointCloudPreviewer);var i=(t=_possibleConstructorReturn(this,(PointCloudPreviewer.__proto__||Object.getPrototypeOf(PointCloudPreviewer)).call(this,e))).props.pointCloud;return t.state={pointCloud:i},t}return _inherits(PointCloudPreviewer,r.default.Component),_createClass(PointCloudPreviewer,[{key:"render",value:function render(){return r.default.createElement(c.default,{className:l.default.previewImageContainer})}}]),PointCloudPreviewer}();g.propTypes={pointCloud:o.default.object.isRequired};var v=function(e){function Previewer(e){var t;return _classCallCheck(this,Previewer),t=_possibleConstructorReturn(this,(Previewer.__proto__||Object.getPrototypeOf(Previewer)).call(this,e)),t.state={isResizing:!1},t.handleDragStarted=t.handleDragStarted.bind(t),t.handleDragFinished=t.handleDragFinished.bind(t),t}return _inherits(Previewer,r.default.Component),_createClass(Previewer,[{key:"componentWillUnmount",value:function componentWillUnmount(){this.props.previewMode&&this.props.dispatch(h())}},{key:"handleDragStarted",value:function handleDragStarted(){this.setState({isResizing:!0})}},{key:"handleDragFinished",value:function handleDragFinished(){this.setState({isResizing:!1})}},{key:"render",value:function render(){var e={height:"12px",width:"100%",margin:"auto",background:"grey",borderLeft:"5px solid #ccc",cursor:"ns-resize",zIndex:"1"},t=Object.assign({},e,{borderLeft:"5px solid blue"}),i=r.default.createElement("div",null),n=r.default.createElement("div",null),o=!(!this.props.media||"image"!==this.props.media.properties.contentType),a=null!==this.props.pointCloud,l="100%",c=!1;return o&&!a?i=r.default.createElement(m,{media:this.props.media,previewMode:this.props.previewMode}):a&&!o?i=r.default.createElement(g,{pointCloud:this.props.pointCloud,previewMode:this.props.previewMode}):o&&a&&(i=r.default.createElement(m,{media:this.props.media,previewMode:this.props.previewMode}),n=r.default.createElement(g,{pointCloud:this.props.pointCloud,previewMode:this.props.previewMode}),c=!0,l="50%"),r.default.createElement(s.default,{split:"horizontal",defaultSize:l,allowResize:c,resizerStyle:this.state.isResizing?t:e,onDragStarted:this.handleDragStarted,onDragFinished:this.handleDragFinished},i,n,")}")}}]),Previewer}();v.propTypes={dispatch:o.default.func.isRequired,media:o.default.shape({properties:o.default.object,geometry:o.default.object}),pointCloud:o.default.object,previewMode:o.default.bool};var y=(0,n.connect)(function(e){var t=p(e),i=f(e);return{previewMode:d(e),showPreviewer:1===t.length||null!==i,media:t[0],pointCloud:i}})(v);t.default=y},762:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(1)),a=_interopRequireDefault(i(763)),s=_interopRequireDefault(i(818)),l=i(12),c=l.selectors.getSelectedMedias,u=l.selectors.getSelectFilterPending,h=l.selectors.getVisibleMedias,d=l.selectors.getSelectedPointCloud,p=l.actions.selectMediaById,f=function(e){function Potree(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Potree),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Potree.__proto__||Object.getPrototypeOf(Potree)).call(this,e)),t.hovered_cam_matrix=new THREE.Matrix4,t.viewer_cam_matrix=new THREE.Matrix4,t.raycaster=new THREE.Raycaster,t.mouse=new THREE.Vector2,t.mediaCamera_intersected=null,t.potreeIsLoading=!1,t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Potree,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Potree,[{key:"componentDidMount",value:function componentDidMount(){this.initViewer()}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){var t=this;if(!this.potreeIsLoading&&(0===this.potree.scene.pointclouds.length||e.pointCloud.metaData&&e.pointCloud.metaData._id!==this.props.pointCloud.metaData._id)&&(e.pointCloud.metaData&&e.pointCloud.metaData._id!==this.props.pointCloud.metaData._id&&(this.potree.scene.pointclouds=[]),e.pointCloud.metaData&&e.pointCloud.metaData._id)){this.potreeIsLoading=!0,a.default.loadPointCloud("potreeviewer/potreedataset/".concat(e.pointCloud.metaData._id,"/cloud.js"),e.pointCloud.metaData.name,function(e){t.potreeIsLoading=!1,t.potree.scene.addPointCloud(e.pointcloud),t.potree.fitToScreen()});var i=JSON.parse(e.pointCloud.metaData.visus);this.addCamerasToPotree(i),this.filterVisibleCamera(this.props.visibleMedias)}var r=this.props.selectedMedias[0],n=e.selectedMedias[0];if(!this.props.pointCloud.metaData||!n||r&&r.properties._id===n.properties._id)n||this.potree.fitToScreen();else{var o=this.potree.scene.scene.children.find(function(e){return e.userData.mediaId===n.properties._id});o&&(this.goToMediaCamera(o),o.loadMedia())}e.visibleMedias&&e.visibleMedias.length!==this.props.visibleMedias.length&&this.filterVisibleCamera(e.visibleMedias)}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return!1}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.potree.scene.pointclouds=[],this.potree.stopRendering()}},{key:"initViewer",value:function initViewer(){var e=this;window.viewer=this.potree=new a.default.Viewer(this.potreeContainer),this.potree.setEDLEnabled(!1),this.potree.setPointSize(3),this.potree.setMaterial("RGB"),this.potree.setFOV(60),this.potree.setQuality("Squares"),this.potree.setPointBudget(1e7),this.potree.startRendering(),this.potreeContainer.addEventListener("mousemove",function(t){e.onMouseMove(t)},!1),this.potreeContainer.addEventListener("mousedown",function(t){e.onMouseClick(t)},!1),this.potree.scene.scene.add(s.default.mediaPlane)}},{key:"addCamerasToPotree",value:function addCamerasToPotree(e){var t=this;e.map(function(e){if(e.camera3d&&e.camera3d.filename){var i=new s.default(e);t.potree.scene.scene.add(i)}})}},{key:"filterVisibleCamera",value:function filterVisibleCamera(e){this.potree.scene.scene.children.map(function(t){var i=e.some(function(e){return!(t instanceof s.default)||e.properties._id===t.userData.mediaId});t.visible=!!i})}},{key:"goToMediaCamera",value:function goToMediaCamera(e){var t=this,i=this.potree.scene.view.position.clone(),r=this.potree.scene.view.direction.clone();i.add(r.multiplyScalar(1));var n=e.getWorldDirection(),o=e.position.clone().sub(n),a=new THREE.Matrix4;new TWEEN.Tween(this.potree.scene.view.position).to({x:e.position.x,y:e.position.y,z:e.position.z},1e3).start(),new TWEEN.Tween(i).to({x:o.x,y:o.y,z:o.z},1e3).onUpdate(function(e){t.potree.scene.view.lookAt(e)}).start(),new TWEEN.Tween({}).to({},1e3).onUpdate(function(){var i=t.potree.scene.camera.matrix.clone();i.transpose(),a.multiplyMatrices(i,e.matrix);var r=t.potree.scene.camera.aspect,n=Math.abs(a.elements[0])+Math.abs(a.elements[4]),o=Math.abs(a.elements[1])+Math.abs(a.elements[5]),s=1*Math.max(n/r,o/1),l=2*Math.atan(1.1*s/(2*e.cam_scale.z));l=180*l/Math.PI,t.viewer_cam_matrix=t.potree.scene.camera.matrix.clone(),t.potree.setFOV(l)}).start()}},{key:"onMouseMove",value:function onMouseMove(e){var t=this.potree.renderer.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.left)/(t.right-t.left)*2-1,this.mouse.y=-(e.clientY-t.top)/(t.bottom-t.top)*2+1,this.raycaster.setFromCamera(this.mouse,this.potree.scene.camera);var i=this.raycaster.intersectObjects(this.potree.scene.scene.children);if(i.length>0&&i[0].object.userData.mediaId?this.mediaCamera_intersected&&this.mediaCamera_intersected.uuid===i[0].object.uuid||(this.mediaCamera_intersected&&this.mediaCamera_intersected.toggleSelection(),this.mediaCamera_intersected=i[0].object,this.mediaCamera_intersected.toggleSelection()):this.mediaCamera_intersected&&(this.mediaCamera_intersected.toggleSelection(),this.mediaCamera_intersected=null),4===e.buttons&&this.mediaCamera_intersected){var r=.25*this.mouse.x*Math.PI,n=-.5*this.mouse.y*Math.PI/2,o=new THREE.Matrix4,a=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4;a.makeRotationX(n),s.makeRotationY(r),o.multiplyMatrices(a,s),this.hovered_cam_matrix=this.mediaCamera_intersected.matrix.clone(),l.copy(this.viewer_cam_matrix),o.multiplyMatrices(l,o);var c=new THREE.Vector3(o.elements[8],o.elements[9],o.elements[10]),u=new THREE.Vector3(this.hovered_cam_matrix.elements[12],this.hovered_cam_matrix.elements[13],this.hovered_cam_matrix.elements[14]);u.sub(c),this.potree.scene.view.lookAt(u)}}},{key:"onMouseClick",value:function onMouseClick(e){var t=e||window.event;("which"in t&&3===t.which||"button"in t&&2===t.button)&&this.mediaCamera_intersected&&(this.mediaCamera_intersected.loadMedia(),this.props.selectedMedias[0]&&this.props.selectedMedias[0].properties._id===this.mediaCamera_intersected.userData.mediaId||this.props.dispatch(p({mediaId:this.mediaCamera_intersected.userData.mediaId})))}},{key:"render",value:function render(){var e=this;return r.default.createElement("div",{id:"potree",style:{position:"absolute",width:"100%",height:"100%"},ref:function ref(t){return e.potreeContainer=t}})}}]),Potree}();f.propTypes={dispatch:o.default.func.isRequired,pointCloud:o.default.object,selectedMedias:o.default.arrayOf(o.default.object),visibleMedias:o.default.arrayOf(o.default.object)};var m=(0,n.connect)(function(e){return{pointCloud:d(e),selectedMedias:c(e),visibleMedias:h(e),selectFilterPending:u(e)}})(f);t.default=m},763:function(e,t,i){var r,n=i(764),o=i(765),a=i(766),s=i(767),l=i(768),c=i(769);i(770),i(771),i(772),i(773),i(774),i(775),i(776),i(777),i(778),i(779),i(780),i(781),i(782),i(783),i(784),i(785),i(786),i(787),i(788),i(789),i(790),i(791),i(792),i(793),i(794),i(795),i(796),i(797),i(798),i(799),i(800),i(801),i(802),i(803),i(804),i(805),i(806),i(807),i(808),i(809),i(810),i(811),i(812),i(813),i(814),i(815),i(816),window.THREE=n||{},window.proj4=o||{},window.TWEEN=a||{},window.Stats=s||{},r=i(817),window.Potree=r||{},window.$=window.jQuery=c,window.BinaryHeap=l,e.exports=r},764:function(e,t,i){!function(e,i){i(t)}(0,function(e){"use strict";function EventDispatcher(){}function Vector2(e,t){this.x=e||0,this.y=t||0}function Texture(e,t,i,r,n,o,a,s,l,c){Object.defineProperty(this,"id",{value:ht++}),this.uuid=ut.generateUUID(),this.name="",this.image=void 0!==e?e:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:he,this.wrapT=void 0!==r?r:he,this.magFilter=void 0!==n?n:ve,this.minFilter=void 0!==o?o:be,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Oe,this.type=void 0!==s?s:we,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:tt,this.version=0,this.onUpdate=null}function Vector4(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1}function WebGLRenderTarget(e,t,i){this.uuid=ut.generateUUID(),this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),void 0===(i=i||{}).minFilter&&(i.minFilter=ve),this.texture=new Texture(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function WebGLRenderTargetCube(e,t,i){WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0,this.activeMipMapLevel=0}function Quaternion(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1}function Vector3(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}function Matrix4(){this.elements=new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function CubeTexture(e,t,i,r,n,o,a,s,l,c){Texture.call(this,e=void 0!==e?e:[],t=void 0!==t?t:ie,i,r,n,o,a,s,l,c),this.flipY=!1}function UniformContainer(){this.seq=[],this.map={}}function flatten(e,t,i){var r=e[0];if(r<=0||r>0)return e;var n=t*i,o=ft[n];if(void 0===o&&(o=new Float32Array(n),ft[n]=o),0!==t){r.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=i,e[a].toArray(o,s)}return o}function allocTexUnits(e,t){var i=mt[t];void 0===i&&(i=new Int32Array(t),mt[t]=i);for(var r=0;r!==t;++r)i[r]=e.allocTextureUnit();return i}function setValue1f(e,t){e.uniform1f(this.addr,t)}function setValue1i(e,t){e.uniform1i(this.addr,t)}function setValue2fv(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function setValue3fv(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)}function setValue4fv(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function setValue2fm(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function setValue3fm(e,t){e.uniformMatrix3fv(this.addr,!1,t.elements||t)}function setValue4fm(e,t){e.uniformMatrix4fv(this.addr,!1,new Float32Array(t.elements)||t)}function setValueT1(e,t,i){var r=i.allocTextureUnit();e.uniform1i(this.addr,r),i.setTexture2D(t||dt,r)}function setValueT6(e,t,i){var r=i.allocTextureUnit();e.uniform1i(this.addr,r),i.setTextureCube(t||pt,r)}function setValue2iv(e,t){e.uniform2iv(this.addr,t)}function setValue3iv(e,t){e.uniform3iv(this.addr,t)}function setValue4iv(e,t){e.uniform4iv(this.addr,t)}function setValue1fv(e,t){e.uniform1fv(this.addr,t)}function setValue1iv(e,t){e.uniform1iv(this.addr,t)}function setValueV2a(e,t){e.uniform2fv(this.addr,flatten(t,this.size,2))}function setValueV3a(e,t){e.uniform3fv(this.addr,flatten(t,this.size,3))}function setValueV4a(e,t){e.uniform4fv(this.addr,flatten(t,this.size,4))}function setValueM2a(e,t){e.uniformMatrix2fv(this.addr,!1,flatten(t,this.size,4))}function setValueM3a(e,t){e.uniformMatrix3fv(this.addr,!1,flatten(t,this.size,9))}function setValueM4a(e,t){e.uniformMatrix4fv(this.addr,!1,flatten(t,this.size,16))}function setValueT1a(e,t,i){var r=t.length,n=allocTexUnits(i,r);e.uniform1iv(this.addr,n);for(var o=0;o!==r;++o)i.setTexture2D(t[o]||dt,n[o])}function setValueT6a(e,t,i){var r=t.length,n=allocTexUnits(i,r);e.uniform1iv(this.addr,n);for(var o=0;o!==r;++o)i.setTextureCube(t[o]||pt,n[o])}function SingleUniform(e,t,i){this.id=e,this.addr=i,this.setValue=function getSingularSetter(e){switch(e){case 5126:return setValue1f;case 35664:return setValue2fv;case 35665:return setValue3fv;case 35666:return setValue4fv;case 35674:return setValue2fm;case 35675:return setValue3fm;case 35676:return setValue4fm;case 35678:return setValueT1;case 35680:return setValueT6;case 5124:case 35670:return setValue1i;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}(t.type)}function PureArrayUniform(e,t,i){this.id=e,this.addr=i,this.size=t.size,this.setValue=function getPureArraySetter(e){switch(e){case 5126:return setValue1fv;case 35664:return setValueV2a;case 35665:return setValueV3a;case 35666:return setValueV4a;case 35674:return setValueM2a;case 35675:return setValueM3a;case 35676:return setValueM4a;case 35678:return setValueT1a;case 35680:return setValueT6a;case 5124:case 35670:return setValue1iv;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}(t.type)}function StructuredUniform(e){this.id=e,UniformContainer.call(this)}function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,i){var r=e.name,n=r.length;for(gt.lastIndex=0;;){var o=gt.exec(r),a=gt.lastIndex,s=o[1],l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===n){addUniform(i,void 0===c?new SingleUniform(s,e,t):new PureArrayUniform(s,e,t));break}var u=i.map[s];void 0===u&&addUniform(i,u=new StructuredUniform(s)),i=u}}function WebGLUniforms(e,t,i){UniformContainer.call(this),this.renderer=i;for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n!==r;++n){var o=e.getActiveUniform(t,n),a=o.name;parseUniform(o,e.getUniformLocation(t,a),this)}}function Color(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}function DataTexture(e,t,i,r,n,o,a,s,l,c,u,h){Texture.call(this,null,o,a,s,l,c,r,n,u,h),this.image={data:e,width:t,height:i},this.magFilter=void 0!==l?l:fe,this.minFilter=void 0!==c?c:fe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Box2(e,t){this.min=void 0!==e?e:new Vector2(1/0,1/0),this.max=void 0!==t?t:new Vector2(-1/0,-1/0)}function LensFlarePlugin(e,t){function init(){var t=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),d=new Uint16Array([0,1,2,0,2,3]);i=u.createBuffer(),r=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,i),u.bufferData(u.ARRAY_BUFFER,t,u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),u.bufferData(u.ELEMENT_ARRAY_BUFFER,d,u.STATIC_DRAW),l=u.createTexture(),c=u.createTexture(),h.bindTexture(u.TEXTURE_2D,l),u.texImage2D(u.TEXTURE_2D,0,u.RGB,16,16,0,u.RGB,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),h.bindTexture(u.TEXTURE_2D,c),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,16,16,0,u.RGBA,u.UNSIGNED_BYTE,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),n={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},o=function createProgram(t){var i=u.createProgram(),r=u.createShader(u.FRAGMENT_SHADER),n=u.createShader(u.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return u.shaderSource(r,o+t.fragmentShader),u.shaderSource(n,o+t.vertexShader),u.compileShader(r),u.compileShader(n),u.attachShader(i,r),u.attachShader(i,n),u.linkProgram(i),i}(n),a={vertex:u.getAttribLocation(o,"position"),uv:u.getAttribLocation(o,"uv")},s={renderType:u.getUniformLocation(o,"renderType"),map:u.getUniformLocation(o,"map"),occlusionMap:u.getUniformLocation(o,"occlusionMap"),opacity:u.getUniformLocation(o,"opacity"),color:u.getUniformLocation(o,"color"),scale:u.getUniformLocation(o,"scale"),rotation:u.getUniformLocation(o,"rotation"),screenPosition:u.getUniformLocation(o,"screenPosition")}}var i,r,n,o,a,s,l,c,u=e.context,h=e.state;this.render=function(n,d,p){if(0!==t.length){var f=new Vector3,m=p.w/p.z,g=.5*p.z,v=.5*p.w,y=16/p.w,b=new Vector2(y*m,y),x=new Vector3(1,1,0),w=new Vector2(1,1),_=new Box2;_.min.set(p.x,p.y),_.max.set(p.x+(p.z-16),p.y+(p.w-16)),void 0===o&&init(),u.useProgram(o),h.initAttributes(),h.enableAttribute(a.vertex),h.enableAttribute(a.uv),h.disableUnusedAttributes(),u.uniform1i(s.occlusionMap,0),u.uniform1i(s.map,1),u.bindBuffer(u.ARRAY_BUFFER,i),u.vertexAttribPointer(a.vertex,2,u.FLOAT,!1,16,0),u.vertexAttribPointer(a.uv,2,u.FLOAT,!1,16,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),h.disable(u.CULL_FACE),h.setDepthWrite(!1);for(var E=0,M=t.length;E<M;E++){y=16/p.w,b.set(y*m,y);var A=t[E];if(f.set(A.matrixWorld.elements[12],A.matrixWorld.elements[13],A.matrixWorld.elements[14]),f.applyMatrix4(d.matrixWorldInverse),f.applyProjection(d.projectionMatrix),x.copy(f),w.x=p.x+x.x*g+g-8,w.y=p.y+x.y*v+v-8,!0===_.containsPoint(w)){h.activeTexture(u.TEXTURE0),h.bindTexture(u.TEXTURE_2D,null),h.activeTexture(u.TEXTURE1),h.bindTexture(u.TEXTURE_2D,l),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGB,w.x,w.y,16,16,0),u.uniform1i(s.renderType,0),u.uniform2f(s.scale,b.x,b.y),u.uniform3f(s.screenPosition,x.x,x.y,x.z),h.disable(u.BLEND),h.enable(u.DEPTH_TEST),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),h.activeTexture(u.TEXTURE0),h.bindTexture(u.TEXTURE_2D,c),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,w.x,w.y,16,16,0),u.uniform1i(s.renderType,1),h.disable(u.DEPTH_TEST),h.activeTexture(u.TEXTURE1),h.bindTexture(u.TEXTURE_2D,l),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),A.positionScreen.copy(x),A.customUpdateCallback?A.customUpdateCallback(A):A.updateLensFlares(),u.uniform1i(s.renderType,2),h.enable(u.BLEND);for(var T=0,S=A.lensFlares.length;T<S;T++){var P=A.lensFlares[T];P.opacity>.001&&P.scale>.001&&(x.x=P.x,x.y=P.y,x.z=P.z,y=P.size*P.scale/p.w,b.x=y*m,b.y=y,u.uniform3f(s.screenPosition,x.x,x.y,x.z),u.uniform2f(s.scale,b.x,b.y),u.uniform1f(s.rotation,P.rotation),u.uniform1f(s.opacity,P.opacity),u.uniform3f(s.color,P.color.r,P.color.g,P.color.b),h.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),e.setTexture2D(P.texture,1),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0))}}}h.enable(u.CULL_FACE),h.enable(u.DEPTH_TEST),h.setDepthWrite(!0),e.resetGLState()}}}function SpritePlugin(e,t){function init(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),c=new Uint16Array([0,1,2,0,2,3]);i=l.createBuffer(),r=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,i),l.bufferData(l.ARRAY_BUFFER,t,l.STATIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),l.bufferData(l.ELEMENT_ARRAY_BUFFER,c,l.STATIC_DRAW),n=function createProgram(){var t=l.createProgram(),i=l.createShader(l.VERTEX_SHADER),r=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),l.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),l.compileShader(i),l.compileShader(r),l.attachShader(t,i),l.attachShader(t,r),l.linkProgram(t),t}(),o={position:l.getAttribLocation(n,"position"),uv:l.getAttribLocation(n,"uv")},a={uvOffset:l.getUniformLocation(n,"uvOffset"),uvScale:l.getUniformLocation(n,"uvScale"),rotation:l.getUniformLocation(n,"rotation"),scale:l.getUniformLocation(n,"scale"),color:l.getUniformLocation(n,"color"),map:l.getUniformLocation(n,"map"),opacity:l.getUniformLocation(n,"opacity"),modelViewMatrix:l.getUniformLocation(n,"modelViewMatrix"),projectionMatrix:l.getUniformLocation(n,"projectionMatrix"),fogType:l.getUniformLocation(n,"fogType"),fogDensity:l.getUniformLocation(n,"fogDensity"),fogNear:l.getUniformLocation(n,"fogNear"),fogFar:l.getUniformLocation(n,"fogFar"),fogColor:l.getUniformLocation(n,"fogColor"),alphaTest:l.getUniformLocation(n,"alphaTest")};var u=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");u.width=8,u.height=8;var h=u.getContext("2d");h.fillStyle="white",h.fillRect(0,0,8,8),(s=new Texture(u)).needsUpdate=!0}function painterSortStable(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}var i,r,n,o,a,s,l=e.context,c=e.state,u=new Vector3,h=new Quaternion,d=new Vector3;this.render=function(p,f){if(0!==t.length){void 0===n&&init(),l.useProgram(n),c.initAttributes(),c.enableAttribute(o.position),c.enableAttribute(o.uv),c.disableUnusedAttributes(),c.disable(l.CULL_FACE),c.enable(l.BLEND),l.bindBuffer(l.ARRAY_BUFFER,i),l.vertexAttribPointer(o.position,2,l.FLOAT,!1,16,0),l.vertexAttribPointer(o.uv,2,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),l.uniformMatrix4fv(a.projectionMatrix,!1,new Float32Array(f.projectionMatrix.elements)),c.activeTexture(l.TEXTURE0),l.uniform1i(a.map,0);var m=0,g=0,v=p.fog;v?(l.uniform3f(a.fogColor,v.color.r,v.color.g,v.color.b),v.isFog?(l.uniform1f(a.fogNear,v.near),l.uniform1f(a.fogFar,v.far),l.uniform1i(a.fogType,1),m=1,g=1):v.isFogExp2&&(l.uniform1f(a.fogDensity,v.density),l.uniform1i(a.fogType,2),m=2,g=2)):(l.uniform1i(a.fogType,0),m=0,g=0);for(var y=0,b=t.length;y<b;y++){(w=t[y]).modelViewMatrix.multiplyMatrices(f.matrixWorldInverse,w.matrixWorld),w.z=-w.modelViewMatrix.elements[14]}t.sort(painterSortStable);var x=[];for(y=0,b=t.length;y<b;y++){var w,_=(w=t[y]).material;if(!1!==_.visible){l.uniform1f(a.alphaTest,_.alphaTest),l.uniformMatrix4fv(a.modelViewMatrix,!1,new Float32Array(w.modelViewMatrix.elements)),w.matrixWorld.decompose(u,h,d),x[0]=d.x,x[1]=d.y;var E=0;p.fog&&_.fog&&(E=g),m!==E&&(l.uniform1i(a.fogType,E),m=E),null!==_.map?(l.uniform2f(a.uvOffset,_.map.offset.x,_.map.offset.y),l.uniform2f(a.uvScale,_.map.repeat.x,_.map.repeat.y)):(l.uniform2f(a.uvOffset,0,0),l.uniform2f(a.uvScale,1,1)),l.uniform1f(a.opacity,_.opacity),l.uniform3f(a.color,_.color.r,_.color.g,_.color.b),l.uniform1f(a.rotation,_.rotation),l.uniform2fv(a.scale,x),c.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),c.setDepthTest(_.depthTest),c.setDepthWrite(_.depthWrite),_.map?e.setTexture2D(_.map,0):e.setTexture2D(s,0),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0)}}c.enable(l.CULL_FACE),e.resetGLState()}}}function Material(){Object.defineProperty(this,"id",{value:wt++}),this.uuid=ut.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=y,this.side=l,this.shading=d,this.vertexColors=p,this.opacity=1,this.transparent=!1,this.blendSrc=D,this.blendDst=I,this.blendEquation=M,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=V,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0}function ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function MeshDepthMaterial(e){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=lt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function Box3(e,t){this.min=void 0!==e?e:new Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Vector3(-1/0,-1/0,-1/0)}function Sphere(e,t){this.center=void 0!==e?e:new Vector3,this.radius=void 0!==t?t:0}function Matrix3(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function Plane(e,t){this.normal=void 0!==e?e:new Vector3(1,0,0),this.constant=void 0!==t?t:0}function Frustum(e,t,i,r,n,o){this.planes=[void 0!==e?e:new Plane,void 0!==t?t:new Plane,void 0!==i?i:new Plane,void 0!==r?r:new Plane,void 0!==n?n:new Plane,void 0!==o?o:new Plane]}function WebGLShadowMap(e,t,i,r){function getDepthMaterial(t,i,r,n){var o=t.geometry,a=null,s=w,h=t.customDepthMaterial;if(r&&(s=_,h=t.customDistanceMaterial),h)a=h;else{var d=!1;i.morphTargets&&(o&&o.isBufferGeometry?d=o.morphAttributes&&o.morphAttributes.position&&o.morphAttributes.position.length>0:o&&o.isGeometry&&(d=o.morphTargets&&o.morphTargets.length>0));var p=t.isSkinnedMesh&&i.skinning,f=0;d&&(f|=y),p&&(f|=b),a=s[f]}if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var m=a.uuid,g=i.uuid,v=E[m];void 0===v&&(v={},E[m]=v);var x=v[g];void 0===x&&(x=a.clone(),v[g]=x),a=x}a.visible=i.visible,a.wireframe=i.wireframe;var M=i.side;return O.renderSingleSided&&M==u&&(M=l),O.renderReverseSided&&(M===l?M=c:M===c&&(M=l)),a.side=M,a.clipShadows=i.clipShadows,a.clippingPlanes=i.clippingPlanes,a.wireframeLinewidth=i.wireframeLinewidth,a.linewidth=i.linewidth,r&&void 0!==a.uniforms.lightPos&&a.uniforms.lightPos.value.copy(n),a}function projectObject(e,t,i){if(!1!==e.visible){if(0!=(e.layers.mask&t.layers.mask)&&(e.isMesh||e.isLine||e.isPoints)&&e.castShadow&&(!1===e.frustumCulled||!0===s.intersectsObject(e))){!0===e.material.visible&&(e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),v.push(e))}for(var r=e.children,n=0,o=r.length;n<o;n++)projectObject(r[n],t,i)}}var n=e.context,o=e.state,s=new Frustum,h=new Matrix4,d=t.shadows,p=new Vector2,f=new Vector2(r.maxTextureSize,r.maxTextureSize),m=new Vector3,g=new Vector3,v=[],y=1,b=2,x=1+(y|b),w=new Array(x),_=new Array(x),E={},M=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],A=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],T=[new Vector4,new Vector4,new Vector4,new Vector4,new Vector4,new Vector4],S=new MeshDepthMaterial;S.depthPacking=ct,S.clipping=!0;for(var P=xt.distanceRGBA,C=Object.assign({},P.uniforms),R=0;R!==x;++R){var L=0!=(R&y),B=0!=(R&b),D=S.clone();D.morphTargets=L,D.skinning=B,w[R]=D;var I=new ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:C,vertexShader:P.vertexShader,fragmentShader:P.fragmentShader,morphTargets:L,skinning:B,clipping:!0});_[R]=I}var O=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=a,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(t,r){if(!1!==O.enabled&&(!1!==O.autoUpdate||!1!==O.needsUpdate)&&0!==d.length){o.buffers.color.setClear(1,1,1,1),o.disable(n.BLEND),o.setDepthTest(!0),o.setScissorTest(!1);for(var a,l,c=0,u=d.length;c<u;c++){var y=d[c],b=y.shadow;if(void 0!==b){var x=b.camera;if(p.copy(b.mapSize),p.min(f),y&&y.isPointLight){a=6,l=!0;var w=p.x,_=p.y;T[0].set(2*w,_,w,_),T[1].set(0,_,w,_),T[2].set(3*w,_,w,_),T[3].set(w,_,w,_),T[4].set(3*w,0,w,_),T[5].set(w,0,w,_),p.x*=4,p.y*=2}else a=1,l=!1;if(null===b.map){var E={minFilter:fe,magFilter:fe,format:Oe};b.map=new WebGLRenderTarget(p.x,p.y,E),x.updateProjectionMatrix()}b.isSpotLightShadow&&b.update(y),b&&b.isRectAreaLightShadow&&b.update(y);var S=b.map,P=b.matrix;g.setFromMatrixPosition(y.matrixWorld),x.position.copy(g),e.setRenderTarget(S),e.clear();for(var C=0;C<a;C++){if(l){m.copy(x.position),m.add(M[C]),x.up.copy(A[C]),x.lookAt(m);var R=T[C];o.viewport(R)}else m.setFromMatrixPosition(y.target.matrixWorld),x.lookAt(m);x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(x.projectionMatrix),P.multiply(x.matrixWorldInverse),h.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),s.setFromMatrix(h),v.length=0,projectObject(t,r,x);for(var L=0,B=v.length;L<B;L++){var D=v[L],I=i.update(D),N=D.material;if(N&&N.isMultiMaterial)for(var k=I.groups,F=N.materials,U=0,H=k.length;U<H;U++){var z=k[U],G=F[z.materialIndex];if(!0===G.visible){var V=getDepthMaterial(D,G,l,g);e.renderBufferDirect(x,null,I,V,D,z)}}else{V=getDepthMaterial(D,N,l,g);e.renderBufferDirect(x,null,I,V,D,null)}}}}else console.warn("THREE.WebGLShadowMap:",y,"has no shadow.")}var j=e.getClearColor(),W=e.getClearAlpha();e.setClearColor(j,W),O.needsUpdate=!1}}}function Ray(e,t){this.origin=void 0!==e?e:new Vector3,this.direction=void 0!==t?t:new Vector3}function Euler(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||Euler.DefaultOrder}function Layers(){this.mask=1}function Object3D(){Object.defineProperty(this,"id",{value:_t++}),this.uuid=ut.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3,t=new Euler,i=new Quaternion,r=new Vector3(1,1,1);t.onChange(function onRotationChange(){i.setFromEuler(t,!1)}),i.onChange(function onQuaternionChange(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={},this.onBeforeRender=function(){},this.onAfterRender=function(){}}function Line3(e,t){this.start=void 0!==e?e:new Vector3,this.end=void 0!==t?t:new Vector3}function Triangle(e,t,i){this.a=void 0!==e?e:new Vector3,this.b=void 0!==t?t:new Vector3,this.c=void 0!==i?i:new Vector3}function Face3(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Color,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==o?o:0}function MeshBasicMaterial(e){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function BufferAttribute(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=ut.generateUUID(),this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function Int8BufferAttribute(e,t){BufferAttribute.call(this,new Int8Array(e),t)}function Uint8BufferAttribute(e,t){BufferAttribute.call(this,new Uint8Array(e),t)}function Uint8ClampedBufferAttribute(e,t){BufferAttribute.call(this,new Uint8ClampedArray(e),t)}function Int16BufferAttribute(e,t){BufferAttribute.call(this,new Int16Array(e),t)}function Uint16BufferAttribute(e,t){BufferAttribute.call(this,new Uint16Array(e),t)}function Int32BufferAttribute(e,t){BufferAttribute.call(this,new Int32Array(e),t)}function Uint32BufferAttribute(e,t){BufferAttribute.call(this,new Uint32Array(e),t)}function Float32BufferAttribute(e,t){BufferAttribute.call(this,new Float32Array(e),t)}function Float64BufferAttribute(e,t){BufferAttribute.call(this,new Float64Array(e),t)}function DirectGeometry(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Geometry(){Object.defineProperty(this,"id",{value:GeometryIdCount()}),this.uuid=ut.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function GeometryIdCount(){return Et++}function BufferGeometry(){Object.defineProperty(this,"id",{value:GeometryIdCount()}),this.uuid=ut.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Mesh(e,t){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=Ze,this.updateMorphTargets()}function BoxBufferGeometry(e,t,i,r,n,o){function buildPlane(e,t,i,r,n,o,s,l,y,b,x){for(var w=o/y,_=s/b,E=o/2,M=s/2,A=l/2,T=y+1,S=b+1,P=0,C=0,R=new Vector3,L=0;L<S;L++)for(var B=L*_-M,D=0;D<T;D++){var I=D*w-E;R[e]=I*r,R[t]=B*n,R[i]=A,u[p]=R.x,u[p+1]=R.y,u[p+2]=R.z,R[e]=0,R[t]=0,R[i]=l>0?1:-1,h[p]=R.x,h[p+1]=R.y,h[p+2]=R.z,d[f]=D/y,d[f+1]=1-L/b,p+=3,f+=2,P+=1}for(L=0;L<b;L++)for(D=0;D<y;D++){var O=g+D+T*L,N=g+D+T*(L+1),k=g+(D+1)+T*(L+1),F=g+(D+1)+T*L;c[m]=O,c[m+1]=N,c[m+2]=F,c[m+3]=N,c[m+4]=k,c[m+5]=F,m+=6,C+=6}a.addGroup(v,C,x),v+=C,g+=P}BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o};var a=this,s=function calculateVertexCount(e,t,i){var r=0;return r+=(e+1)*(t+1)*2,r+=(e+1)*(i+1)*2,r+=(i+1)*(t+1)*2}(r=Math.floor(r)||1,n=Math.floor(n)||1,o=Math.floor(o)||1),l=function calculateIndexCount(e,t,i){var r=0;return r+=e*t*2,r+=e*i*2,6*(r+=i*t*2)}(r,n,o),c=new(l>65535?Uint32Array:Uint16Array)(l),u=new Float32Array(3*s),h=new Float32Array(3*s),d=new Float32Array(2*s),p=0,f=0,m=0,g=0,v=0;buildPlane("z","y","x",-1,-1,i,t,e,o,n,0),buildPlane("z","y","x",1,-1,i,t,-e,o,n,1),buildPlane("x","z","y",1,1,e,i,t,r,o,2),buildPlane("x","z","y",1,-1,e,i,-t,r,o,3),buildPlane("x","y","z",1,-1,e,t,i,r,n,4),buildPlane("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(new BufferAttribute(c,1)),this.addAttribute("position",new BufferAttribute(u,3)),this.addAttribute("normal",new BufferAttribute(h,3)),this.addAttribute("uv",new BufferAttribute(d,2))}function PlaneBufferGeometry(e,t,i,r){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};for(var n=e/2,o=t/2,a=Math.floor(i)||1,s=Math.floor(r)||1,l=a+1,c=s+1,u=e/a,h=t/s,d=new Float32Array(l*c*3),p=new Float32Array(l*c*3),f=new Float32Array(l*c*2),m=0,g=0,v=0;v<c;v++)for(var y=v*h-o,b=0;b<l;b++){var x=b*u-n;d[m]=x,d[m+1]=-y,p[m+2]=1,f[g]=b/a,f[g+1]=1-v/s,m+=3,g+=2}m=0;var w=new(d.length/3>65535?Uint32Array:Uint16Array)(a*s*6);for(v=0;v<s;v++)for(b=0;b<a;b++){var _=b+l*v,E=b+l*(v+1),M=b+1+l*(v+1),A=b+1+l*v;w[m]=_,w[m+1]=E,w[m+2]=A,w[m+3]=E,w[m+4]=M,w[m+5]=A,m+=6}this.setIndex(new BufferAttribute(w,1)),this.addAttribute("position",new BufferAttribute(d,3)),this.addAttribute("normal",new BufferAttribute(p,3)),this.addAttribute("uv",new BufferAttribute(f,2))}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4}function PerspectiveCamera(e,t,i,r){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function OrthographicCamera(e,t,i,r,n,o){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function WebGLShader(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),!1===e.getShaderParameter(r,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(r),function addLineNumbers(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(i)),r}function getEncodingComponents(e){switch(e){case tt:return["Linear","( value )"];case it:return["sRGB","( value )"];case nt:return["RGBE","( value )"];case ot:return["RGBM","( value, 7.0 )"];case at:return["RGBM","( value, 16.0 )"];case st:return["RGBD","( value, 256.0 )"];case rt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function getTexelDecodingFunction(e,t){var i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function parseIncludes(e){return e.replace(/#include +<([\w\d.]+)>/g,function replace(e,t){var i=vt[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return parseIncludes(i)})}function unrollLoops(e){return e.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function replace(e,t,i,r){for(var n="",o=parseInt(t);o<parseInt(i);o++)n+=r.replace(/\[ i \]/g,"[ "+o+" ]");return n})}function WebGLProgram(e,t,i,r){var n=e.context,o=i.extensions,l=i.defines,c=i.__webglShader.vertexShader,u=i.__webglShader.fragmentShader,h="SHADOWMAP_TYPE_BASIC";r.shadowMapType===a?h="SHADOWMAP_TYPE_PCF":r.shadowMapType===s&&(h="SHADOWMAP_TYPE_PCF_SOFT");var d="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(i.envMap.mapping){case ie:case re:d="ENVMAP_TYPE_CUBE";break;case se:case le:d="ENVMAP_TYPE_CUBE_UV";break;case ne:case oe:d="ENVMAP_TYPE_EQUIREC";break;case ae:d="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case re:case oe:p="ENVMAP_MODE_REFRACTION"}switch(i.combine){case Y:f="ENVMAP_BLENDING_MULTIPLY";break;case $:f="ENVMAP_BLENDING_MIX";break;case K:f="ENVMAP_BLENDING_ADD"}}var m,g,v=e.gammaFactor>0?e.gammaFactor:1,y=function generateExtensions(e,t,i){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(o,r,e.extensions),b=function generateDefines(e){var t=[];for(var i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}(l),x=n.createProgram();i.isRawShaderMaterial?(m=[b,"\n"].filter(filterEmptyLine).join("\n"),g=[y,b,"\n"].filter(filterEmptyLine).join("\n")):(m=["precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+i.__webglShader.name,b,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+p:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+h:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&e.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),g=[y,"precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+i.__webglShader.name,b,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"","#define GAMMA_FACTOR "+v,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+d:"",r.envMap?"#define "+p:"",r.envMap?"#define "+f:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(r.numClippingPlanes-r.numClipIntersection),r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+h:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&e.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",r.envMap&&e.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",r.toneMapping!==Q?"#define TONE_MAPPING":"",r.toneMapping!==Q?vt.tonemapping_pars_fragment:"",r.toneMapping!==Q?function getToneMappingFunction(e,t){var i;switch(t){case Z:i="Linear";break;case J:i="Reinhard";break;case ee:i="Uncharted2";break;case te:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}("toneMapping",r.toneMapping):"",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?vt.encodings_pars_fragment:"",r.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",r.mapEncoding):"",r.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.outputEncoding?function getTexelEncodingFunction(e,t){var i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}("linearToOutputTexel",r.outputEncoding):"",r.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),c=replaceLightNums(c=parseIncludes(c),r),u=replaceLightNums(u=parseIncludes(u),r),i.isShaderMaterial||(c=unrollLoops(c),u=unrollLoops(u));var w=m+c,_=g+u,E=WebGLShader(n,n.VERTEX_SHADER,w),M=WebGLShader(n,n.FRAGMENT_SHADER,_);n.attachShader(x,E),n.attachShader(x,M),void 0!==i.index0AttributeName?n.bindAttribLocation(x,0,i.index0AttributeName):!0===r.morphTargets&&n.bindAttribLocation(x,0,"position"),n.linkProgram(x);var A=n.getProgramInfoLog(x),T=n.getShaderInfoLog(E),S=n.getShaderInfoLog(M),P=!0,C=!0;!1===n.getProgramParameter(x,n.LINK_STATUS)?(P=!1,console.error("THREE.WebGLProgram: shader error: ",n.getError(),"gl.VALIDATE_STATUS",n.getProgramParameter(x,n.VALIDATE_STATUS),"gl.getProgramInfoLog",A,T,S)):""!==A?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",A):""!==T&&""!==S||(C=!1),C&&(this.diagnostics={runnable:P,material:i,programLog:A,vertexShader:{log:T,prefix:m},fragmentShader:{log:S,prefix:g}}),n.deleteShader(E),n.deleteShader(M);var R;this.getUniforms=function(){return void 0===R&&(R=new WebGLUniforms(n,x,e)),R};var L;return this.getAttributes=function(){return void 0===L&&(L=function fetchAttributeLocations(e,t,i){for(var r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<n;o++){var a=e.getActiveAttrib(t,o).name;r[a]=e.getAttribLocation(t,a)}return r}(n,x)),L},this.destroy=function(){n.deleteProgram(x),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=Mt++,this.code=t,this.usedTimes=1,this.program=x,this.vertexShader=E,this.fragmentShader=M,this}function WebGLPrograms(e,t){function getTextureEncodingFromMap(e,t){var i;return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=tt,i===tt&&t&&(i=rt),i}var i=[],r={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},n=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking"];this.getParameters=function(i,n,o,a,s,l){var d=r[i.type],p=function allocateBones(e){if(t.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var i=t.maxVertexUniforms,r=Math.floor((i-20)/4);return void 0!==e&&e&&e.isSkinnedMesh&&(r=Math.min(e.skeleton.bones.length,r))<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)"),r}(l),f=e.getPrecision();null!==i.precision&&(f=t.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",f,"instead.");var m=e.getCurrentRenderTarget();return{shaderID:d,precision:f,supportsVertexTextures:t.vertexTextures,outputEncoding:getTextureEncodingFromMap(m?m.texture:null,e.gammaOutput),map:!!i.map,mapEncoding:getTextureEncodingFromMap(i.map,e.gammaInput),envMap:!!i.envMap,envMapMode:i.envMap&&i.envMap.mapping,envMapEncoding:getTextureEncodingFromMap(i.envMap,e.gammaInput),envMapCubeUV:!!i.envMap&&(i.envMap.mapping===se||i.envMap.mapping===le),lightMap:!!i.lightMap,aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(i.emissiveMap,e.gammaInput),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,combine:i.combine,vertexColors:i.vertexColors,fog:!!o,useFog:i.fog,fogExp:o&&o.isFogExp2,flatShading:i.shading===h,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:i.skinning,maxBones:p,useVertexTexture:t.floatVertexTextures&&l&&l.skeleton&&l.skeleton.useVertexTexture,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:a,numClipIntersection:s,shadowMapEnabled:e.shadowMap.enabled&&l.receiveShadow&&n.shadows.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===u,flipSided:i.side===c,depthPacking:void 0!==i.depthPacking&&i.depthPacking}},this.getProgramCode=function(e,t){var i=[];if(t.shaderID?i.push(t.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)i.push(r),i.push(e.defines[r]);for(var o=0;o<n.length;o++)i.push(t[n[o]]);return i.join()},this.acquireProgram=function(t,r,n){for(var o,a=0,s=i.length;a<s;a++){var l=i[a];if(l.code===n){++(o=l).usedTimes;break}}return void 0===o&&(o=new WebGLProgram(e,n,t,r),i.push(o)),o},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=i.indexOf(e);i[t]=i[i.length-1],i.pop(),e.destroy()}},this.programs=i}function WebGLGeometries(e,t,i){function onGeometryDispose(e){var n=e.target,o=r[n.id];null!==o.index&&deleteAttribute(o.index),function deleteAttributes(e){for(var t in e)deleteAttribute(e[t])}(o.attributes),n.removeEventListener("dispose",onGeometryDispose),delete r[n.id];var a=t.get(n);a.wireframe&&deleteAttribute(a.wireframe),t.delete(n);var s=t.get(o);s.wireframe&&deleteAttribute(s.wireframe),t.delete(o),i.memory.geometries--}function deleteAttribute(i){var r=function getAttributeBuffer(e){return e.isInterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}(i);void 0!==r&&(e.deleteBuffer(r),function removeAttributeBuffer(e){e.isInterleavedBufferAttribute?t.delete(e.data):t.delete(e)}(i))}var r={};return{get:function(e){var t=e.geometry;if(void 0!==r[t.id])return r[t.id];t.addEventListener("dispose",onGeometryDispose);var n;return t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new BufferGeometry).setFromObject(e)),n=t._bufferGeometry),r[t.id]=n,i.memory.geometries++,n}}}function WebGLObjects(e,t,i){function updateAttribute(i,r){var n=i.isInterleavedBufferAttribute?i.data:i,o=t.get(n);void 0===o.__webglBuffer?function createBuffer(t,i,r){t.__webglBuffer=e.createBuffer(),e.bindBuffer(r,t.__webglBuffer);var n=i.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(r,i.array,n);var o=e.FLOAT,a=i.array;a instanceof Float32Array?o=e.FLOAT:a instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):a instanceof Uint16Array?o=e.UNSIGNED_SHORT:a instanceof Int16Array?o=e.SHORT:a instanceof Uint32Array?o=e.UNSIGNED_INT:a instanceof Int32Array?o=e.INT:a instanceof Int8Array?o=e.BYTE:a instanceof Uint8Array&&(o=e.UNSIGNED_BYTE);t.bytesPerElement=a.BYTES_PER_ELEMENT,t.type=o,t.version=i.version,i.onUploadCallback()}(o,n,r):o.version!==n.version&&function updateBuffer(t,i,r){e.bindBuffer(r,t.__webglBuffer),!1===i.dynamic?e.bufferData(r,i.array,e.STATIC_DRAW):-1===i.updateRange.count?e.bufferSubData(r,0,i.array):0===i.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,i.updateRange.offset*i.array.BYTES_PER_ELEMENT,i.array.subarray(i.updateRange.offset,i.updateRange.offset+i.updateRange.count)),i.updateRange.count=0);t.version=i.version}(o,n,r)}var r=new WebGLGeometries(e,t,i);return{getAttributeBuffer:function getAttributeBuffer(e){return e.isInterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer},getAttributeProperties:function getAttributeProperties(e){return e.isInterleavedBufferAttribute?t.get(e.data):t.get(e)},getWireframeAttribute:function getWireframeAttribute(i){var r=t.get(i);if(void 0!==r.wireframe)return r.wireframe;var n=[],o=i.index,a=i.attributes,s=a.position;if(null!==o)for(var l=0,c=(p=o.array).length;l<c;l+=3){var u=p[l+0],h=p[l+1],d=p[l+2];n.push(u,h,h,d,d,u)}else{var p;for(l=0,c=(p=a.position.array).length/3-1;l<c;l+=3)u=l+0,h=l+1,d=l+2,n.push(u,h,h,d,d,u)}var f=new BufferAttribute(new(s.count>65535?Uint32Array:Uint16Array)(n),1);return updateAttribute(f,e.ELEMENT_ARRAY_BUFFER),r.wireframe=f,f},update:function update(t){var i=r.get(t);t.geometry.isGeometry&&i.updateFromObject(t);var n=i.index,o=i.attributes;null!==n&&updateAttribute(n,e.ELEMENT_ARRAY_BUFFER);for(var a in o)updateAttribute(o[a],e.ARRAY_BUFFER);var s=i.morphAttributes;for(var a in s)for(var l=s[a],c=0,u=l.length;c<u;c++)updateAttribute(l[c],e.ARRAY_BUFFER);return i}}}function WebGLTextures(e,t,i,r,n,o,a){function clampToMaxSize(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height),r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=Math.floor(e.width*i),r.height=Math.floor(e.height*i);return r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e),r}return e}function isPowerOfTwo(e){return ut.isPowerOfTwo(e.width)&&ut.isPowerOfTwo(e.height)}function filterFallback(t){return t===fe||t===me||t===ge?e.NEAREST:e.LINEAR}function onTextureDispose(t){var i=t.target;i.removeEventListener("dispose",onTextureDispose),function deallocateTexture(t){var i=r.get(t);if(t.image&&i.__image__webglTextureCube)e.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture)}r.delete(t)}(i),s.textures--}function onRenderTargetDispose(t){var i=t.target;i.removeEventListener("dispose",onRenderTargetDispose),function deallocateRenderTarget(t){var i=r.get(t),n=r.get(t.texture);if(!t)return;void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[o]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);r.delete(t.texture),r.delete(t)}(i),s.textures--}function setTexture2D(t,a){var c=r.get(t);if(t.version>0&&c.__version!==t.version){var u=t.image;if(void 0===u)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(!1!==u.complete)return void function uploadTexture(t,r,a){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",onTextureDispose),t.__webglTexture=e.createTexture(),s.textures++);i.activeTexture(e.TEXTURE0+a),i.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);var c=clampToMaxSize(r.image,n.maxTextureSize);(function textureNeedsPowerOfTwo(e){return e.wrapS!==he||e.wrapT!==he||e.minFilter!==fe&&e.minFilter!==ve})(r)&&!1===isPowerOfTwo(c)&&(c=function makePowerOfTwo(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.width=ut.nearestPowerOfTwo(e.width),t.height=ut.nearestPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}(c));var u=isPowerOfTwo(c),h=o(r.format),d=o(r.type);setTextureParameters(e.TEXTURE_2D,r,u);var p,f=r.mipmaps;if(r.isDepthTexture){var m=e.DEPTH_COMPONENT;if(r.type===Se){if(!l)throw new Error("Float Depth Texture only supported in WebGL2.0");m=e.DEPTH_COMPONENT32F}else l&&(m=e.DEPTH_COMPONENT16);r.format===Ue&&m===e.DEPTH_COMPONENT&&r.type!==Me&&r.type!==Te&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Me,d=o(r.type)),r.format===He&&(m=e.DEPTH_STENCIL,r.type!==Be&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Be,d=o(r.type))),i.texImage2D(e.TEXTURE_2D,0,m,c.width,c.height,0,h,d,null)}else if(r.isDataTexture)if(f.length>0&&u){for(var g=0,v=f.length;g<v;g++)p=f[g],i.texImage2D(e.TEXTURE_2D,g,h,p.width,p.height,0,h,d,p.data);r.generateMipmaps=!1}else i.texImage2D(e.TEXTURE_2D,0,h,c.width,c.height,0,h,d,c.data);else if(r.isCompressedTexture)for(var g=0,v=f.length;g<v;g++)p=f[g],r.format!==Oe&&r.format!==Ie?i.getCompressedTextureFormats().indexOf(h)>-1?i.compressedTexImage2D(e.TEXTURE_2D,g,h,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(e.TEXTURE_2D,g,h,p.width,p.height,0,h,d,p.data);else if(f.length>0&&u){for(var g=0,v=f.length;g<v;g++)p=f[g],i.texImage2D(e.TEXTURE_2D,g,h,h,d,p);r.generateMipmaps=!1}else i.texImage2D(e.TEXTURE_2D,0,h,h,d,c);r.generateMipmaps&&u&&e.generateMipmap(e.TEXTURE_2D);t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(c,t,a);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}i.activeTexture(e.TEXTURE0+a),i.bindTexture(e.TEXTURE_2D,c.__webglTexture)}function setTextureParameters(i,a,s){var l;if(s?(e.texParameteri(i,e.TEXTURE_WRAP_S,o(a.wrapS)),e.texParameteri(i,e.TEXTURE_WRAP_T,o(a.wrapT)),e.texParameteri(i,e.TEXTURE_MAG_FILTER,o(a.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,o(a.minFilter))):(e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),a.wrapS===he&&a.wrapT===he||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",a),e.texParameteri(i,e.TEXTURE_MAG_FILTER,filterFallback(a.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,filterFallback(a.minFilter)),a.minFilter!==fe&&a.minFilter!==ve&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",a)),l=t.get("EXT_texture_filter_anisotropic")){if(a.type===Se&&null===t.get("OES_texture_float_linear"))return;if(a.type===Pe&&null===t.get("OES_texture_half_float_linear"))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function setupFrameBufferTexture(t,n,a,s){var l=o(n.texture.format),c=o(n.texture.type);i.texImage2D(s,0,l,n.width,n.height,0,l,c,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,a,s,r.get(n.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function setupRenderBufferStorage(t,i){e.bindRenderbuffer(e.RENDERBUFFER,t),i.depthBuffer&&!i.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):i.depthBuffer&&i.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,i.width,i.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function setupDepthRenderbuffer(t){var i=r.get(t),n=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function setupDepthTexture(t,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported!");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),setTexture2D(i.depthTexture,0);var n=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Ue)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,n,0);else{if(i.depthTexture.format!==He)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,n,0)}}(i.__webglFramebuffer,t)}else if(n){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),setupRenderBufferStorage(i.__webglDepthbuffer[o],t)}else e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),setupRenderBufferStorage(i.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}var s=a.memory,l="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext;this.setTexture2D=setTexture2D,this.setTextureCube=function setTextureCube(t,a){var l=r.get(t);if(6===t.image.length)if(t.version>0&&l.__version!==t.version){l.__image__webglTextureCube||(t.addEventListener("dispose",onTextureDispose),l.__image__webglTextureCube=e.createTexture(),s.textures++),i.activeTexture(e.TEXTURE0+a),i.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var c=t&&t.isCompressedTexture,u=t.image[0]&&t.image[0].isDataTexture,h=[],d=0;d<6;d++)h[d]=c||u?u?t.image[d].image:t.image[d]:clampToMaxSize(t.image[d],n.maxCubemapSize);var p=isPowerOfTwo(h[0]),f=o(t.format),m=o(t.type);for(setTextureParameters(e.TEXTURE_CUBE_MAP,t,p),d=0;d<6;d++)if(c)for(var g,v=h[d].mipmaps,y=0,b=v.length;y<b;y++)g=v[y],t.format!==Oe&&t.format!==Ie?i.getCompressedTextureFormats().indexOf(f)>-1?i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,y,f,g.width,g.height,0,g.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,y,f,g.width,g.height,0,f,m,g.data);else u?i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,f,h[d].width,h[d].height,0,f,m,h[d].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,f,f,m,h[d]);t.generateMipmaps&&p&&e.generateMipmap(e.TEXTURE_CUBE_MAP),l.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(e.TEXTURE0+a),i.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)},this.setTextureCubeDynamic=function setTextureCubeDynamic(t,n){i.activeTexture(e.TEXTURE0+n),i.bindTexture(e.TEXTURE_CUBE_MAP,r.get(t).__webglTexture)},this.setupRenderTarget=function setupRenderTarget(t){var n=r.get(t),o=r.get(t.texture);t.addEventListener("dispose",onRenderTargetDispose),o.__webglTexture=e.createTexture(),s.textures++;var a=!0===t.isWebGLRenderTargetCube,l=isPowerOfTwo(t);if(a){n.__webglFramebuffer=[];for(var c=0;c<6;c++)n.__webglFramebuffer[c]=e.createFramebuffer()}else n.__webglFramebuffer=e.createFramebuffer();if(a){for(i.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),setTextureParameters(e.TEXTURE_CUBE_MAP,t.texture,l),c=0;c<6;c++)setupFrameBufferTexture(n.__webglFramebuffer[c],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+c);t.texture.generateMipmaps&&l&&e.generateMipmap(e.TEXTURE_CUBE_MAP),i.bindTexture(e.TEXTURE_CUBE_MAP,null)}else i.bindTexture(e.TEXTURE_2D,o.__webglTexture),setTextureParameters(e.TEXTURE_2D,t.texture,l),setupFrameBufferTexture(n.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),t.texture.generateMipmaps&&l&&e.generateMipmap(e.TEXTURE_2D),i.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&setupDepthRenderbuffer(t)},this.updateRenderTargetMipmap=function updateRenderTargetMipmap(t){var n=t.texture;if(n.generateMipmaps&&isPowerOfTwo(t)&&n.minFilter!==fe&&n.minFilter!==ve){var o=t&&t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=r.get(n).__webglTexture;i.bindTexture(o,a),e.generateMipmap(o),i.bindTexture(o,null)}}}function WebGLRenderer(e){function getTargetPixelRatio(){return null===oe?nt:1}function setDefaultGLState(){Mt.init(),Mt.scissor(pe.copy(ot).multiplyScalar(nt)),Mt.viewport(Fe.copy(st).multiplyScalar(nt)),Mt.buffers.color.setClear(Qe.r,Qe.g,Qe.b,tt,v)}function resetGLState(){ne=null,ce=null,le="",se=-1,Mt.reset()}function onContextLost(e){e.preventDefault(),resetGLState(),setDefaultGLState(),At.clear()}function onMaterialDispose(e){var t=e.target;t.removeEventListener("dispose",onMaterialDispose),function deallocateMaterial(e){releaseMaterialProgramReference(e),At.delete(e)}(t)}function releaseMaterialProgramReference(e){var t=At.get(e).program;e.program=void 0,void 0!==t&&Pt.releaseProgram(t)}function absNumericalSort(e,t){return Math.abs(t[0])-Math.abs(e[0])}function painterSortStable(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.program&&t.material.program&&e.material.program!==t.material.program?e.material.program.id-t.material.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function pushRenderItem(e,t,i,r,n){var o,a;i.transparent?(o=Q,a=++J):(o=$,a=++K);var s=o[a];void 0!==s?(s.id=e.id,s.object=e,s.geometry=t,s.material=i,s.z=ft.z,s.group=n):(s={id:e.id,object:e,geometry:t,material:i,z:ft.z,group:n},o.push(s))}function isSphereViewable(e){if(!lt.intersectsSphere(e))return!1;var t=ct.numPlanes;if(0===t)return!0;var i=re.clippingPlanes,r=e.center,n=-e.radius,o=0;do{if(i[o].distanceToPoint(r)<n)return!1}while(++o!==t);return!0}function projectObject(e,t){if(!1!==e.visible){if(0!=(e.layers.mask&t.layers.mask))if(e.isLight)Y.push(e);else if(e.isSprite)!1!==e.frustumCulled&&!0!==function isSpriteViewable(e){return dt.center.set(0,0,0),dt.radius=.7071067811865476,dt.applyMatrix4(e.matrixWorld),isSphereViewable(dt)}(e)||te.push(e);else if(e.isLensFlare)ie.push(e);else if(e.isImmediateRenderObject)!0===re.sortObjects&&(ft.setFromMatrixPosition(e.matrixWorld),ft.applyProjection(pt)),pushRenderItem(e,null,e.material,ft.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!1===e.frustumCulled||!0===function isObjectViewable(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),dt.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),isSphereViewable(dt)}(e))){var i=e.material;if(!0===i.visible){!0===re.sortObjects&&(ft.setFromMatrixPosition(e.matrixWorld),ft.applyProjection(pt));var r=St.update(e);if(i.isMultiMaterial)for(var n=r.groups,o=i.materials,a=0,s=n.length;a<s;a++){var l=n[a],c=o[l.materialIndex];!0===c.visible&&pushRenderItem(e,r,c,ft.z,l)}else pushRenderItem(e,r,i,ft.z,null)}}var u=e.children;for(a=0,s=u.length;a<s;a++)projectObject(u[a],t)}}function renderObjects(e,t,i,r){for(var n=0,o=e.length;n<o;n++){var a=e[n],s=a.object,l=a.geometry,c=void 0===r?a.material:r,u=a.group;if(s.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,s.matrixWorld),s.normalMatrix.getNormalMatrix(s.modelViewMatrix),s.onBeforeRender(re,t,i,l,c,u),s.isImmediateRenderObject){setMaterial(c);var h=setProgram(i,t.fog,c,s);le="",s.render(function(e){re.renderBufferImmediate(e,h,c)})}else re.renderBufferDirect(i,t.fog,l,c,s,u);s.onAfterRender(re,t,i,l,c,u)}}function setMaterial(e){e.side===u?Mt.disable(bt.CULL_FACE):Mt.enable(bt.CULL_FACE),Mt.setFlipSided(e.side===c),!0===e.transparent?Mt.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):Mt.setBlending(g),Mt.setDepthFunc(e.depthFunc),Mt.setDepthTest(e.depthTest),Mt.setDepthWrite(e.depthWrite),Mt.setColorWrite(e.colorWrite),Mt.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function setProgram(e,t,i,r){Ke=0;var n=At.get(i);if(ut&&(ht||e!==ce)){var o=e===ce&&i.id===se;ct.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,n,o)}!1===i.needsUpdate&&(void 0===n.program?i.needsUpdate=!0:i.fog&&n.fog!==t?i.needsUpdate=!0:i.lights&&n.lightsHash!==vt.hash?i.needsUpdate=!0:void 0===n.numClippingPlanes||n.numClippingPlanes===ct.numPlanes&&n.numIntersection===ct.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(!function initMaterial(e,t,i){var r=At.get(e),n=Pt.getParameters(e,vt,t,ct.numPlanes,ct.numIntersection,i),o=Pt.getProgramCode(e,n),a=r.program,s=!0;if(void 0===a)e.addEventListener("dispose",onMaterialDispose);else if(a.code!==o)releaseMaterialProgramReference(e);else{if(void 0!==n.shaderID)return;s=!1}if(s){if(n.shaderID){var l=xt[n.shaderID];r.__webglShader={name:e.type,uniforms:Object.assign({},l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else r.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.__webglShader=r.__webglShader,a=Pt.acquireProgram(e,n,o),r.program=a,e.program=a}var c=a.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var u=0;u<re.maxMorphTargets;u++)c["morphTarget"+u]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals)for(e.numSupportedMorphNormals=0,u=0;u<re.maxMorphNormals;u++)c["morphNormal"+u]>=0&&e.numSupportedMorphNormals++;var h=r.__webglShader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=ct.numPlanes,r.numIntersection=ct.numIntersection,h.clippingPlanes=ct.uniform),r.fog=t,r.lightsHash=vt.hash,e.lights&&(h.ambientLightColor.value=vt.ambient,h.directionalLights.value=vt.directional,h.spotLights.value=vt.spot,h.rectAreaLights.value=vt.rectArea,h.pointLights.value=vt.point,h.hemisphereLights.value=vt.hemi,h.directionalShadowMap.value=vt.directionalShadowMap,h.directionalShadowMatrix.value=vt.directionalShadowMatrix,h.spotShadowMap.value=vt.spotShadowMap,h.spotShadowMatrix.value=vt.spotShadowMatrix,h.pointShadowMap.value=vt.pointShadowMap,h.pointShadowMatrix.value=vt.pointShadowMatrix);var d=r.program.getUniforms(),p=WebGLUniforms.seqWithValue(d.seq,h);r.uniformsList=p}(i,t,r),i.needsUpdate=!1);var a=!1,s=!1,l=!1,c=n.program,u=c.getUniforms(),h=n.__webglShader.uniforms;if(c.id!==ne&&(bt.useProgram(c.program),ne=c.id,a=!0,s=!0,l=!0),i.id!==se&&(se=i.id,s=!0),a||e!==ce){if(u.set(bt,e,"projectionMatrix"),Et.logarithmicDepthBuffer&&u.setValue(bt,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),e!==ce&&(ce=e,s=!0,l=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var d=u.map.cameraPosition;void 0!==d&&d.setValue(bt,ft.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&u.setValue(bt,"viewMatrix",e.matrixWorldInverse),u.set(bt,re,"toneMappingExposure"),u.set(bt,re,"toneMappingWhitePoint")}if(i.skinning){u.setOptional(bt,r,"bindMatrix"),u.setOptional(bt,r,"bindMatrixInverse");var p=r.skeleton;p&&(Et.floatVertexTextures&&p.useVertexTexture?(u.set(bt,p,"boneTexture"),u.set(bt,p,"boneTextureWidth"),u.set(bt,p,"boneTextureHeight")):u.setOptional(bt,p,"boneMatrices"))}return s&&(i.lights&&function markUniformsLightsNeedsUpdate(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(h,l),t&&i.fog&&function refreshUniformsFog(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(h,t),(i.isMeshBasicMaterial||i.isMeshLambertMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.isMeshDepthMaterial)&&function refreshUniformsCommon(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity);e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity);t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var i;t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap);if(void 0!==i){i.isWebGLRenderTarget&&(i=i.texture);var r=i.offset,n=i.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(h,i),i.isLineBasicMaterial?refreshUniformsLine(h,i):i.isLineDashedMaterial?(refreshUniformsLine(h,i),function refreshUniformsDash(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(h,i)):i.isPointsMaterial?function refreshUniformsPoints(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*nt,e.scale.value=.5*rt,e.map.value=t.map,null!==t.map){var i=t.map.offset,r=t.map.repeat;e.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}}(h,i):i.isMeshLambertMaterial?function refreshUniformsLambert(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(h,i):i.isMeshToonMaterial?function refreshUniformsToon(e,t){refreshUniformsPhong(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(h,i):i.isMeshPhongMaterial?refreshUniformsPhong(h,i):i.isMeshPhysicalMaterial?function refreshUniformsPhysical(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,refreshUniformsStandard(e,t)}(h,i):i.isMeshStandardMaterial?refreshUniformsStandard(h,i):i.isMeshDepthMaterial?i.displacementMap&&(h.displacementMap.value=i.displacementMap,h.displacementScale.value=i.displacementScale,h.displacementBias.value=i.displacementBias):i.isMeshNormalMaterial&&(h.opacity.value=i.opacity),WebGLUniforms.upload(bt,n.uniformsList,h,re)),u.set(bt,r,"modelViewMatrix"),u.set(bt,r,"normalMatrix"),u.setValue(bt,"modelMatrix",r.matrixWorld),c}function refreshUniformsLine(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function refreshUniformsPhong(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function refreshUniformsStandard(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}function paramThreeToGL(e){var t;if(e===ue)return bt.REPEAT;if(e===he)return bt.CLAMP_TO_EDGE;if(e===de)return bt.MIRRORED_REPEAT;if(e===fe)return bt.NEAREST;if(e===me)return bt.NEAREST_MIPMAP_NEAREST;if(e===ge)return bt.NEAREST_MIPMAP_LINEAR;if(e===ve)return bt.LINEAR;if(e===ye)return bt.LINEAR_MIPMAP_NEAREST;if(e===be)return bt.LINEAR_MIPMAP_LINEAR;if(e===we)return bt.UNSIGNED_BYTE;if(e===Ce)return bt.UNSIGNED_SHORT_4_4_4_4;if(e===Re)return bt.UNSIGNED_SHORT_5_5_5_1;if(e===Le)return bt.UNSIGNED_SHORT_5_6_5;if(e===_e)return bt.BYTE;if(e===Ee)return bt.SHORT;if(e===Me)return bt.UNSIGNED_SHORT;if(e===Ae)return bt.INT;if(e===Te)return bt.UNSIGNED_INT;if(e===Se)return bt.FLOAT;if(e===Pe&&null!==(t=_t.get("OES_texture_half_float")))return t.HALF_FLOAT_OES;if(e===De)return bt.ALPHA;if(e===Ie)return bt.RGB;if(e===Oe)return bt.RGBA;if(e===Ne)return bt.LUMINANCE;if(e===ke)return bt.LUMINANCE_ALPHA;if(e===Ue)return bt.DEPTH_COMPONENT;if(e===He)return bt.DEPTH_STENCIL;if(e===M)return bt.FUNC_ADD;if(e===A)return bt.FUNC_SUBTRACT;if(e===T)return bt.FUNC_REVERSE_SUBTRACT;if(e===C)return bt.ZERO;if(e===R)return bt.ONE;if(e===L)return bt.SRC_COLOR;if(e===B)return bt.ONE_MINUS_SRC_COLOR;if(e===D)return bt.SRC_ALPHA;if(e===I)return bt.ONE_MINUS_SRC_ALPHA;if(e===O)return bt.DST_ALPHA;if(e===N)return bt.ONE_MINUS_DST_ALPHA;if(e===k)return bt.DST_COLOR;if(e===F)return bt.ONE_MINUS_DST_COLOR;if(e===U)return bt.SRC_ALPHA_SATURATE;if((e===ze||e===Ge||e===Ve||e===je)&&null!==(t=_t.get("WEBGL_compressed_texture_s3tc"))){if(e===ze)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ge)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Ve)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===je)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===We||e===qe||e===Xe||e===Ye)&&null!==(t=_t.get("WEBGL_compressed_texture_pvrtc"))){if(e===We)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===qe)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Xe)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Ye)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===$e&&null!==(t=_t.get("WEBGL_compressed_texture_etc1")))return t.COMPRESSED_RGB_ETC1_WEBGL;if((e===S||e===P)&&null!==(t=_t.get("EXT_blend_minmax"))){if(e===S)return t.MIN_EXT;if(e===P)return t.MAX_EXT}return e===Be&&null!==(t=_t.get("WEBGL_depth_texture"))?t.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer",t);var a=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),s=void 0!==e.context?e.context:null,l=void 0!==e.alpha&&e.alpha,d=void 0===e.depth||e.depth,f=void 0===e.stencil||e.stencil,m=void 0!==e.antialias&&e.antialias,v=void 0===e.premultipliedAlpha||e.premultipliedAlpha,E=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,Y=[],$=[],K=-1,Q=[],J=-1,ee=new Float32Array(8),te=[],ie=[];this.domElement=a,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Z,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var re=this,ne=null,oe=null,ae=null,se=-1,le="",ce=null,pe=new Vector4,xe=null,Fe=new Vector4,Ke=0,Qe=new Color(0),tt=0,it=a.width,rt=a.height,nt=1,ot=new Vector4(0,0,it,rt),at=!1,st=new Vector4(0,0,it,rt),lt=new Frustum,ct=new function WebGLClipping(){function resetGlobalState(){s.value!==t&&(s.value=t,s.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function projectPlanes(t,i,r,n){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=s.value,!0!==n||null===c){var u=r+4*l,h=i.matrixWorldInverse;a.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var d=0,p=r;d!==l;++d,p+=4)o.copy(t[d]).applyMatrix4(h,a),o.normal.toArray(c,p),c[p+3]=o.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=l,c}var e=this,t=null,i=0,r=!1,n=!1,o=new Plane,a=new Matrix3,s={value:null,needsUpdate:!1};this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,n,o){var a=0!==e.length||n||0!==i||r;return r=n,t=projectPlanes(e,o,0),i=e.length,a},this.beginShadows=function(){n=!0,projectPlanes(null)},this.endShadows=function(){n=!1,resetGlobalState()},this.setState=function(e,o,a,l,c,u){if(!r||null===e||0===e.length||n&&!a)n?projectPlanes(null):resetGlobalState();else{var h=n?0:i,d=4*h,p=c.clippingState||null;s.value=p,p=projectPlanes(e,l,d,u);for(var f=0;f!==d;++f)p[f]=t[f];c.clippingState=p,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=h}}},ut=!1,ht=!1,dt=new Sphere,pt=new Matrix4,ft=new Vector3,mt=new Matrix4,gt=new Matrix4,vt={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},yt={calls:0,vertices:0,faces:0,points:0};this.info={render:yt,memory:{geometries:0,textures:0},programs:null};var bt;try{var wt={alpha:l,depth:d,stencil:f,antialias:m,premultipliedAlpha:v,preserveDrawingBuffer:E};if(null===(bt=s||a.getContext("webgl",wt)||a.getContext("experimental-webgl",wt)))throw null!==a.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===bt.getShaderPrecisionFormat&&(bt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),a.addEventListener("webglcontextlost",onContextLost,!1)}catch(e){console.error("THREE.WebGLRenderer: "+e)}var _t=new function WebGLExtensions(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];var r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":r=e.getExtension("WEBGL_compressed_texture_etc1");break;default:r=e.getExtension(i)}return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=r,r}}}(bt);_t.get("WEBGL_depth_texture"),_t.get("OES_texture_float"),_t.get("OES_texture_float_linear"),_t.get("OES_texture_half_float"),_t.get("OES_texture_half_float_linear"),_t.get("OES_standard_derivatives"),_t.get("ANGLE_instanced_arrays"),_t.get("OES_element_index_uint")&&(BufferGeometry.MaxIndex=4294967296);var Et=new function WebGLCapabilities(e,t,i){function getMaxPrecision(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var r,n=void 0!==i.precision?i.precision:"highp",o=getMaxPrecision(n);o!==n&&(console.warn("THREE.WebGLRenderer:",n,"not supported, using",o,"instead."),n=o);var a=!0===i.logarithmicDepthBuffer&&!!t.get("EXT_frag_depth"),s=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),l=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_TEXTURE_SIZE),u=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),h=e.getParameter(e.MAX_VERTEX_ATTRIBS),d=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),p=e.getParameter(e.MAX_VARYING_VECTORS),f=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),m=l>0,g=!!t.get("OES_texture_float");return{getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==r)return r;var i=t.get("EXT_texture_filter_anisotropic");return r=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:getMaxPrecision,precision:n,logarithmicDepthBuffer:a,maxTextures:s,maxVertexTextures:l,maxTextureSize:c,maxCubemapSize:u,maxAttributes:h,maxVertexUniforms:d,maxVaryings:p,maxFragmentUniforms:f,vertexTextures:m,floatFragmentTextures:g,floatVertexTextures:m&&g}}(bt,_t,e),Mt=new function WebGLState(e,t,o){function createTexture(t,i,r){var n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var a=0;a<r;a++)e.texImage2D(i+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n);return o}function enable(t){!0!==p[t]&&(e.enable(t),p[t]=!0)}function disable(t){!1!==p[t]&&(e.disable(t),p[t]=!1)}function setBlending(t,i,r,n,a,s,l,c){t!==g?enable(e.BLEND):disable(e.BLEND),t===m&&c===P||(t===b?c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===x?c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===w?c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),m=t,P=c),t===_?(a=a||i,s=s||r,l=l||n,i===v&&a===A||(e.blendEquationSeparate(o(i),o(a)),v=i,A=a),r===E&&n===M&&s===T&&l===S||(e.blendFuncSeparate(o(r),o(n),o(s),o(l)),E=r,M=n,T=s,S=l)):(v=null,E=null,M=null,A=null,T=null,S=null)}function setDepthFunc(e){s.setFunc(e)}function setFlipSided(t){C!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),C=t)}function setCullFace(t){t!==i?(enable(e.CULL_FACE),t!==R&&(t===r?e.cullFace(e.BACK):t===n?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):disable(e.CULL_FACE),R=t}function activeTexture(t){void 0===t&&(t=e.TEXTURE0+O-1),N!==t&&(e.activeTexture(t),N=t)}var a=new function ColorBuffer(){var t=!1,i=new Vector4,r=null,n=new Vector4;return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),i.set(t,r,o,a),!1===n.equals(i)&&(e.clearColor(t,r,o,a),n.copy(i))},reset:function(){t=!1,r=null,n.set(0,0,0,1)}}},s=new function DepthBuffer(){var t=!1,i=null,r=null,n=null;return{setTest:function(t){t?enable(e.DEPTH_TEST):disable(e.DEPTH_TEST)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case H:e.depthFunc(e.NEVER);break;case z:e.depthFunc(e.ALWAYS);break;case G:e.depthFunc(e.LESS);break;case V:e.depthFunc(e.LEQUAL);break;case j:e.depthFunc(e.EQUAL);break;case W:e.depthFunc(e.GEQUAL);break;case q:e.depthFunc(e.GREATER);break;case X:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,r=null,n=null}}},l=new function StencilBuffer(){var t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(t){t?enable(e.STENCIL_TEST):disable(e.STENCIL_TEST)},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,a){r===t&&n===i&&o===a||(e.stencilFunc(t,i,a),r=t,n=i,o=a)},setOp:function(t,i,r){a===t&&s===i&&l===r||(e.stencilOp(t,i,r),a=t,s=i,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,c=null}}},c=e.getParameter(e.MAX_VERTEX_ATTRIBS),u=new Uint8Array(c),h=new Uint8Array(c),d=new Uint8Array(c),p={},f=null,m=null,v=null,E=null,M=null,A=null,T=null,S=null,P=!1,C=null,R=null,L=null,B=null,D=null,I=null,O=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),N=null,k={},F=new Vector4,U=new Vector4,Y={};return Y[e.TEXTURE_2D]=createTexture(e.TEXTURE_2D,e.TEXTURE_2D,1),Y[e.TEXTURE_CUBE_MAP]=createTexture(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:a,depth:s,stencil:l},init:function init(){a.setClear(0,0,0,1),s.setClear(1),l.setClear(0),enable(e.DEPTH_TEST),setDepthFunc(V),setFlipSided(!1),setCullFace(r),enable(e.CULL_FACE),enable(e.BLEND),setBlending(y)},initAttributes:function initAttributes(){for(var e=0,t=u.length;e<t;e++)u[e]=0},enableAttribute:function enableAttribute(i){u[i]=1,0===h[i]&&(e.enableVertexAttribArray(i),h[i]=1),0!==d[i]&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),d[i]=0)},enableAttributeAndDivisor:function enableAttributeAndDivisor(t,i,r){u[t]=1,0===h[t]&&(e.enableVertexAttribArray(t),h[t]=1),d[t]!==i&&(r.vertexAttribDivisorANGLE(t,i),d[t]=i)},disableUnusedAttributes:function disableUnusedAttributes(){for(var t=0,i=h.length;t!==i;++t)h[t]!==u[t]&&(e.disableVertexAttribArray(t),h[t]=0)},enable:enable,disable:disable,getCompressedTextureFormats:function getCompressedTextureFormats(){if(null===f&&(f=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var i=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<i.length;r++)f.push(i[r]);return f},setBlending:setBlending,setColorWrite:function setColorWrite(e){a.setMask(e)},setDepthTest:function setDepthTest(e){s.setTest(e)},setDepthWrite:function setDepthWrite(e){s.setMask(e)},setDepthFunc:setDepthFunc,setStencilTest:function setStencilTest(e){l.setTest(e)},setStencilWrite:function setStencilWrite(e){l.setMask(e)},setStencilFunc:function setStencilFunc(e,t,i){l.setFunc(e,t,i)},setStencilOp:function setStencilOp(e,t,i){l.setOp(e,t,i)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function setLineWidth(t){t!==L&&(e.lineWidth(t),L=t)},setPolygonOffset:function setPolygonOffset(t,i,r){t?(enable(e.POLYGON_OFFSET_FILL),B===i&&D===r||(e.polygonOffset(i,r),B=i,D=r)):disable(e.POLYGON_OFFSET_FILL)},getScissorTest:function getScissorTest(){return I},setScissorTest:function setScissorTest(t){I=t,t?enable(e.SCISSOR_TEST):disable(e.SCISSOR_TEST)},activeTexture:activeTexture,bindTexture:function bindTexture(t,i){null===N&&activeTexture();var r=k[N];void 0===r&&(r={type:void 0,texture:void 0},k[N]=r),r.type===t&&r.texture===i||(e.bindTexture(t,i||Y[t]),r.type=t,r.texture=i)},compressedTexImage2D:function compressedTexImage2D(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error(e)}},texImage2D:function texImage2D(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error(e)}},scissor:function scissor(t){!1===F.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),F.copy(t))},viewport:function viewport(t){!1===U.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),U.copy(t))},reset:function reset(){for(var t=0;t<h.length;t++)1===h[t]&&(e.disableVertexAttribArray(t),h[t]=0);p={},f=null,N=null,k={},m=null,C=null,R=null,a.reset(),s.reset(),l.reset()}}}(bt,_t,paramThreeToGL),At=new function WebGLProperties(){var e={};return{get:function(t){var i=t.uuid,r=e[i];return void 0===r&&(r={},e[i]=r),r},delete:function(t){delete e[t.uuid]},clear:function(){e={}}}},Tt=new WebGLTextures(bt,_t,Mt,At,Et,paramThreeToGL,this.info),St=new WebGLObjects(bt,At,this.info),Pt=new WebGLPrograms(this,Et),Ct=new function WebGLLights(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=i,i}}};this.info.programs=Pt.programs;var Rt=new function WebGLBufferRenderer(e,t,i){var r;return{setMode:function setMode(e){r=e},render:function render(t,n){e.drawArrays(r,t,n),i.calls++,i.vertices+=n,r===e.TRIANGLES&&(i.faces+=n/3)},renderInstances:function renderInstances(n){var o=t.get("ANGLE_instanced_arrays");if(null!==o){var a=n.attributes.position,s=0;a.isInterleavedBufferAttribute?(s=a.data.count,o.drawArraysInstancedANGLE(r,0,s,n.maxInstancedCount)):(s=a.count,o.drawArraysInstancedANGLE(r,0,s,n.maxInstancedCount)),i.calls++,i.vertices+=s*n.maxInstancedCount,r===e.TRIANGLES&&(i.faces+=n.maxInstancedCount*s/3)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}}(bt,_t,yt),Lt=new function WebGLIndexedBufferRenderer(e,t,i){var r,n,o;return{setMode:function setMode(e){r=e},setIndex:function setIndex(i){i.array instanceof Uint32Array&&t.get("OES_element_index_uint")?(n=e.UNSIGNED_INT,o=4):(n=e.UNSIGNED_SHORT,o=2)},render:function render(t,a){e.drawElements(r,a,n,t*o),i.calls++,i.vertices+=a,r===e.TRIANGLES&&(i.faces+=a/3)},renderInstances:function renderInstances(a,s,l){var c=t.get("ANGLE_instanced_arrays");null!==c?(c.drawElementsInstancedANGLE(r,l,n,s*o,a.maxInstancedCount),i.calls++,i.vertices+=l*a.maxInstancedCount,r===e.TRIANGLES&&(i.faces+=a.maxInstancedCount*l/3)):console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}}(bt,_t,yt),Bt=new OrthographicCamera(-1,1,1,-1,0,1),Dt=new PerspectiveCamera,It=new Mesh(new PlaneBufferGeometry(2,2),new MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1})),Ot=xt.cube,Nt=new Mesh(new BoxBufferGeometry(5,5,5),new ShaderMaterial({uniforms:Ot.uniforms,vertexShader:Ot.vertexShader,fragmentShader:Ot.fragmentShader,side:c,depthTest:!1,depthWrite:!1,fog:!1}));setDefaultGLState(),this.context=bt,this.capabilities=Et,this.extensions=_t,this.properties=At,this.state=Mt;var kt=new WebGLShadowMap(this,vt,St,Et);this.shadowMap=kt;var Ft=new SpritePlugin(this,te),Ut=new LensFlarePlugin(this,ie);this.getContext=function(){return bt},this.getContextAttributes=function(){return bt.getContextAttributes()},this.forceContextLoss=function(){_t.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){return Et.getMaxAnisotropy()},this.getPrecision=function(){return Et.precision},this.getPixelRatio=function(){return nt},this.setPixelRatio=function(e){void 0!==e&&(nt=e,this.setSize(st.z,st.w,!1))},this.getSize=function(){return{width:it,height:rt}},this.setSize=function(e,t,i){it=e,rt=t,a.width=e*nt,a.height=t*nt,!1!==i&&(a.style.width=e+"px",a.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,r){Mt.viewport(st.set(e,t,i,r))},this.setScissor=function(e,t,i,r){Mt.scissor(ot.set(e,t,i,r))},this.setScissorTest=function(e){Mt.setScissorTest(at=e)},this.getClearColor=function(){return Qe},this.setClearColor=function(e,t){Qe.set(e),tt=void 0!==t?t:1,Mt.buffers.color.setClear(Qe.r,Qe.g,Qe.b,tt,v)},this.getClearAlpha=function(){return tt},this.setClearAlpha=function(e){tt=e,Mt.buffers.color.setClear(Qe.r,Qe.g,Qe.b,tt,v)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=bt.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=bt.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=bt.STENCIL_BUFFER_BIT),bt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.resetGLState=resetGLState,this.dispose=function(){Q=[],J=-1,$=[],K=-1,a.removeEventListener("webglcontextlost",onContextLost,!1)},this.renderBufferImmediate=function(e,t,i){Mt.initAttributes();var r=At.get(e);e.hasPositions&&!r.position&&(r.position=bt.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=bt.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=bt.createBuffer()),e.hasColors&&!r.color&&(r.color=bt.createBuffer());var n=t.getAttributes();if(e.hasPositions&&(bt.bindBuffer(bt.ARRAY_BUFFER,r.position),bt.bufferData(bt.ARRAY_BUFFER,e.positionArray,bt.DYNAMIC_DRAW),Mt.enableAttribute(n.position),bt.vertexAttribPointer(n.position,3,bt.FLOAT,!1,0,0)),e.hasNormals){if(bt.bindBuffer(bt.ARRAY_BUFFER,r.normal),!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&i.shading===h)for(var o=0,a=3*e.count;o<a;o+=9){var s=e.normalArray,l=(s[o+0]+s[o+3]+s[o+6])/3,c=(s[o+1]+s[o+4]+s[o+7])/3,u=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=l,s[o+1]=c,s[o+2]=u,s[o+3]=l,s[o+4]=c,s[o+5]=u,s[o+6]=l,s[o+7]=c,s[o+8]=u}bt.bufferData(bt.ARRAY_BUFFER,e.normalArray,bt.DYNAMIC_DRAW),Mt.enableAttribute(n.normal),bt.vertexAttribPointer(n.normal,3,bt.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(bt.bindBuffer(bt.ARRAY_BUFFER,r.uv),bt.bufferData(bt.ARRAY_BUFFER,e.uvArray,bt.DYNAMIC_DRAW),Mt.enableAttribute(n.uv),bt.vertexAttribPointer(n.uv,2,bt.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==p&&(bt.bindBuffer(bt.ARRAY_BUFFER,r.color),bt.bufferData(bt.ARRAY_BUFFER,e.colorArray,bt.DYNAMIC_DRAW),Mt.enableAttribute(n.color),bt.vertexAttribPointer(n.color,3,bt.FLOAT,!1,0,0)),Mt.disableUnusedAttributes(),bt.drawArrays(bt.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,o){setMaterial(r);var a=setProgram(e,t,r,n),s=!1,l=i.id+"_"+a.id+"_"+r.wireframe;l!==le&&(le=l,s=!0);var c=n.morphTargetInfluences;if(void 0!==c){for(var u=[],h=0,d=c.length;h<d;h++){var p=c[h];u.push([p,h])}u.sort(absNumericalSort),u.length>8&&(u.length=8);var f=i.morphAttributes;for(h=0,d=u.length;h<d;h++){p=u[h];if(ee[h]=p[0],0!==p[0]){var m=p[1];!0===r.morphTargets&&f.position&&i.addAttribute("morphTarget"+h,f.position[m]),!0===r.morphNormals&&f.normal&&i.addAttribute("morphNormal"+h,f.normal[m])}else!0===r.morphTargets&&i.removeAttribute("morphTarget"+h),!0===r.morphNormals&&i.removeAttribute("morphNormal"+h)}h=u.length;for(var g=ee.length;h<g;h++)ee[h]=0;a.getUniforms().setValue(bt,"morphTargetInfluences",ee),s=!0}m=i.index;var v=i.attributes.position,y=1;!0===r.wireframe&&(m=St.getWireframeAttribute(i),y=2);var b;null!==m?(b=Lt).setIndex(m):b=Rt,s&&(!function setupVertexAttributes(e,t,i,r){var n;if(i&&i.isInstancedBufferGeometry&&null===(n=_t.get("ANGLE_instanced_arrays")))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===r&&(r=0),Mt.initAttributes();var o=i.attributes,a=t.getAttributes(),s=e.defaultAttributeValues;for(var l in a){var c=a[l];if(c>=0){var u=o[l];if(void 0!==u){var h=u.normalized,d=u.itemSize,p=St.getAttributeProperties(u),f=p.__webglBuffer,m=p.type,g=p.bytesPerElement;if(u.isInterleavedBufferAttribute){var v=u.data,y=v.stride,b=u.offset;v&&v.isInstancedInterleavedBuffer?(Mt.enableAttributeAndDivisor(c,v.meshPerAttribute,n),void 0===i.maxInstancedCount&&(i.maxInstancedCount=v.meshPerAttribute*v.count)):Mt.enableAttribute(c),bt.bindBuffer(bt.ARRAY_BUFFER,f),bt.vertexAttribPointer(c,d,m,h,y*g,(r*y+b)*g)}else u.isInstancedBufferAttribute?(Mt.enableAttributeAndDivisor(c,u.meshPerAttribute,n),void 0===i.maxInstancedCount&&(i.maxInstancedCount=u.meshPerAttribute*u.count)):Mt.enableAttribute(c),bt.bindBuffer(bt.ARRAY_BUFFER,f),bt.vertexAttribPointer(c,d,m,h,0,r*d*g)}else if(void 0!==s){var x=s[l];if(void 0!==x)switch(x.length){case 2:bt.vertexAttrib2fv(c,x);break;case 3:bt.vertexAttrib3fv(c,x);break;case 4:bt.vertexAttrib4fv(c,x);break;default:bt.vertexAttrib1fv(c,x)}}}}Mt.disableUnusedAttributes()}}(r,a,i),null!==m&&bt.bindBuffer(bt.ELEMENT_ARRAY_BUFFER,St.getAttributeBuffer(m)));var x=0;null!==m?x=m.count:void 0!==v&&(x=v.count);var w=i.drawRange.start*y,_=i.drawRange.count*y,E=null!==o?o.start*y:0,M=null!==o?o.count*y:1/0,A=Math.max(w,E),T=Math.min(x,w+_,E+M)-1,S=Math.max(0,T-A+1);if(0!==S){if(n.isMesh)if(!0===r.wireframe)Mt.setLineWidth(r.wireframeLinewidth*getTargetPixelRatio()),b.setMode(bt.LINES);else switch(n.drawMode){case Ze:b.setMode(bt.TRIANGLES);break;case Je:b.setMode(bt.TRIANGLE_STRIP);break;case et:b.setMode(bt.TRIANGLE_FAN)}else if(n.isLine){var P=r.linewidth;void 0===P&&(P=1),Mt.setLineWidth(P*getTargetPixelRatio()),n.isLineSegments?b.setMode(bt.LINES):b.setMode(bt.LINE_STRIP)}else n.isPoints&&b.setMode(bt.POINTS);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&b.renderInstances(i,A,S):b.render(A,S)}},this.render=function(e,t,i,r){if(void 0===t||!0===t.isCamera){le="",se=-1,ce=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),pt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),lt.setFromMatrix(pt),Y.length=0,K=-1,J=-1,te.length=0,ie.length=0,ht=this.localClippingEnabled,ut=ct.init(this.clippingPlanes,ht,t),projectObject(e,t),$.length=K+1,Q.length=J+1,!0===re.sortObjects&&($.sort(painterSortStable),Q.sort(reversePainterSortStable)),ut&&ct.beginShadows(),function setupShadows(e){for(var t=0,i=0,r=e.length;i<r;i++){var n=e[i];n.castShadow&&(vt.shadows[t++]=n)}vt.shadows.length=t}(Y),kt.render(e,t),function setupLights(e,t){var i,r,n,o,a,s,l,c=0,u=0,h=0,d=t.matrixWorldInverse,p=0,f=0,m=0,g=0,v=0;for(i=0,r=e.length;i<r;i++)if(n=e[i],o=n.color,a=n.intensity,s=n.distance,l=n.shadow&&n.shadow.map?n.shadow.map.texture:null,n.isAmbientLight)c+=o.r*a,u+=o.g*a,h+=o.b*a;else if(n.isDirectionalLight)(y=Ct.get(n)).color.copy(n.color).multiplyScalar(n.intensity),y.direction.setFromMatrixPosition(n.matrixWorld),ft.setFromMatrixPosition(n.target.matrixWorld),y.direction.sub(ft),y.direction.transformDirection(d),y.shadow=n.castShadow,n.castShadow&&(y.shadowBias=n.shadow.bias,y.shadowRadius=n.shadow.radius,y.shadowMapSize=n.shadow.mapSize),vt.directionalShadowMap[p]=l,vt.directionalShadowMatrix[p]=n.shadow.matrix,vt.directional[p++]=y;else if(n.isSpotLight)(y=Ct.get(n)).position.setFromMatrixPosition(n.matrixWorld),y.position.applyMatrix4(d),y.color.copy(o).multiplyScalar(a),y.distance=s,y.direction.setFromMatrixPosition(n.matrixWorld),ft.setFromMatrixPosition(n.target.matrixWorld),y.direction.sub(ft),y.direction.transformDirection(d),y.coneCos=Math.cos(n.angle),y.penumbraCos=Math.cos(n.angle*(1-n.penumbra)),y.decay=0===n.distance?0:n.decay,y.shadow=n.castShadow,n.castShadow&&(y.shadowBias=n.shadow.bias,y.shadowRadius=n.shadow.radius,y.shadowMapSize=n.shadow.mapSize),vt.spotShadowMap[m]=l,vt.spotShadowMatrix[m]=n.shadow.matrix,vt.spot[m++]=y;else if(n.isRectAreaLight)(y=Ct.get(n)).color.copy(o).multiplyScalar(a/(n.width*n.height)),y.position.setFromMatrixPosition(n.matrixWorld),y.position.applyMatrix4(d),gt.identity(),mt.copy(n.matrixWorld),mt.premultiply(d),gt.extractRotation(mt),y.halfWidth.set(.5*n.width,0,0),y.halfHeight.set(0,.5*n.height,0),y.halfWidth.applyMatrix4(gt),y.halfHeight.applyMatrix4(gt),vt.rectArea[g++]=y;else if(n.isPointLight)(y=Ct.get(n)).position.setFromMatrixPosition(n.matrixWorld),y.position.applyMatrix4(d),y.color.copy(n.color).multiplyScalar(n.intensity),y.distance=n.distance,y.decay=0===n.distance?0:n.decay,y.shadow=n.castShadow,n.castShadow&&(y.shadowBias=n.shadow.bias,y.shadowRadius=n.shadow.radius,y.shadowMapSize=n.shadow.mapSize),vt.pointShadowMap[f]=l,void 0===vt.pointShadowMatrix[f]&&(vt.pointShadowMatrix[f]=new Matrix4),ft.setFromMatrixPosition(n.matrixWorld).negate(),vt.pointShadowMatrix[f].identity().setPosition(ft),vt.point[f++]=y;else if(n.isHemisphereLight){var y;(y=Ct.get(n)).direction.setFromMatrixPosition(n.matrixWorld),y.direction.transformDirection(d),y.direction.normalize(),y.skyColor.copy(n.color).multiplyScalar(a),y.groundColor.copy(n.groundColor).multiplyScalar(a),vt.hemi[v++]=y}vt.ambient[0]=c,vt.ambient[1]=u,vt.ambient[2]=h,vt.directional.length=p,vt.spot.length=m,vt.rectArea.length=g,vt.point.length=f,vt.hemi.length=v,vt.hash=p+","+f+","+m+","+g+","+v+","+vt.shadows.length}(Y,t),ut&&ct.endShadows(),yt.calls=0,yt.vertices=0,yt.faces=0,yt.points=0,void 0===i&&(i=null),this.setRenderTarget(i);var n=e.background;if(null===n?Mt.buffers.color.setClear(Qe.r,Qe.g,Qe.b,tt,v):n&&n.isColor&&(Mt.buffers.color.setClear(n.r,n.g,n.b,1,v),r=!0),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),n&&n.isCubeTexture?(Dt.projectionMatrix.copy(t.projectionMatrix),Dt.matrixWorld.extractRotation(t.matrixWorld),Dt.matrixWorldInverse.getInverse(Dt.matrixWorld),Nt.material.uniforms.tCube.value=n,Nt.modelViewMatrix.multiplyMatrices(Dt.matrixWorldInverse,Nt.matrixWorld),St.update(Nt),re.renderBufferDirect(Dt,null,Nt.geometry,Nt.material,Nt,null)):n&&n.isTexture&&(It.material.map=n,St.update(It),re.renderBufferDirect(Bt,null,It.geometry,It.material,It,null)),e.overrideMaterial){var o=e.overrideMaterial;renderObjects($,e,t,o),renderObjects(Q,e,t,o)}else Mt.setBlending(g),renderObjects($,e,t),renderObjects(Q,e,t);Ft.render(e,t),Ut.render(e,t,Fe),i&&Tt.updateRenderTargetMipmap(i),Mt.setDepthTest(!0),Mt.setDepthWrite(!0),Mt.setColorWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFaceCulling=function(e,t){Mt.setCullFace(e),Mt.setFlipSided(t===o)},this.allocTextureUnit=function allocTextureUnit(){var e=Ke;return e>=Et.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Et.maxTextures),Ke+=1,e},this.setTexture2D=function(){var e=!1;return function setTexture2D(t,i){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),Tt.setTexture2D(t,i)}}(),this.setTexture=function(){var e=!1;return function setTexture(t,i){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),Tt.setTexture2D(t,i)}}(),this.setTextureCube=function(){var e=!1;return function setTextureCube(t,i){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?Tt.setTextureCube(t,i):Tt.setTextureCubeDynamic(t,i)}}(),this.getCurrentRenderTarget=function(){return oe},this.setRenderTarget=function(e){oe=e,e&&void 0===At.get(e).__webglFramebuffer&&Tt.setupRenderTarget(e);var t,i=e&&e.isWebGLRenderTargetCube;if(e){var r=At.get(e);t=i?r.__webglFramebuffer[e.activeCubeFace]:r.__webglFramebuffer,pe.copy(e.scissor),xe=e.scissorTest,Fe.copy(e.viewport)}else t=null,pe.copy(ot).multiplyScalar(nt),xe=at,Fe.copy(st).multiplyScalar(nt);if(ae!==t&&(bt.bindFramebuffer(bt.FRAMEBUFFER,t),ae=t),Mt.scissor(pe),Mt.setScissorTest(xe),Mt.viewport(Fe),i){var n=At.get(e.texture);bt.framebufferTexture2D(bt.FRAMEBUFFER,bt.COLOR_ATTACHMENT0,bt.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,i,r,n,o){if(!1!==(e&&e.isWebGLRenderTarget)){var a=At.get(e).__webglFramebuffer;if(a){var s=!1;a!==ae&&(bt.bindFramebuffer(bt.FRAMEBUFFER,a),s=!0);try{var l=e.texture,c=l.format,u=l.type;if(c!==Oe&&paramThreeToGL(c)!==bt.getParameter(bt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===we||paramThreeToGL(u)===bt.getParameter(bt.IMPLEMENTATION_COLOR_READ_TYPE)||u===Se&&(_t.get("OES_texture_float")||_t.get("WEBGL_color_buffer_float"))||u===Pe&&_t.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");bt.checkFramebufferStatus(bt.FRAMEBUFFER)===bt.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-r&&i>=0&&i<=e.height-n&&bt.readPixels(t,i,r,n,paramThreeToGL(c),paramThreeToGL(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&bt.bindFramebuffer(bt.FRAMEBUFFER,ae)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}function FogExp2(e,t){this.name="",this.color=new Color(e),this.density=void 0!==t?t:25e-5}function Fog(e,t,i){this.name="",this.color=new Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function LensFlare(e,t,i,r,n){Object3D.call(this),this.lensFlares=[],this.positionScreen=new Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,r,n)}function SpriteMaterial(e){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function Sprite(e){Object3D.call(this),this.type="Sprite",this.material=void 0!==e?e:new SpriteMaterial}function LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Skeleton(e,t,i){if(this.useVertexTexture=void 0===i||i,this.identityMatrix=new Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var r=Math.sqrt(4*this.bones.length);r=ut.nextPowerOfTwo(Math.ceil(r)),r=Math.max(r,4),this.boneTextureWidth=r,this.boneTextureHeight=r,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,Oe,Se)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var n=0,o=this.bones.length;n<o;n++)this.boneInverses.push(new Matrix4)}}function Bone(){Object3D.call(this),this.type="Bone"}function SkinnedMesh(e,t,i){Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4;var r=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,o,a=0,s=this.geometry.bones.length;a<s;++a)o=this.geometry.bones[a],n=new Bone,r.push(n),n.name=o.name,n.position.fromArray(o.pos),n.quaternion.fromArray(o.rotq),void 0!==o.scl&&n.scale.fromArray(o.scl);for(a=0,s=this.geometry.bones.length;a<s;++a)-1!==(o=this.geometry.bones[a]).parent&&null!==o.parent&&void 0!==r[o.parent]?r[o.parent].add(r[a]):this.add(r[a])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new Skeleton(r,void 0,i),this.matrixWorld)}function LineBasicMaterial(e){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Line(e,t,i){if(1===i)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new LineSegments(e,t);Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new LineBasicMaterial({color:16777215*Math.random()})}function LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}function PointsMaterial(e){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function Points(e,t){Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new PointsMaterial({color:16777215*Math.random()})}function Group(){Object3D.call(this),this.type="Group"}function VideoTexture(e,t,i,r,n,o,a,s,l){function update(){requestAnimationFrame(update),e.readyState>=e.HAVE_CURRENT_DATA&&(c.needsUpdate=!0)}Texture.call(this,e,t,i,r,n,o,a,s,l),this.generateMipmaps=!1;var c=this;update()}function CompressedTexture(e,t,i,r,n,o,a,s,l,c,u,h){Texture.call(this,null,o,a,s,l,c,r,n,u,h),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function CanvasTexture(e,t,i,r,n,o,a,s,l){Texture.call(this,e,t,i,r,n,o,a,s,l),this.needsUpdate=!0}function DepthTexture(e,t,i,r,n,o,a,s,l,c){if((c=void 0!==c?c:Ue)!==Ue&&c!==He)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Ue&&(i=Me),void 0===i&&c===He&&(i=Be),Texture.call(this,null,r,n,o,a,s,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:fe,this.minFilter=void 0!==s?s:fe,this.flipY=!1,this.generateMipmaps=!1}function WireframeGeometry(e){function sortFunction(e,t){return e-t}BufferGeometry.call(this);var t=[0,0],i={},r=["a","b","c"];if(e&&e.isGeometry){for(var n=e.vertices,o=e.faces,a=0,s=new Uint32Array(6*o.length),l=0,c=o.length;l<c;l++)for(var u=o[l],h=0;h<3;h++){t[0]=u[r[h]],t[1]=u[r[(h+1)%3]],t.sort(sortFunction);void 0===i[w=t.toString()]&&(s[2*a]=t[0],s[2*a+1]=t[1],i[w]=!0,a++)}var d=new Float32Array(2*a*3);for(l=0,c=a;l<c;l++)for(h=0;h<2;h++){var p=n[s[2*l+h]];d[(_=6*l+3*h)+0]=p.x,d[_+1]=p.y,d[_+2]=p.z}this.addAttribute("position",new BufferAttribute(d,3))}else if(e&&e.isBufferGeometry)if(null!==e.index){var f=e.index.array,m=(n=e.attributes.position,e.groups);a=0;0===m.length&&e.addGroup(0,f.length);s=new Uint32Array(2*f.length);for(var g=0,v=m.length;g<v;++g)for(var y=m[g],b=y.start,x=(l=b,b+y.count);l<x;l+=3)for(h=0;h<3;h++){t[0]=f[l+h],t[1]=f[l+(h+1)%3],t.sort(sortFunction);var w;void 0===i[w=t.toString()]&&(s[2*a]=t[0],s[2*a+1]=t[1],i[w]=!0,a++)}for(d=new Float32Array(2*a*3),l=0,c=a;l<c;l++)for(h=0;h<2;h++){var _=6*l+3*h,E=s[2*l+h];d[_+0]=n.getX(E),d[_+1]=n.getY(E),d[_+2]=n.getZ(E)}this.addAttribute("position",new BufferAttribute(d,3))}else{var M=(a=(n=e.attributes.position.array).length/3)/3;for(d=new Float32Array(2*a*3),l=0,c=M;l<c;l++)for(h=0;h<3;h++){var A=9*l+3*h;d[(_=18*l+6*h)+0]=n[A],d[_+1]=n[A+1],d[_+2]=n[A+2];E=9*l+(h+1)%3*3;d[_+3]=n[E],d[_+4]=n[E+1],d[_+5]=n[E+2]}this.addAttribute("position",new BufferAttribute(d,3))}}function ParametricBufferGeometry(e,t,i){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var r,n,o,a,s,l=[],c=[],u=t+1;for(r=0;r<=i;r++)for(s=r/i,n=0;n<=t;n++)o=e(a=n/t,s),l.push(o.x,o.y,o.z),c.push(a,s);var h,d,p,f,m=[];for(r=0;r<i;r++)for(n=0;n<t;n++)h=r*u+n,d=r*u+n+1,p=(r+1)*u+n+1,f=(r+1)*u+n,m.push(h,d,f),m.push(d,p,f);this.setIndex(new(m.length>65535?Uint32BufferAttribute:Uint16BufferAttribute)(m,1)),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("uv",new Float32BufferAttribute(c,2)),this.computeVertexNormals()}function ParametricGeometry(e,t,i){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new ParametricBufferGeometry(e,t,i)),this.mergeVertices()}function PolyhedronBufferGeometry(e,t,i,r){function pushVertex(e){n.push(e.x,e.y,e.z)}function getVertexByIndex(t,i){var r=3*t;i.x=e[r+0],i.y=e[r+1],i.z=e[r+2]}function correctUV(e,t,i,r){r<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=r/2/Math.PI+.5)}function azimuth(e){return Math.atan2(e.z,-e.x)}BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},i=i||1;var n=[],o=[];!function subdivide(e){for(var i=new Vector3,r=new Vector3,n=new Vector3,o=0;o<t.length;o+=3)getVertexByIndex(t[o+0],i),getVertexByIndex(t[o+1],r),getVertexByIndex(t[o+2],n),function subdivideFace(e,t,i,r){var n,o,a=Math.pow(2,r),s=[];for(n=0;n<=a;n++){s[n]=[];var l=e.clone().lerp(i,n/a),c=t.clone().lerp(i,n/a),u=a-n;for(o=0;o<=u;o++)s[n][o]=0===o&&n===a?l:l.clone().lerp(c,o/u)}for(n=0;n<a;n++)for(o=0;o<2*(a-n)-1;o++){var h=Math.floor(o/2);o%2==0?(pushVertex(s[n][h+1]),pushVertex(s[n+1][h]),pushVertex(s[n][h])):(pushVertex(s[n][h+1]),pushVertex(s[n+1][h+1]),pushVertex(s[n+1][h]))}}(i,r,n,e)}(r=r||0),function appplyRadius(e){for(var t=new Vector3,i=0;i<n.length;i+=3)t.x=n[i+0],t.y=n[i+1],t.z=n[i+2],t.normalize().multiplyScalar(e),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z}(i),function generateUVs(){for(var e=new Vector3,t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];var i=azimuth(e)/2/Math.PI+.5,r=function inclination(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;o.push(i,1-r)}!function correctUVs(){for(var e=new Vector3,t=new Vector3,i=new Vector3,r=new Vector3,a=new Vector2,s=new Vector2,l=new Vector2,c=0,u=0;c<n.length;c+=9,u+=6){e.set(n[c+0],n[c+1],n[c+2]),t.set(n[c+3],n[c+4],n[c+5]),i.set(n[c+6],n[c+7],n[c+8]),a.set(o[u+0],o[u+1]),s.set(o[u+2],o[u+3]),l.set(o[u+4],o[u+5]),r.copy(e).add(t).add(i).divideScalar(3);var h=azimuth(r);correctUV(a,u+0,e,h),correctUV(s,u+2,t,h),correctUV(l,u+4,i,h)}}(),function correctSeam(){for(var e=0;e<o.length;e+=6){var t=o[e+0],i=o[e+2],r=o[e+4],n=Math.max(t,i,r),a=Math.min(t,i,r);n>.9&&a<.1&&(t<.2&&(o[e+0]+=1),i<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.addAttribute("position",new Float32BufferAttribute(n,3)),this.addAttribute("normal",new Float32BufferAttribute(n.slice(),3)),this.addAttribute("uv",new Float32BufferAttribute(o,2)),this.normalizeNormals(),this.boundingSphere=new Sphere(new Vector3,i)}function TetrahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function TetrahedronGeometry(e,t){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new TetrahedronBufferGeometry(e,t)),this.mergeVertices()}function OctahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function OctahedronGeometry(e,t){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new OctahedronBufferGeometry(e,t)),this.mergeVertices()}function IcosahedronBufferGeometry(e,t){var i=(1+Math.sqrt(5))/2;PolyhedronBufferGeometry.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function IcosahedronGeometry(e,t){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new IcosahedronBufferGeometry(e,t)),this.mergeVertices()}function DodecahedronBufferGeometry(e,t){var i=(1+Math.sqrt(5))/2,r=1/i;PolyhedronBufferGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function DodecahedronGeometry(e,t){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new DodecahedronBufferGeometry(e,t)),this.mergeVertices()}function PolyhedronGeometry(e,t,i,r){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},this.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,i,r)),this.mergeVertices()}function TubeBufferGeometry(e,t,i,r,n){function generateSegment(n){var a=e.getPointAt(n/t),u=o.normals[n],p=o.binormals[n];for(s=0;s<=r;s++){var f=s/r*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);c.x=g*u.x+m*p.x,c.y=g*u.y+m*p.y,c.z=g*u.z+m*p.z,c.normalize(),d.push(c.x,c.y,c.z),l.x=a.x+i*c.x,l.y=a.y+i*c.y,l.z=a.z+i*c.z,h.push(l.x,l.y,l.z)}}BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},t=t||64,i=i||1,r=r||8,n=n||!1;var o=e.computeFrenetFrames(t,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new Vector3,c=new Vector3,u=new Vector2,h=[],d=[],p=[],f=[];!function generateBufferData(){for(a=0;a<t;a++)generateSegment(a);generateSegment(!1===n?t:0),function generateUVs(){for(a=0;a<=t;a++)for(s=0;s<=r;s++)u.x=a/t,u.y=s/r,p.push(u.x,u.y)}(),function generateIndices(){for(s=1;s<=t;s++)for(a=1;a<=r;a++){var e=(r+1)*(s-1)+(a-1),i=(r+1)*s+(a-1),n=(r+1)*s+a,o=(r+1)*(s-1)+a;f.push(e,i,o),f.push(i,n,o)}}()}(),this.setIndex(new(f.length>65535?Uint32BufferAttribute:Uint16BufferAttribute)(f,1)),this.addAttribute("position",new Float32BufferAttribute(h,3)),this.addAttribute("normal",new Float32BufferAttribute(d,3)),this.addAttribute("uv",new Float32BufferAttribute(p,2))}function TubeGeometry(e,t,i,r,n,o){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new TubeBufferGeometry(e,t,i,r,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function TorusKnotBufferGeometry(e,t,i,r,n,o){function calculatePositionOnCurve(e,t,i,r,n){var o=Math.cos(e),a=Math.sin(e),s=i/t*e,l=Math.cos(s);n.x=r*(2+l)*.5*o,n.y=r*(2+l)*a*.5,n.z=r*Math.sin(s)*.5}BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},e=e||100,t=t||40,i=Math.floor(i)||64,r=Math.floor(r)||8,n=n||2,o=o||3;var a,s,l=(r+1)*(i+1),c=r*i*2*3,u=new BufferAttribute(new(c>65535?Uint32Array:Uint16Array)(c),1),h=new BufferAttribute(new Float32Array(3*l),3),d=new BufferAttribute(new Float32Array(3*l),3),p=new BufferAttribute(new Float32Array(2*l),2),f=0,m=0,g=new Vector3,v=new Vector3,y=new Vector2,b=new Vector3,x=new Vector3,w=new Vector3,_=new Vector3,E=new Vector3;for(a=0;a<=i;++a){var M=a/i*n*Math.PI*2;for(calculatePositionOnCurve(M,n,o,e,b),calculatePositionOnCurve(M+.01,n,o,e,x),_.subVectors(x,b),E.addVectors(x,b),w.crossVectors(_,E),E.crossVectors(w,_),w.normalize(),E.normalize(),s=0;s<=r;++s){var A=s/r*Math.PI*2,T=-t*Math.cos(A),S=t*Math.sin(A);g.x=b.x+(T*E.x+S*w.x),g.y=b.y+(T*E.y+S*w.y),g.z=b.z+(T*E.z+S*w.z),h.setXYZ(f,g.x,g.y,g.z),v.subVectors(g,b).normalize(),d.setXYZ(f,v.x,v.y,v.z),y.x=a/i,y.y=s/r,p.setXY(f,y.x,y.y),f++}}for(s=1;s<=i;s++)for(a=1;a<=r;a++){var P=(r+1)*(s-1)+(a-1),C=(r+1)*s+(a-1),R=(r+1)*s+a,L=(r+1)*(s-1)+a;u.setX(m,P),m++,u.setX(m,C),m++,u.setX(m,L),m++,u.setX(m,C),m++,u.setX(m,R),m++,u.setX(m,L),m++}this.setIndex(u),this.addAttribute("position",h),this.addAttribute("normal",d),this.addAttribute("uv",p)}function TorusKnotGeometry(e,t,i,r,n,o,a){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,i,r,n,o)),this.mergeVertices()}function TorusBufferGeometry(e,t,i,r,n){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},e=e||100,t=t||40,i=Math.floor(i)||8,r=Math.floor(r)||6,n=n||2*Math.PI;var o,a,s=(i+1)*(r+1),l=i*r*2*3,c=new(l>65535?Uint32Array:Uint16Array)(l),u=new Float32Array(3*s),h=new Float32Array(3*s),d=new Float32Array(2*s),p=0,f=0,m=0,g=new Vector3,v=new Vector3,y=new Vector3;for(o=0;o<=i;o++)for(a=0;a<=r;a++){var b=a/r*n,x=o/i*Math.PI*2;v.x=(e+t*Math.cos(x))*Math.cos(b),v.y=(e+t*Math.cos(x))*Math.sin(b),v.z=t*Math.sin(x),u[p]=v.x,u[p+1]=v.y,u[p+2]=v.z,g.x=e*Math.cos(b),g.y=e*Math.sin(b),y.subVectors(v,g).normalize(),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z,d[f]=a/r,d[f+1]=o/i,p+=3,f+=2}for(o=1;o<=i;o++)for(a=1;a<=r;a++){var w=(r+1)*o+a-1,_=(r+1)*(o-1)+a-1,E=(r+1)*(o-1)+a,M=(r+1)*o+a;c[m]=w,c[m+1]=_,c[m+2]=M,c[m+3]=_,c[m+4]=E,c[m+5]=M,m+=6}this.setIndex(new BufferAttribute(c,1)),this.addAttribute("position",new BufferAttribute(u,3)),this.addAttribute("normal",new BufferAttribute(h,3)),this.addAttribute("uv",new BufferAttribute(d,2))}function TorusGeometry(e,t,i,r,n){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},this.fromBufferGeometry(new TorusBufferGeometry(e,t,i,r,n))}function ExtrudeGeometry(e,t){void 0!==e?(Geometry.call(this),this.type="ExtrudeGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeFaceNormals()):e=[]}function TextGeometry(e,t){var i=(t=t||{}).font;if(!1===(i&&i.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Geometry;var r=i.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ExtrudeGeometry.call(this,r,t),this.type="TextGeometry"}function SphereBufferGeometry(e,t,i,r,n,o,a){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;for(var s=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),l=(t+1)*(i+1),c=new BufferAttribute(new Float32Array(3*l),3),u=new BufferAttribute(new Float32Array(3*l),3),h=new BufferAttribute(new Float32Array(2*l),2),d=0,p=[],f=new Vector3,m=0;m<=i;m++){for(var g=[],v=m/i,y=0;y<=t;y++){var b=y/t,x=-e*Math.cos(r+b*n)*Math.sin(o+v*a),w=e*Math.cos(o+v*a),_=e*Math.sin(r+b*n)*Math.sin(o+v*a);f.set(x,w,_).normalize(),c.setXYZ(d,x,w,_),u.setXYZ(d,f.x,f.y,f.z),h.setXY(d,b,1-v),g.push(d),d++}p.push(g)}var E=[];for(m=0;m<i;m++)for(y=0;y<t;y++){var M=p[m][y+1],A=p[m][y],T=p[m+1][y],S=p[m+1][y+1];(0!==m||o>0)&&E.push(M,A,S),(m!==i-1||s<Math.PI)&&E.push(A,T,S)}this.setIndex(new(c.count>65535?Uint32BufferAttribute:Uint16BufferAttribute)(E,1)),this.addAttribute("position",c),this.addAttribute("normal",u),this.addAttribute("uv",h),this.boundingSphere=new Sphere(new Vector3,e)}function SphereGeometry(e,t,i,r,n,o,a){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new SphereBufferGeometry(e,t,i,r,n,o,a))}function RingBufferGeometry(e,t,i,r,n,o){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},e=e||20,t=t||50,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI;var a,s,l,c=((i=void 0!==i?Math.max(3,i):8)+1)*((r=void 0!==r?Math.max(1,r):1)+1),u=i*r*2*3,h=new BufferAttribute(new(u>65535?Uint32Array:Uint16Array)(u),1),d=new BufferAttribute(new Float32Array(3*c),3),p=new BufferAttribute(new Float32Array(3*c),3),f=new BufferAttribute(new Float32Array(2*c),2),m=0,g=0,v=e,y=(t-e)/r,b=new Vector3,x=new Vector2;for(s=0;s<=r;s++){for(l=0;l<=i;l++)a=n+l/i*o,b.x=v*Math.cos(a),b.y=v*Math.sin(a),d.setXYZ(m,b.x,b.y,b.z),p.setXYZ(m,0,0,1),x.x=(b.x/t+1)/2,x.y=(b.y/t+1)/2,f.setXY(m,x.x,x.y),m++;v+=y}for(s=0;s<r;s++){var w=s*(i+1);for(l=0;l<i;l++){var _=a=l+w,E=a+i+1,M=a+i+2,A=a+1;h.setX(g,_),g++,h.setX(g,E),g++,h.setX(g,M),g++,h.setX(g,_),g++,h.setX(g,M),g++,h.setX(g,A),g++}}this.setIndex(h),this.addAttribute("position",d),this.addAttribute("normal",p),this.addAttribute("uv",f)}function RingGeometry(e,t,i,r,n,o){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},this.fromBufferGeometry(new RingBufferGeometry(e,t,i,r,n,o))}function PlaneGeometry(e,t,i,r){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new PlaneBufferGeometry(e,t,i,r))}function LatheBufferGeometry(e,t,i,r){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t)||12,i=i||0,r=r||2*Math.PI,r=ut.clamp(r,0,2*Math.PI);var n,o,a,s=(t+1)*e.length,l=t*e.length*2*3,c=new BufferAttribute(new(l>65535?Uint32Array:Uint16Array)(l),1),u=new BufferAttribute(new Float32Array(3*s),3),h=new BufferAttribute(new Float32Array(2*s),2),d=0,p=0,f=1/t,m=new Vector3,g=new Vector2;for(o=0;o<=t;o++){var v=i+o*f*r,y=Math.sin(v),b=Math.cos(v);for(a=0;a<=e.length-1;a++)m.x=e[a].x*y,m.y=e[a].y,m.z=e[a].x*b,u.setXYZ(d,m.x,m.y,m.z),g.x=o/t,g.y=a/(e.length-1),h.setXY(d,g.x,g.y),d++}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var x=n=a+o*e.length,w=n+e.length,_=n+e.length+1,E=n+1;c.setX(p,x),p++,c.setX(p,w),p++,c.setX(p,E),p++,c.setX(p,w),p++,c.setX(p,_),p++,c.setX(p,E),p++}if(this.setIndex(c),this.addAttribute("position",u),this.addAttribute("uv",h),this.computeVertexNormals(),r===2*Math.PI){var M=this.attributes.normal.array,A=new Vector3,T=new Vector3,S=new Vector3;for(n=t*e.length*3,o=0,a=0;o<e.length;o++,a+=3)A.x=M[a+0],A.y=M[a+1],A.z=M[a+2],T.x=M[n+a+0],T.y=M[n+a+1],T.z=M[n+a+2],S.addVectors(A,T).normalize(),M[a+0]=M[n+a+0]=S.x,M[a+1]=M[n+a+1]=S.y,M[a+2]=M[n+a+2]=S.z}}function LatheGeometry(e,t,i,r){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},this.fromBufferGeometry(new LatheBufferGeometry(e,t,i,r)),this.mergeVertices()}function ShapeBufferGeometry(e,t){function addShape(e){var a,l,c,u=i.length/3,h=e.extractPoints(t),d=h.shape,p=h.holes;if(!1===At.isClockWise(d))for(d=d.reverse(),a=0,l=p.length;a<l;a++)c=p[a],!0===At.isClockWise(c)&&(p[a]=c.reverse());var f=At.triangulateShape(d,p);for(a=0,l=p.length;a<l;a++)c=p[a],d=d.concat(c);for(a=0,l=d.length;a<l;a++){var m=d[a];i.push(m.x,m.y,0),r.push(0,0,1),n.push(m.x,m.y)}for(a=0,l=f.length;a<l;a++){var g=f[a],v=g[0]+u,y=g[1]+u,b=g[2]+u;o.push(v,y,b),s+=3}}BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],r=[],n=[],o=[],a=0,s=0;if(!1===Array.isArray(e))addShape(e);else for(var l=0;l<e.length;l++)addShape(e[l]),this.addGroup(a,s,l),a+=s,s=0;this.setIndex(new(o.length>65535?Uint32BufferAttribute:Uint16BufferAttribute)(o,1)),this.addAttribute("position",new Float32BufferAttribute(i,3)),this.addAttribute("normal",new Float32BufferAttribute(r,3)),this.addAttribute("uv",new Float32BufferAttribute(n,2))}function ShapeGeometry(e,t){Geometry.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ShapeBufferGeometry(e,t)),this.mergeVertices()}function EdgesGeometry(e,t){function sortFunction(e,t){return e-t}BufferGeometry.call(this),t=void 0!==t?t:1;var i,r=Math.cos(ut.DEG2RAD*t),n=[0,0],o={},a=["a","b","c"];e.isBufferGeometry?(i=new Geometry).fromBufferGeometry(e):i=e.clone(),i.mergeVertices(),i.computeFaceNormals();for(var s=i.vertices,l=i.faces,c=0,u=l.length;c<u;c++)for(var h=l[c],d=0;d<3;d++){n[0]=h[a[d]],n[1]=h[a[(d+1)%3]],n.sort(sortFunction);void 0===o[f=n.toString()]?o[f]={vert1:n[0],vert2:n[1],face1:c,face2:void 0}:o[f].face2=c}var p=[];for(var f in o){var m=o[f];if(void 0===m.face2||l[m.face1].normal.dot(l[m.face2].normal)<=r){var g=s[m.vert1];p.push(g.x),p.push(g.y),p.push(g.z),g=s[m.vert2],p.push(g.x),p.push(g.y),p.push(g.z)}}this.addAttribute("position",new BufferAttribute(new Float32Array(p),3))}function CylinderBufferGeometry(e,t,i,r,n,o,a,s){function generateCap(i){var n,o,c,u=new Vector2,h=new Vector3,y=0,w=!0===i?e:t,_=!0===i?1:-1;for(o=g,n=1;n<=r;n++)p.setXYZ(g,0,b*_,0),f.setXYZ(g,0,_,0),u.x=.5,u.y=.5,m.setXY(g,u.x,u.y),g++;for(c=g,n=0;n<=r;n++){var E=n/r*s+a,M=Math.cos(E),A=Math.sin(E);h.x=w*A,h.y=b*_,h.z=w*M,p.setXYZ(g,h.x,h.y,h.z),f.setXYZ(g,0,_,0),u.x=.5*M+.5,u.y=.5*A*_+.5,m.setXY(g,u.x,u.y),g++}for(n=0;n<r;n++){var T=o+n,S=c+n;!0===i?(d.setX(v,S),v++,d.setX(v,S+1),v++,d.setX(v,T),v++):(d.setX(v,S+1),v++,d.setX(v,S),v++,d.setX(v,T),v++),y+=3}l.addGroup(x,y,!0===i?1:2),x+=y}BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s};var l=this;e=void 0!==e?e:20,t=void 0!==t?t:20,i=void 0!==i?i:100,r=Math.floor(r)||8,n=Math.floor(n)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var c=0;!1===o&&(e>0&&c++,t>0&&c++);var u=function calculateVertexCount(){var e=(r+1)*(n+1);return!1===o&&(e+=(r+1)*c+r*c),e}(),h=function calculateIndexCount(){var e=r*n*2*3;return!1===o&&(e+=r*c*3),e}(),d=new BufferAttribute(new(h>65535?Uint32Array:Uint16Array)(h),1),p=new BufferAttribute(new Float32Array(3*u),3),f=new BufferAttribute(new Float32Array(3*u),3),m=new BufferAttribute(new Float32Array(2*u),2),g=0,v=0,y=[],b=i/2,x=0;!function generateTorso(){var o,c,u=new Vector3,h=new Vector3,w=0,_=(t-e)/i;for(c=0;c<=n;c++){var E=[],M=c/n,A=M*(t-e)+e;for(o=0;o<=r;o++){var T=o/r,S=T*s+a,P=Math.sin(S),C=Math.cos(S);h.x=A*P,h.y=-M*i+b,h.z=A*C,p.setXYZ(g,h.x,h.y,h.z),u.set(P,_,C).normalize(),f.setXYZ(g,u.x,u.y,u.z),m.setXY(g,T,1-M),E.push(g),g++}y.push(E)}for(o=0;o<r;o++)for(c=0;c<n;c++){var R=y[c][o],L=y[c+1][o],B=y[c+1][o+1],D=y[c][o+1];d.setX(v,R),v++,d.setX(v,L),v++,d.setX(v,D),v++,d.setX(v,L),v++,d.setX(v,B),v++,d.setX(v,D),v++,w+=6}l.addGroup(x,w,0),x+=w}(),!1===o&&(e>0&&generateCap(!0),t>0&&generateCap(!1)),this.setIndex(d),this.addAttribute("position",p),this.addAttribute("normal",f),this.addAttribute("uv",m)}function CylinderGeometry(e,t,i,r,n,o,a,s){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new CylinderBufferGeometry(e,t,i,r,n,o,a,s)),this.mergeVertices()}function ConeGeometry(e,t,i,r,n,o,a){CylinderGeometry.call(this,0,e,t,i,r,n,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}function ConeBufferGeometry(e,t,i,r,n,o,a){CylinderBufferGeometry.call(this,0,e,t,i,r,n,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}function CircleBufferGeometry(e,t,i,r){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},e=e||50,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var n=t+2,o=new Float32Array(3*n),a=new Float32Array(3*n),s=new Float32Array(2*n);a[2]=1,s[0]=.5,s[1]=.5;for(var l=0,c=3,u=2;l<=t;l++,c+=3,u+=2){var h=i+l/t*r;o[c]=e*Math.cos(h),o[c+1]=e*Math.sin(h),a[c+2]=1,s[u]=(o[c]/e+1)/2,s[u+1]=(o[c+1]/e+1)/2}var d=[];for(c=1;c<=t;c++)d.push(c,c+1,0);this.setIndex(new BufferAttribute(new Uint16Array(d),1)),this.addAttribute("position",new BufferAttribute(o,3)),this.addAttribute("normal",new BufferAttribute(a,3)),this.addAttribute("uv",new BufferAttribute(s,2)),this.boundingSphere=new Sphere(new Vector3,e)}function CircleGeometry(e,t,i,r){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new CircleBufferGeometry(e,t,i,r))}function BoxGeometry(e,t,i,r,n,o){Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o},this.fromBufferGeometry(new BoxBufferGeometry(e,t,i,r,n,o)),this.mergeVertices()}function ShadowMaterial(){ShaderMaterial.call(this,{uniforms:Object.assign({},bt.lights,{opacity:{value:1}}),vertexShader:vt.shadow_vert,fragmentShader:vt.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}}})}function RawShaderMaterial(e){ShaderMaterial.call(this,e),this.type="RawShaderMaterial"}function MultiMaterial(e){this.uuid=ut.generateUUID(),this.type="MultiMaterial",this.materials=e instanceof Array?e:[],this.visible=!0}function MeshStandardMaterial(e){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function MeshPhongMaterial(e){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshToonMaterial(e){MeshPhongMaterial.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function MeshNormalMaterial(e){Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.morphTargets=!1,this.setValues(e)}function MeshLambertMaterial(e){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function LineDashedMaterial(e){Material.call(this),this.type="LineDashedMaterial",this.color=new Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(e)}function LoadingManager(e,t,i){var r=this,n=!1,o=0,a=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===n&&void 0!==r.onStart&&r.onStart(e,o,a),n=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)}}function FileLoader(e){this.manager=void 0!==e?e:Ct}function CompressedTextureLoader(e){this.manager=void 0!==e?e:Ct,this._parser=null}function BinaryTextureLoader(e){this.manager=void 0!==e?e:Ct,this._parser=null}function ImageLoader(e){this.manager=void 0!==e?e:Ct}function CubeTextureLoader(e){this.manager=void 0!==e?e:Ct}function TextureLoader(e){this.manager=void 0!==e?e:Ct}function Light(e,t){Object3D.call(this),this.type="Light",this.color=new Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function HemisphereLight(e,t,i){Light.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}function LightShadow(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.matrix=new Matrix4}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}function SpotLight(e,t,i,r,n,o){Light.call(this,e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==o?o:1,this.shadow=new SpotLightShadow}function PointLight(e,t,i,r){Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new LightShadow(new PerspectiveCamera(90,1,.5,500))}function DirectionalLightShadow(e){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(e,t){Light.call(this,e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(e,t){Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Interpolant(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function CubicInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}function DiscreteInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}function KeyframeTrackConstructor(e,t,i,r){if(void 0===e)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keyframes in track named "+e);this.name=e,this.times=Lt.convertArray(t,this.TimeBufferType),this.values=Lt.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation),this.validate(),this.optimize()}function VectorKeyframeTrack(e,t,i,r){KeyframeTrackConstructor.call(this,e,t,i,r)}function QuaternionLinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}function QuaternionKeyframeTrack(e,t,i,r){KeyframeTrackConstructor.call(this,e,t,i,r)}function NumberKeyframeTrack(e,t,i,r){KeyframeTrackConstructor.call(this,e,t,i,r)}function StringKeyframeTrack(e,t,i,r){KeyframeTrackConstructor.call(this,e,t,i,r)}function BooleanKeyframeTrack(e,t,i){KeyframeTrackConstructor.call(this,e,t,i)}function ColorKeyframeTrack(e,t,i,r){KeyframeTrackConstructor.call(this,e,t,i,r)}function KeyframeTrack(e,t,i,r){KeyframeTrackConstructor.apply(this,arguments)}function AnimationClip(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=ut.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function MaterialLoader(e){this.manager=void 0!==e?e:Ct,this.textures={}}function BufferGeometryLoader(e){this.manager=void 0!==e?e:Ct}function Loader(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function JSONLoader(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:Ct,this.withCredentials=!1}function ObjectLoader(e){this.manager=void 0!==e?e:Ct,this.texturePath=""}function Curve(){}function LineCurve(e,t){this.v1=e,this.v2=t}function CurvePath(){this.curves=[],this.autoClose=!1}function EllipseCurve(e,t,i,r,n,o,a,s){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s||0}function SplineCurve(e){this.points=void 0===e?[]:e}function CubicBezierCurve(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r}function QuadraticBezierCurve(e,t,i){this.v0=e,this.v1=t,this.v2=i}function Shape(){Path.apply(this,arguments),this.holes=[]}function Path(e){CurvePath.call(this),this.currentPoint=new Vector2,e&&this.fromPoints(e)}function ShapePath(){this.subPaths=[],this.currentPath=null}function Font(e){this.data=e}function FontLoader(e){this.manager=void 0!==e?e:Ct}function AudioLoader(e){this.manager=void 0!==e?e:Ct}function RectAreaLight(e,t,i,r){Light.call(this,e,t),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==i?i:10,this.height=void 0!==r?r:10}function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function CubeCamera(e,t,i){Object3D.call(this),this.type="CubeCamera";var r=new PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new Vector3(1,0,0)),this.add(r);var n=new PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new Vector3(-1,0,0)),this.add(n);var o=new PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new Vector3(0,1,0)),this.add(o);var a=new PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new Vector3(0,-1,0)),this.add(a);var s=new PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new Vector3(0,0,1)),this.add(s);var l=new PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Vector3(0,0,-1)),this.add(l);var c={format:Ie,magFilter:ve,minFilter:ve};this.renderTarget=new WebGLRenderTargetCube(i,i,c),this.updateCubeMap=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,c=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,r,i),i.activeCubeFace=1,e.render(t,n,i),i.activeCubeFace=2,e.render(t,o,i),i.activeCubeFace=3,e.render(t,a,i),i.activeCubeFace=4,e.render(t,s,i),i.texture.generateMipmaps=c,i.activeCubeFace=5,e.render(t,l,i),e.setRenderTarget(null)}}function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=Nt.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Audio(e){Object3D.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function PositionalAudio(e){Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function AudioAnalyser(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function PropertyMixer(e,t,i){this.binding=e,this.valueSize=i;var r,n=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":n=Array,r=this._select;break;default:r=this._lerp}this.buffer=new n(4*i),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function PropertyBinding(e,t,i){this.path=t,this.parsedPath=i||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function AnimationObjectGroup(e){this.uuid=ut.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var i=0,r=arguments.length;i!==r;++i)t[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function AnimationAction(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var r=t.tracks,n=r.length,o=new Array(n),a={endingStart:Qe,endingEnd:Qe},s=0;s!==n;++s){var l=r[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ke,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function AnimationMixer(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Uniform(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function InterleavedBufferAttribute(e,t,i,r){this.uuid=ut.generateUUID(),this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}function InterleavedBuffer(e,t){this.uuid=ut.generateUUID(),this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function InstancedInterleavedBuffer(e,t,i){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=i||1}function InstancedBufferAttribute(e,t,i){BufferAttribute.call(this,e,t),this.meshPerAttribute=i||1}function Raycaster(e,t,i,r){this.ray=new Ray(e,t),this.near=i||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,t,i,r){if(!1!==e.visible&&(e.raycast(t,i),!0===r))for(var n=e.children,o=0,a=n.length;o<a;o++)intersectObject(n[o],t,i,!0)}function Clock(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Spherical(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}function MorphBlendMesh(e,t){Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,r=i-1,n=i/1;this.createAnimation("__default",0,r,n),this.setAnimationWeight("__default",1)}function ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(e){}}function VertexNormalsHelper(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16711680,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new BufferGeometry,c=new Float32BufferAttribute(2*a*3,3);l.addAttribute("position",c),LineSegments.call(this,l,new LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function SpotLightHelper(e){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;for(var t=new BufferGeometry,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,n=1;r<32;r++,n++){var o=r/32*Math.PI*2,a=n/32*Math.PI*2;i.push(Math.cos(o),Math.sin(o),1,Math.cos(a),Math.sin(a),1)}t.addAttribute("position",new Float32BufferAttribute(i,3));var s=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(t,s),this.add(this.cone),this.update()}function SkeletonHelper(e){this.bones=this.getBoneList(e);for(var t=new BufferGeometry,i=[],r=[],n=new Color(0,0,1),o=new Color(0,1,0),a=0;a<this.bones.length;a++){var s=this.bones[a];s.parent&&s.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(n.r,n.g,n.b),r.push(o.r,o.g,o.b))}t.addAttribute("position",new Float32BufferAttribute(i,3)),t.addAttribute("color",new Float32BufferAttribute(r,3));var l=new LineBasicMaterial({vertexColors:m,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,t,l),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function PointLightHelper(e,t){this.light=e,this.light.updateMatrixWorld();var i=new SphereBufferGeometry(t,4,2),r=new MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),Mesh.call(this,i,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1}function RectAreaLightHelper(e){Object3D.call(this),this.light=e,this.light.updateMatrixWorld();var t=new MeshBasicMaterial({color:e.color,fog:!1}),i=new MeshBasicMaterial({color:e.color,fog:!1,wireframe:!0}),r=new BufferGeometry;r.addAttribute("position",new BufferAttribute(new Float32Array(18),3)),this.add(new Mesh(r,t)),this.add(new Mesh(r,i)),this.update()}function HemisphereLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var i=new OctahedronBufferGeometry(t);i.rotateY(.5*Math.PI);var r=new MeshBasicMaterial({vertexColors:m,wireframe:!0}),n=i.getAttribute("position"),o=new Float32Array(3*n.count);i.addAttribute("color",new BufferAttribute(o,3)),this.add(new Mesh(i,r)),this.update()}function GridHelper(e,t,i,r){e=e||10,t=t||10,i=new Color(void 0!==i?i:4473924),r=new Color(void 0!==r?r:8947848);for(var n=t/2,o=2*e/t,a=[],s=[],l=0,c=0,u=-e;l<=t;l++,u+=o){a.push(-e,0,u,e,0,u),a.push(u,0,-e,u,0,e);var h=l===n?i:r;h.toArray(s,c),c+=3,h.toArray(s,c),c+=3,h.toArray(s,c),c+=3,h.toArray(s,c),c+=3}var d=new BufferGeometry;d.addAttribute("position",new Float32BufferAttribute(a,3)),d.addAttribute("color",new Float32BufferAttribute(s,3));var p=new LineBasicMaterial({vertexColors:m});LineSegments.call(this,d,p)}function PolarGridHelper(e,t,i,r,n,o){e=e||10,t=t||16,i=i||8,r=r||64,n=new Color(void 0!==n?n:4473924),o=new Color(void 0!==o?o:8947848);var a,s,l,c,u,h,d,p=[],f=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),a=Math.sin(l)*e,s=Math.cos(l)*e,p.push(0,0,0),p.push(a,0,s),d=1&c?n:o,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(c=0;c<=i;c++)for(d=1&c?n:o,h=e-e/i*c,u=0;u<r;u++)l=u/r*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,p.push(a,0,s),f.push(d.r,d.g,d.b),l=(u+1)/r*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,p.push(a,0,s),f.push(d.r,d.g,d.b);var g=new BufferGeometry;g.addAttribute("position",new Float32BufferAttribute(p,3)),g.addAttribute("color",new Float32BufferAttribute(f,3));var v=new LineBasicMaterial({vertexColors:m});LineSegments.call(this,g,v)}function FaceNormalsHelper(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16776960,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new BufferGeometry,c=new Float32BufferAttribute(2*a*3,3);l.addAttribute("position",c),LineSegments.call(this,l,new LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function DirectionalLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,void 0===t&&(t=1);var i=new BufferGeometry;i.addAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var r=new LineBasicMaterial({fog:!1});this.add(new Line(i,r)),(i=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.add(new Line(i,r)),this.update()}function CameraHelper(e){function addLine(e,t,i){addPoint(e,i),addPoint(t,i)}function addPoint(e,t){r.push(0,0,0),n.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}var t=new BufferGeometry,i=new LineBasicMaterial({color:16777215,vertexColors:f}),r=[],n=[],o={},a=new Color(16755200),s=new Color(16711680),l=new Color(43775),c=new Color(16777215),u=new Color(3355443);addLine("n1","n2",a),addLine("n2","n4",a),addLine("n4","n3",a),addLine("n3","n1",a),addLine("f1","f2",a),addLine("f2","f4",a),addLine("f4","f3",a),addLine("f3","f1",a),addLine("n1","f1",a),addLine("n2","f2",a),addLine("n3","f3",a),addLine("n4","f4",a),addLine("p","n1",s),addLine("p","n2",s),addLine("p","n3",s),addLine("p","n4",s),addLine("u1","u2",l),addLine("u2","u3",l),addLine("u3","u1",l),addLine("c","t",c),addLine("p","c",u),addLine("cn1","cn2",u),addLine("cn3","cn4",u),addLine("cf1","cf2",u),addLine("cf3","cf4",u),t.addAttribute("position",new Float32BufferAttribute(r,3)),t.addAttribute("color",new Float32BufferAttribute(n,3)),LineSegments.call(this,t,i),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function BoxHelper(e,t){void 0===t&&(t=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new BufferGeometry;n.setIndex(new BufferAttribute(i,1)),n.addAttribute("position",new BufferAttribute(r,3)),LineSegments.call(this,n,new LineBasicMaterial({color:t})),void 0!==e&&this.update(e)}function ArrowHelper(e,t,i,r,n,o){Object3D.call(this),void 0===r&&(r=16776960),void 0===i&&(i=1),void 0===n&&(n=.2*i),void 0===o&&(o=.2*n),this.position.copy(t),this.line=new Line(kt,new LineBasicMaterial({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(Ft,new MeshBasicMaterial({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,n,o)}function AxisHelper(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new BufferGeometry;i.addAttribute("position",new Float32BufferAttribute(t,3)),i.addAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new LineBasicMaterial({vertexColors:m});LineSegments.call(this,i,r)}function ArcCurve(e,t,i,r,n,o){EllipseCurve.call(this,e,t,i,i,r,n,o)}function ClosedSplineCurve3(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ut.call(this,e),this.type="catmullrom",this.closed=!0}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(void 0!==r&&null!==r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}),Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;var i=[],r=0,n=t.length;for(r=0;r<n;r++)i[r]=t[r];for(r=0;r<n;r++)i[r].call(this,e)}}}});var t="83dev",i=0,r=1,n=2,o=0,a=1,s=2,l=0,c=1,u=2,h=1,d=2,p=0,f=1,m=2,g=0,y=1,b=2,x=3,w=4,_=5,E={NoBlending:g,NormalBlending:y,AdditiveBlending:b,SubtractiveBlending:x,MultiplyBlending:w,CustomBlending:_},M=100,A=101,T=102,S=103,P=104,C=200,R=201,L=202,B=203,D=204,I=205,O=206,N=207,k=208,F=209,U=210,H=0,z=1,G=2,V=3,j=4,W=5,q=6,X=7,Y=0,$=1,K=2,Q=0,Z=1,J=2,ee=3,te=4,ie=301,re=302,ne=303,oe=304,ae=305,se=306,le=307,ce={UVMapping:300,CubeReflectionMapping:ie,CubeRefractionMapping:re,EquirectangularReflectionMapping:ne,EquirectangularRefractionMapping:oe,SphericalReflectionMapping:ae,CubeUVReflectionMapping:se,CubeUVRefractionMapping:le},ue=1e3,he=1001,de=1002,pe={RepeatWrapping:ue,ClampToEdgeWrapping:he,MirroredRepeatWrapping:de},fe=1003,me=1004,ge=1005,ve=1006,ye=1007,be=1008,xe={NearestFilter:fe,NearestMipMapNearestFilter:me,NearestMipMapLinearFilter:ge,LinearFilter:ve,LinearMipMapNearestFilter:ye,LinearMipMapLinearFilter:be},we=1009,_e=1010,Ee=1011,Me=1012,Ae=1013,Te=1014,Se=1015,Pe=1016,Ce=1017,Re=1018,Le=1019,Be=1020,De=1021,Ie=1022,Oe=1023,Ne=1024,ke=1025,Fe=Oe,Ue=1026,He=1027,ze=2001,Ge=2002,Ve=2003,je=2004,We=2100,qe=2101,Xe=2102,Ye=2103,$e=2151,Ke=2201,Qe=2400,Ze=0,Je=1,et=2,tt=3e3,it=3001,rt=3007,nt=3002,ot=3004,at=3005,st=3006,lt=3200,ct=3201,ut={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function generateUUID(){for(var n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*ut.DEG2RAD},radToDeg:function(e){return e*ut.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}};Vector2.prototype={constructor:Vector2,isVector2:!0,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e):(this.x=0,this.y=0),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e,t;return function clampScalar(i,r){return void 0===e&&(e=new Vector2,t=new Vector2),e.set(i,i),t.set(r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}};var ht=0;Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=300,Texture.prototype={constructor:Texture,isTexture:!0,set needsUpdate(e){!0===e&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var t={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=ut.generateUUID()),void 0===e.images[i.uuid]&&(e.images[i.uuid]={uuid:i.uuid,url:function getDataURL(e){var t;return void 0!==e.toDataURL?t=e:((t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height)),t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}(i)}),t.image=i.uuid}return e.textures[this.uuid]=t,t},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300===this.mapping){if(e.multiply(this.repeat),e.add(this.offset),e.x<0||e.x>1)switch(this.wrapS){case ue:e.x=e.x-Math.floor(e.x);break;case he:e.x=e.x<0?0:1;break;case de:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ue:e.y=e.y-Math.floor(e.y);break;case he:e.y=e.y<0?0:1;break;case de:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}},Object.assign(Texture.prototype,EventDispatcher.prototype),Vector4.prototype={constructor:Vector4,isVector4:!0,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(u+1)/2,v=(f+1)/2,y=(s+c)/4,b=(l+d)/4,x=(h+p)/4;return m>g&&m>v?m<.01?(i=0,r=.707106781,n=.707106781):(r=y/(i=Math.sqrt(m)),n=b/i):g>v?g<.01?(i=.707106781,r=0,n=.707106781):(i=y/(r=Math.sqrt(g)),n=x/r):v<.01?(i=.707106781,r=.707106781,n=0):(i=b/(n=Math.sqrt(v)),r=x/n),this.set(i,r,n,t),this}var w=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-s)*(c-s));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(l-d)/w,this.z=(c-s)/w,this.w=Math.acos((a+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function clampScalar(i,r){return void 0===e&&(e=new Vector4,t=new Vector4),e.set(i,i,i,i),t.set(r,r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},Object.assign(WebGLRenderTarget.prototype,EventDispatcher.prototype,{isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype)).constructor=WebGLRenderTargetCube,WebGLRenderTargetCube.prototype.isWebGLRenderTargetCube=!0,Quaternion.prototype={constructor:Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!1===(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=Math.cos(e._x/2),r=Math.cos(e._y/2),n=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2),l=e.order;return"XYZ"===l?(this._x=o*r*n+i*a*s,this._y=i*a*n-o*r*s,this._z=i*r*s+o*a*n,this._w=i*r*n-o*a*s):"YXZ"===l?(this._x=o*r*n+i*a*s,this._y=i*a*n-o*r*s,this._z=i*r*s-o*a*n,this._w=i*r*n+o*a*s):"ZXY"===l?(this._x=o*r*n-i*a*s,this._y=i*a*n+o*r*s,this._z=i*r*s+o*a*n,this._w=i*r*n-o*a*s):"ZYX"===l?(this._x=o*r*n-i*a*s,this._y=i*a*n+o*r*s,this._z=i*r*s-o*a*n,this._w=i*r*n+o*a*s):"YZX"===l?(this._x=o*r*n+i*a*s,this._y=i*a*n+o*r*s,this._z=i*r*s-o*a*n,this._w=i*r*n-o*a*s):"XZY"===l&&(this._x=o*r*n-i*a*s,this._y=i*a*n-o*r*s,this._z=i*r*s+o*a*n,this._w=i*r*n+o*a*s),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],a=i[1],s=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=r+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,this._z=(a-n)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(o+c)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(o-c)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(a-n)/t,this._x=(o+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t;return function setFromUnitVectors(i,r){return void 0===e&&(e=new Vector3),(t=i.dot(r)+1)<1e-6?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,r),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=i*c+o*a+r*l-n*s,this._y=r*c+o*s+n*a-i*l,this._z=n*c+o*l+i*s-r*a,this._w=o*c-i*a-r*s-n*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,a=o*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var l=Math.atan2(s,a),c=Math.sin((1-t)*l)/s,u=Math.sin(t*l)/s;return this._w=o*c+this._w*u,this._x=i*c+this._x*u,this._y=r*c+this._y*u,this._z=n*c+this._z*u,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},Object.assign(Quaternion,{slerp:function(e,t,i,r){return i.copy(e).slerp(t,r)},slerpFlat:function(e,t,i,r,n,o,a){var s=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=n[o+0],d=n[o+1],p=n[o+2],f=n[o+3];if(u!==f||s!==h||l!==d||c!==p){var m=1-a,g=s*h+l*d+c*p+u*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,g*v);m=Math.sin(m*x)/b,a=Math.sin(a*x)/b}var w=a*v;if(s=s*m+h*w,l=l*m+d*w,c=c*m+p*w,u=u*m+f*w,m===1-a){var _=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=_,l*=_,c*=_,u*=_}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Vector3.prototype={constructor:Vector3,isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function applyEuler(t){return!1===(t&&t.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new Quaternion),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e;return function applyAxisAngle(t,i){return void 0===e&&(e=new Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,i))}}(),applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12],this.y=n[1]*t+n[5]*i+n[9]*r+n[13],this.z=n[2]*t+n[6]*i+n[10]*r+n[14],this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*i,c=s*i+a*t-n*r,u=s*r+n*i-o*t,h=-n*t-o*i-a*r;return this.x=l*s+h*-n+c*-a-u*-o,this.y=c*s+h*-o+u*-n-l*-a,this.z=u*s+h*-a+l*-o-c*-n,this},project:function(){var e;return function project(t){return void 0===e&&(e=new Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function unproject(t){return void 0===e&&(e=new Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e,t;return function clampScalar(i,r){return void 0===e&&(e=new Vector3,t=new Vector3),e.set(i,i,i),t.set(r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e;return function projectOnPlane(t){return void 0===e&&(e=new Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function reflect(t){return void 0===e&&(e=new Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(ut.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromMatrixPosition:function(e){return this.setFromMatrixColumn(e,3)},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){if("number"==typeof e){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var i=e;e=t,t=i}return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},Matrix4.prototype={constructor:Matrix4,isMatrix4:!0,set:function(e,t,i,r,n,o,a,s,l,c,u,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e;return function extractRotation(t){void 0===e&&(e=new Vector3);var i=this.elements,r=t.elements,n=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),a=1/e.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,this}}(),makeRotationFromEuler:function(e){!1===(e&&e.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(r),l=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if("XYZ"===e.order){var h=o*c,d=o*u,p=a*c,f=a*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=p+d*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m-y*a,t[4]=-o*u,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*c,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*c,d=o*u,p=a*c,f=a*u;t[0]=s*c,t[4]=p*l-d,t[8]=h*l+f,t[1]=s*u,t[5]=f*l+h,t[9]=d*l-p,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,x=o*l,w=a*s,_=a*l;t[0]=s*c,t[4]=_-b*u,t[8]=w*u+x,t[1]=u,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=x*u+w,t[10]=b-_*u}else if("XZY"===e.order){b=o*s,x=o*l,w=a*s,_=a*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=b*u+_,t[5]=o*c,t[9]=x*u-w,t[2]=w*u-x,t[6]=a*c,t[10]=_*u+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=e.w,a=i+i,s=r+r,l=n+n,c=i*a,u=i*s,h=i*l,d=r*s,p=r*l,f=n*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(d+f),t[4]=u-v,t[8]=h+g,t[1]=u+v,t[5]=1-(c+f),t[9]=p-m,t[2]=h-g,t[6]=p+m,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e,t,i;return function lookAt(r,n,o){void 0===e&&(e=new Vector3,t=new Vector3,i=new Vector3);var a=this.elements;return i.subVectors(r,n).normalize(),0===i.lengthSq()&&(i.z=1),e.crossVectors(o,i).normalize(),0===e.lengthSq()&&(i.z+=1e-4,e.crossVectors(o,i).normalize()),t.crossVectors(i,e),a[0]=e.x,a[4]=t.x,a[8]=i.x,a[1]=e.y,a[5]=t.y,a[9]=i.y,a[2]=e.z,a[6]=t.z,a[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],x=i[15],w=r[0],_=r[4],E=r[8],M=r[12],A=r[1],T=r[5],S=r[9],P=r[13],C=r[2],R=r[6],L=r[10],B=r[14],D=r[3],I=r[7],O=r[11],N=r[15];return n[0]=o*w+a*A+s*C+l*D,n[4]=o*_+a*T+s*R+l*I,n[8]=o*E+a*S+s*L+l*O,n[12]=o*M+a*P+s*B+l*N,n[1]=c*w+u*A+h*C+d*D,n[5]=c*_+u*T+h*R+d*I,n[9]=c*E+u*S+h*L+d*O,n[13]=c*M+u*P+h*B+d*N,n[2]=p*w+f*A+m*C+g*D,n[6]=p*_+f*T+m*R+g*I,n[10]=p*E+f*S+m*L+g*O,n[14]=p*M+f*P+m*B+g*N,n[3]=v*w+y*A+b*C+x*D,n[7]=v*_+y*T+b*R+x*I,n[11]=v*E+y*S+b*L+x*O,n[15]=v*M+y*P+b*B+x*N,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToVector3Array:function(){var e;return function applyToVector3Array(t,i,r){void 0===e&&(e=new Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length);for(var n=0,o=i;n<r;n+=3,o+=3)e.fromArray(t,o),e.applyMatrix4(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function applyToBuffer(t,i,r){void 0===e&&(e=new Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length/t.itemSize);for(var n=0,o=i;n<r;n++,o++)e.x=t.getX(o),e.y=t.getY(o),e.z=t.getZ(o),e.applyMatrix4(this),t.setXYZ(o,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+n*s*u-r*l*u-n*a*h+i*l*h+r*a*d-i*s*d)+e[7]*(+t*s*d-t*l*h+n*o*h-r*o*d+r*l*c-n*s*c)+e[11]*(+t*l*u-t*a*d-n*o*u+i*o*d+n*a*c-i*l*c)+e[15]*(-r*a*c-t*s*u+t*a*h+r*o*u-i*o*h+i*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],x=p*y*h-v*f*h+v*u*m-c*y*m-p*u*b+c*f*b,w=g*f*h-d*y*h-g*u*m+l*y*m+d*u*b-l*f*b,_=d*v*h-g*p*h+g*c*m-l*v*m-d*c*b+l*p*b,E=g*p*u-d*v*u-g*c*f+l*v*f+d*c*y-l*p*y,M=n*x+o*w+a*_+s*E;if(0===M){var A="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(!0===t)throw new Error(A);return console.warn(A),this.identity()}var T=1/M;return i[0]=x*T,i[1]=(v*f*s-p*y*s-v*a*m+o*y*m+p*a*b-o*f*b)*T,i[2]=(c*y*s-v*u*s+v*a*h-o*y*h-c*a*b+o*u*b)*T,i[3]=(p*u*s-c*f*s-p*a*h+o*f*h+c*a*m-o*u*m)*T,i[4]=w*T,i[5]=(d*y*s-g*f*s+g*a*m-n*y*m-d*a*b+n*f*b)*T,i[6]=(g*u*s-l*y*s-g*a*h+n*y*h+l*a*b-n*u*b)*T,i[7]=(l*f*s-d*u*s+d*a*h-n*f*h-l*a*m+n*u*m)*T,i[8]=_*T,i[9]=(g*p*s-d*v*s-g*o*m+n*v*m+d*o*b-n*p*b)*T,i[10]=(l*v*s-g*c*s+g*o*h-n*v*h-l*o*b+n*c*b)*T,i[11]=(d*c*s-l*p*s-d*o*h+n*p*h+l*o*m-n*c*m)*T,i[12]=E*T,i[13]=(d*v*a-g*p*a+g*o*f-n*v*f-d*o*y+n*p*y)*T,i[14]=(g*c*a-l*v*a-g*o*u+n*v*u+l*o*y-n*c*y)*T,i[15]=(l*p*a-d*c*a+d*o*u-n*p*u-l*o*f+n*c*f)*T,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,l=n*o,c=n*a;return this.set(l*o+i,l*a-r*s,l*s+r*a,0,l*a+r*s,c*a+i,c*s-r*o,0,l*s-r*a,c*s+r*o,n*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e,t;return function decompose(i,r,n){void 0===e&&(e=new Vector3,t=new Matrix4);var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var c=1/a,u=1/s,h=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,r.setFromRotationMatrix(t),n.x=a,n.y=s,n.z=l,this}}(),makeFrustum:function(e,t,i,r,n,o){var a=this.elements,s=2*n/(t-e),l=2*n/(r-i),c=(t+e)/(t-e),u=(r+i)/(r-i),h=-(o+n)/(o-n),d=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,i,r){var n=i*Math.tan(ut.DEG2RAD*e*.5),o=-n,a=o*t,s=n*t;return this.makeFrustum(a,s,o,n,i,r)},makeOrthographic:function(e,t,i,r,n,o){var a=this.elements,s=1/(t-e),l=1/(i-r),c=1/(o-n),u=(t+e)*s,h=(i+r)*l,d=(o+n)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},(CubeTexture.prototype=Object.create(Texture.prototype)).constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var dt=new Texture,pt=new CubeTexture,ft=[],mt=[];StructuredUniform.prototype.setValue=function(e,t){for(var i=this.seq,r=0,n=i.length;r!==n;++r){var o=i[r];o.setValue(e,t[o.id])}};var gt=/([\w\d_]+)(\])?(\[|\.)?/g;WebGLUniforms.prototype.setValue=function(e,t,i){var r=this.map[t];void 0!==r&&r.setValue(e,i,this.renderer)},WebGLUniforms.prototype.set=function(e,t,i){var r=this.map[i];void 0!==r&&r.setValue(e,t[i],this.renderer)},WebGLUniforms.prototype.setOptional=function(e,t,i){var r=t[i];void 0!==r&&this.setValue(e,i,r)},WebGLUniforms.upload=function(e,t,i,r){for(var n=0,o=t.length;n!==o;++n){var a=t[n],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}},WebGLUniforms.seqWithValue=function(e,t){for(var i=[],r=0,n=e.length;r!==n;++r){var o=e[r];o.id in t&&i.push(o)}return i};var vt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#include <normal_flip>\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#include <normal_flip>\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n    }\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = material.specularRoughness;\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n    }\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",normal_frag:"uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n",normal_vert:"varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};Color.prototype={constructor:Color,isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function hue2rgb(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function setHSL(e,t,i){if(e=ut.euclideanModulo(e,1),t=ut.clamp(t,0,1),i=ut.clamp(i,0,1),0===t)this.r=this.g=this.b=i;else{var r=i<=.5?i*(1+t):i+t-i*t,n=2*i-r;this.r=hue2rgb(n,r,e+1/3),this.g=hue2rgb(n,r,e),this.b=hue2rgb(n,r,e-1/3)}return this}}(),setStyle:function(e){function handleAlpha(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var t;if(t=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,r=t[1],n=t[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,handleAlpha(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,handleAlpha(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){var o=parseFloat(i[1])/360,a=parseInt(i[2],10)/100,s=parseInt(i[3],10)/100;return handleAlpha(i[5]),this.setHSL(o,a,s)}}}else if(t=/^\#([A-Fa-f0-9]+)$/.exec(e)){var l=(c=t[1]).length;if(3===l)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(e&&e.length>0){var c;void 0!==(c=yt[e])?this.setHex(c):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,i,r=e||{h:0,s:0,l:0},n=this.r,o=this.g,a=this.b,s=Math.max(n,o,a),l=Math.min(n,o,a),c=(l+s)/2;if(l===s)t=0,i=0;else{var u=s-l;switch(i=c<=.5?u/(s+l):u/(2-s-l),s){case n:t=(o-a)/u+(o<a?6:0);break;case o:t=(a-n)/u+2;break;case a:t=(n-o)/u+4}t/=6}return r.h=t,r.s=i,r.l=c,r},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=i,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}};var yt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};(DataTexture.prototype=Object.create(Texture.prototype)).constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;var bt={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new Vector4(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new Vector4(0,0,1,1)}}},xt={basic:{uniforms:Object.assign({},bt.common,bt.aomap,bt.lightmap,bt.fog),vertexShader:vt.meshbasic_vert,fragmentShader:vt.meshbasic_frag},lambert:{uniforms:Object.assign({},bt.common,bt.aomap,bt.lightmap,bt.emissivemap,bt.fog,bt.lights,{emissive:{value:new Color(0)}}),vertexShader:vt.meshlambert_vert,fragmentShader:vt.meshlambert_frag},phong:{uniforms:Object.assign({},bt.common,bt.aomap,bt.lightmap,bt.emissivemap,bt.bumpmap,bt.normalmap,bt.displacementmap,bt.gradientmap,bt.fog,bt.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}),vertexShader:vt.meshphong_vert,fragmentShader:vt.meshphong_frag},standard:{uniforms:Object.assign({},bt.common,bt.aomap,bt.lightmap,bt.emissivemap,bt.bumpmap,bt.normalmap,bt.displacementmap,bt.roughnessmap,bt.metalnessmap,bt.fog,bt.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}),vertexShader:vt.meshphysical_vert,fragmentShader:vt.meshphysical_frag},points:{uniforms:Object.assign({},bt.points,bt.fog),vertexShader:vt.points_vert,fragmentShader:vt.points_frag},dashed:{uniforms:Object.assign({},bt.common,bt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}),vertexShader:vt.linedashed_vert,fragmentShader:vt.linedashed_frag},depth:{uniforms:Object.assign({},bt.common,bt.displacementmap),vertexShader:vt.depth_vert,fragmentShader:vt.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:vt.normal_vert,fragmentShader:vt.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:vt.cube_vert,fragmentShader:vt.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:vt.equirect_vert,fragmentShader:vt.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new Vector3}},vertexShader:vt.distanceRGBA_vert,fragmentShader:vt.distanceRGBA_frag}};xt.physical={uniforms:Object.assign({},xt.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}),vertexShader:vt.meshphysical_vert,fragmentShader:vt.meshphysical_frag},Box2.prototype={constructor:Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector2;return function setFromCenterAndSize(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){var t=e||new Vector2;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new Vector2;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector2;return function distanceToPoint(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};var wt=0;Material.prototype={constructor:Material,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){var r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]="overdraw"===t?Number(i):i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){function extractFromCache(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}var t=void 0===e;t&&(e={textures:{},images:{}});var i={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==y&&(i.blending=this.blending),this.shading!==d&&(i.shading=this.shading),this.side!==l&&(i.side=this.side),this.vertexColors!==p&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),i.skinning=this.skinning,i.morphTargets=this.morphTargets,t){var r=extractFromCache(e.textures),n=extractFromCache(e.images);r.length>0&&(i.textures=r),n.length>0&&(i.images=n)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.shading=e.shading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(Material.prototype,EventDispatcher.prototype),(ShaderMaterial.prototype=Object.create(Material.prototype)).constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Object.assign({},e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},ShaderMaterial.prototype.toJSON=function(e){var t=Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},(MeshDepthMaterial.prototype=Object.create(Material.prototype)).constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Box3.prototype={constructor:Box3,isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>o&&(o=u),h>a&&(a=h)}this.min.set(t,i,r),this.max.set(n,o,a)},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector3;return function setFromCenterAndSize(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(){var e=new Vector3;return function setFromObject(t){var i=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var r=t.geometry;if(void 0!==r)if(r.isGeometry)for(var n=r.vertices,o=0,a=n.length;o<a;o++)e.copy(n[o]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e);else if(r.isBufferGeometry){var s=r.attributes.position;if(void 0!==s){var l,c,u;s.isInterleavedBufferAttribute?(l=s.data.array,c=s.offset,u=s.data.stride):(l=s.array,c=0,u=3);for(o=c,a=l.length;o<a;o+=u)e.fromArray(l,o),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e)}}}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){var t=e||new Vector3;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new Vector3;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e;return function intersectsSphere(t){return void 0===e&&(e=new Vector3),this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant},clampPoint:function(e,t){return(t||new Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector3;return function distanceToPoint(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Vector3;return function getBoundingSphere(t){var i=t||new Sphere;return this.getCenter(i.center),i.radius=.5*this.getSize(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3];return function applyMatrix4(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Sphere.prototype={constructor:Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new Box3;return function setFromPoints(t,i){var r=this.center;void 0!==i?r.copy(i):e.setFromPoints(t).getCenter(r);for(var n=0,o=0,a=t.length;o<a;o++)n=Math.max(n,r.distanceToSquared(t[o]));return this.radius=Math.sqrt(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(this.center.dot(e.normal)-e.constant)<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new Vector3;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},Matrix3.prototype={constructor:Matrix3,isMatrix3:!0,set:function(e,t,i,r,n,o,a,s,l){var c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=n,c[5]=s,c[6]=i,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToVector3Array:function(){var e;return function applyToVector3Array(t,i,r){void 0===e&&(e=new Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length);for(var n=0,o=i;n<r;n+=3,o+=3)e.fromArray(t,o),e.applyMatrix3(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function applyToBuffer(t,i,r){void 0===e&&(e=new Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length/t.itemSize);for(var n=0,o=i;n<r;n++,o++)e.x=t.getX(o),e.y=t.getY(o),e.z=t.getZ(o),e.applyMatrix3(this),t.setXYZ(o,e.x,e.y,e.z);return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-i*n*c+i*a*s+r*n*l-r*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var i=e.elements,r=this.elements,n=i[0],o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=d*l-c*h,f=c*u-d*s,m=h*s-l*u,g=n*p+o*f+a*m;if(0===g){var v="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return r[0]=p*y,r[1]=(a*h-d*o)*y,r[2]=(c*o-a*l)*y,r[3]=f*y,r[4]=(d*n-a*u)*y,r[5]=(a*s-c*n)*y,r[6]=m*y,r[7]=(o*u-h*n)*y,r[8]=(l*n-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}},Plane.prototype={constructor:Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Vector3,t=new Vector3;return function setFromCoplanarPoints(i,r,n){var o=e.subVectors(n,r).cross(t.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);return(t||new Vector3).copy(this.normal).multiplyScalar(i)},intersectLine:function(){var e=new Vector3;return function intersectLine(t,i){var r=i||new Vector3,n=t.delta(e),o=this.normal.dot(n);if(0!==o){var a=-(t.start.dot(this.normal)+this.constant)/o;if(!(a<0||a>1))return r.copy(n).multiplyScalar(a).add(t.start)}else if(0===this.distanceToPoint(t.start))return r.copy(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return(e||new Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Vector3,t=new Matrix3;return function applyMatrix4(i,r){var n=this.coplanarPoint(e).applyMatrix4(i),o=r||t.getNormalMatrix(i),a=this.normal.applyMatrix3(o).normalize();return this.constant=-n.dot(a),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},Frustum.prototype={constructor:Frustum,set:function(e,t,i,r,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(a-r,u-s,f-h,y-m).normalize(),t[1].setComponents(a+r,u+s,f+h,y+m).normalize(),t[2].setComponents(a+n,u+l,f+d,y+g).normalize(),t[3].setComponents(a-n,u-l,f-d,y-g).normalize(),t[4].setComponents(a-o,u-c,f-p,y-v).normalize(),t[5].setComponents(a+o,u+c,f+p,y+v).normalize(),this},intersectsObject:function(){var e=new Sphere;return function intersectsObject(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new Sphere;return function intersectsSprite(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0},intersectsBox:function(){var e=new Vector3,t=new Vector3;return function intersectsBox(i){for(var r=this.planes,n=0;n<6;n++){var o=r[n];e.x=o.normal.x>0?i.min.x:i.max.x,t.x=o.normal.x>0?i.max.x:i.min.x,e.y=o.normal.y>0?i.min.y:i.max.y,t.y=o.normal.y>0?i.max.y:i.min.y,e.z=o.normal.z>0?i.min.z:i.max.z,t.z=o.normal.z>0?i.max.z:i.min.z;var a=o.distanceToPoint(e),s=o.distanceToPoint(t);if(a<0&&s<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}},Ray.prototype={constructor:Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Vector3;return function recast(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new Vector3;i.subVectors(e,this.origin);var r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Vector3;return function distanceSqToPoint(t){var i=e.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new Vector3,t=new Vector3,i=new Vector3;return function distanceSqToSegment(r,n,o,a){e.copy(r).add(n).multiplyScalar(.5),t.copy(n).sub(r).normalize(),i.copy(this.origin).sub(e);var s,l,c,u,h=.5*r.distanceTo(n),d=-this.direction.dot(t),p=i.dot(this.direction),f=-i.dot(t),m=i.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(s=d*f-p,l=d*p-f,u=h*g,s>=0)if(l>=-u)if(l<=u){var v=1/g;c=(s*=v)*(s+d*(l*=v)+2*p)+l*(d*s+l+2*f)+m}else l=h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else l=-h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;else l<=-u?c=-(s=Math.max(0,-(-d*h+p)))*s+(l=s>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(s=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(s=Math.max(0,-(d*h+p)))*s+(l=s>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else l=d>0?-h:h,c=-(s=Math.max(0,-(d*l+p)))*s+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(t).multiplyScalar(l).add(e),c}}(),intersectSphere:function(){var e=new Vector3;return function intersectSphere(t,i){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),n=e.dot(e)-r*r,o=t.radius*t.radius;if(n>o)return null;var a=Math.sqrt(o-n),s=r-a,l=r+a;return s<0&&l<0?null:s<0?this.at(l,i):this.at(s,i)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var i,r,n,o,a,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(n=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),i>o||n>r?null:((n>i||i!=i)&&(i=n),(o<r||r!=r)&&(r=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),i>s||a>r?null:((a>i||i!=i)&&(i=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(i>=0?i:r,t)))},intersectsBox:function(){var e=new Vector3;return function intersectsBox(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new Vector3,t=new Vector3,i=new Vector3,r=new Vector3;return function intersectTriangle(n,o,a,s,l){t.subVectors(o,n),i.subVectors(a,n),r.crossVectors(t,i);var c,u=this.direction.dot(r);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,n);var h=c*this.direction.dot(i.crossVectors(e,i));if(h<0)return null;var d=c*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>u)return null;var p=-c*e.dot(r);return p<0?null:this.at(p/u,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Euler.prototype={constructor:Euler,isEuler:!0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var r=ut.clamp,n=e.elements,o=n[0],a=n[4],s=n[8],l=n[1],c=n[5],u=n[9],h=n[2],d=n[6],p=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function setFromQuaternion(t,i,r){return void 0===e&&(e=new Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,r)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new Quaternion;return function reorder(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},Layers.prototype={constructor:Layers,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)},test:function(e){return 0!=(this.mask&e.mask)}};var _t=0;Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object.assign(Object3D.prototype,EventDispatcher.prototype,{isObject3D:!0,applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new Quaternion;return function rotateOnAxis(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new Vector3(1,0,0);return function rotateX(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Vector3(0,1,0);return function rotateY(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Vector3(0,0,1);return function rotateZ(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new Vector3;return function translateOnAxis(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new Vector3(1,0,0);return function translateX(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Vector3(0,1,0);return function translateY(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Vector3(0,0,1);return function translateZ(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new Matrix4;return function worldToLocal(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new Matrix4;return function lookAt(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var i=this.children.indexOf(e);-1!==i&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(i,1))},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){var t=e||new Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new Vector3,t=new Vector3;return function getWorldQuaternion(i){var r=i||new Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldRotation:function(){var e=new Quaternion;return function getWorldRotation(t){var i=t||new Euler;return this.getWorldQuaternion(e),i.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new Vector3,t=new Quaternion;return function getWorldScale(i){var r=i||new Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new Quaternion;return function getWorldDirection(t){var i=t||new Vector3;return this.getWorldQuaternion(e),i.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},toJSON:function(e){function extractFromCache(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}var t=void 0===e||""===e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{}},i.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var r={};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),r.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===e.geometries[this.geometry.uuid]&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),r.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===e.materials[this.material.uuid]&&(e.materials[this.material.uuid]=this.material.toJSON(e)),r.material=this.material.uuid),this.children.length>0){r.children=[];for(var n=0;n<this.children.length;n++)r.children.push(this.children[n].toJSON(e).object)}if(t){var o=extractFromCache(e.geometries),a=extractFromCache(e.materials),s=extractFromCache(e.textures),l=extractFromCache(e.images);o.length>0&&(i.geometries=o),a.length>0&&(i.materials=a),s.length>0&&(i.textures=s),l.length>0&&(i.images=l)}return i.object=r,i},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var r=e.children[i];this.add(r.clone())}return this}}),Line3.prototype={constructor:Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return(e||new Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new Vector3,t=new Vector3;return function closestPointToPointParameter(i,r){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var n=t.dot(t),o=t.dot(e)/n;return r&&(o=ut.clamp(o,0,1)),o}}(),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t),n=i||new Vector3;return this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},Triangle.normal=function(){var e=new Vector3;return function normal(t,i,r,n){var o=n||new Vector3;o.subVectors(r,i),e.subVectors(t,i),o.cross(e);var a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}}(),Triangle.barycoordFromPoint=function(){var e=new Vector3,t=new Vector3,i=new Vector3;return function barycoordFromPoint(r,n,o,a,s){e.subVectors(a,n),t.subVectors(o,n),i.subVectors(r,n);var l=e.dot(e),c=e.dot(t),u=e.dot(i),h=t.dot(t),d=t.dot(i),p=l*h-c*c,f=s||new Vector3;if(0===p)return f.set(-2,-1,-1);var m=1/p,g=(h*u-c*d)*m,v=(l*d-c*u)*m;return f.set(1-g-v,v,g)}}(),Triangle.containsPoint=function(){var e=new Vector3;return function containsPoint(t,i,r,n){var o=Triangle.barycoordFromPoint(t,i,r,n,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),Triangle.prototype={constructor:Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new Vector3,t=new Vector3;return function area(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Triangle.containsPoint(e,this.a,this.b,this.c)},closestPointToPoint:function(){var e,t,i,r;return function closestPointToPoint(n,o){void 0===e&&(e=new Plane,t=[new Line3,new Line3,new Line3],i=new Vector3,r=new Vector3);var a=o||new Vector3,s=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(n,i),!0===this.containsPoint(i))a.copy(i);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var l=0;l<t.length;l++){t[l].closestPointToPoint(i,!0,r);var c=i.distanceToSquared(r);c<s&&(s=c,a.copy(r))}}return a}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Face3.prototype={constructor:Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},(MeshBasicMaterial.prototype=Object.create(Material.prototype)).constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},BufferAttribute.prototype={constructor:BufferAttribute,isBufferAttribute:!0,set needsUpdate(e){!0===e&&this.version++},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.itemSize:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new Color),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyIndicesArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];t[i++]=o.a,t[i++]=o.b,t[i++]=o.c}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new Vector2),t[i++]=o.x,t[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new Vector3),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Vector4),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return(new this.constructor).copy(this)}},(Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Int8BufferAttribute,(Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint8BufferAttribute,(Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint8ClampedBufferAttribute,(Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Int16BufferAttribute,(Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint16BufferAttribute,(Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Int32BufferAttribute,(Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint32BufferAttribute,(Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Float32BufferAttribute,(Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function(e){for(var t,i,r=[],n=e.faces,o=0;o<n.length;o++){var a=n[o];a.materialIndex!==i&&(i=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,r.push(t)),t={start:3*o,materialIndex:i})}void 0!==t&&(t.count=3*o-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,i=e.faces,r=e.vertices,n=e.faceVertexUvs,o=n[0]&&n[0].length>0,a=n[1]&&n[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]=[];this.morphTargets.position=t}var u,h=e.morphNormals,d=h.length;if(d>0){u=[];for(c=0;c<d;c++)u[c]=[];this.morphTargets.normal=u}var p=e.skinIndices,f=e.skinWeights,m=p.length===r.length,g=f.length===r.length;for(c=0;c<i.length;c++){var v=i[c];this.vertices.push(r[v.a],r[v.b],r[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=v.normal;this.normals.push(b,b,b)}var x=v.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===o){void 0!==(_=n[0][c])?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Vector2,new Vector2,new Vector2))}if(!0===a){var _;void 0!==(_=n[1][c])?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Vector2,new Vector2,new Vector2))}for(var E=0;E<l;E++){var M=s[E].vertices;t[E].push(M[v.a],M[v.b],M[v.c])}for(E=0;E<d;E++){var A=h[E].vertexNormals[c];u[E].push(A.a,A.b,A.c)}m&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}}),Object.assign(Geometry.prototype,EventDispatcher.prototype,{isGeometry:!0,applyMatrix:function(e){for(var t=(new Matrix3).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var o=0,a=n.vertexNormals.length;o<a;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e;return function rotateX(t){return void 0===e&&(e=new Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function rotateY(t){return void 0===e&&(e=new Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function rotateZ(t){return void 0===e&&(e=new Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function translate(t,i,r){return void 0===e&&(e=new Matrix4),e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e;return function scale(t,i,r){return void 0===e&&(e=new Matrix4),e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function lookAt(t){void 0===e&&(e=new Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function addFace(e,i,r,n){var d=new Face3(e,i,r,void 0!==o?[c[e].clone(),c[i].clone(),c[r].clone()]:[],void 0!==a?[t.colors[e].clone(),t.colors[i].clone(),t.colors[r].clone()]:[],n);t.faces.push(d),void 0!==s&&t.faceVertexUvs[0].push([u[e].clone(),u[i].clone(),u[r].clone()]),void 0!==l&&t.faceVertexUvs[1].push([h[e].clone(),h[i].clone(),h[r].clone()])}var t=this,i=null!==e.index?e.index.array:void 0,r=e.attributes,n=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=[],u=[],h=[],d=0,p=0;d<n.length;d+=3,p+=2)t.vertices.push(new Vector3(n[d],n[d+1],n[d+2])),void 0!==o&&c.push(new Vector3(o[d],o[d+1],o[d+2])),void 0!==a&&t.colors.push(new Color(a[d],a[d+1],a[d+2])),void 0!==s&&u.push(new Vector2(s[p],s[p+1])),void 0!==l&&h.push(new Vector2(l[p],l[p+1]));if(void 0!==i){var f=e.groups;if(f.length>0)for(d=0;d<f.length;d++)for(var m=f[d],g=m.start,v=(p=g,g+m.count);p<v;p+=3)addFace(i[p],i[p+1],i[p+2],m.materialIndex);else for(d=0;d<i.length;d+=3)addFace(i[d],i[d+1],i[d+2])}else for(d=0;d<n.length/3;d+=3)addFace(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new Matrix4;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new Vector3,t=new Vector3,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],o=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);var t,i,r,n,o,a;for(a=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)a[t]=new Vector3;if(e){var s,l,c,u=new Vector3,h=new Vector3;for(r=0,n=this.faces.length;r<n;r++)o=this.faces[r],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),a[o.a].add(u),a[o.b].add(u),a[o.c].add(u)}else for(this.computeFaceNormals(),r=0,n=this.faces.length;r<n;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)a[t].normalize();for(r=0,n=this.faces.length;r<n;r++){var d=(o=this.faces[r]).vertexNormals;3===d.length?(d[0].copy(a[o.a]),d[1].copy(a[o.b]),d[2].copy(a[o.c])):(d[0]=a[o.a].clone(),d[1]=a[o.b].clone(),d[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(i=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for((n=this.faces[i]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)c=new Vector3,u={a:new Vector3,b:new Vector3,c:new Vector3},a.push(c),s.push(u)}var l=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals();var c,u;for(i=0,r=this.faces.length;i<r;i++)n=this.faces[i],c=l.faceNormals[i],u=l.vertexNormals[i],c.copy(n.normal),u.a.copy(n.vertexNormals[0]),u.b.copy(n.vertexNormals[1]),u.c.copy(n.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;i<r;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(!1!==(e&&e.isGeometry)){var r,n=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],h=this.colors,d=e.colors;void 0===i&&(i=0),void 0!==t&&(r=(new Matrix3).getNormalMatrix(t));for(var p=0,f=a.length;p<f;p++){var m=a[p].clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var g,v,y,b=l[p],x=b.vertexNormals,w=b.vertexColors;(g=new Face3(b.a+n,b.b+n,b.c+n)).normal.copy(b.normal),void 0!==r&&g.normal.applyMatrix3(r).normalize();for(var _=0,E=x.length;_<E;_++)v=x[_].clone(),void 0!==r&&v.applyMatrix3(r).normalize(),g.vertexNormals.push(v);g.color.copy(b.color);for(_=0,E=w.length;_<E;_++)y=w[_],g.vertexColors.push(y.clone());g.materialIndex=b.materialIndex+i,s.push(g)}for(p=0,f=u.length;p<f;p++){var M=u[p],A=[];if(void 0!==M){for(_=0,E=M.length;_<E;_++)A.push(M[_].clone());c.push(A)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){!1!==(e&&e.isMesh)?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,i,r,n,o,a,s,l={},c=[],u=[],h=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=i,c.push(this.vertices[i]),u[i]=c.length-1):u[i]=u[l[t]];var d=[];for(i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).a=u[n.a],n.b=u[n.b],n.c=u[n.c],o=[n.a,n.b,n.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){p,d.push(i);break}}for(i=d.length-1;i>=0;i--){var f=d[i];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort(function materialIndexSort(e,t){return e.materialIndex-t.materialIndex});var r,n,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),a&&a.length===t&&(n=[]);for(i=0;i<t;i++){var s=e[i]._id;r&&r.push(o[s]),n&&n.push(a[s])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){function setBit(e,t,i){return i?e|1<<t:e&~(1<<t)}function getNormalIndex(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function getColorIndex(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function getUvIndex(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/2,h.push(e.x,e.y),d[t])}var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var r=[],n=0;n<this.vertices.length;n++){var o=this.vertices[n];r.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],u={},h=[],d={};for(n=0;n<this.faces.length;n++){var p=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=p.normal.length()>0,g=p.vertexNormals.length>0,v=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,b=0;if(b=setBit(b,0,0),b=setBit(b,1,!0),b=setBit(b,2,!1),b=setBit(b,3,f),b=setBit(b,4,m),b=setBit(b,5,g),b=setBit(b,6,v),b=setBit(b,7,y),a.push(b),a.push(p.a,p.b,p.c),a.push(p.materialIndex),f){var x=this.faceVertexUvs[0][n];a.push(getUvIndex(x[0]),getUvIndex(x[1]),getUvIndex(x[2]))}if(m&&a.push(getNormalIndex(p.normal)),g){var w=p.vertexNormals;a.push(getNormalIndex(w[0]),getNormalIndex(w[1]),getNormalIndex(w[2]))}if(v&&a.push(getColorIndex(p.color)),y){var _=p.vertexColors;a.push(getColorIndex(_[0]),getColorIndex(_[1]),getColorIndex(_[2]))}}return e.data={},e.data.vertices=r,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function(){return(new Geometry).copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]],this.colors=[];for(var t=e.vertices,i=0,r=t.length;i<r;i++)this.vertices.push(t[i].clone());var n=e.colors;for(i=0,r=n.length;i<r;i++)this.colors.push(n[i].clone());var o=e.faces;for(i=0,r=o.length;i<r;i++)this.faces.push(o[i].clone());for(i=0,r=e.faceVertexUvs.length;i<r;i++){var a=e.faceVertexUvs[i];void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(var s=0,l=a.length;s<l;s++){for(var c=a[s],u=[],h=0,d=c.length;h<d;h++){var p=c[h];u.push(p.clone())}this.faceVertexUvs[i].push(u)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Et=0;Object.assign(BufferGeometry.prototype,EventDispatcher.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){return!1===(t&&t.isBufferAttribute)&&!1===(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new BufferAttribute(arguments[1],arguments[2]))):"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this)},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){(new Matrix3).getNormalMatrix(e).applyToVector3Array(i.array),i.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e;return function rotateX(t){return void 0===e&&(e=new Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function rotateY(t){return void 0===e&&(e=new Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function rotateZ(t){return void 0===e&&(e=new Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function translate(t,i,r){return void 0===e&&(e=new Matrix4),e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e;return function scale(t,i,r){return void 0===e&&(e=new Matrix4),e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function lookAt(t){void 0===e&&(e=new Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new Float32BufferAttribute(3*t.vertices.length,3),r=new Float32BufferAttribute(3*t.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new Float32BufferAttribute(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var i=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(i=void 0,t.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}var r;return!0===t.verticesNeedUpdate&&(void 0!==(r=this.attributes.position)&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(void 0!==(r=this.attributes.normal)&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(void 0!==(r=this.attributes.color)&&(r.copyColorsArray(t.colors),r.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(void 0!==(r=this.attributes.uv)&&(r.copyVector2sArray(t.uvs),r.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(void 0!==(r=this.attributes.lineDistance)&&(r.copyArray(t.lineDistances),r.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.addAttribute("normal",new BufferAttribute(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.addAttribute("color",new BufferAttribute(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new BufferAttribute(o,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var a=new(e.vertices.length>65535?Uint32Array:Uint16Array)(3*e.indices.length);this.setIndex(new BufferAttribute(a,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var s in e.morphTargets){for(var l=[],c=e.morphTargets[s],u=0,h=c.length;u<h;u++){var d=c[u],p=new Float32BufferAttribute(3*d.length,3);l.push(p.copyVector3sArray(d))}this.morphAttributes[s]=l}if(e.skinIndices.length>0){var f=new Float32BufferAttribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var m=new Float32BufferAttribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position.array;void 0!==e?this.boundingBox.setFromArray(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new Box3,t=new Vector3;return function computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var i=this.attributes.position;if(i){var r=i.array,n=this.boundingSphere.center;e.setFromArray(r),e.getCenter(n);for(var o=0,a=0,s=r.length;a<s;a+=3)t.fromArray(r,a),o=Math.max(o,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,i=this.groups;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new BufferAttribute(new Float32Array(r.length),3));else for(var n=t.normal.array,o=0,a=n.length;o<a;o++)n[o]=0;var s,l,c,u=t.normal.array,h=new Vector3,d=new Vector3,p=new Vector3,f=new Vector3,m=new Vector3;if(e){var g=e.array;0===i.length&&this.addGroup(0,g.length);for(var v=0,y=i.length;v<y;++v){var b=i[v],x=b.start;for(o=x,a=x+b.count;o<a;o+=3)s=3*g[o+0],l=3*g[o+1],c=3*g[o+2],h.fromArray(r,s),d.fromArray(r,l),p.fromArray(r,c),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[s]+=f.x,u[s+1]+=f.y,u[s+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z,u[c]+=f.x,u[c+1]+=f.y,u[c+2]+=f.z}}else for(o=0,a=r.length;o<a;o+=9)h.fromArray(r,o),d.fromArray(r,o+3),p.fromArray(r,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[o]=f.x,u[o+1]=f.y,u[o+2]=f.z,u[o+3]=f.x,u[o+4]=f.y,u[o+5]=f.z,u[o+6]=f.x,u[o+7]=f.y,u[o+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(!1!==(e&&e.isBufferGeometry)){void 0===t&&(t=0);var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var n=i[r].array,o=e.attributes[r],a=o.array,s=0,l=o.itemSize*t;s<a.length;s++,l++)n[l]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e,t,i,r,n=this.attributes.normal.array,o=0,a=n.length;o<a;o+=3)e=n[o],t=n[o+1],i=n[o+2],r=1/Math.sqrt(e*e+t*t+i*i),n[o]*=r,n[o+1]*=r,n[o+2]*=r},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new BufferGeometry,t=this.index.array,i=this.attributes;for(var r in i){for(var n=i[r],o=n.array,a=n.itemSize,s=new o.constructor(t.length*a),l=0,c=0,u=0,h=t.length;u<h;u++){l=t[u]*a;for(var d=0;d<a;d++)s[c++]=o[l++]}e.addAttribute(r,new BufferAttribute(s,a))}return e},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;if(null!==r){var n=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:n}}var o=this.attributes;for(var i in o){var a=o[i];n=Array.prototype.slice.call(a.array);e.data.attributes[i]={itemSize:a.itemSize,type:a.array.constructor.name,array:n,normalized:a.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new BufferGeometry).copy(this)},copy:function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var i=e.attributes;for(var r in i){var n=i[r];this.addAttribute(r,n.clone())}for(var o=e.groups,a=0,s=o.length;a<s;a++){var l=o[a];this.addGroup(l.start,l.count,l.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),BufferGeometry.MaxIndex=65535,Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Object3D.prototype.copy.call(this,e),this.drawMode=e.drawMode,this},updateMorphTargets:function(){var e=this.geometry.morphTargets;if(void 0!==e&&e.length>0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var t=0,i=e.length;t<i;t++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[e[t].name]=t}},raycast:function(){function uvIntersection(e,t,i,r,n,o,a){return Triangle.barycoordFromPoint(e,t,i,r,f),n.multiplyScalar(f.x),o.multiplyScalar(f.y),a.multiplyScalar(f.z),n.add(o).add(a),n.clone()}function checkIntersection(e,t,i,r,n,o,a){var s=e.material;if(null===(s.side===c?i.intersectTriangle(o,n,r,!0,a):i.intersectTriangle(r,n,o,s.side!==u,a)))return null;g.copy(a),g.applyMatrix4(e.matrixWorld);var l=t.ray.origin.distanceTo(g);return l<t.near||l>t.far?null:{distance:l,point:g.clone(),object:e}}function checkBufferGeometryIntersection(e,t,i,a,s,l,c,u){r.fromArray(a,3*l),n.fromArray(a,3*c),o.fromArray(a,3*u);var f=checkIntersection(e,t,i,r,n,o,m);return f&&(s&&(h.fromArray(s,2*l),d.fromArray(s,2*c),p.fromArray(s,2*u),f.uv=uvIntersection(m,r,n,o,h,d,p)),f.face=new Face3(l,c,u,Triangle.normal(r,n,o)),f.faceIndex=l),f}var e=new Matrix4,t=new Ray,i=new Sphere,r=new Vector3,n=new Vector3,o=new Vector3,a=new Vector3,s=new Vector3,l=new Vector3,h=new Vector2,d=new Vector2,p=new Vector2,f=new Vector3,m=new Vector3,g=new Vector3;return function raycast(c,u){var f=this.geometry,g=this.material,v=this.matrixWorld;if(void 0!==g&&(null===f.boundingSphere&&f.computeBoundingSphere(),i.copy(f.boundingSphere),i.applyMatrix4(v),!1!==c.ray.intersectsSphere(i)&&(e.getInverse(v),t.copy(c.ray).applyMatrix4(e),null===f.boundingBox||!1!==t.intersectsBox(f.boundingBox)))){var y,b;if(f.isBufferGeometry){var x,w,_,E=f.index,M=f.attributes,A=M.position.array;if(void 0!==M.uv&&(y=M.uv.array),null!==E)for(var T=E.array,S=0,P=T.length;S<P;S+=3)x=T[S],w=T[S+1],_=T[S+2],(b=checkBufferGeometryIntersection(this,c,t,A,y,x,w,_))&&(b.faceIndex=Math.floor(S/3),u.push(b));else for(S=0,P=A.length;S<P;S+=9)(b=checkBufferGeometryIntersection(this,c,t,A,y,x=S/3,w=x+1,_=x+2))&&(b.index=x,u.push(b))}else if(f.isGeometry){var C,R,L,B=g&&g.isMultiMaterial,D=!0===B?g.materials:null,I=f.vertices,O=f.faces,N=f.faceVertexUvs[0];N.length>0&&(y=N);for(var k=0,F=O.length;k<F;k++){var U=O[k],H=!0===B?D[U.materialIndex]:g;if(void 0!==H){if(C=I[U.a],R=I[U.b],L=I[U.c],!0===H.morphTargets){var z=f.morphTargets,G=this.morphTargetInfluences;r.set(0,0,0),n.set(0,0,0),o.set(0,0,0);for(var V=0,j=z.length;V<j;V++){var W=G[V];if(0!==W){var q=z[V].vertices;r.addScaledVector(a.subVectors(q[U.a],C),W),n.addScaledVector(s.subVectors(q[U.b],R),W),o.addScaledVector(l.subVectors(q[U.c],L),W)}}r.add(C),n.add(R),o.add(L),C=r,R=n,L=o}if(b=checkIntersection(this,c,t,C,R,L,m)){if(y){var X=y[k];h.copy(X[0]),d.copy(X[1]),p.copy(X[2]),b.uv=uvIntersection(m,C,R,L,h,d,p)}b.face=U,b.faceIndex=k,u.push(b)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(BoxBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=BoxBufferGeometry,(PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=PlaneBufferGeometry,(Camera.prototype=Object.create(Object3D.prototype)).constructor=Camera,Camera.prototype.isCamera=!0,Camera.prototype.getWorldDirection=function(){var e=new Quaternion;return function getWorldDirection(t){var i=t||new Vector3;return this.getWorldQuaternion(e),i.set(0,0,-1).applyQuaternion(e)}}(),Camera.prototype.lookAt=function(){var e=new Matrix4;return function lookAt(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),Camera.prototype.clone=function(){return(new this.constructor).copy(this)},Camera.prototype.copy=function(e){return Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(e){return Camera.prototype.copy.call(this,e),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*ut.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*ut.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*ut.RAD2DEG*Math.atan(Math.tan(.5*ut.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,n,o){this.aspect=e/t,this.view={fullWidth:e,fullHeight:t,offsetX:i,offsetY:r,width:n,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*ut.DEG2RAD*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,o=this.view;if(null!==o){var a=o.fullWidth,s=o.fullHeight;n+=o.offsetX*r/a,t-=o.offsetY*i/s,r*=o.width/a,i*=o.height/s}var l=this.filmOffset;0!==l&&(n+=e*l/this.getFilmWidth()),this.projectionMatrix.makeFrustum(n,n+r,t-i,t,e,this.far)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(e){return Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,r,n,o){this.view={fullWidth:e,fullHeight:t,offsetX:i,offsetY:r,width:n,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,o=i+e,a=r+t,s=r-t;if(null!==this.view){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(n+=u*(this.view.offsetX/l))+u*(this.view.width/l),s=(a-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(n,o,a,s,this.near,this.far)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}});var Mt=0;FogExp2.prototype.isFogExp2=!0,FogExp2.prototype.clone=function(){return new FogExp2(this.color.getHex(),this.density)},FogExp2.prototype.toJSON=function(e){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Fog.prototype.isFog=!0,Fog.prototype.clone=function(){return new Fog(this.color.getHex(),this.near,this.far)},Fog.prototype.toJSON=function(e){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},(Scene.prototype=Object.create(Object3D.prototype)).constructor=Scene,Scene.prototype.copy=function(e,t){return Object3D.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},Scene.prototype.toJSON=function(e){var t=Object3D.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},LensFlare.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LensFlare,isLensFlare:!0,copy:function(e){Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,i=e.lensFlares.length;t<i;t++)this.lensFlares.push(e.lensFlares[t]);return this},add:function(e,t,i,r,n,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===n&&(n=new Color(16777215)),void 0===r&&(r=y),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:n,blending:r})},updateLensFlares:function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<i;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)}}),(SpriteMaterial.prototype=Object.create(Material.prototype)).constructor=SpriteMaterial,SpriteMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(){var e=new Vector3;return function raycast(t,i){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.distanceSqToPoint(e);r>this.scale.x*this.scale.y/4||i.push({distance:Math.sqrt(r),point:this.position,face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,copy:function(e){Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,r=0;r<i.length&&!(t<i[r].distance);r++);i.splice(r,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object},raycast:function(){var e=new Vector3;return function raycast(t,i){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,i)}}(),update:function(){var e=new Vector3,t=new Vector3;return function update(i){var r=this.levels;if(r.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);r[0].object.visible=!0;for(var o=1,a=r.length;o<a&&n>=r[o].distance;o++)r[o-1].object.visible=!1,r[o].object.visible=!0;for(;o<a;o++)r[o].object.visible=!1}}}(),toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var i=this.levels,r=0,n=i.length;r<n;r++){var o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new Matrix4;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){for(var e,t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new Matrix4;return function update(){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(r,this.boneInverses[t]),e.toArray(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new Skeleton(this.bones,this.boneInverses,this.useVertexTexture)}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var e=0;e<this.geometry.skinWeights.length;e++){var t=this.geometry.skinWeights[e];(n=1/t.lengthManhattan())!==1/0?t.multiplyScalar(n):t.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var i=new Vector4,r=this.geometry.attributes.skinWeight;for(e=0;e<r.count;e++){i.x=r.getX(e),i.y=r.getY(e),i.z=r.getZ(e),i.w=r.getW(e);var n;(n=1/i.lengthManhattan())!==1/0?i.multiplyScalar(n):i.set(1,0,0,0),r.setXYZW(e,i.x,i.y,i.z,i.w)}}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture).copy(this)}}),(LineBasicMaterial.prototype=Object.create(Material.prototype)).constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,raycast:function(){var e=new Matrix4,t=new Ray,i=new Sphere;return function raycast(r,n){var o=r.linePrecision,a=o*o,s=this.geometry,l=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(l),!1!==r.ray.intersectsSphere(i)){e.getInverse(l),t.copy(r.ray).applyMatrix4(e);var c=new Vector3,u=new Vector3,h=new Vector3,d=new Vector3,p=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var f=s.index,m=s.attributes.position.array;if(null!==f)for(var g=f.array,v=0,y=g.length-1;v<y;v+=p){var b=g[v],x=g[v+1];c.fromArray(m,3*b),u.fromArray(m,3*x);if(!(t.distanceSqToSegment(c,u,d,h)>a)){d.applyMatrix4(this.matrixWorld);(E=r.ray.origin.distanceTo(d))<r.near||E>r.far||n.push({distance:E,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(v=0,y=m.length/3-1;v<y;v+=p){c.fromArray(m,3*v),u.fromArray(m,3*v+3);if(!(t.distanceSqToSegment(c,u,d,h)>a)){d.applyMatrix4(this.matrixWorld);(E=r.ray.origin.distanceTo(d))<r.near||E>r.far||n.push({distance:E,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}else if(s.isGeometry){var w=s.vertices,_=w.length;for(v=0;v<_-1;v+=p){if(!(t.distanceSqToSegment(w[v],w[v+1],d,h)>a)){d.applyMatrix4(this.matrixWorld);var E;(E=r.ray.origin.distanceTo(d))<r.near||E>r.far||n.push({distance:E,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0}),(PointsMaterial.prototype=Object.create(Material.prototype)).constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(){var e=new Matrix4,t=new Ray,i=new Sphere;return function raycast(r,n){function testPoint(e,i){var a=t.distanceSqToPoint(e);if(a<u){var l=t.closestPointToPoint(e);l.applyMatrix4(s);var c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;n.push({distance:c,distanceToRay:Math.sqrt(a),point:l.clone(),index:i,face:null,object:o})}}var o=this,a=this.geometry,s=this.matrixWorld,l=r.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(s),!1!==r.ray.intersectsSphere(i)){e.getInverse(s),t.copy(r.ray).applyMatrix4(e);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new Vector3;if(a.isBufferGeometry){var d=a.index,p=a.attributes.position.array;if(null!==d)for(var f=d.array,m=0,g=f.length;m<g;m++){var v=f[m];h.fromArray(p,3*v),testPoint(h,v)}else{m=0;for(var y=p.length/3;m<y;m++)h.fromArray(p,3*m),testPoint(h,m)}}else{var b=a.vertices;for(m=0,y=b.length;m<y;m++)testPoint(b[m],m)}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group}),(VideoTexture.prototype=Object.create(Texture.prototype)).constructor=VideoTexture,(CompressedTexture.prototype=Object.create(Texture.prototype)).constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,(CanvasTexture.prototype=Object.create(Texture.prototype)).constructor=CanvasTexture,(DepthTexture.prototype=Object.create(Texture.prototype)).constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0,(WireframeGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=WireframeGeometry,(ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=ParametricBufferGeometry,(ParametricGeometry.prototype=Object.create(Geometry.prototype)).constructor=ParametricGeometry,(PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=PolyhedronBufferGeometry,(TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=TetrahedronBufferGeometry,(TetrahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=TetrahedronGeometry,(OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=OctahedronBufferGeometry,(OctahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=OctahedronGeometry,(IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=IcosahedronBufferGeometry,(IcosahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=IcosahedronGeometry,(DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=DodecahedronBufferGeometry,(DodecahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=DodecahedronGeometry,(PolyhedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=PolyhedronGeometry,(TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=TubeBufferGeometry,(TubeGeometry.prototype=Object.create(Geometry.prototype)).constructor=TubeGeometry,(TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=TorusKnotBufferGeometry,(TorusKnotGeometry.prototype=Object.create(Geometry.prototype)).constructor=TorusKnotGeometry,(TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=TorusBufferGeometry,(TorusGeometry.prototype=Object.create(Geometry.prototype)).constructor=TorusGeometry;var At={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},triangulate:function(){function snip(e,t,i,r,n,o){var a,s,l,c,u,h,d,p,f;if(s=e[o[t]].x,l=e[o[t]].y,c=e[o[i]].x,u=e[o[i]].y,h=e[o[r]].x,d=e[o[r]].y,(c-s)*(d-l)-(u-l)*(h-s)<=0)return!1;var m,g,v,y,b,x,w,_,E,M,A,T,S,P,C;for(m=h-c,g=d-u,v=s-h,y=l-d,b=c-s,x=u-l,a=0;a<n;a++)if(p=e[o[a]].x,f=e[o[a]].y,!(p===s&&f===l||p===c&&f===u||p===h&&f===d)&&(w=p-s,_=f-l,E=p-c,M=f-u,A=p-h,T=f-d,C=m*M-g*E,S=b*_-x*w,P=v*T-y*A,C>=-Number.EPSILON&&P>=-Number.EPSILON&&S>=-Number.EPSILON))return!1;return!0}return function triangulate(e,t){var i=e.length;if(i<3)return null;var r,n,o,a=[],s=[],l=[];if(At.area(e)>0)for(n=0;n<i;n++)s[n]=n;else for(n=0;n<i;n++)s[n]=i-1-n;var c=i,u=2*c;for(n=c-1;c>2;){if(u--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),t?l:a;if(r=n,c<=r&&(r=0),n=r+1,c<=n&&(n=0),o=n+1,c<=o&&(o=0),snip(e,r,n,o,c,s)){var h,d,p,f,m;for(h=s[r],d=s[n],p=s[o],a.push([e[h],e[d],e[p]]),l.push([s[r],s[n],s[o]]),f=n,m=n+1;m<c;f++,m++)s[f]=s[m];u=2*--c}}return t?l:a}}(),triangulateShape:function(e,t){function removeDupEndPts(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function point_in_segment_2D_colin(e,t,i){return e.x!==t.x?e.x<t.x?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:e.y<t.y?e.y<=i.y&&i.y<=t.y:t.y<=i.y&&i.y<=e.y}function intersect_segments_2D(e,t,i,r,n){var o=t.x-e.x,a=t.y-e.y,s=r.x-i.x,l=r.y-i.y,c=e.x-i.x,u=e.y-i.y,h=a*s-o*l,d=a*c-o*u;if(Math.abs(h)>Number.EPSILON){var p;if(h>0){if(d<0||d>h)return[];if((p=l*c-s*u)<0||p>h)return[]}else{if(d>0||d<h)return[];if((p=l*c-s*u)>0||p<h)return[]}if(0===p)return!n||0!==d&&d!==h?[e]:[];if(p===h)return!n||0!==d&&d!==h?[t]:[];if(0===d)return[i];if(d===h)return[r];var f=p/h;return[{x:e.x+f*o,y:e.y+f*a}]}if(0!==d||l*c!=s*u)return[];var m=0===o&&0===a,g=0===s&&0===l;if(m&&g)return e.x!==i.x||e.y!==i.y?[]:[e];if(m)return point_in_segment_2D_colin(i,r,e)?[e]:[];if(g)return point_in_segment_2D_colin(e,t,i)?[i]:[];var v,y,b,x,w,_,E,M;return 0!==o?(e.x<t.x?(v=e,b=e.x,y=t,x=t.x):(v=t,b=t.x,y=e,x=e.x),i.x<r.x?(w=i,E=i.x,_=r,M=r.x):(w=r,E=r.x,_=i,M=i.x)):(e.y<t.y?(v=e,b=e.y,y=t,x=t.y):(v=t,b=t.y,y=e,x=e.y),i.y<r.y?(w=i,E=i.y,_=r,M=r.y):(w=r,E=r.y,_=i,M=i.y)),b<=E?x<E?[]:x===E?n?[]:[w]:x<=M?[w,y]:[w,_]:b>M?[]:b===M?n?[]:[v]:x<=M?[v,y]:[v,_]}function isPointInsideAngle(e,t,i,r){var n=t.x-e.x,o=t.y-e.y,a=i.x-e.x,s=i.y-e.y,l=r.x-e.x,c=r.y-e.y,u=n*s-o*a,h=n*c-o*l;if(Math.abs(u)>Number.EPSILON){var d=l*s-c*a;return u>0?h>=0&&d>=0:h>=0||d>=0}return h>0}removeDupEndPts(e),t.forEach(removeDupEndPts);for(var i,r,n,o,a,s,l={},c=e.concat(),u=0,h=t.length;u<h;u++)Array.prototype.push.apply(c,t[u]);for(i=0,r=c.length;i<r;i++)void 0!==l[a=c[i].x+":"+c[i].y]&&console.warn("THREE.ShapeUtils: Duplicate point",a,i),l[a]=i;var d=function removeHoles(e,t){function isCutLineInsideAngles(e,t){var r=p.length-1,n=e-1;n<0&&(n=r);var o=e+1;o>r&&(o=0);var a=isPointInsideAngle(p[e],p[n],p[o],i[t]);if(!a)return!1;var s=i.length-1,l=t-1;l<0&&(l=s);var c=t+1;return c>s&&(c=0),!!(a=isPointInsideAngle(i[t],i[l],i[c],p[e]))}function intersectsShapeEdge(e,t){var i,r;for(i=0;i<p.length;i++)if(r=i+1,r%=p.length,intersect_segments_2D(e,t,p[i],p[r],!0).length>0)return!0;return!1}function intersectsHoleEdge(e,i){var r,n,o,a;for(r=0;r<f.length;r++)for(n=t[f[r]],o=0;o<n.length;o++)if(a=o+1,a%=n.length,intersect_segments_2D(e,i,n[o],n[a],!0).length>0)return!0;return!1}for(var i,r,n,o,a,s,l,c,u,h,d,p=e.concat(),f=[],m=[],g=0,v=t.length;g<v;g++)f.push(g);for(var y=0,b=2*f.length;f.length>0;){if(--b<0){console.log("Infinite Loop! Holes left:"+f.length+", Probably Hole outside Shape!");break}for(n=y;n<p.length;n++){for(o=p[n],r=-1,g=0;g<f.length;g++)if(s=f[g],l=o.x+":"+o.y+":"+s,void 0===m[l]){i=t[s];for(var x=0;x<i.length;x++)if(a=i[x],isCutLineInsideAngles(n,x)&&!intersectsShapeEdge(o,a)&&!intersectsHoleEdge(o,a)){r=x,f.splice(g,1),c=p.slice(0,n+1),u=p.slice(n),h=i.slice(r),d=i.slice(0,r+1),p=c.concat(h).concat(d).concat(u),y=n;break}if(r>=0)break;m[l]=!0}if(r>=0)break}}return p}(e,t),p=At.triangulate(d,!1);for(i=0,r=p.length;i<r;i++)for(o=p[i],n=0;n<3;n++)void 0!==(s=l[a=o[n].x+":"+o[n].y])&&(o[n]=s);return p.concat()},isClockWise:function(e){return At.area(e)<0},b2:function(){return function b2(e,t,i,r){return function b2p0(e,t){var i=1-e;return i*i*t}(e,t)+function b2p1(e,t){return 2*(1-e)*e*t}(e,i)+function b2p2(e,t){return e*e*t}(e,r)}}(),b3:function(){return function b3(e,t,i,r,n){return function b3p0(e,t){var i=1-e;return i*i*i*t}(e,t)+function b3p1(e,t){var i=1-e;return 3*i*i*e*t}(e,i)+function b3p2(e,t){return 3*(1-e)*e*e*t}(e,r)+function b3p3(e,t){return e*e*e*t}(e,n)}}()};(ExtrudeGeometry.prototype=Object.create(Geometry.prototype)).constructor=ExtrudeGeometry,ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,r=0;r<i;r++){var n=e[r];this.addShape(n,t)}},ExtrudeGeometry.prototype.addShape=function(e,t){function scalePt2(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}function getBevelVec(e,t,i){var r,n,o=1,a=e.x-t.x,s=e.y-t.y,l=i.x-e.x,c=i.y-e.y,u=a*a+s*s,h=a*c-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(u),p=Math.sqrt(l*l+c*c),f=t.x-s/d,m=t.y+a/d,g=((i.x-c/p-f)*c-(i.y+l/p-m)*l)/(a*c-s*l),v=(r=f+a*g-e.x)*r+(n=m+s*g-e.y)*n;if(v<=2)return new Vector2(r,n);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(r=-s,n=a,o=Math.sqrt(u)):(r=a,n=s,o=Math.sqrt(u/2))}return new Vector2(r/o,n/o)}function sidewalls(e,t){var i,r;for(F=e.length;--F>=0;){i=F,(r=F-1)<0&&(r=e.length-1);var n=0,o=p+2*u;for(n=0;n<o;n++){var a=O*n,s=O*(n+1);!function f4(e,t,i,r,n,o,a,s,l){e+=_,t+=_,i+=_,r+=_,w.faces.push(new Face3(e,t,r,null,null,1)),w.faces.push(new Face3(t,i,r,null,null,1));var c=g.generateSideWallUV(w,e,t,i,r);w.faceVertexUvs[0].push([c[0],c[1],c[3]]),w.faceVertexUvs[0].push([c[1],c[2],c[3]])}(t+i+a,t+r+a,t+r+s,t+i+s)}}}function v(e,t,i){w.vertices.push(new Vector3(e,t,i))}function f3(e,t,i){e+=_,t+=_,i+=_,w.faces.push(new Face3(e,t,i,null,null,0));var r=g.generateTopUV(w,e,t,i);w.faceVertexUvs[0].push(r)}var i,r,n,o,a,s=void 0!==t.amount?t.amount:100,l=void 0!==t.bevelThickness?t.bevelThickness:6,c=void 0!==t.bevelSize?t.bevelSize:l-2,u=void 0!==t.bevelSegments?t.bevelSegments:3,h=void 0===t.bevelEnabled||t.bevelEnabled,d=void 0!==t.curveSegments?t.curveSegments:12,p=void 0!==t.steps?t.steps:1,f=t.extrudePath,m=!1,g=void 0!==t.UVGenerator?t.UVGenerator:ExtrudeGeometry.WorldUVGenerator;f&&(i=f.getSpacedPoints(p),m=!0,h=!1,r=void 0!==t.frames?t.frames:f.computeFrenetFrames(p,!1),n=new Vector3,o=new Vector3,a=new Vector3),h||(u=0,l=0,c=0);var y,b,x,w=this,_=this.vertices.length,E=e.extractPoints(d),M=E.shape,A=E.holes,T=!At.isClockWise(M);if(T){for(M=M.reverse(),b=0,x=A.length;b<x;b++)y=A[b],At.isClockWise(y)&&(A[b]=y.reverse());T=!1}var S=At.triangulateShape(M,A),P=M;for(b=0,x=A.length;b<x;b++)y=A[b],M=M.concat(y);for(var C,R,L,B,D,I,O=M.length,N=S.length,k=[],F=0,U=P.length,H=U-1,z=F+1;F<U;F++,H++,z++)H===U&&(H=0),z===U&&(z=0),k[F]=getBevelVec(P[F],P[H],P[z]);var G,V=[],j=k.concat();for(b=0,x=A.length;b<x;b++){for(y=A[b],G=[],F=0,H=(U=y.length)-1,z=F+1;F<U;F++,H++,z++)H===U&&(H=0),z===U&&(z=0),G[F]=getBevelVec(y[F],y[H],y[z]);V.push(G),j=j.concat(G)}for(C=0;C<u;C++){for(L=C/u,B=l*Math.cos(L*Math.PI/2),R=c*Math.sin(L*Math.PI/2),F=0,U=P.length;F<U;F++)v((D=scalePt2(P[F],k[F],R)).x,D.y,-B);for(b=0,x=A.length;b<x;b++)for(y=A[b],G=V[b],F=0,U=y.length;F<U;F++)v((D=scalePt2(y[F],G[F],R)).x,D.y,-B)}for(R=c,F=0;F<O;F++)D=h?scalePt2(M[F],j[F],R):M[F],m?(o.copy(r.normals[0]).multiplyScalar(D.x),n.copy(r.binormals[0]).multiplyScalar(D.y),a.copy(i[0]).add(o).add(n),v(a.x,a.y,a.z)):v(D.x,D.y,0);var W;for(W=1;W<=p;W++)for(F=0;F<O;F++)D=h?scalePt2(M[F],j[F],R):M[F],m?(o.copy(r.normals[W]).multiplyScalar(D.x),n.copy(r.binormals[W]).multiplyScalar(D.y),a.copy(i[W]).add(o).add(n),v(a.x,a.y,a.z)):v(D.x,D.y,s/p*W);for(C=u-1;C>=0;C--){for(L=C/u,B=l*Math.cos(L*Math.PI/2),R=c*Math.sin(L*Math.PI/2),F=0,U=P.length;F<U;F++)v((D=scalePt2(P[F],k[F],R)).x,D.y,s+B);for(b=0,x=A.length;b<x;b++)for(y=A[b],G=V[b],F=0,U=y.length;F<U;F++)D=scalePt2(y[F],G[F],R),m?v(D.x,D.y+i[p-1].y,i[p-1].x+B):v(D.x,D.y,s+B)}!function buildLidFaces(){if(h){var e=0,t=O*e;for(F=0;F<N;F++)f3((I=S[F])[2]+t,I[1]+t,I[0]+t);for(t=O*(e=p+2*u),F=0;F<N;F++)f3((I=S[F])[0]+t,I[1]+t,I[2]+t)}else{for(F=0;F<N;F++)f3((I=S[F])[2],I[1],I[0]);for(F=0;F<N;F++)f3((I=S[F])[0]+O*p,I[1]+O*p,I[2]+O*p)}}(),function buildSideFaces(){var e=0;for(sidewalls(P,e),e+=P.length,b=0,x=A.length;b<x;b++)sidewalls(y=A[b],e),e+=y.length}()},ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r){var n=e.vertices,o=n[t],a=n[i],s=n[r];return[new Vector2(o.x,o.y),new Vector2(a.x,a.y),new Vector2(s.x,s.y)]},generateSideWallUV:function(e,t,i,r,n){var o=e.vertices,a=o[t],s=o[i],l=o[r],c=o[n];return Math.abs(a.y-s.y)<.01?[new Vector2(a.x,1-a.z),new Vector2(s.x,1-s.z),new Vector2(l.x,1-l.z),new Vector2(c.x,1-c.z)]:[new Vector2(a.y,1-a.z),new Vector2(s.y,1-s.z),new Vector2(l.y,1-l.z),new Vector2(c.y,1-c.z)]}},(TextGeometry.prototype=Object.create(ExtrudeGeometry.prototype)).constructor=TextGeometry,(SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=SphereBufferGeometry,(SphereGeometry.prototype=Object.create(Geometry.prototype)).constructor=SphereGeometry,(RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=RingBufferGeometry,(RingGeometry.prototype=Object.create(Geometry.prototype)).constructor=RingGeometry,(PlaneGeometry.prototype=Object.create(Geometry.prototype)).constructor=PlaneGeometry,(LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=LatheBufferGeometry,(LatheGeometry.prototype=Object.create(Geometry.prototype)).constructor=LatheGeometry,(ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=ShapeBufferGeometry,(ShapeGeometry.prototype=Object.create(Geometry.prototype)).constructor=ShapeGeometry,(EdgesGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=EdgesGeometry,(CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=CylinderBufferGeometry,(CylinderGeometry.prototype=Object.create(Geometry.prototype)).constructor=CylinderGeometry,(ConeGeometry.prototype=Object.create(CylinderGeometry.prototype)).constructor=ConeGeometry,(ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype)).constructor=ConeBufferGeometry,(CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=CircleBufferGeometry,(CircleGeometry.prototype=Object.create(Geometry.prototype)).constructor=CircleGeometry,(BoxGeometry.prototype=Object.create(Geometry.prototype)).constructor=BoxGeometry;var Tt=Object.freeze({WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,SphereBufferGeometry:SphereBufferGeometry,SphereGeometry:SphereGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneBufferGeometry:PlaneBufferGeometry,PlaneGeometry:PlaneGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleBufferGeometry:CircleBufferGeometry,CircleGeometry:CircleGeometry,BoxBufferGeometry:BoxBufferGeometry,BoxGeometry:BoxGeometry});(ShadowMaterial.prototype=Object.create(ShaderMaterial.prototype)).constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,(RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype)).constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MultiMaterial.prototype={constructor:MultiMaterial,isMultiMaterial:!0,toJSON:function(e){for(var t={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},i=this.materials,r=0,n=i.length;r<n;r++){var o=i[r].toJSON(e);delete o.metadata,t.materials.push(o)}return t.visible=this.visible,t},clone:function(){for(var e=new this.constructor,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},(MeshStandardMaterial.prototype=Object.create(Material.prototype)).constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype)).constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},(MeshPhongMaterial.prototype=Object.create(Material.prototype)).constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(MeshToonMaterial.prototype=Object.create(MeshPhongMaterial.prototype)).constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(e){return MeshPhongMaterial.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},(MeshNormalMaterial.prototype=Object.create(Material.prototype)).constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},(MeshLambertMaterial.prototype=Object.create(Material.prototype)).constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(LineDashedMaterial.prototype=Object.create(Material.prototype)).constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var St=Object.freeze({ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MultiMaterial:MultiMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshBasicMaterial:MeshBasicMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),Pt={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Ct=new LoadingManager;Object.assign(FileLoader.prototype,{load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var n=this,o=Pt.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],c=a[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":u=new ArrayBuffer(c.length);for(var d=new Uint8Array(u),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);"blob"===h&&(u=new Blob([u],{type:s}));break;case"document":var f=new DOMParser;u=f.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}window.setTimeout(function(){t&&t(u),n.manager.itemEnd(e)},0)}catch(t){window.setTimeout(function(){r&&r(t),n.manager.itemError(e)},0)}}else{var m=new XMLHttpRequest;m.open("GET",e,!0),m.addEventListener("load",function(i){var o=i.target.response;Pt.add(e,o),200===this.status?(t&&t(o),n.manager.itemEnd(e)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),t&&t(o),n.manager.itemEnd(e)):(r&&r(i),n.manager.itemError(e))},!1),void 0!==i&&m.addEventListener("progress",function(e){i(e)},!1),m.addEventListener("error",function(t){r&&r(t),n.manager.itemError(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),m.send(null)}return n.manager.itemStart(e),m},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this}}),Object.assign(CompressedTextureLoader.prototype,{load:function(e,t,i,r){function loadTexture(c){s.load(e[c],function(e){var i=n._parser(e,!0);o[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(l+=1)&&(1===i.mipmapCount&&(a.minFilter=ve),a.format=i.format,a.needsUpdate=!0,t&&t(a))},i,r)}var n=this,o=[],a=new CompressedTexture;a.image=o;var s=new FileLoader(this.manager);if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var l=0,c=0,u=e.length;c<u;++c)loadTexture(c);else s.load(e,function(e){var i=n._parser(e,!0);if(i.isCubemap)for(var r=i.mipmaps.length/i.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)o[s].mipmaps.push(i.mipmaps[s*i.mipmapCount+l]),o[s].format=i.format,o[s].width=i.width,o[s].height=i.height}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=ve),a.format=i.format,a.needsUpdate=!0,t&&t(a)},i,r);return a},setPath:function(e){return this.path=e,this}});var Rt=BinaryTextureLoader;Object.assign(BinaryTextureLoader.prototype,{load:function(e,t,i,r){var n=this,o=new DataTexture,a=new FileLoader(this.manager);return a.setResponseType("arraybuffer"),a.load(e,function(e){var i=n._parser(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:he,o.wrapT=void 0!==i.wrapT?i.wrapT:he,o.magFilter=void 0!==i.magFilter?i.magFilter:ve,o.minFilter=void 0!==i.minFilter?i.minFilter:be,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=ve),o.needsUpdate=!0,t&&t(o,i))},i,r),o}}),Object.assign(ImageLoader.prototype,{load:function(e,t,i,r){var n=this,o=document.createElementNS("http://www.w3.org/1999/xhtml","img");if(o.onload=function(){o.onload=null,URL.revokeObjectURL(o.src),t&&t(o),n.manager.itemEnd(e)},o.onerror=r,0===e.indexOf("data:"))o.src=e;else if(void 0!==this.crossOrigin)o.crossOrigin=this.crossOrigin,o.src=e;else{var a=new FileLoader;a.setPath(this.path),a.setResponseType("blob"),a.setWithCredentials(this.withCredentials),a.load(e,function(e){o.src=URL.createObjectURL(e)},i,r)}return n.manager.itemStart(e),o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(CubeTextureLoader.prototype,{load:function(e,t,i,r){function loadTexture(i){o.load(e[i],function(e){n.images[i]=e,6===++a&&(n.needsUpdate=!0,t&&t(n))},void 0,r)}var n=new CubeTexture,o=new ImageLoader(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);for(var a=0,s=0;s<e.length;++s)loadTexture(s);return n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(TextureLoader.prototype,{load:function(e,t,i,r){var n=new Texture,o=new ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setWithCredentials(this.withCredentials),o.setPath(this.path),o.load(e,function(i){var r=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);n.format=r?Ie:Oe,n.image=i,n.needsUpdate=!0,void 0!==t&&t(n)},i,r),n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(LightShadow.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,update:function(e){var t=2*ut.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,r=e.distance||500,n=this.camera;t===n.fov&&i===n.aspect&&r===n.far||(n.fov=t,n.aspect=i,n.far=r,n.updateProjectionMatrix())}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0});var Lt={arraySlice:function(e,t,i){return Lt.isTypedArray(e)?new e.constructor(e.subarray(t,i)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=new Array(t),r=0;r!==t;++r)i[r]=r;return i.sort(function compareTime(t,i){return e[t]-e[i]}),i},sortedArray:function(e,t,i){for(var r=e.length,n=new e.constructor(r),o=0,a=0;a!==r;++o)for(var s=i[o]*t,l=0;l!==t;++l)n[a++]=e[s+l];return n},flattenJSON:function(e,t,i,r){for(var n=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[n++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(t.push(o.time),i.push.apply(i,a)),o=e[n++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(t.push(o.time),a.toArray(i,i.length)),o=e[n++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(t.push(o.time),i.push(a)),o=e[n++]}while(void 0!==o)}}};Interpolant.prototype={constructor:Interpolant,evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{var o;i:{r:if(!(e<r)){for(var a=i+2;;){if(void 0===r){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,n)}if(i===a)break;if(n=r,r=t[++i],e<r)break t}o=t.length;break i}if(e>=n)break e;var s=t[1];e<s&&(i=2,n=s);for(a=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===a)break;if(r=n,n=t[--i-1],e>=n)break t}o=i,i=0}for(;i<o;){var l=i+o>>>1;e<t[l]?o=l:i=l+1}if(r=t[i],void 0===(n=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r,o=0;o!==r;++o)t[o]=i[n+o];return t},interpolate_:function(e,t,i,r){throw new Error("call to abstract method")},intervalChanged_:function(e,t,i){}},Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:Qe,endingEnd:Qe},intervalChanged_:function(e,t,i){var r=this.parameterPositions,n=e-2,o=e+1,a=r[n],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:n=e,a=2*t-i;break;case 2402:a=t+r[n=r.length-2]-r[n+1];break;default:n=e,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*i-t;break;case 2402:o=1,s=i+r[1]-r[0];break;default:o=e-1,s=t}var l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-i),this._offsetPrev=n*c,this._offsetNext=o*c},interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f,x=0;x!==a;++x)n[x]=g*o[c+x]+v*o[l+x]+y*o[s+x]+b*o[u+x];return n}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(i-t)/(r-t),u=1-c,h=0;h!==a;++h)n[h]=o[l+h]*u+o[s+h]*c;return n}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e,t,i,r){return this.copySampleValue_(e-1)}});var Bt;Bt={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)this.createInterpolant=t;else{var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}console.warn(i)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,r=i.length,n=0,o=r-1;n!==r&&i[n]<e;)++n;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==n||o!==r){n>=o&&(o=Math.max(o,1),n=o-1);var a=this.getValueSize();this.times=Lt.arraySlice(i,n,o),this.values=Lt.arraySlice(this.values,n*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("invalid value size in track",this),e=!1);var i=this.times,r=this.values,n=i.length;0===n&&(console.error("track is empty",this),e=!1);for(var o=null,a=0;a!==n;a++){var s=i[a];if("number"==typeof s&&isNaN(s)){console.error("time is not a valid number",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("out of order keys",this,a,s,o),e=!1;break}o=s}if(void 0!==r&&Lt.isTypedArray(r)){a=0;for(var l=r.length;a!==l;++a){var c=r[a];if(isNaN(c)){console.error("value is not a valid number",this,a,c),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),r=2302===this.getInterpolation(),n=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(r)s=!0;else for(var c=a*i,u=c-i,h=c+i,d=0;d!==i;++d){var p=t[c+d];if(p!==t[u+d]||p!==t[h+d]){s=!0;break}}if(s){if(a!==n){e[n]=e[a];var f=a*i,m=n*i;for(d=0;d!==i;++d)t[m+d]=t[f+d]}++n}}if(o>0){e[n]=e[o];for(f=o*i,m=n*i,d=0;d!==i;++d)t[m+d]=t[f+d];++n}return n!==e.length&&(this.times=Lt.arraySlice(e,0,n),this.values=Lt.arraySlice(t,0,n*i)),this}},VectorKeyframeTrack.prototype=Object.assign(Object.create(Bt),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=(i-t)/(r-t),c=s+a;s!==c;s+=4)Quaternion.slerpFlat(n,0,o,s-a,o,s,l);return n}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(Bt),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),NumberKeyframeTrack.prototype=Object.assign(Object.create(Bt),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),StringKeyframeTrack.prototype=Object.assign(Object.create(Bt),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(Bt),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(Bt),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),KeyframeTrack.prototype=Bt,Bt.constructor=KeyframeTrack,Object.assign(KeyframeTrack,{parse:function(e){if(void 0===e.type)throw new Error("track type undefined, can not parse");var t=KeyframeTrack._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var i=[],r=[];Lt.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:Lt.convertArray(e.times,Array),values:Lt.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("Unsupported typeName: "+e)}}),AnimationClip.prototype={constructor:AnimationClip,resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}this.duration=e},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},Object.assign(AnimationClip,{parse:function(e){for(var t=[],i=e.tracks,r=1/(e.fps||1),n=0,o=i.length;n!==o;++n)t.push(KeyframeTrack.parse(i[n]).scale(r));return new AnimationClip(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t},n=0,o=i.length;n!==o;++n)t.push(KeyframeTrack.toJSON(i[n]));return r},CreateFromMorphTargetSequence:function(e,t,i,r){for(var n=t.length,o=[],a=0;a<n;a++){var s=[],l=[];s.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);var c=Lt.getKeyframeOrder(s);s=Lt.sortedArray(s,1,c),l=Lt.sortedArray(l,1,c),r||0!==s[0]||(s.push(n),l.push(l[0])),o.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/i))}return new AnimationClip(e,-1,o)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var r=e;i=r.geometry&&r.geometry.animations||r.animations}for(var n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(n);if(l&&l.length>1){var c=r[h=l[1]];c||(r[h]=c=[]),c.push(s)}}var u=[];for(var h in r)u.push(AnimationClip.CreateFromMorphTargetSequence(h,r[h],t,i));return u},parseAnimation:function(e,t){if(!e)return console.error("  no animation in JSONLoader data"),null;for(var i=function(e,t,i,r,n){if(0!==i.length){var o=[],a=[];Lt.flattenJSON(i,o,a,r),0!==o.length&&n.push(new e(t,o,a))}},r=[],n=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;for(var p in u){var f=[],m=[];for(d=0;d!==c[h].morphTargets.length;++d){var g=c[h];f.push(g.time),m.push(g.morphTarget===p?1:0)}r.push(new NumberKeyframeTrack(".morphTargetInfluence["+p+"]",f,m))}o=u.length*(a||1)}else{var v=".bones["+t[l].name+"]";i(VectorKeyframeTrack,v+".position",c,"pos",r),i(QuaternionKeyframeTrack,v+".quaternion",c,"rot",r),i(VectorKeyframeTrack,v+".scale",c,"scl",r)}}if(0===r.length)return null;return new AnimationClip(n,o,r)}}),Object.assign(MaterialLoader.prototype,{load:function(e,t,i,r){var n=this;new FileLoader(n.manager).load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},setTextures:function(e){this.textures=e},parse:function(e){function getTexture(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var t=this.textures,i=new St[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearCoat&&(i.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(i.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(i.uniforms=e.uniforms),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(i.vertexColors=e.vertexColors),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.shading&&(i.shading=e.shading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.side&&(i.side=e.side),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=getTexture(e.map)),void 0!==e.alphaMap&&(i.alphaMap=getTexture(e.alphaMap),i.transparent=!0),void 0!==e.bumpMap&&(i.bumpMap=getTexture(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=getTexture(e.normalMap)),void 0!==e.normalScale){var r=e.normalScale;!1===Array.isArray(r)&&(r=[r,r]),i.normalScale=(new Vector2).fromArray(r)}if(void 0!==e.displacementMap&&(i.displacementMap=getTexture(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=getTexture(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=getTexture(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=getTexture(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=getTexture(e.specularMap)),void 0!==e.envMap&&(i.envMap=getTexture(e.envMap)),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.lightMap&&(i.lightMap=getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=getTexture(e.gradientMap)),void 0!==e.materials)for(var n=0,o=e.materials.length;n<o;n++)i.materials.push(this.parse(e.materials[n]));return i}}),Object.assign(BufferGeometryLoader.prototype,{load:function(e,t,i,r){var n=this;new FileLoader(n.manager).load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},parse:function(e){var t=new BufferGeometry,i=e.data.index,r={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};if(void 0!==i){var n=new r[i.type](i.array);t.setIndex(new BufferAttribute(n,1))}var o=e.data.attributes;for(var a in o){var s=o[a];n=new r[s.type](s.array);t.addAttribute(a,new BufferAttribute(n,s.itemSize,s.normalized))}var l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(var c=0,u=l.length;c!==u;++c){var h=l[c];t.addGroup(h.start,h.count,h.materialIndex)}var d=e.data.boundingSphere;if(void 0!==d){var p=new Vector3;void 0!==d.center&&p.fromArray(d.center),t.boundingSphere=new Sphere(p,d.radius)}return t}}),Loader.prototype={constructor:Loader,crossOrigin:void 0,extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,i){for(var r=[],n=0;n<e.length;++n)r[n]=this.createMaterial(e[n],t,i);return r},createMaterial:function(){var e,t,i;return function createMaterial(r,n,o){function loadTexture(e,i,r,s,l){var c,u=n+e,h=Loader.Handlers.get(u);null!==h?c=h.load(u):(t.setCrossOrigin(o),c=t.load(u)),void 0!==i&&(c.repeat.fromArray(i),1!==i[0]&&(c.wrapS=ue),1!==i[1]&&(c.wrapT=ue)),void 0!==r&&c.offset.fromArray(r),void 0!==s&&("repeat"===s[0]&&(c.wrapS=ue),"mirror"===s[0]&&(c.wrapS=de),"repeat"===s[1]&&(c.wrapT=ue),"mirror"===s[1]&&(c.wrapT=de)),void 0!==l&&(c.anisotropy=l);var d=ut.generateUUID();return a[d]=c,d}void 0===e&&(e=new Color),void 0===t&&(t=new TextureLoader),void 0===i&&(i=new MaterialLoader);var a={},s={uuid:ut.generateUUID(),type:"MeshLambertMaterial"};for(var l in r){var h=r[l];switch(l){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":s.name=h;break;case"blending":s.blending=E[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case"colorDiffuse":s.color=e.fromArray(h).getHex();break;case"colorSpecular":s.specular=e.fromArray(h).getHex();break;case"colorEmissive":s.emissive=e.fromArray(h).getHex();break;case"specularCoef":s.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(s.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(s.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(s.type="MeshStandardMaterial");break;case"mapDiffuse":s.map=loadTexture(h,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":s.emissiveMap=loadTexture(h,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":s.lightMap=loadTexture(h,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":s.aoMap=loadTexture(h,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":s.bumpMap=loadTexture(h,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":s.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":s.normalMap=loadTexture(h,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":s.normalScale=[h,h];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":s.specularMap=loadTexture(h,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":s.metalnessMap=loadTexture(h,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":s.roughnessMap=loadTexture(h,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":s.alphaMap=loadTexture(h,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":s.side=c;break;case"doubleSided":s.side=u;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),s.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":s[l]=h;break;case"vertexColors":!0===h&&(s.vertexColors=m),"face"===h&&(s.vertexColors=f);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,h)}}return"MeshBasicMaterial"===s.type&&delete s.emissive,"MeshPhongMaterial"!==s.type&&delete s.specular,s.opacity<1&&(s.transparent=!0),i.setTextures(a),i.parse(s)}}()},Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,r=t.length;i<r;i+=2){var n=t[i],o=t[i+1];if(n.test(e))return o}return null}},Object.assign(JSONLoader.prototype,{load:function(e,t,i,r){var n=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Loader.prototype.extractUrlBase(e),a=new FileLoader(this.manager);a.setWithCredentials(this.withCredentials),a.load(e,function(i){var r=JSON.parse(i),a=r.metadata;if(void 0!==a){var s=a.type;if(void 0!==s){if("object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}}var l=n.parse(r,o);t(l.geometry,l.materials)},i,r)},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){var i=new Geometry,r=void 0!==e.scale?1/e.scale:1;if(function parseModel(t){function isBitSet(e,t){return e&1<<t}var r,n,o,a,s,l,c,u,h,d,p,f,m,g,v,y,b,x,w,_,E,M,A,T,S,P=e.faces,C=e.vertices,R=e.normals,L=e.colors,B=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&B++;for(r=0;r<B;r++)i.faceVertexUvs[r]=[]}for(a=0,s=C.length;a<s;)(x=new Vector3).x=C[a++]*t,x.y=C[a++]*t,x.z=C[a++]*t,i.vertices.push(x);for(a=0,s=P.length;a<s;)if(d=P[a++],p=isBitSet(d,0),f=isBitSet(d,1),m=isBitSet(d,3),g=isBitSet(d,4),v=isBitSet(d,5),y=isBitSet(d,6),b=isBitSet(d,7),p){if(_=new Face3,_.a=P[a],_.b=P[a+1],_.c=P[a+3],E=new Face3,E.a=P[a+1],E.b=P[a+2],E.c=P[a+3],a+=4,f&&(h=P[a++],_.materialIndex=h,E.materialIndex=h),o=i.faces.length,m)for(r=0;r<B;r++)for(T=e.uvs[r],i.faceVertexUvs[r][o]=[],i.faceVertexUvs[r][o+1]=[],n=0;n<4;n++)S=new Vector2(T[2*(u=P[a++])],T[2*u+1]),2!==n&&i.faceVertexUvs[r][o].push(S),0!==n&&i.faceVertexUvs[r][o+1].push(S);if(g&&(c=3*P[a++],_.normal.set(R[c++],R[c++],R[c]),E.normal.copy(_.normal)),v)for(r=0;r<4;r++)c=3*P[a++],A=new Vector3(R[c++],R[c++],R[c]),2!==r&&_.vertexNormals.push(A),0!==r&&E.vertexNormals.push(A);if(y&&(M=L[l=P[a++]],_.color.setHex(M),E.color.setHex(M)),b)for(r=0;r<4;r++)M=L[l=P[a++]],2!==r&&_.vertexColors.push(new Color(M)),0!==r&&E.vertexColors.push(new Color(M));i.faces.push(_),i.faces.push(E)}else{if(w=new Face3,w.a=P[a++],w.b=P[a++],w.c=P[a++],f&&(h=P[a++],w.materialIndex=h),o=i.faces.length,m)for(r=0;r<B;r++)for(T=e.uvs[r],i.faceVertexUvs[r][o]=[],n=0;n<3;n++)S=new Vector2(T[2*(u=P[a++])],T[2*u+1]),i.faceVertexUvs[r][o].push(S);if(g&&(c=3*P[a++],w.normal.set(R[c++],R[c++],R[c])),v)for(r=0;r<3;r++)c=3*P[a++],A=new Vector3(R[c++],R[c++],R[c]),w.vertexNormals.push(A);if(y&&(l=P[a++],w.color.setHex(L[l])),b)for(r=0;r<3;r++)l=P[a++],w.vertexColors.push(new Color(L[l]));i.faces.push(w)}}(r),function parseSkin(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,n=e.skinWeights.length;r<n;r+=t){var o=e.skinWeights[r],a=t>1?e.skinWeights[r+1]:0,s=t>2?e.skinWeights[r+2]:0,l=t>3?e.skinWeights[r+3]:0;i.skinWeights.push(new Vector4(o,a,s,l))}if(e.skinIndices)for(r=0,n=e.skinIndices.length;r<n;r+=t){var c=e.skinIndices[r],u=t>1?e.skinIndices[r+1]:0,h=t>2?e.skinIndices[r+2]:0,d=t>3?e.skinIndices[r+3]:0;i.skinIndices.push(new Vector4(c,u,h,d))}i.bones=e.bones,i.bones&&i.bones.length>0&&(i.skinWeights.length!==i.skinIndices.length||i.skinIndices.length!==i.vertices.length)&&console.warn("When skinning, number of vertices ("+i.vertices.length+"), skinIndices ("+i.skinIndices.length+"), and skinWeights ("+i.skinWeights.length+") should match.")}(),function parseMorphing(t){if(void 0!==e.morphTargets)for(var r=0,n=e.morphTargets.length;r<n;r++){i.morphTargets[r]={},i.morphTargets[r].name=e.morphTargets[r].name,i.morphTargets[r].vertices=[];for(var o=i.morphTargets[r].vertices,a=e.morphTargets[r].vertices,s=0,l=a.length;s<l;s+=3){var c=new Vector3;c.x=a[s]*t,c.y=a[s+1]*t,c.z=a[s+2]*t,o.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=i.faces,h=e.morphColors[0].colors;for(r=0,n=u.length;r<n;r++)u[r].color.fromArray(h,3*r)}}(r),function parseAnimations(){var t=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var n=0;n<r.length;n++){var o=AnimationClip.parseAnimation(r[n],i.bones);o&&t.push(o)}if(i.morphTargets){var a=AnimationClip.CreateClipsFromMorphTargetSequences(i.morphTargets,10);t=t.concat(a)}t.length>0&&(i.animations=t)}(),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:i};var n=Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:i,materials:n}}}),Object.assign(ObjectLoader.prototype,{load:function(e,t,i,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this;new FileLoader(n.manager).load(e,function(i){var r=null;try{r=JSON.parse(i)}catch(t){return void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var o=r.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?n.parse(r,t):console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead.")},i,r)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=this.parseGeometries(e.geometries),r=this.parseImages(e.images,function(){void 0!==t&&t(a)}),n=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,n),a=this.parseObject(e.object,i,o);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new JSONLoader,r=new BufferGeometryLoader,n=0,o=e.length;n<o;n++){var a,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Tt[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Tt[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Tt[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Tt[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Tt[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Tt[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":a=new Tt[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Tt[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Tt[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Tt[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Tt[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"BufferGeometry":a=r.parse(s);break;case"Geometry":a=i.parse(s.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e,t){var i={};if(void 0!==e){var r=new MaterialLoader;r.setTextures(t);for(var n=0,o=e.length;n<o;n++){var a=r.parse(e[n]);i[a.uuid]=a}}return i},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=AnimationClip.parse(e[i]);t.push(r)}return t},parseImages:function(e,t){function loadImage(e){return i.manager.itemStart(e),n.load(e,function(){i.manager.itemEnd(e)},void 0,function(){i.manager.itemError(e)})}var i=this,r={};if(void 0!==e&&e.length>0){var n=new ImageLoader(new LoadingManager(t));n.setCrossOrigin(this.crossOrigin);for(var o=0,a=e.length;o<a;o++){var s=e[o],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:i.texturePath+s.url;r[s.uuid]=loadImage(l)}}return r},parseTextures:function(e,t){function parseConstant(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var o=e[r];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var a=new Texture(t[o.image]);a.needsUpdate=!0,a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.mapping&&(a.mapping=parseConstant(o.mapping,ce)),void 0!==o.offset&&a.offset.fromArray(o.offset),void 0!==o.repeat&&a.repeat.fromArray(o.repeat),void 0!==o.wrap&&(a.wrapS=parseConstant(o.wrap[0],pe),a.wrapT=parseConstant(o.wrap[1],pe)),void 0!==o.minFilter&&(a.minFilter=parseConstant(o.minFilter,xe)),void 0!==o.magFilter&&(a.magFilter=parseConstant(o.magFilter,xe)),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),void 0!==o.flipY&&(a.flipY=o.flipY),i[o.uuid]=a}return i},parseObject:function(){var e=new Matrix4;return function parseObject(t,i,r){function getGeometry(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),i[e]}function getMaterial(e){if(void 0!==e)return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}var n;switch(t.type){case"Scene":n=new Scene,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new Color(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new FogExp2(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":n=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":n=new DirectionalLight(t.color,t.intensity);break;case"PointLight":n=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":n=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var o=getGeometry(t.geometry),a=getMaterial(t.material);n=o.bones&&o.bones.length>0?new SkinnedMesh(o,a):new Mesh(o,a);break;case"LOD":n=new LOD;break;case"Line":n=new Line(getGeometry(t.geometry),getMaterial(t.material),t.mode);break;case"LineSegments":n=new LineSegments(getGeometry(t.geometry),getMaterial(t.material));break;case"PointCloud":case"Points":n=new Points(getGeometry(t.geometry),getMaterial(t.material));break;case"Sprite":n=new Sprite(getMaterial(t.material));break;case"Group":n=new Group;break;default:n=new Object3D}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.children)for(var s in t.children)n.add(this.parseObject(t.children[s],i,r));if("LOD"===t.type)for(var l=t.levels,c=0;c<l.length;c++){var u=l[c];void 0!==(s=n.getObjectByProperty("uuid",u.object))&&n.addLevel(s,u.distance)}return n}}()}),Curve.prototype={constructor:Curve,getPoint:function(e){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){e||(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){e||(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),o=0;for(r.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];for(var a,s=0,l=o-1;s<=l;)if(n=Math.floor(s+(l-s)/2),(a=r[n]-i)<0)s=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,r[n]===i){return n/(o-1)}var c=r[n];return(n+(i-c)/(r[n+1]-c))/(o-1)},getTangent:function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),i>1&&(i=1);var r=this.getPoint(t);return this.getPoint(i).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var i,r,n,o=new Vector3,a=[],s=[],l=[],c=new Vector3,u=new Matrix4;for(i=0;i<=e;i++)r=i/e,a[i]=this.getTangentAt(r),a[i].normalize();s[0]=new Vector3,l[0]=new Vector3;var h=Number.MAX_VALUE,d=Math.abs(a[0].x),p=Math.abs(a[0].y),f=Math.abs(a[0].z);for(d<=h&&(h=d,o.set(1,0,0)),p<=h&&(h=p,o.set(0,1,0)),f<=h&&o.set(0,0,1),c.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],c),l[0].crossVectors(a[0],s[0]),i=1;i<=e;i++)s[i]=s[i-1].clone(),l[i]=l[i-1].clone(),c.crossVectors(a[i-1],a[i]),c.length()>Number.EPSILON&&(c.normalize(),n=Math.acos(ut.clamp(a[i-1].dot(a[i]),-1,1)),s[i].applyMatrix4(u.makeRotationAxis(c,n))),l[i].crossVectors(a[i],s[i]);if(!0===t)for(n=Math.acos(ut.clamp(s[0].dot(s[e]),-1,1)),n/=e,a[0].dot(c.crossVectors(s[0],s[e]))>0&&(n=-n),i=1;i<=e;i++)s[i].applyMatrix4(u.makeRotationAxis(a[i],n*i)),l[i].crossVectors(a[i],s[i]);return{tangents:a,normals:s,binormals:l}}},Curve.create=function(e,t){return e.prototype=Object.create(Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},(LineCurve.prototype=Object.create(Curve.prototype)).constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(e){if(1===e)return this.v2.clone();var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=t){var n=i[r]-t,o=this.curves[r],a=o.getLength(),s=0===a?0:1-n/a;return o.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){e||(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],r=0,n=this.curves;r<n.length;r++)for(var o=n[r],a=o&&o.isEllipseCurve?2*e:o&&o.isLineCurve?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(i.push(c),t=c)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},createPointsGeometry:function(e){var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){for(var t=new Geometry,i=0,r=e.length;i<r;i++){var n=e[i];t.vertices.push(new Vector3(n.x,n.y,n.z||0))}return t}}),(EllipseCurve.prototype=Object.create(Curve.prototype)).constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(e){for(var t=2*Math.PI,i=this.aEndAngle-this.aStartAngle,r=Math.abs(i)<Number.EPSILON;i<0;)i+=t;for(;i>t;)i-=t;i<Number.EPSILON&&(i=r?0:t),!0!==this.aClockwise||r||(i===t?i=-t:i-=t);var n=this.aStartAngle+e*i,o=this.aX+this.xRadius*Math.cos(n),a=this.aY+this.yRadius*Math.sin(n);if(0!==this.aRotation){var s=Math.cos(this.aRotation),l=Math.sin(this.aRotation),c=o-this.aX,u=a-this.aY;o=c*s-u*l+this.aX,a=c*l+u*s+this.aY}return new Vector2(o,a)};var Dt={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e,t,i,r,n){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,r,n){var o=.5*(i-e),a=.5*(r-t),s=n*n;return(2*t-2*i+o+a)*(n*s)+(-3*t+3*i-2*o-a)*s+o*n+t}};(SplineCurve.prototype=Object.create(Curve.prototype)).constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(e){var t=this.points,i=(t.length-1)*e,r=Math.floor(i),n=i-r,o=t[0===r?r:r-1],a=t[r],s=t[r>t.length-2?t.length-1:r+1],l=t[r>t.length-3?t.length-1:r+2],c=Dt.interpolate;return new Vector2(c(o.x,a.x,s.x,l.x,n),c(o.y,a.y,s.y,l.y,n))},(CubicBezierCurve.prototype=Object.create(Curve.prototype)).constructor=CubicBezierCurve,CubicBezierCurve.prototype.getPoint=function(e){var t=At.b3;return new Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},CubicBezierCurve.prototype.getTangent=function(e){var t=Dt.tangentCubicBezier;return new Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},(QuadraticBezierCurve.prototype=Object.create(Curve.prototype)).constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.getPoint=function(e){var t=At.b2;return new Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))},QuadraticBezierCurve.prototype.getTangent=function(e){var t=Dt.tangentQuadraticBezier;return new Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()};var It=Object.assign(Object.create(CurvePath.prototype),{fromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var i=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));this.curves.push(i),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,i,r){var n=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r));this.curves.push(n),this.currentPoint.set(i,r)},bezierCurveTo:function(e,t,i,r,n,o){var a=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r),new Vector2(n,o));this.curves.push(a),this.currentPoint.set(n,o)},splineThru:function(e){var t=new SplineCurve([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,i,r,n,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+a,t+s,i,r,n,o)},absarc:function(e,t,i,r,n,o){this.absellipse(e,t,i,i,r,n,o)},ellipse:function(e,t,i,r,n,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,i,r,n,o,a,s)},absellipse:function(e,t,i,r,n,o,a,s){var l=new EllipseCurve(e,t,i,r,n,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)}});Shape.prototype=Object.assign(Object.create(It),{constructor:Shape,getPointsHoles:function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractAllPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},extractPoints:function(e){return this.extractAllPoints(e)}}),Path.prototype=It,It.constructor=Path,ShapePath.prototype={moveTo:function(e,t){this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,i,r){this.currentPath.quadraticCurveTo(e,t,i,r)},bezierCurveTo:function(e,t,i,r,n,o){this.currentPath.bezierCurveTo(e,t,i,r,n,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function toShapesNoHoles(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],o=new Shape;o.curves=n.curves,t.push(o)}return t}function isPointInsidePolygon(e,t){for(var i=t.length,r=!1,n=i-1,o=0;o<i;n=o++){var a=t[n],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=t[o],l=-l,s=t[n],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var u=c*(e.x-a.x)-l*(e.y-a.y);if(0===u)return!0;if(u<0)continue;r=!r}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return r}var i=At.isClockWise,r=this.subPaths;if(0===r.length)return[];if(!0===t)return toShapesNoHoles(r);var n,o,a,s=[];if(1===r.length)return o=r[0],a=new Shape,a.curves=o.curves,s.push(a),s;var l=!i(r[0].getPoints());l=e?!l:l;var c,u=[],h=[],d=[],p=0;h[p]=void 0,d[p]=[];for(var f=0,m=r.length;f<m;f++)n=i(c=(o=r[f]).getPoints()),(n=e?!n:n)?(!l&&h[p]&&p++,h[p]={s:new Shape,p:c},h[p].s.curves=o.curves,l&&p++,d[p]=[]):d[p].push({h:o,p:c[0]});if(!h[0])return toShapesNoHoles(r);if(h.length>1){for(var g=!1,v=[],y=0,b=h.length;y<b;y++)u[y]=[];for(y=0,b=h.length;y<b;y++)for(var x=d[y],w=0;w<x.length;w++){for(var _=x[w],E=!0,M=0;M<h.length;M++)isPointInsidePolygon(_.p,h[M].p)&&(y!==M&&v.push({froms:y,tos:M,hole:w}),E?(E=!1,u[M].push(_)):g=!0);E&&u[y].push(_)}v.length>0&&(g||(d=u))}f=0;for(var A,T=h.length;f<T;f++){a=h[f].s,s.push(a);for(var S=0,P=(A=d[f]).length;S<P;S++)a.holes.push(A[S].h)}return s}},Object.assign(Font.prototype,{isFont:!0,generateShapes:function(e,t,i){void 0===t&&(t=100),void 0===i&&(i=4);for(var r=this.data,n=function createPaths(e){for(var n=String(e).split(""),o=t/r.resolution,a=0,s=[],l=0;l<n.length;l++){var c=function createPath(e,t,n){var o=r.glyphs[e]||r.glyphs["?"];if(o){var a,s,l,c,u,h,d,p,f,m,g,v=new ShapePath,y=[],b=At.b2,x=At.b3;if(o.o)for(var w=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),_=0,E=w.length;_<E;){var M=w[_++];switch(M){case"m":a=w[_++]*t+n,s=w[_++]*t,v.moveTo(a,s);break;case"l":a=w[_++]*t+n,s=w[_++]*t,v.lineTo(a,s);break;case"q":if(l=w[_++]*t+n,c=w[_++]*t,d=w[_++]*t+n,p=w[_++]*t,v.quadraticCurveTo(d,p,l,c),g=y[y.length-1]){u=g.x,h=g.y;for(var A=1;A<=i;A++){var T=A/i;b(T,u,d,l),b(T,h,p,c)}}break;case"b":if(l=w[_++]*t+n,c=w[_++]*t,d=w[_++]*t+n,p=w[_++]*t,f=w[_++]*t+n,m=w[_++]*t,v.bezierCurveTo(d,p,f,m,l,c),g=y[y.length-1]){u=g.x,h=g.y;for(var A=1;A<=i;A++){var T=A/i;x(T,u,d,f,l),x(T,h,p,m,c)}}}}return{offset:o.ha*t,path:v}}}(n[l],o,a);a+=c.offset,s.push(c.path)}return s}(e),o=[],a=0,s=n.length;a<s;a++)Array.prototype.push.apply(o,n[a].toShapes());return o}}),Object.assign(FontLoader.prototype,{load:function(e,t,i,r){var n=this;new FileLoader(this.manager).load(e,function(e){var i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}var r=n.parse(i);t&&t(r)},i,r)},parse:function(e){return new Font(e)}});var Ot,Nt={getContext:function(){return void 0===Ot&&(Ot=new(window.AudioContext||window.webkitAudioContext)),Ot},setContext:function(e){Ot=e}};Object.assign(AudioLoader.prototype,{load:function(e,t,i,r){var n=new FileLoader(this.manager);n.setResponseType("arraybuffer"),n.load(e,function(e){Nt.getContext().decodeAudioData(e,function(e){t(e)})},i,r)}}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this}}),Object.assign(StereoCamera.prototype,{update:function(){var e,t,i,r,n,o,a,s=new Matrix4,l=new Matrix4;return function update(c){if(e!==this||t!==c.focus||i!==c.fov||r!==c.aspect*this.aspect||n!==c.near||o!==c.far||a!==c.zoom){e=this,t=c.focus,i=c.fov,r=c.aspect*this.aspect,n=c.near,o=c.far,a=c.zoom;var u,h,d=c.projectionMatrix.clone(),p=this.eyeSep/2,f=p*n/t,m=n*Math.tan(ut.DEG2RAD*i*.5)/a;l.elements[12]=-p,s.elements[12]=p,u=-m*r+f,h=m*r+f,d.elements[0]=2*n/(h-u),d.elements[8]=(h+u)/(h-u),this.cameraL.projectionMatrix.copy(d),u=-m*r-f,h=m*r-f,d.elements[0]=2*n/(h-u),d.elements[8]=(h+u)/(h-u),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(l),this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(s)}}()}),(CubeCamera.prototype=Object.create(Object3D.prototype)).constructor=CubeCamera,AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var e=new Vector3,t=new Quaternion,i=new Vector3,r=new Vector3;return function updateMatrixWorld(n){Object3D.prototype.updateMatrixWorld.call(this,n);var o=this.context.listener,a=this.up;this.matrixWorld.decompose(e,t,i),r.set(0,0,-1).applyQuaternion(t),o.positionX?(o.positionX.setValueAtTime(e.x,this.context.currentTime),o.positionY.setValueAtTime(e.y,this.context.currentTime),o.positionZ.setValueAtTime(e.z,this.context.currentTime),o.forwardX.setValueAtTime(r.x,this.context.currentTime),o.forwardY.setValueAtTime(r.y,this.context.currentTime),o.forwardZ.setValueAtTime(r.z,this.context.currentTime),o.upX.setValueAtTime(a.x,this.context.currentTime),o.upY.setValueAtTime(a.y,this.context.currentTime),o.upZ.setValueAtTime(a.z,this.context.currentTime)):(o.setPosition(e.x,e.y,e.z),o.setOrientation(r.x,r.y,r.z,a.x,a.y,a.z))}}()}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),e.start(0,this.startTime),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new Vector3;return function updateMatrixWorld(t){Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),PropertyMixer.prototype={constructor:PropertyMixer,accumulate:function(e,t){var i=this.buffer,r=this.valueSize,n=e*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)i[n+a]=i[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(i,n,0,s,r)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,n<1){var a=3*t;this._mixBufferRegion(i,r,a,1-n,t)}for(var s=t,l=t+t;s!==l;++s)if(i[s]!==i[s+t]){o.setValue(i,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,r=3*i;e.getValue(t,r);for(var n=i,o=r;n!==o;++n)t[n]=t[r+n%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,r,n){if(r>=.5)for(var o=0;o!==n;++o)e[t+o]=e[i+o]},_slerp:function(e,t,i,r,n){Quaternion.slerpFlat(e,t,e,t,e,i,r)},_lerp:function(e,t,i,r,n){for(var o=1-r,a=0;a!==n;++a){var s=t+a;e[s]=e[s]*o+e[i+a]*r}}},PropertyBinding.prototype={constructor:PropertyBinding,getValue:function getValue_unbound(e,t){this.bind(),this.getValue(e,t)},setValue:function getValue_unbound(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("  can not bind to material as node does not have a material",this);if(!e.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[i])return void console.error("  can not bind to objectName of node, undefined",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,e);e=e[o]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;void 0!==e.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var c=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);if(!e.geometry.morphTargets)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===n){n=a;break}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):void 0!==s.length?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("  trying to update property for track: "+u+"."+r+" but it wasn't found.",e)}}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function getValue_direct(e,t){e[t]=this.node[this.propertyName]},function getValue_array(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)e[t++]=i[r]},function getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function setValue_direct(e,t){this.node[this.propertyName]=e[t]},function setValue_direct_setNeedsUpdate(e,t){this.node[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.node[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_array(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++]},function setValue_array_setNeedsUpdate(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function setValue_array_setMatrixWorldNeedsUpdate(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)},function setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),(PropertyBinding.Composite=function(e,t,i){var r=i||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}).prototype={constructor:PropertyBinding.Composite,getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},PropertyBinding.create=function(e,t,i){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,i):new PropertyBinding(e,t,i)},PropertyBinding.parseTrackName=function(e){var t=/^((?:\w+[\/:])*)(\w+)?(?:\.(\w+)(?:\[(.+)\])?)?\.(\w+)(?:\[(.+)\])?$/.exec(e);if(!t)throw new Error("cannot parse trackName at all: "+e);var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]};if(null===i.propertyName||0===i.propertyName.length)throw new Error("can not parse propertyName from trackName: "+e);return i},PropertyBinding.findNode=function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=function(e){for(var i=0;i<e.bones.length;i++){var r=e.bones[i];if(r.name===t)return r}return null}(e.skeleton);if(i)return i}if(e.children){var r=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t||n.uuid===t)return n;var o=r(n.children);if(o)return o}return null},n=r(e.children);if(n)return n}return null},AnimationObjectGroup.prototype={constructor:AnimationObjectGroup,isAnimationObjectGroup:!0,add:function(e){for(var t=this._objects,i=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,o=this._paths,a=this._parsedPaths,s=this._bindings,l=s.length,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],d=h.uuid,p=n[d];if(void 0===p){p=i++,n[d]=p,t.push(h);for(var f=0,m=l;f!==m;++f)s[f].push(new PropertyBinding(h,o[f],a[f]))}else if(p<r){var g=t[p],v=--r,y=t[v];n[y.uuid]=p,t[p]=y,n[d]=v,t[v]=h;for(f=0,m=l;f!==m;++f){var b=s[f],x=b[v],w=b[p];b[p]=x,void 0===w&&(w=new PropertyBinding(h,o[f],a[f])),b[v]=w}}else t[p]!==g&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=r},remove:function(e){for(var t=this._objects,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,o=n.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a],c=l.uuid,u=r[c];if(void 0!==u&&u>=i){var h=i++,d=t[h];r[d.uuid]=u,t[u]=d,r[c]=h,t[h]=l;for(var p=0,f=o;p!==f;++p){var m=n[p],g=m[h],v=m[u];m[u]=g,m[h]=v}}}this.nCachedObjects_=i},uncache:function(e){for(var t=this._objects,i=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,o=this._bindings,a=o.length,s=0,l=arguments.length;s!==l;++s){var c=arguments[s].uuid,u=n[c];if(void 0!==u)if(delete n[c],u<r){var h=--r,d=t[h],p=t[y=--i];n[d.uuid]=u,t[u]=d,n[p.uuid]=h,t[h]=p,t.pop();for(var f=0,m=a;f!==m;++f){var g=(b=o[f])[h],v=b[y];b[u]=g,b[h]=v,b.pop()}}else{var y;n[(p=t[y=--i]).uuid]=u,t[u]=p,t.pop();for(f=0,m=a;f!==m;++f){var b;(b=o[f])[u]=b[y],b.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(void 0!==r)return n[r];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);r=n.length,i[e]=r,o.push(e),a.push(t),n.push(u);for(var h=c,d=s.length;h!==d;++h){var p=s[h];u[h]=new PropertyBinding(p,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var r=this._paths,n=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=i,o[i]=s,o.pop(),n[i]=n[a],n.pop(),r[i]=r[a],r.pop()}}},AnimationAction.prototype={constructor:AnimationAction,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var r=this._clip.duration,n=e._clip.duration,o=n/r,a=r/n;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var r=this._mixer,n=r.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=n,s[1]=n+i,l[0]=e/a,l[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,r){var n=this._startTime;if(null!==n){var o=(e-n)*i;if(o<0||0===i)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(r,s)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var i=this._clip.duration,r=this.loop,n=this._loopCount;if(2200===r){-1===n&&(this.loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=i)t=i;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var o=2202===r;if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||t<0){var a=Math.floor(t/i);t-=i*a,n+=Math.abs(a);var s=this.repetitions-n;if(s<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(0===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&n))return this.time=t,i-t}return this.time=t,t},_setEndings:function(e,t,i){var r=this._interpolantSettings;i?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:Qe:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:Qe:2402)},_scheduleFading:function(e,t,i){var r=this._mixer,n=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=n,s[0]=t,a[1]=n+e,s[1]=i,this}},Object.assign(AnimationMixer.prototype,EventDispatcher.prototype,{clipAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?AnimationClip.findByName(i,e):e,o=null!==n?n.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[r];if(void 0!==l)return l;s=a.knownActions[0],null===n&&(n=s._clip)}if(null===n)return null;var c=new AnimationAction(this,n,t);return this._bindAction(c,s),this._addInactiveAction(c,o,r),c},existingAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?AnimationClip.findByName(i,e):e,o=n?n.uuid:e,a=this._actionsByClip[o];return void 0!==a?a.actionByRoot[r]||null:null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==t;++n)e[n].reset();for(n=0;n!==r;++n)i[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1,a=0;a!==i;++a){var s=t[a];s.enabled&&s._update(r,e,n,o)}var l=this._bindings,c=this._nActiveBindings;for(a=0;a!==c;++a)l[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){for(var o=n.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var r in i){var n=i[r].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),Object.assign(AnimationMixer.prototype,{_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,o=e._propertyBindings,a=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==n;++u){var h=r[u],d=h.name,p=c[d];if(void 0!==p)o[u]=p;else{if(void 0!==(p=o[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(p=new PropertyMixer(PropertyBinding.create(i,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[u]=p}a[u].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}for(var n=e._propertyBindings,o=0,a=n.length;o!==a;++o){var s=n[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,o=this._actionsByClip,a=o[n],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=r[t],o=this._bindings;void 0===n&&(n={},r[t]=n),n[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[n];e:{for(var c in a)break e;delete o[r]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1)}),Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())},(InstancedBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=InstancedBufferGeometry,InstancedBufferGeometry.prototype.isInstancedBufferGeometry=!0,InstancedBufferGeometry.prototype.addGroup=function(e,t,i){this.groups.push({start:e,count:t,materialIndex:i})},InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var i=e.attributes;for(var r in i){var n=i[r];this.addAttribute(r,n.clone())}for(var o=e.groups,a=0,s=o.length;a<s;a++){var l=o[a];this.addGroup(l.start,l.count,l.materialIndex)}return this},InterleavedBufferAttribute.prototype={constructor:InterleavedBufferAttribute,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}},InterleavedBuffer.prototype={constructor:InterleavedBuffer,isInterleavedBuffer:!0,set needsUpdate(e){!0===e&&this.version++},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.stride:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}},(InstancedInterleavedBuffer.prototype=Object.create(InterleavedBuffer.prototype)).constructor=InstancedInterleavedBuffer,InstancedInterleavedBuffer.prototype.isInstancedInterleavedBuffer=!0,InstancedInterleavedBuffer.prototype.copy=function(e){return InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},(InstancedBufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=InstancedBufferAttribute,InstancedBufferAttribute.prototype.isInstancedBufferAttribute=!0,InstancedBufferAttribute.prototype.copy=function(e){return BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},Raycaster.prototype={constructor:Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t){var i=[];return intersectObject(e,this,i,t),i.sort(ascSort),i},intersectObjects:function(e,t){var i=[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,n=e.length;r<n;r++)intersectObject(e[r],this,i,t);return i.sort(ascSort),i}},Clock.prototype={constructor:Clock,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=(performance||Date).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}},Spherical.prototype={constructor:Spherical,set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(ut.clamp(e.y/this.radius,-1,1))),this}},(MorphBlendMesh.prototype=Object.create(Mesh.prototype)).constructor=MorphBlendMesh,MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){var n={start:t,end:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)_?(\d+)/i,r={},n=this.geometry,o=0,a=n.morphTargets.length;o<a;o++){var s=n.morphTargets[o].name.match(i);if(s&&s.length>1){r[l=s[1]]||(r[l]={start:1/0,end:-1/0});o<(c=r[l]).start&&(c.start=o),o>c.end&&(c.end=o),t||(t=l)}}for(var l in r){var c=r[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var r=this.animationsList[t];if(r.active){var n=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.start+ut.clamp(Math.floor(r.time/n),0,r.length-1),a=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var s=r.time%n/n;r.directionBackwards&&(s=1-s),r.currentFrame!==r.lastFrame?(this.morphTargetInfluences[r.currentFrame]=s*a,this.morphTargetInfluences[r.lastFrame]=(1-s)*a):this.morphTargetInfluences[r.currentFrame]=a}}},(ImmediateRenderObject.prototype=Object.create(Object3D.prototype)).constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0,(VertexNormalsHelper.prototype=Object.create(LineSegments.prototype)).constructor=VertexNormalsHelper,VertexNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,i=new Matrix3;return function update(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,l=a.faces,c=0,u=0,h=l.length;u<h;u++)for(var d=l[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=s[d[r[p]]],g=d.vertexNormals[p];e.copy(m).applyMatrix4(n),t.copy(g).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}else if(a&&a.isBufferGeometry){var v=a.attributes.position,y=a.attributes.normal;for(c=0,p=0,f=v.count;p<f;p++)e.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(n),t.set(y.getX(p),y.getY(p),y.getZ(p)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}return o.needsUpdate=!0,this}}(),(SpotLightHelper.prototype=Object.create(Object3D.prototype)).constructor=SpotLightHelper,SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3;return function update(){var i=this.light.distance?this.light.distance:1e3,r=i*Math.tan(this.light.angle);this.cone.scale.set(r,r,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),(SkeletonHelper.prototype=Object.create(LineSegments.prototype)).constructor=SkeletonHelper,SkeletonHelper.prototype.getBoneList=function(e){var t=[];e&&e.isBone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,this.getBoneList(e.children[i]));return t},SkeletonHelper.prototype.update=function(){var e=new Vector3,t=new Matrix4,i=new Matrix4;return function update(){var r=this.geometry,n=r.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var o=0,a=0;o<this.bones.length;o++){var s=this.bones[o];s.parent&&s.parent.isBone&&(t.multiplyMatrices(i,s.matrixWorld),e.setFromMatrixPosition(t),n.setXYZ(a,e.x,e.y,e.z),t.multiplyMatrices(i,s.parent.matrixWorld),e.setFromMatrixPosition(t),n.setXYZ(a+1,e.x,e.y,e.z),a+=2)}r.getAttribute("position").needsUpdate=!0}}(),(PointLightHelper.prototype=Object.create(Mesh.prototype)).constructor=PointLightHelper,PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},(RectAreaLightHelper.prototype=Object.create(Object3D.prototype)).constructor=RectAreaLightHelper,RectAreaLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose(),this.children[1].geometry.dispose(),this.children[1].material.dispose()},RectAreaLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3;return function update(){var i=this.children[0],r=this.children[1];if(this.light.target){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld);var n=t.clone().sub(e);i.lookAt(n),r.lookAt(n)}i.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),r.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var o=.5*this.light.width,a=.5*this.light.height,s=i.geometry.getAttribute("position"),l=s.array;l[0]=o,l[1]=-a,l[2]=0,l[3]=o,l[4]=a,l[5]=0,l[6]=-o,l[7]=a,l[8]=0,l[9]=-o,l[10]=a,l[11]=0,l[12]=-o,l[13]=-a,l[14]=0,l[15]=o,l[16]=-a,l[17]=0,s.needsUpdate=!0}}(),(HemisphereLightHelper.prototype=Object.create(Object3D.prototype)).constructor=HemisphereLightHelper,HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var e=new Vector3,t=new Color,i=new Color;return function update(){var r=this.children[0],n=r.geometry.getAttribute("color");t.copy(this.light.color).multiplyScalar(this.light.intensity),i.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var o=0,a=n.count;o<a;o++){var s=o<a/2?t:i;n.setXYZ(o,s.r,s.g,s.b)}r.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),n.needsUpdate=!0}}(),(GridHelper.prototype=Object.create(LineSegments.prototype)).constructor=GridHelper,(PolarGridHelper.prototype=Object.create(LineSegments.prototype)).constructor=PolarGridHelper,(FaceNormalsHelper.prototype=Object.create(LineSegments.prototype)).constructor=FaceNormalsHelper,FaceNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,i=new Matrix3;return function update(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,n=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,l=0,c=0,u=s.length;c<u;c++){var h=s[c],d=h.normal;e.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(r),t.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),n.setXYZ(l,e.x,e.y,e.z),l+=1,n.setXYZ(l,t.x,t.y,t.z),l+=1}return n.needsUpdate=!0,this}}(),(DirectionalLightHelper.prototype=Object.create(Object3D.prototype)).constructor=DirectionalLightHelper,DirectionalLightHelper.prototype.dispose=function(){var e=this.children[0],t=this.children[1];e.geometry.dispose(),e.material.dispose(),t.geometry.dispose(),t.material.dispose()},DirectionalLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,i=new Vector3;return function update(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e);var r=this.children[0],n=this.children[1];r.lookAt(i),r.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),n.lookAt(i),n.scale.z=i.length()}}(),(CameraHelper.prototype=Object.create(LineSegments.prototype)).constructor=CameraHelper,CameraHelper.prototype.update=function(){function setPoint(n,o,a,s){i.set(o,a,s).unproject(r);var l=t[n];if(void 0!==l)for(var c=e.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],i.x,i.y,i.z)}var e,t,i=new Vector3,r=new Camera;return function update(){e=this.geometry,t=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix),setPoint("c",0,0,-1),setPoint("t",0,0,1),setPoint("n1",-1,-1,-1),setPoint("n2",1,-1,-1),setPoint("n3",-1,1,-1),setPoint("n4",1,1,-1),setPoint("f1",-1,-1,1),setPoint("f2",1,-1,1),setPoint("f3",-1,1,1),setPoint("f4",1,1,1),setPoint("u1",.7,1.1,-1),setPoint("u2",-.7,1.1,-1),setPoint("u3",0,2,-1),setPoint("cf1",-1,0,1),setPoint("cf2",1,0,1),setPoint("cf3",0,-1,1),setPoint("cf4",0,1,1),setPoint("cn1",-1,0,-1),setPoint("cn2",1,0,-1),setPoint("cn3",0,-1,-1),setPoint("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),(BoxHelper.prototype=Object.create(LineSegments.prototype)).constructor=BoxHelper,BoxHelper.prototype.update=function(){var e=new Box3;return function update(t){if(t&&t.isBox3?e.copy(t):e.setFromObject(t),!e.isEmpty()){var i=e.min,r=e.max,n=this.geometry.attributes.position,o=n.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=i.x,o[4]=r.y,o[5]=r.z,o[6]=i.x,o[7]=i.y,o[8]=r.z,o[9]=r.x,o[10]=i.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=i.z,o[15]=i.x,o[16]=r.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=r.x,o[22]=i.y,o[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}();var kt=new BufferGeometry;kt.addAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3));var Ft=new CylinderBufferGeometry(0,.5,1,5,1);Ft.translate(0,-.5,0),(ArrowHelper.prototype=Object.create(Object3D.prototype)).constructor=ArrowHelper,ArrowHelper.prototype.setDirection=function(){var e,t=new Vector3;return function setDirection(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),ArrowHelper.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},(AxisHelper.prototype=Object.create(LineSegments.prototype)).constructor=AxisHelper;var Ut=function(){function CubicPoly(){}var e=new Vector3,t=new CubicPoly,i=new CubicPoly,r=new CubicPoly;return CubicPoly.prototype.init=function(e,t,i,r){this.c0=e,this.c1=i,this.c2=-3*e+3*t-2*i-r,this.c3=2*e-2*t+i+r},CubicPoly.prototype.initNonuniformCatmullRom=function(e,t,i,r,n,o,a){var s=(t-e)/n-(i-e)/(n+o)+(i-t)/o,l=(i-t)/o-(r-t)/(o+a)+(r-i)/a;s*=o,l*=o,this.init(t,i,s,l)},CubicPoly.prototype.initCatmullRom=function(e,t,i,r,n){this.init(t,i,n*(i-e),n*(r-t))},CubicPoly.prototype.calc=function(e){var t=e*e,i=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*i},Curve.create(function(e){this.points=e||[],this.closed=!1},function(n){var o,a,s,l,c=this.points;(l=c.length)<2&&console.log("duh, you need at least 2 points"),s=(o=(l-(this.closed?0:1))*n)-(a=Math.floor(o)),this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/c.length)+1)*c.length:0===s&&a===l-1&&(a=l-2,s=1);var u,h,d,p;if(this.closed||a>0?u=c[(a-1)%l]:(e.subVectors(c[0],c[1]).add(c[0]),u=e),h=c[a%l],d=c[(a+1)%l],this.closed||a+2<l?p=c[(a+2)%l]:(e.subVectors(c[l-1],c[l-2]).add(c[l-1]),p=e),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var f="chordal"===this.type?.5:.25,m=Math.pow(u.distanceToSquared(h),f),g=Math.pow(h.distanceToSquared(d),f),v=Math.pow(d.distanceToSquared(p),f);g<1e-4&&(g=1),m<1e-4&&(m=g),v<1e-4&&(v=g),t.initNonuniformCatmullRom(u.x,h.x,d.x,p.x,m,g,v),i.initNonuniformCatmullRom(u.y,h.y,d.y,p.y,m,g,v),r.initNonuniformCatmullRom(u.z,h.z,d.z,p.z,m,g,v)}else if("catmullrom"===this.type){var y=void 0!==this.tension?this.tension:.5;t.initCatmullRom(u.x,h.x,d.x,p.x,y),i.initCatmullRom(u.y,h.y,d.y,p.y,y),r.initCatmullRom(u.z,h.z,d.z,p.z,y)}return new Vector3(t.calc(s),i.calc(s),r.calc(s))})}(),Ht=Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0===e?[]:e},function(e){var t=this.points,i=(t.length-1)*e,r=Math.floor(i),n=i-r,o=t[0==r?r:r-1],a=t[r],s=t[r>t.length-2?t.length-1:r+1],l=t[r>t.length-3?t.length-1:r+2],c=Dt.interpolate;return new Vector3(c(o.x,a.x,s.x,l.x,n),c(o.y,a.y,s.y,l.y,n),c(o.z,a.z,s.z,l.z,n))}),zt=Curve.create(function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},function(e){var t=At.b3;return new Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),Gt=Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t=At.b2;return new Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))}),Vt=Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){if(1===e)return this.v2.clone();var t=new Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t});(ArcCurve.prototype=Object.create(EllipseCurve.prototype)).constructor=ArcCurve;var jt={createMultiMaterialObject:function(e,t){for(var i=new Group,r=0,n=t.length;r<n;r++)i.add(new Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var r=new Matrix4;r.getInverse(i.matrixWorld),e.applyMatrix(r),t.remove(e),i.add(e)}};ClosedSplineCurve3.prototype=Object.create(Ut.prototype),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Object.assign(Box2.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Box3.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},ut.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)}}),Object.assign(Matrix4.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function getPosition(){return void 0===e&&(e=new Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}}),Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Shape.prototype,{extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)}}),Geometry.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(Object3D.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(BufferGeometry.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new Color}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),EventDispatcher.prototype=Object.assign(Object.create({constructor:EventDispatcher,apply:function(e){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in."),Object.assign(e,this)}}),EventDispatcher.prototype),Object.assign(WebGLRenderer.prototype,{supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=e}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){return this.renderReverseSided?n:r},set:function(e){var t=e!==r;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+t+"."),this.renderReverseSided=t}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Audio.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new AudioLoader).load(e,function(e){t.setBuffer(e)}),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};var Wt={merge:function(e,t,i){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},qt={crossOrigin:void 0,loadTexture:function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new TextureLoader;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},loadTextureCube:function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new CubeTextureLoader;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},Xt={merge:function(e){console.warn("THREE.UniformsUtils.merge() has been deprecated. Use Object.assign() instead.");for(var t={},i=0;i<e.length;i++){var r=this.clone(e[i]);for(var n in r)t[n]=r[n]}return t},clone:function(e){console.warn("THREE.UniformsUtils.clone() has been deprecated.");var t={};for(var i in e){t[i]={};for(var r in e[i]){var n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}};e.WebGLRenderTargetCube=WebGLRenderTargetCube,e.WebGLRenderTarget=WebGLRenderTarget,e.WebGLRenderer=WebGLRenderer,e.ShaderLib=xt,e.UniformsLib=bt,e.ShaderChunk=vt,e.FogExp2=FogExp2,e.Fog=Fog,e.Scene=Scene,e.LensFlare=LensFlare,e.Sprite=Sprite,e.LOD=LOD,e.SkinnedMesh=SkinnedMesh,e.Skeleton=Skeleton,e.Bone=Bone,e.Mesh=Mesh,e.LineSegments=LineSegments,e.Line=Line,e.Points=Points,e.Group=Group,e.VideoTexture=VideoTexture,e.DataTexture=DataTexture,e.CompressedTexture=CompressedTexture,e.CubeTexture=CubeTexture,e.CanvasTexture=CanvasTexture,e.DepthTexture=DepthTexture,e.Texture=Texture,e.CompressedTextureLoader=CompressedTextureLoader,e.BinaryTextureLoader=BinaryTextureLoader,e.DataTextureLoader=Rt,e.CubeTextureLoader=CubeTextureLoader,e.TextureLoader=TextureLoader,e.ObjectLoader=ObjectLoader,e.MaterialLoader=MaterialLoader,e.BufferGeometryLoader=BufferGeometryLoader,e.DefaultLoadingManager=Ct,e.LoadingManager=LoadingManager,e.JSONLoader=JSONLoader,e.ImageLoader=ImageLoader,e.FontLoader=FontLoader,e.FileLoader=FileLoader,e.Loader=Loader,e.Cache=Pt,e.AudioLoader=AudioLoader,e.SpotLightShadow=SpotLightShadow,e.SpotLight=SpotLight,e.PointLight=PointLight,e.RectAreaLight=RectAreaLight,e.HemisphereLight=HemisphereLight,e.DirectionalLightShadow=DirectionalLightShadow,e.DirectionalLight=DirectionalLight,e.AmbientLight=AmbientLight,e.LightShadow=LightShadow,e.Light=Light,e.StereoCamera=StereoCamera,e.PerspectiveCamera=PerspectiveCamera,e.OrthographicCamera=OrthographicCamera,e.CubeCamera=CubeCamera,e.Camera=Camera,e.AudioListener=AudioListener,e.PositionalAudio=PositionalAudio,e.AudioContext=Nt,e.AudioAnalyser=AudioAnalyser,e.Audio=Audio,e.VectorKeyframeTrack=VectorKeyframeTrack,e.StringKeyframeTrack=StringKeyframeTrack,e.QuaternionKeyframeTrack=QuaternionKeyframeTrack,e.NumberKeyframeTrack=NumberKeyframeTrack,e.ColorKeyframeTrack=ColorKeyframeTrack,e.BooleanKeyframeTrack=BooleanKeyframeTrack,e.PropertyMixer=PropertyMixer,e.PropertyBinding=PropertyBinding,e.KeyframeTrack=KeyframeTrack,e.AnimationUtils=Lt,e.AnimationObjectGroup=AnimationObjectGroup,e.AnimationMixer=AnimationMixer,e.AnimationClip=AnimationClip,e.Uniform=Uniform,e.InstancedBufferGeometry=InstancedBufferGeometry,e.BufferGeometry=BufferGeometry,e.GeometryIdCount=GeometryIdCount,e.Geometry=Geometry,e.InterleavedBufferAttribute=InterleavedBufferAttribute,e.InstancedInterleavedBuffer=InstancedInterleavedBuffer,e.InterleavedBuffer=InterleavedBuffer,e.InstancedBufferAttribute=InstancedBufferAttribute,e.Face3=Face3,e.Object3D=Object3D,e.Raycaster=Raycaster,e.Layers=Layers,e.EventDispatcher=EventDispatcher,e.Clock=Clock,e.QuaternionLinearInterpolant=QuaternionLinearInterpolant,e.LinearInterpolant=LinearInterpolant,e.DiscreteInterpolant=DiscreteInterpolant,e.CubicInterpolant=CubicInterpolant,e.Interpolant=Interpolant,e.Triangle=Triangle,e.Spline=function Spline(e){function interpolate(e,t,i,r,n,o,a){var s=.5*(i-e),l=.5*(r-t);return(2*(t-i)+s+l)*a+(-3*(t-i)-2*s-l)*o+s*n+t}this.points=e;var t,i,r,n,o,a,s,l,c,u=[],h={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,i=Math.floor(t),r=t-i,u[0]=0===i?i:i-1,u[1]=i,u[2]=i>this.points.length-2?this.points.length-1:i+1,u[3]=i>this.points.length-3?this.points.length-1:i+2,a=this.points[u[0]],s=this.points[u[1]],l=this.points[u[2]],c=this.points[u[3]],n=r*r,o=r*n,h.x=interpolate(a.x,s.x,l.x,c.x,r,n,o),h.y=interpolate(a.y,s.y,l.y,c.y,r,n,o),h.z=interpolate(a.z,s.z,l.z,c.z,r,n,o),h},this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;e<i;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,i,r,n,o=0,a=0,s=0,l=new Vector3,c=new Vector3,u=[],h=0;for(u[0]=0,e||(e=100),r=this.points.length*e,l.copy(this.points[0]),t=1;t<r;t++)i=t/r,n=this.getPoint(i),c.copy(n),h+=c.distanceTo(l),l.copy(n),o=(this.points.length-1)*i,(a=Math.floor(o))!==s&&(u[a]=h,s=a);return u[u.length]=h,{chunks:u,total:h}},this.reparametrizeByArcLength=function(e){var t,i,r,n,o,a,s,l,c=[],u=new Vector3,h=this.getLength();for(c.push(u.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=h.chunks[t]-h.chunks[t-1],s=Math.ceil(e*a/h.total),n=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;i<s-1;i++)r=n+i*(1/s)*(o-n),l=this.getPoint(r),c.push(u.copy(l).clone());c.push(u.copy(this.points[t]).clone())}this.points=c}},e.Math=ut,e.Spherical=Spherical,e.Plane=Plane,e.Frustum=Frustum,e.Sphere=Sphere,e.Ray=Ray,e.Matrix4=Matrix4,e.Matrix3=Matrix3,e.Box3=Box3,e.Box2=Box2,e.Line3=Line3,e.Euler=Euler,e.Vector4=Vector4,e.Vector3=Vector3,e.Vector2=Vector2,e.Quaternion=Quaternion,e.Color=Color,e.MorphBlendMesh=MorphBlendMesh,e.ImmediateRenderObject=ImmediateRenderObject,e.VertexNormalsHelper=VertexNormalsHelper,e.SpotLightHelper=SpotLightHelper,e.SkeletonHelper=SkeletonHelper,e.PointLightHelper=PointLightHelper,e.RectAreaLightHelper=RectAreaLightHelper,e.HemisphereLightHelper=HemisphereLightHelper,e.GridHelper=GridHelper,e.PolarGridHelper=PolarGridHelper,e.FaceNormalsHelper=FaceNormalsHelper,e.DirectionalLightHelper=DirectionalLightHelper,e.CameraHelper=CameraHelper,e.BoxHelper=BoxHelper,e.ArrowHelper=ArrowHelper,e.AxisHelper=AxisHelper,e.CatmullRomCurve3=Ut,e.SplineCurve3=Ht,e.CubicBezierCurve3=zt,e.QuadraticBezierCurve3=Gt,e.LineCurve3=Vt,e.ArcCurve=ArcCurve,e.EllipseCurve=EllipseCurve,e.SplineCurve=SplineCurve,e.CubicBezierCurve=CubicBezierCurve,e.QuadraticBezierCurve=QuadraticBezierCurve,e.LineCurve=LineCurve,e.Shape=Shape,e.ShapePath=ShapePath,e.Path=Path,e.Font=Font,e.CurvePath=CurvePath,e.Curve=Curve,e.ShapeUtils=At,e.SceneUtils=jt,e.CurveUtils=Dt,e.WireframeGeometry=WireframeGeometry,e.ParametricGeometry=ParametricGeometry,e.ParametricBufferGeometry=ParametricBufferGeometry,e.TetrahedronGeometry=TetrahedronGeometry,e.TetrahedronBufferGeometry=TetrahedronBufferGeometry,e.OctahedronGeometry=OctahedronGeometry,e.OctahedronBufferGeometry=OctahedronBufferGeometry,e.IcosahedronGeometry=IcosahedronGeometry,e.IcosahedronBufferGeometry=IcosahedronBufferGeometry,e.DodecahedronGeometry=DodecahedronGeometry,e.DodecahedronBufferGeometry=DodecahedronBufferGeometry,e.PolyhedronGeometry=PolyhedronGeometry,e.PolyhedronBufferGeometry=PolyhedronBufferGeometry,e.TubeGeometry=TubeGeometry,e.TubeBufferGeometry=TubeBufferGeometry,e.TorusKnotGeometry=TorusKnotGeometry,e.TorusKnotBufferGeometry=TorusKnotBufferGeometry,e.TorusGeometry=TorusGeometry,e.TorusBufferGeometry=TorusBufferGeometry,e.TextGeometry=TextGeometry,e.SphereBufferGeometry=SphereBufferGeometry,e.SphereGeometry=SphereGeometry,e.RingGeometry=RingGeometry,e.RingBufferGeometry=RingBufferGeometry,e.PlaneBufferGeometry=PlaneBufferGeometry,e.PlaneGeometry=PlaneGeometry,e.LatheGeometry=LatheGeometry,e.LatheBufferGeometry=LatheBufferGeometry,e.ShapeGeometry=ShapeGeometry,e.ShapeBufferGeometry=ShapeBufferGeometry,e.ExtrudeGeometry=ExtrudeGeometry,e.EdgesGeometry=EdgesGeometry,e.ConeGeometry=ConeGeometry,e.ConeBufferGeometry=ConeBufferGeometry,e.CylinderGeometry=CylinderGeometry,e.CylinderBufferGeometry=CylinderBufferGeometry,e.CircleBufferGeometry=CircleBufferGeometry,e.CircleGeometry=CircleGeometry,e.BoxBufferGeometry=BoxBufferGeometry,e.BoxGeometry=BoxGeometry,e.ShadowMaterial=ShadowMaterial,e.SpriteMaterial=SpriteMaterial,e.RawShaderMaterial=RawShaderMaterial,e.ShaderMaterial=ShaderMaterial,e.PointsMaterial=PointsMaterial,e.MultiMaterial=MultiMaterial,e.MeshPhysicalMaterial=MeshPhysicalMaterial,e.MeshStandardMaterial=MeshStandardMaterial,e.MeshPhongMaterial=MeshPhongMaterial,e.MeshToonMaterial=MeshToonMaterial,e.MeshNormalMaterial=MeshNormalMaterial,e.MeshLambertMaterial=MeshLambertMaterial,e.MeshDepthMaterial=MeshDepthMaterial,e.MeshBasicMaterial=MeshBasicMaterial,e.LineDashedMaterial=LineDashedMaterial,e.LineBasicMaterial=LineBasicMaterial,e.Material=Material,e.Float64BufferAttribute=Float64BufferAttribute,e.Float32BufferAttribute=Float32BufferAttribute,e.Uint32BufferAttribute=Uint32BufferAttribute,e.Int32BufferAttribute=Int32BufferAttribute,e.Uint16BufferAttribute=Uint16BufferAttribute,e.Int16BufferAttribute=Int16BufferAttribute,e.Uint8ClampedBufferAttribute=Uint8ClampedBufferAttribute,e.Uint8BufferAttribute=Uint8BufferAttribute,e.Int8BufferAttribute=Int8BufferAttribute,e.BufferAttribute=BufferAttribute,e.REVISION=t,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=i,e.CullFaceBack=r,e.CullFaceFront=n,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=o,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=a,e.PCFSoftShadowMap=s,e.FrontSide=l,e.BackSide=c,e.DoubleSide=u,e.FlatShading=h,e.SmoothShading=d,e.NoColors=p,e.FaceColors=f,e.VertexColors=m,e.NoBlending=g,e.NormalBlending=y,e.AdditiveBlending=b,e.SubtractiveBlending=x,e.MultiplyBlending=w,e.CustomBlending=_,e.BlendingMode=E,e.AddEquation=M,e.SubtractEquation=A,e.ReverseSubtractEquation=T,e.MinEquation=S,e.MaxEquation=P,e.ZeroFactor=C,e.OneFactor=R,e.SrcColorFactor=L,e.OneMinusSrcColorFactor=B,e.SrcAlphaFactor=D,e.OneMinusSrcAlphaFactor=I,e.DstAlphaFactor=O,e.OneMinusDstAlphaFactor=N,e.DstColorFactor=k,e.OneMinusDstColorFactor=F,e.SrcAlphaSaturateFactor=U,e.NeverDepth=H,e.AlwaysDepth=z,e.LessDepth=G,e.LessEqualDepth=V,e.EqualDepth=j,e.GreaterEqualDepth=W,e.GreaterDepth=q,e.NotEqualDepth=X,e.MultiplyOperation=Y,e.MixOperation=$,e.AddOperation=K,e.NoToneMapping=Q,e.LinearToneMapping=Z,e.ReinhardToneMapping=J,e.Uncharted2ToneMapping=ee,e.CineonToneMapping=te,e.UVMapping=300,e.CubeReflectionMapping=ie,e.CubeRefractionMapping=re,e.EquirectangularReflectionMapping=ne,e.EquirectangularRefractionMapping=oe,e.SphericalReflectionMapping=ae,e.CubeUVReflectionMapping=se,e.CubeUVRefractionMapping=le,e.TextureMapping=ce,e.RepeatWrapping=ue,e.ClampToEdgeWrapping=he,e.MirroredRepeatWrapping=de,e.TextureWrapping=pe,e.NearestFilter=fe,e.NearestMipMapNearestFilter=me,e.NearestMipMapLinearFilter=ge,e.LinearFilter=ve,e.LinearMipMapNearestFilter=ye,e.LinearMipMapLinearFilter=be,e.TextureFilter=xe,e.UnsignedByteType=we,e.ByteType=_e,e.ShortType=Ee,e.UnsignedShortType=Me,e.IntType=Ae,e.UnsignedIntType=Te,e.FloatType=Se,e.HalfFloatType=Pe,e.UnsignedShort4444Type=Ce,e.UnsignedShort5551Type=Re,e.UnsignedShort565Type=Le,e.UnsignedInt248Type=Be,e.AlphaFormat=De,e.RGBFormat=Ie,e.RGBAFormat=Oe,e.LuminanceFormat=Ne,e.LuminanceAlphaFormat=ke,e.RGBEFormat=Fe,e.DepthFormat=Ue,e.DepthStencilFormat=He,e.RGB_S3TC_DXT1_Format=ze,e.RGBA_S3TC_DXT1_Format=Ge,e.RGBA_S3TC_DXT3_Format=Ve,e.RGBA_S3TC_DXT5_Format=je,e.RGB_PVRTC_4BPPV1_Format=We,e.RGB_PVRTC_2BPPV1_Format=qe,e.RGBA_PVRTC_4BPPV1_Format=Xe,e.RGBA_PVRTC_2BPPV1_Format=Ye,e.RGB_ETC1_Format=$e,e.LoopOnce=2200,e.LoopRepeat=Ke,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=Qe,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=Ze,e.TriangleStripDrawMode=Je,e.TriangleFanDrawMode=et,e.LinearEncoding=tt,e.sRGBEncoding=it,e.GammaEncoding=rt,e.RGBEEncoding=nt,e.LogLuvEncoding=3003,e.RGBM7Encoding=ot,e.RGBM16Encoding=at,e.RGBDEncoding=st,e.BasicDepthPacking=lt,e.RGBADepthPacking=ct,e.CubeGeometry=BoxGeometry,e.Face4=function Face4(e,t,i,r,n,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(e,t,i,n,o,a)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function MeshFaceMaterial(e){return console.warn("THREE.MeshFaceMaterial has been renamed to THREE.MultiMaterial."),new MultiMaterial(e)},e.PointCloud=function PointCloud(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(e,t)},e.Particle=function Particle(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(e)},e.ParticleSystem=function ParticleSystem(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(e,t)},e.PointCloudMaterial=function PointCloudMaterial(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)},e.ParticleBasicMaterial=function ParticleBasicMaterial(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)},e.ParticleSystemMaterial=function ParticleSystemMaterial(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)},e.Vertex=function Vertex(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(e,t,i)},e.DynamicBufferAttribute=function DynamicBufferAttribute(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new BufferAttribute(e,t).setDynamic(!0)},e.Int8Attribute=function Int8Attribute(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(e,t)},e.Uint8Attribute=function Uint8Attribute(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(e,t)},e.Uint8ClampedAttribute=function Uint8ClampedAttribute(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(e,t)},e.Int16Attribute=function Int16Attribute(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(e,t)},e.Uint16Attribute=function Uint16Attribute(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(e,t)},e.Int32Attribute=function Int32Attribute(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(e,t)},e.Uint32Attribute=function Uint32Attribute(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(e,t)},e.Float32Attribute=function Float32Attribute(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(e,t)},e.Float64Attribute=function Float64Attribute(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(e,t)},e.ClosedSplineCurve3=ClosedSplineCurve3,e.BoundingBoxHelper=function BoundingBoxHelper(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(e,t)},e.EdgesHelper=function EdgesHelper(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))},e.WireframeHelper=function WireframeHelper(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))},e.XHRLoader=function XHRLoader(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(e)},e.GeometryUtils=Wt,e.ImageUtils=qt,e.UniformsUtils=Xt,e.Projector=function Projector(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},e.CanvasRenderer=function CanvasRenderer(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},Object.defineProperty(e,"__esModule",{value:!0})})},765:function(t,i,r){var n;!function(e){t.exports=e()}(function(){return function a(t,i,r){function e(s,l){if(!i[s]){if(!t[s]){if(!l&&("function"==typeof n&&n))return n(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(i){var r=t[s][1][i];return e(r||i)},c,c.exports,a,t,i,r)}return i[s].exports}for(var o="function"==typeof n&&n,s=0;s<r.length;s++)e(r[s]);return e}({1:[function(e,t,i){function Point(e,t,i){if(!(this instanceof Point))return new Point(e,t,i);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var r=e.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=e,this.y=t,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var r=e("mgrs");Point.fromMGRS=function(e){return new Point(r.toPoint(e))},Point.prototype.toMGRS=function(e){return r.forward([this.x,this.y],e)},t.exports=Point},{mgrs:67}],2:[function(e,t,i){function Projection(e,t){if(!(this instanceof Projection))return new Projection(e);t=t||function(e){if(e)throw e};var i=r(e);if("object"==typeof i){var o=a(i),s=Projection.projections.get(o.projName);s?(n(this,o),n(this,s),this.init(),t(null,this)):t(e)}else t(e)}var r=e("./parseCode"),n=e("./extend"),o=e("./projections"),a=e("./deriveConstants");(Projection.projections=o).start(),t.exports=Projection},{"./deriveConstants":33,"./extend":34,"./parseCode":37,"./projections":39}],3:[function(e,t,i){t.exports=function(e,t,i){var r,n,o,a=i.x,s=i.y,l=i.z||0;for(o=0;3>o;o++)if(!t||2!==o||void 0!==i.z)switch(0===o?(r=a,n="x"):1===o?(r=s,n="y"):(r=l,n="z"),e.axis[o]){case"e":i[n]=r;break;case"w":i[n]=-r;break;case"n":i[n]=r;break;case"s":i[n]=-r;break;case"u":void 0!==i[n]&&(i.z=r);break;case"d":void 0!==i[n]&&(i.z=-r);break;default:return null}return i}},{}],4:[function(e,t,i){var r=Math.PI/2,n=e("./sign");t.exports=function(e){return Math.abs(e)<r?e:e-n(e)*Math.PI}},{"./sign":21}],5:[function(e,t,i){var r=2*Math.PI,n=e("./sign");t.exports=function(e){return Math.abs(e)<=3.14159265359?e:e-n(e)*r}},{"./sign":21}],6:[function(e,t,i){t.exports=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}},{}],7:[function(e,t,i){t.exports=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))}},{}],8:[function(e,t,i){t.exports=function(e){return.375*e*(1+.25*e*(1+.46875*e))}},{}],9:[function(e,t,i){t.exports=function(e){return.05859375*e*e*(1+.75*e)}},{}],10:[function(e,t,i){t.exports=function(e){return e*e*e*(35/3072)}},{}],11:[function(e,t,i){t.exports=function(e,t,i){var r=t*i;return e/Math.sqrt(1-r*r)}},{}],12:[function(e,t,i){t.exports=function(e,t,i,r,n){var o,a;o=e/t;for(var s=0;15>s;s++)if(a=(e-(t*o-i*Math.sin(2*o)+r*Math.sin(4*o)-n*Math.sin(6*o)))/(t-2*i*Math.cos(2*o)+4*r*Math.cos(4*o)-6*n*Math.cos(6*o)),o+=a,Math.abs(a)<=1e-10)return o;return NaN}},{}],13:[function(e,t,i){var r=Math.PI/2;t.exports=function(e,t){var i=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-i)<1e-6)return 0>t?-1*r:r;for(var n,o,a,s,l=Math.asin(.5*t),c=0;30>c;c++)if(o=Math.sin(l),a=Math.cos(l),s=e*o,n=Math.pow(1-s*s,2)/(2*a)*(t/(1-e*e)-o/(1-s*s)+.5/e*Math.log((1-s)/(1+s))),l+=n,Math.abs(n)<=1e-10)return l;return NaN}},{}],14:[function(e,t,i){t.exports=function(e,t,i,r,n){return e*n-t*Math.sin(2*n)+i*Math.sin(4*n)-r*Math.sin(6*n)}},{}],15:[function(e,t,i){t.exports=function(e,t,i){var r=e*t;return i/Math.sqrt(1-r*r)}},{}],16:[function(e,t,i){var r=Math.PI/2;t.exports=function(e,t){for(var i,n,o=.5*e,a=r-2*Math.atan(t),s=0;15>=s;s++)if(i=e*Math.sin(a),n=r-2*Math.atan(t*Math.pow((1-i)/(1+i),o))-a,a+=n,Math.abs(n)<=1e-10)return a;return-9999}},{}],17:[function(e,t,i){t.exports=function(e){var t=[];t[0]=1-e*(.25+e*(.046875+e*(.01953125+.01068115234375*e))),t[1]=e*(.75-e*(.046875+e*(.01953125+.01068115234375*e)));var i=e*e;return t[2]=i*(.46875-e*(.013020833333333334+.007120768229166667*e)),i*=e,t[3]=i*(.3645833333333333-.005696614583333333*e),t[4]=i*e*.3076171875,t}},{}],18:[function(e,t,i){var r=e("./pj_mlfn");t.exports=function(e,t,i){for(var n=1/(1-t),o=e,a=20;a;--a){var s=Math.sin(o),l=1-t*s*s;if(l=(r(o,s,Math.cos(o),i)-e)*(l*Math.sqrt(l))*n,o-=l,Math.abs(l)<1e-10)return o}return o}},{"./pj_mlfn":19}],19:[function(e,t,i){t.exports=function(e,t,i,r){return i*=t,t*=t,r[0]*e-i*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))}},{}],20:[function(e,t,i){t.exports=function(e,t){var i;return e>1e-7?(i=e*t,(1-e*e)*(t/(1-i*i)-.5/e*Math.log((1-i)/(1+i)))):2*t}},{}],21:[function(e,t,i){t.exports=function(e){return 0>e?-1:1}},{}],22:[function(e,t,i){t.exports=function(e,t){return Math.pow((1-e)/(1+e),t)}},{}],23:[function(e,t,i){t.exports=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}},{}],24:[function(e,t,i){var r=Math.PI/2;t.exports=function(e,t,i){var n=e*i,o=.5*e;return n=Math.pow((1-n)/(1+n),o),Math.tan(.5*(r-t))/n}},{}],25:[function(e,t,i){i.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},i.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},i.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},i.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},i.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},i.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},i.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},i.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},i.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},i.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},i.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},i.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},i.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},i.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},i.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},i.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},{}],26:[function(e,t,i){i.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},i.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},i.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},i.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},i.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},i.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},i.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},i.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},i.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},i.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},i.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},i.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},i.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},i.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},i.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},i.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},i.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},i.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},i.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},i.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},i.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},i.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},i.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},i.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},i.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},i.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},i.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},i.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},i.hough={a:6378270,rf:297,ellipseName:"Hough"},i.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},i.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},i.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},i.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},i.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},i.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},i.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},i.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},i.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},i.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},i.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},i.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"},i.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"},i.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},{}],27:[function(e,t,i){i.greenwich=0,i.lisbon=-9.131906111111,i.paris=2.337229166667,i.bogota=-74.080916666667,i.madrid=-3.687938888889,i.rome=12.452333333333,i.bern=7.439583333333,i.jakarta=106.807719444444,i.ferro=-17.666666666667,i.brussels=4.367975,i.stockholm=18.058277777778,i.athens=23.7163375,i.oslo=10.722916666667},{}],28:[function(e,t,i){i.ft={to_meter:.3048},i["us-ft"]={to_meter:1200/3937}},{}],29:[function(t,i,r){function d(e,t,i){var r;return Array.isArray(i)?(r=o(e,t,i),3===i.length?[r.x,r.y,r.z]:[r.x,r.y]):o(e,t,i)}function e(e){return e instanceof n?e:e.oProj?e.oProj:n(e)}var n=t("./Proj"),o=t("./transform"),a=n("WGS84");i.exports=function proj4(t,i,r){t=e(t);var n,o=!1;return void 0===i?(i=t,t=a,o=!0):(void 0!==i.x||Array.isArray(i))&&(r=i,i=t,t=a,o=!0),i=e(i),r?d(t,i,r):(n={forward:function(e){return d(t,i,e)},inverse:function(e){return d(i,t,e)}},o&&(n.oProj=i),n)}},{"./Proj":2,"./transform":65}],30:[function(e,t,i){var r=Math.PI/2,n=484813681109536e-20,o=function(e){return this instanceof o?(this.datum_type=4,void(e&&(e.datumCode&&"none"===e.datumCode&&(this.datum_type=5),e.datum_params&&(this.datum_params=e.datum_params.map(parseFloat),(0!==this.datum_params[0]||0!==this.datum_params[1]||0!==this.datum_params[2])&&(this.datum_type=1),this.datum_params.length>3&&(0!==this.datum_params[3]||0!==this.datum_params[4]||0!==this.datum_params[5]||0!==this.datum_params[6])&&(this.datum_type=2,this.datum_params[3]*=n,this.datum_params[4]*=n,this.datum_params[5]*=n,this.datum_params[6]=this.datum_params[6]/1e6+1)),this.datum_type=e.grids?3:this.datum_type,this.a=e.a,this.b=e.b,this.es=e.es,this.ep2=e.ep2,3===this.datum_type&&(this.grids=e.grids)))):new o(e)};o.prototype={compare_datums:function(e){return this.datum_type===e.datum_type&&(!(this.a!==e.a||Math.abs(this.es-e.es)>5e-11)&&(1===this.datum_type?this.datum_params[0]===e.datum_params[0]&&this.datum_params[1]===e.datum_params[1]&&this.datum_params[2]===e.datum_params[2]:2===this.datum_type?this.datum_params[0]===e.datum_params[0]&&this.datum_params[1]===e.datum_params[1]&&this.datum_params[2]===e.datum_params[2]&&this.datum_params[3]===e.datum_params[3]&&this.datum_params[4]===e.datum_params[4]&&this.datum_params[5]===e.datum_params[5]&&this.datum_params[6]===e.datum_params[6]:3!==this.datum_type&&3!==e.datum_type||this.nadgrids===e.nadgrids))},geodetic_to_geocentric:function(e){var t,i,n,o,a,s,l,c=e.x,u=e.y,h=e.z?e.z:0;if(-r>u&&u>-1.001*r)u=-r;else if(u>r&&1.001*r>u)u=r;else if(-r>u||u>r)return null;return c>Math.PI&&(c-=2*Math.PI),a=Math.sin(u),l=Math.cos(u),s=a*a,o=this.a/Math.sqrt(1-this.es*s),t=(o+h)*l*Math.cos(c),i=(o+h)*l*Math.sin(c),n=(o*(1-this.es)+h)*a,e.x=t,e.y=i,e.z=n,0},geocentric_to_geodetic:function(e){var t,i,n,o,a,s,l,c,u,h,d,p,f,m,g,v,y=e.x,b=e.y,x=e.z?e.z:0;if(!1,t=Math.sqrt(y*y+b*b),i=Math.sqrt(y*y+b*b+x*x),t/this.a<1e-12){if(!0,m=0,i/this.a<1e-12)return g=r,void(v=-this.b)}else m=Math.atan2(b,y);n=x/i,o=t/i,a=1/Math.sqrt(1-this.es*(2-this.es)*o*o),c=o*(1-this.es)*a,u=n*a,f=0;do{f++,l=this.a/Math.sqrt(1-this.es*u*u),v=t*c+x*u-l*(1-this.es*u*u),s=this.es*l/(l+v),a=1/Math.sqrt(1-s*(2-s)*o*o),h=o*(1-s)*a,d=n*a,p=d*c-h*u,c=h,u=d}while(p*p>1e-24&&30>f);return g=Math.atan(d/Math.abs(h)),e.x=m,e.y=g,e.z=v,e},geocentric_to_geodetic_noniter:function(e){var t,i,n,o,a,s,l,c,u,h,d,p,f,m,g,v,y,b=e.x,x=e.y,w=e.z?e.z:0;if(b=parseFloat(b),x=parseFloat(x),w=parseFloat(w),y=!1,0!==b)t=Math.atan2(x,b);else if(x>0)t=r;else if(0>x)t=-r;else if(y=!0,t=0,w>0)i=r;else{if(!(0>w))return i=r,void(n=-this.b);i=-r}return a=b*b+x*x,o=Math.sqrt(a),s=1.0026*w,c=Math.sqrt(s*s+a),h=s/c,p=o/c,d=h*h*h,l=w+this.b*this.ep2*d,v=o-this.a*this.es*p*p*p,u=Math.sqrt(l*l+v*v),f=l/u,m=v/u,g=this.a/Math.sqrt(1-this.es*f*f),n=m>=.3826834323650898?o/m-g:-.3826834323650898>=m?o/-m-g:w/f+g*(this.es-1),!1===y&&(i=Math.atan(f/m)),e.x=t,e.y=i,e.z=n,e},geocentric_to_wgs84:function(e){if(1===this.datum_type)e.x+=this.datum_params[0],e.y+=this.datum_params[1],e.z+=this.datum_params[2];else if(2===this.datum_type){var t=this.datum_params[0],i=this.datum_params[1],r=this.datum_params[2],n=this.datum_params[3],o=this.datum_params[4],a=this.datum_params[5],s=this.datum_params[6],l=s*(e.x-a*e.y+o*e.z)+t,c=s*(a*e.x+e.y-n*e.z)+i,u=s*(-o*e.x+n*e.y+e.z)+r;e.x=l,e.y=c,e.z=u}},geocentric_from_wgs84:function(e){if(1===this.datum_type)e.x-=this.datum_params[0],e.y-=this.datum_params[1],e.z-=this.datum_params[2];else if(2===this.datum_type){var t=this.datum_params[0],i=this.datum_params[1],r=this.datum_params[2],n=this.datum_params[3],o=this.datum_params[4],a=this.datum_params[5],s=this.datum_params[6],l=(e.x-t)/s,c=(e.y-i)/s,u=(e.z-r)/s;e.x=l+a*c-o*u,e.y=-a*l+c+n*u,e.z=o*l-n*c+u}}},t.exports=o},{}],31:[function(e,t,i){var r=1,n=2;t.exports=function(e,t,i){function j(e){return e===r||e===n}var o,a,s;if(e.compare_datums(t))return i;if(5===e.datum_type||5===t.datum_type)return i;var l=e.a,c=e.es,u=t.a,h=t.es,d=e.datum_type;if(3===d)if(0===this.apply_gridshift(e,0,i))e.a=6378137,e.es=.006694379990141316;else{if(!e.datum_params)return e.a=l,e.es=e.es,i;for(o=1,a=0,s=e.datum_params.length;s>a;a++)o*=e.datum_params[a];if(0===o)return e.a=l,e.es=e.es,i;d=e.datum_params.length>3?n:r}return 3===t.datum_type&&(t.a=6378137,t.es=.006694379990141316),(e.es!==t.es||e.a!==t.a||j(d)||j(t.datum_type))&&(e.geodetic_to_geocentric(i),j(e.datum_type)&&e.geocentric_to_wgs84(i),j(t.datum_type)&&t.geocentric_from_wgs84(i),t.geocentric_to_geodetic(i)),3===t.datum_type&&this.apply_gridshift(t,1,i),e.a=l,e.es=c,t.a=u,t.es=h,i}},{}],32:[function(e,t,i){function d(e){var t=this;if(2===arguments.length){var i=arguments[1];d[e]="string"==typeof i?"+"===i.charAt(0)?n(arguments[1]):o(arguments[1]):i}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?d.apply(t,e):d(e)});if("string"==typeof e){if(e in d)return d[e]}else"EPSG"in e?d["EPSG:"+e.EPSG]=e:"ESRI"in e?d["ESRI:"+e.ESRI]=e:"IAU2000"in e?d["IAU2000:"+e.IAU2000]=e:console.log(e);return}}var r=e("./global"),n=e("./projString"),o=e("./wkt");r(d),t.exports=d},{"./global":35,"./projString":38,"./wkt":66}],33:[function(e,t,i){var r=e("./constants/Datum"),n=e("./constants/Ellipsoid"),o=e("./extend"),a=e("./datum");t.exports=function(e){if(e.datumCode&&"none"!==e.datumCode){var t=r[e.datumCode];t&&(e.datum_params=t.towgs84?t.towgs84.split(","):null,e.ellps=t.ellipse,e.datumName=t.datumName?t.datumName:e.datumCode)}if(!e.a){var i=n[e.ellps]?n[e.ellps]:n.WGS84;o(e,i)}return e.rf&&!e.b&&(e.b=(1-1/e.rf)*e.a),(0===e.rf||Math.abs(e.a-e.b)<1e-10)&&(e.sphere=!0,e.b=e.a),e.a2=e.a*e.a,e.b2=e.b*e.b,e.es=(e.a2-e.b2)/e.a2,e.e=Math.sqrt(e.es),e.R_A&&(e.a*=1-e.es*(.16666666666666666+e.es*(.04722222222222222+.022156084656084655*e.es)),e.a2=e.a*e.a,e.b2=e.b*e.b,e.es=0),e.ep2=(e.a2-e.b2)/e.b2,e.k0||(e.k0=1),e.axis||(e.axis="enu"),e.datum||(e.datum=a(e)),e}},{"./constants/Datum":25,"./constants/Ellipsoid":26,"./datum":30,"./extend":34}],34:[function(e,t,i){t.exports=function(e,t){e=e||{};var i,r;if(!t)return e;for(r in t)void 0!==(i=t[r])&&(e[r]=i);return e}},{}],35:[function(e,t,i){t.exports=function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}},{}],36:[function(e,t,i){var r=e("./core");r.defaultDatum="WGS84",r.Proj=e("./Proj"),r.WGS84=new r.Proj("WGS84"),r.Point=e("./Point"),r.toPoint=e("./common/toPoint"),r.defs=e("./defs"),r.transform=e("./transform"),r.mgrs=e("mgrs"),r.version=e("../package.json").version,e("./includedProjections")(r),t.exports=r},{"../package.json":68,"./Point":1,"./Proj":2,"./common/toPoint":23,"./core":29,"./defs":32,"./includedProjections":"hTEDpn","./transform":65,mgrs:67}],37:[function(t,i,r){var n=t("./defs"),o=t("./wkt"),a=t("./projString");i.exports=function h(t){return function d(e){return"string"==typeof e}(t)?function e(t){return t in n}(t)?n[t]:function f(e){return["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"].reduce(function(t,i){return t+1+e.indexOf(i)},0)}(t)?o(t):function g(e){return"+"===e[0]}(t)?a(t):void 0:t}},{"./defs":32,"./projString":38,"./wkt":66}],38:[function(e,t,i){var r=.017453292519943295,n=e("./constants/PrimeMeridian"),o=e("./constants/units");t.exports=function(e){var t={},i={};e.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).forEach(function(e){var t=e.split("=");t.push(!0),i[t[0].toLowerCase()]=t[1]});var a,s,l,c={proj:"projName",datum:"datumCode",rf:function(e){t.rf=parseFloat(e)},lat_0:function(e){t.lat0=e*r},lat_1:function(e){t.lat1=e*r},lat_2:function(e){t.lat2=e*r},lat_ts:function(e){t.lat_ts=e*r},lon_0:function(e){t.long0=e*r},lon_1:function(e){t.long1=e*r},lon_2:function(e){t.long2=e*r},alpha:function(e){t.alpha=parseFloat(e)*r},lonc:function(e){t.longc=e*r},x_0:function(e){t.x0=parseFloat(e)},y_0:function(e){t.y0=parseFloat(e)},k_0:function(e){t.k0=parseFloat(e)},k:function(e){t.k0=parseFloat(e)},a:function(e){t.a=parseFloat(e)},b:function(e){t.b=parseFloat(e)},r_a:function(){t.R_A=!0},zone:function(e){t.zone=parseInt(e,10)},south:function(){t.utmSouth=!0},towgs84:function(e){t.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){t.to_meter=parseFloat(e)},units:function(e){t.units=e,o[e]&&(t.to_meter=o[e].to_meter)},from_greenwich:function(e){t.from_greenwich=e*r},pm:function(e){t.from_greenwich=(n[e]?n[e]:parseFloat(e))*r},nadgrids:function(e){"@null"===e?t.datumCode="none":t.nadgrids=e},axis:function(e){3===e.length&&-1!=="ewnsud".indexOf(e.substr(0,1))&&-1!=="ewnsud".indexOf(e.substr(1,1))&&-1!=="ewnsud".indexOf(e.substr(2,1))&&(t.axis=e)}};for(a in i)s=i[a],a in c?"function"==typeof(l=c[a])?l(s):t[l]=s:t[a]=s;return"string"==typeof t.datumCode&&"WGS84"!==t.datumCode&&(t.datumCode=t.datumCode.toLowerCase()),t}},{"./constants/PrimeMeridian":27,"./constants/units":28}],39:[function(e,t,i){function d(e,t){var i=o.length;return e.names?(o[i]=e,e.names.forEach(function(e){n[e.toLowerCase()]=i}),this):(console.log(t),!0)}var r=[e("./projections/merc"),e("./projections/longlat")],n={},o=[];i.add=d,i.get=function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==n[t]&&o[n[t]]?o[n[t]]:void 0},i.start=function(){r.forEach(d)}},{"./projections/longlat":51,"./projections/merc":52}],40:[function(e,t,i){var r=e("../common/msfnz"),n=e("../common/qsfnz"),o=e("../common/adjust_lon"),a=e("../common/asinz");i.init=function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=r(this.e3,this.sin_po,this.cos_po),this.qs1=n(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=r(this.e3,this.sin_po,this.cos_po),this.qs2=n(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=n(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>1e-10?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},i.forward=function(e){var t=e.x,i=e.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var r=n(this.e3,this.sin_phi,this.cos_phi),a=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,s=this.ns0*o(t-this.long0),l=a*Math.sin(s)+this.x0,c=this.rh-a*Math.cos(s)+this.y0;return e.x=l,e.y=c,e},i.inverse=function(e){var t,i,r,n,a,s;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1),n=0,0!==t&&(n=Math.atan2(r*e.x,r*e.y)),r=t*this.ns0/this.a,this.sphere?s=Math.asin((this.c-r*r)/(2*this.ns0)):(i=(this.c-r*r)/this.ns0,s=this.phi1z(this.e3,i)),a=o(n/this.ns0+this.long0),e.x=a,e.y=s,e},i.phi1z=function(e,t){var i,r,n,o,s,l=a(.5*t);if(1e-10>e)return l;for(var c=e*e,u=1;25>=u;u++)if(i=Math.sin(l),r=Math.cos(l),n=e*i,o=1-n*n,s=.5*o*o/r*(t/(1-c)-i/o+.5/e*Math.log((1-n)/(1+n))),l+=s,Math.abs(s)<=1e-7)return l;return null},i.names=["Albers_Conic_Equal_Area","Albers","aea"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/msfnz":15,"../common/qsfnz":20}],41:[function(e,t,i){var r=e("../common/adjust_lon"),n=Math.PI/2,o=e("../common/mlfn"),a=e("../common/e0fn"),s=e("../common/e1fn"),l=e("../common/e2fn"),c=e("../common/e3fn"),u=e("../common/gN"),h=e("../common/asinz"),d=e("../common/imlfn");i.init=function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},i.forward=function(e){var t,i,h,d,p,f,m,g,v,y,b,x,w,_,E,M,A,T,S,P,C,R,L,B=e.x,D=e.y,I=Math.sin(e.y),O=Math.cos(e.y),N=r(B-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=1e-10?(e.x=this.x0+this.a*(n-D)*Math.sin(N),e.y=this.y0-this.a*(n-D)*Math.cos(N),e):Math.abs(this.sin_p12+1)<=1e-10?(e.x=this.x0+this.a*(n+D)*Math.sin(N),e.y=this.y0+this.a*(n+D)*Math.cos(N),e):(T=this.sin_p12*I+this.cos_p12*O*Math.cos(N),M=Math.acos(T),A=M/Math.sin(M),e.x=this.x0+this.a*A*O*Math.sin(N),e.y=this.y0+this.a*A*(this.cos_p12*I-this.sin_p12*O*Math.cos(N)),e):(t=a(this.es),i=s(this.es),h=l(this.es),d=c(this.es),Math.abs(this.sin_p12-1)<=1e-10?(p=this.a*o(t,i,h,d,n),f=this.a*o(t,i,h,d,D),e.x=this.x0+(p-f)*Math.sin(N),e.y=this.y0-(p-f)*Math.cos(N),e):Math.abs(this.sin_p12+1)<=1e-10?(p=this.a*o(t,i,h,d,n),f=this.a*o(t,i,h,d,D),e.x=this.x0+(p+f)*Math.sin(N),e.y=this.y0+(p+f)*Math.cos(N),e):(m=I/O,g=u(this.a,this.e,this.sin_p12),v=u(this.a,this.e,I),y=Math.atan((1-this.es)*m+this.es*g*this.sin_p12/(v*O)),b=Math.atan2(Math.sin(N),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(N)),S=0===b?Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(b)-Math.PI)<=1e-10?-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.asin(Math.sin(N)*Math.cos(y)/Math.sin(b)),x=this.e*this.sin_p12/Math.sqrt(1-this.es),w=this.e*this.cos_p12*Math.cos(b)/Math.sqrt(1-this.es),_=x*w,E=w*w,P=S*S,C=P*S,R=C*S,L=R*S,M=g*S*(1-P*E*(1-E)/6+C/8*_*(1-2*E)+R/120*(E*(4-7*E)-3*x*x*(1-7*E))-L/48*_),e.x=this.x0+M*Math.sin(b),e.y=this.y0+M*Math.cos(b),e))},i.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t,i,p,f,m,g,v,y,b,x,w,_,E,M,A,T,S,P,C,R,L,B,D;if(this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*n*this.a)return;return i=t/this.a,p=Math.sin(i),f=Math.cos(i),m=this.long0,Math.abs(t)<=1e-10?g=this.lat0:(g=h(f*this.sin_p12+e.y*p*this.cos_p12/t),v=Math.abs(this.lat0)-n,m=r(Math.abs(v)<=1e-10?this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y):this.long0+Math.atan2(e.x*p,t*this.cos_p12*f-e.y*this.sin_p12*p))),e.x=m,e.y=g,e}return y=a(this.es),b=s(this.es),x=l(this.es),w=c(this.es),Math.abs(this.sin_p12-1)<=1e-10?(_=this.a*o(y,b,x,w,n),t=Math.sqrt(e.x*e.x+e.y*e.y),E=_-t,g=d(E/this.a,y,b,x,w),m=r(this.long0+Math.atan2(e.x,-1*e.y)),e.x=m,e.y=g,e):Math.abs(this.sin_p12+1)<=1e-10?(_=this.a*o(y,b,x,w,n),t=Math.sqrt(e.x*e.x+e.y*e.y),E=t-_,g=d(E/this.a,y,b,x,w),m=r(this.long0+Math.atan2(e.x,e.y)),e.x=m,e.y=g,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),T=Math.atan2(e.x,e.y),M=u(this.a,this.e,this.sin_p12),S=Math.cos(T),P=this.e*this.cos_p12*S,C=-P*P/(1-this.es),R=3*this.es*(1-C)*this.sin_p12*this.cos_p12*S/(1-this.es),L=t/M,B=L-C*(1+C)*Math.pow(L,3)/6-R*(1+3*C)*Math.pow(L,4)/24,D=1-C*B*B/2-L*B*B*B/6,A=Math.asin(this.sin_p12*Math.cos(B)+this.cos_p12*Math.sin(B)*S),m=r(this.long0+Math.asin(Math.sin(T)*Math.sin(B)/Math.cos(A))),g=Math.atan((1-this.es*D*this.sin_p12/Math.sin(A))*Math.tan(A)/(1-this.es)),e.x=m,e.y=g,e)},i.names=["Azimuthal_Equidistant","aeqd"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],42:[function(e,t,i){var r=e("../common/mlfn"),n=e("../common/e0fn"),o=e("../common/e1fn"),a=e("../common/e2fn"),s=e("../common/e3fn"),l=e("../common/gN"),c=e("../common/adjust_lon"),u=e("../common/adjust_lat"),h=e("../common/imlfn"),d=Math.PI/2;i.init=function(){this.sphere||(this.e0=n(this.es),this.e1=o(this.es),this.e2=a(this.es),this.e3=s(this.es),this.ml0=this.a*r(this.e0,this.e1,this.e2,this.e3,this.lat0))},i.forward=function(e){var t,i,n=e.x,o=e.y;if(n=c(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(o)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(o),Math.cos(n))-this.lat0);else{var a=Math.sin(o),s=Math.cos(o),u=l(this.a,this.e,a),h=Math.tan(o)*Math.tan(o),d=n*Math.cos(o),p=d*d,f=this.es*s*s/(1-this.es);t=u*d*(1-p*h*(1/6-(8-h+8*f)*p/120)),i=this.a*r(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+u*a/s*p*(.5+(5-h+6*f)*p/24)}return e.x=t+this.x0,e.y=i+this.y0,e},i.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t,i,r=e.x/this.a,n=e.y/this.a;if(this.sphere){var o=n+this.lat0;t=Math.asin(Math.sin(o)*Math.cos(r)),i=Math.atan2(Math.tan(r),Math.cos(o))}else{var a=this.ml0/this.a+n,s=h(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-d)<=1e-10)return e.x=this.long0,e.y=d,0>n&&(e.y*=-1),e;var p=l(this.a,this.e,Math.sin(s)),f=p*p*p/this.a/this.a*(1-this.es),m=Math.pow(Math.tan(s),2),g=r*this.a/p,v=g*g;t=s-p*Math.tan(s)/f*g*g*(.5-(1+3*m)*g*g/24),i=g*(1-v*(m/3+(1+3*m)*m*v/15))/Math.cos(s)}return e.x=c(i+this.long0),e.y=u(t),e},i.names=["Cassini","Cassini_Soldner","cass"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],43:[function(e,t,i){var r=e("../common/adjust_lon"),n=e("../common/qsfnz"),o=e("../common/msfnz"),a=e("../common/iqsfnz");i.init=function(){this.sphere||(this.k0=o(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},i.forward=function(e){var t,i,o=e.x,a=e.y,s=r(o-this.long0);if(this.sphere)t=this.x0+this.a*s*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var l=n(this.e,Math.sin(a));t=this.x0+this.a*this.k0*s,i=this.y0+this.a*l*.5/this.k0}return e.x=t,e.y=i,e},i.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t,i;return this.sphere?(t=r(this.long0+e.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(i=a(this.e,2*e.y*this.k0/this.a),t=r(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=i,e},i.names=["cea"]},{"../common/adjust_lon":5,"../common/iqsfnz":13,"../common/msfnz":15,"../common/qsfnz":20}],44:[function(e,t,i){var r=e("../common/adjust_lon"),n=e("../common/adjust_lat");i.init=function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},i.forward=function(e){var t=e.x,i=e.y,o=r(t-this.long0),a=n(i-this.lat0);return e.x=this.x0+this.a*o*this.rc,e.y=this.y0+this.a*a,e},i.inverse=function(e){var t=e.x,i=e.y;return e.x=r(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=n(this.lat0+(i-this.y0)/this.a),e},i.names=["Equirectangular","Equidistant_Cylindrical","eqc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5}],45:[function(e,t,i){var r=e("../common/e0fn"),n=e("../common/e1fn"),o=e("../common/e2fn"),a=e("../common/e3fn"),s=e("../common/msfnz"),l=e("../common/mlfn"),c=e("../common/adjust_lon"),u=e("../common/adjust_lat"),h=e("../common/imlfn");i.init=function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=n(this.es),this.e2=o(this.es),this.e3=a(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=s(this.e,this.sinphi,this.cosphi),this.ml1=l(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<1e-10?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=s(this.e,this.sinphi,this.cosphi),this.ml2=l(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=l(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},i.forward=function(e){var t,i=e.x,r=e.y;if(this.sphere)t=this.a*(this.g-r);else{var n=l(this.e0,this.e1,this.e2,this.e3,r);t=this.a*(this.g-n)}var o=this.ns*c(i-this.long0),a=this.x0+t*Math.sin(o),s=this.y0+this.rh-t*Math.cos(o);return e.x=a,e.y=s,e},i.inverse=function(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,i,r,n;this.ns>=0?(i=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(i=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var o=0;if(0!==i&&(o=Math.atan2(t*e.x,t*e.y)),this.sphere)return n=c(this.long0+o/this.ns),r=u(this.g-i/this.a),e.x=n,e.y=r,e;var a=this.g-i/this.a;return r=h(a,this.e0,this.e1,this.e2,this.e3),n=c(this.long0+o/this.ns),e.x=n,e.y=r,e},i.names=["Equidistant_Conic","eqdc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/imlfn":12,"../common/mlfn":14,"../common/msfnz":15}],46:[function(e,t,i){var r=Math.PI/4,n=e("../common/srat"),o=Math.PI/2;i.init=function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+r)/(Math.pow(Math.tan(.5*this.lat0+r),this.C)*n(this.e*e,this.ratexp))},i.forward=function(e){var t=e.x,i=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+r),this.C)*n(this.e*Math.sin(i),this.ratexp))-o,e.x=this.C*t,e},i.inverse=function(e){for(var t=e.x/this.C,i=e.y,a=Math.pow(Math.tan(.5*i+r)/this.K,1/this.C),s=20;s>0&&(i=2*Math.atan(a*n(this.e*Math.sin(e.y),-.5*this.e))-o,!(Math.abs(i-e.y)<1e-14));--s)e.y=i;return s?(e.x=t,e.y=i,e):null},i.names=["gauss"]},{"../common/srat":22}],47:[function(e,t,i){var r=e("../common/adjust_lon"),n=e("../common/asinz");i.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},i.forward=function(e){var t,i,n,o,a,s,l,c=e.x,u=e.y;return n=r(c-this.long0),t=Math.sin(u),i=Math.cos(u),o=Math.cos(n),a=this.sin_p14*t+this.cos_p14*i*o,1,a>0||Math.abs(a)<=1e-10?(s=this.x0+1*this.a*i*Math.sin(n)/a,l=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*i*o)/a):(s=this.x0+this.infinity_dist*i*Math.sin(n),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*i*o)),e.x=s,e.y=l,e},i.inverse=function(e){var t,i,o,a,s,l;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(a=Math.atan2(t,this.rc),i=Math.sin(a),o=Math.cos(a),l=n(o*this.sin_p14+e.y*i*this.cos_p14/t),s=Math.atan2(e.x*i,t*this.cos_p14*o-e.y*this.sin_p14*i),s=r(this.long0+s)):(l=this.phic0,s=0),e.x=s,e.y=l,e},i.names=["gnom"]},{"../common/adjust_lon":5,"../common/asinz":6}],48:[function(e,t,i){var r=e("../common/adjust_lon");i.init=function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},i.forward=function(e){var t,i,n,o,a,s,l,c=e.x,u=e.y,h=r(c-this.long0);return t=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/t)-this.s45),n=-h*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),a=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(o)),s=this.n*a,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),e.y=l*Math.cos(s)/1,e.x=l*Math.sin(s)/1,this.czech||(e.y*=-1,e.x*=-1),e},i.inverse=function(e){var t,i,r,n,o,a,s,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),o=Math.sqrt(e.x*e.x+e.y*e.y),n=Math.atan2(e.y,e.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),i=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(t)),e.x=this.long0-i/this.alfa,a=t,s=0;var c=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-e.y)<1e-10&&(s=1),a=e.y,c+=1}while(0===s&&15>c);return c>=15?null:e},i.names=["Krovak","krovak"]},{"../common/adjust_lon":5}],49:[function(e,t,i){var r=Math.PI/2,n=Math.PI/4,o=e("../common/qsfnz"),a=e("../common/adjust_lon");i.S_POLE=1,i.N_POLE=2,i.EQUIT=3,i.OBLIQ=4,i.init=function(){var e=Math.abs(this.lat0);if(Math.abs(e-r)<1e-10?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<1e-10?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=o(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=o(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},i.forward=function(e){var t,i,s,l,c,u,h,d,p,f,m=e.x,g=e.y;if(m=a(m-this.long0),this.sphere){if(c=Math.sin(g),f=Math.cos(g),s=Math.cos(m),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(1e-10>=(i=this.mode===this.EQUIT?1+f*s:1+this.sinph0*c+this.cosph0*f*s))return null;t=(i=Math.sqrt(2/i))*f*Math.sin(m),i*=this.mode===this.EQUIT?c:this.cosph0*c-this.sinph0*f*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(g+this.phi0)<1e-10)return null;i=n-.5*g,t=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(m),i*=s}}else{switch(h=0,d=0,p=0,s=Math.cos(m),l=Math.sin(m),c=Math.sin(g),u=o(this.e,c),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(h=u/this.qp,d=Math.sqrt(1-h*h)),this.mode){case this.OBLIQ:p=1+this.sinb1*h+this.cosb1*d*s;break;case this.EQUIT:p=1+d*s;break;case this.N_POLE:p=r+g,u=this.qp-u;break;case this.S_POLE:p=g-r,u=this.qp+u}if(Math.abs(p)<1e-10)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p),i=this.mode===this.OBLIQ?this.ymf*p*(this.cosb1*h-this.sinb1*d*s):(p=Math.sqrt(2/(1+d*s)))*h*this.ymf,t=this.xmf*p*d*l;break;case this.N_POLE:case this.S_POLE:u>=0?(t=(p=Math.sqrt(u))*l,i=s*(this.mode===this.S_POLE?p:-p)):t=i=0}}return e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e},i.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t,i,n,o,s,l,c,u=e.x/this.a,h=e.y/this.a;if(this.sphere){var d,p=0,f=0;if(d=Math.sqrt(u*u+h*h),(i=.5*d)>1)return null;switch(i=2*Math.asin(i),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sin(i),p=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(d)<=1e-10?0:Math.asin(h*f/d),u*=f,h=p*d;break;case this.OBLIQ:i=Math.abs(d)<=1e-10?this.phi0:Math.asin(p*this.sinph0+h*f*this.cosph0/d),u*=f*this.cosph0,h=(p-Math.sin(i)*this.sinph0)*d;break;case this.N_POLE:h=-h,i=r-i;break;case this.S_POLE:i-=r}t=0!==h||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,h):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,h*=this.dd,1e-10>(l=Math.sqrt(u*u+h*h)))return e.x=0,e.y=this.phi0,e;o=2*Math.asin(.5*l/this.rq),n=Math.cos(o),u*=o=Math.sin(o),this.mode===this.OBLIQ?(c=n*this.sinb1+h*o*this.cosb1/l,s=this.qp*c,h=l*this.cosb1*n-h*this.sinb1*o):(c=h*o/l,s=this.qp*c,h=l*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(h=-h),!(s=u*u+h*h))return e.x=0,e.y=this.phi0,e;c=1-s/this.qp,this.mode===this.S_POLE&&(c=-c)}t=Math.atan2(u,h),i=this.authlat(Math.asin(c),this.apa)}return e.x=a(this.long0+t),e.y=i,e},i.P00=.3333333333333333,i.P01=.17222222222222222,i.P02=.10257936507936508,i.P10=.06388888888888888,i.P11=.0664021164021164,i.P20=.016415012942191543,i.authset=function(e){var t,i=[];return i[0]=e*this.P00,t=e*e,i[0]+=t*this.P01,i[1]=t*this.P10,t*=e,i[0]+=t*this.P02,i[1]+=t*this.P11,i[2]=t*this.P20,i},i.authlat=function(e,t){var i=e+e;return e+t[0]*Math.sin(i)+t[1]*Math.sin(i+i)+t[2]*Math.sin(i+i+i)},i.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"]},{"../common/adjust_lon":5,"../common/qsfnz":20}],50:[function(e,t,i){var r=e("../common/msfnz"),n=e("../common/tsfnz"),o=Math.PI/2,a=e("../common/sign"),s=e("../common/adjust_lon"),l=e("../common/phi2z");i.init=function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<1e-10)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),i=Math.cos(this.lat1),o=r(this.e,t,i),a=n(this.e,this.lat1,t),s=Math.sin(this.lat2),l=Math.cos(this.lat2),c=r(this.e,s,l),u=n(this.e,this.lat2,s),h=n(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>1e-10?this.ns=Math.log(o/c)/Math.log(a/u):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=o/(this.ns*Math.pow(a,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}},i.forward=function(e){var t=e.x,i=e.y;Math.abs(2*Math.abs(i)-Math.PI)<=1e-10&&(i=a(i)*(o-2e-10));var r,l,c=Math.abs(Math.abs(i)-o);if(c>1e-10)r=n(this.e,i,Math.sin(i)),l=this.a*this.f0*Math.pow(r,this.ns);else{if(0>=(c=i*this.ns))return null;l=0}var u=this.ns*s(t-this.long0);return e.x=this.k0*(l*Math.sin(u))+this.x0,e.y=this.k0*(this.rh-l*Math.cos(u))+this.y0,e},i.inverse=function(e){var t,i,r,n,a,c=(e.x-this.x0)/this.k0,u=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(c*c+u*u),i=1):(t=-Math.sqrt(c*c+u*u),i=-1);var h=0;if(0!==t&&(h=Math.atan2(i*c,i*u)),0!==t||this.ns>0){if(i=1/this.ns,r=Math.pow(t/(this.a*this.f0),i),-9999===(n=l(this.e,r)))return null}else n=-o;return a=s(h/this.ns+this.long0),e.x=a,e.y=n,e},i.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],51:[function(e,t,i){function d(e){return e}i.init=function(){},i.forward=d,i.inverse=d,i.names=["longlat","identity"]},{}],52:[function(e,t,i){var r=e("../common/msfnz"),n=Math.PI/2,o=57.29577951308232,a=e("../common/adjust_lon"),s=Math.PI/4,l=e("../common/tsfnz"),c=e("../common/phi2z");i.init=function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},i.forward=function(e){var t=e.x,i=e.y;if(i*o>90&&-90>i*o&&t*o>180&&-180>t*o)return null;var r,c;if(Math.abs(Math.abs(i)-n)<=1e-10)return null;if(this.sphere)r=this.x0+this.a*this.k0*a(t-this.long0),c=this.y0+this.a*this.k0*Math.log(Math.tan(s+.5*i));else{var u=Math.sin(i),h=l(this.e,i,u);r=this.x0+this.a*this.k0*a(t-this.long0),c=this.y0-this.a*this.k0*Math.log(h)}return e.x=r,e.y=c,e},i.inverse=function(e){var t,i,r=e.x-this.x0,o=e.y-this.y0;if(this.sphere)i=n-2*Math.atan(Math.exp(-o/(this.a*this.k0)));else{var s=Math.exp(-o/(this.a*this.k0));if(-9999===(i=c(this.e,s)))return null}return t=a(this.long0+r/(this.a*this.k0)),e.x=t,e.y=i,e},i.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/tsfnz":24}],53:[function(e,t,i){var r=e("../common/adjust_lon");i.init=function(){},i.forward=function(e){var t=e.x,i=e.y,n=r(t-this.long0),o=this.x0+this.a*n,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return e.x=o,e.y=a,e},i.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t=r(this.long0+e.x/this.a),i=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=i,e},i.names=["Miller_Cylindrical","mill"]},{"../common/adjust_lon":5}],54:[function(e,t,i){var r=e("../common/adjust_lon");i.init=function(){},i.forward=function(e){for(var t=e.x,i=e.y,n=r(t-this.long0),o=i,a=Math.PI*Math.sin(i),s=0;;s++){var l=-(o+Math.sin(o)-a)/(1+Math.cos(o));if(o+=l,Math.abs(l)<1e-10)break}o/=2,Math.PI/2-Math.abs(i)<1e-10&&(n=0);var c=.900316316158*this.a*n*Math.cos(o)+this.x0,u=1.4142135623731*this.a*Math.sin(o)+this.y0;return e.x=c,e.y=u,e},i.inverse=function(e){var t,i;e.x-=this.x0,e.y-=this.y0,i=e.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),t=Math.asin(i);var n=r(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*t+Math.sin(2*t))/Math.PI,Math.abs(i)>1&&(i=1);var o=Math.asin(i);return e.x=n,e.y=o,e},i.names=["Mollweide","moll"]},{"../common/adjust_lon":5}],55:[function(e,t,i){i.iterations=1,i.init=function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},i.forward=function(e){var t,i=e.x,r=(e.y-this.lat0)/484813681109536e-20*1e-5,n=i-this.long0,o=1,a=0;for(t=1;10>=t;t++)o*=r,a+=this.A[t]*o;var s,l,c=a,u=n,h=1,d=0,p=0,f=0;for(t=1;6>=t;t++)s=h*c-d*u,l=d*c+h*u,h=s,d=l,p=p+this.B_re[t]*h-this.B_im[t]*d,f=f+this.B_im[t]*h+this.B_re[t]*d;return e.x=f*this.a+this.x0,e.y=p*this.a+this.y0,e},i.inverse=function(e){var t,i,r,n=e.x,o=e.y,a=n-this.x0,s=(o-this.y0)/this.a,l=a/this.a,c=1,u=0,h=0,d=0;for(t=1;6>=t;t++)i=c*s-u*l,r=u*s+c*l,c=i,u=r,h=h+this.C_re[t]*c-this.C_im[t]*u,d=d+this.C_im[t]*c+this.C_re[t]*u;for(var p=0;p<this.iterations;p++){var f,m,g=h,v=d,y=s,b=l;for(t=2;6>=t;t++)f=g*h-v*d,m=v*h+g*d,g=f,v=m,y+=(t-1)*(this.B_re[t]*g-this.B_im[t]*v),b+=(t-1)*(this.B_im[t]*g+this.B_re[t]*v);g=1,v=0;var x=this.B_re[1],w=this.B_im[1];for(t=2;6>=t;t++)f=g*h-v*d,m=v*h+g*d,g=f,v=m,x+=t*(this.B_re[t]*g-this.B_im[t]*v),w+=t*(this.B_im[t]*g+this.B_re[t]*v);var _=x*x+w*w;h=(y*x+b*w)/_,d=(b*x-y*w)/_}var E=h,M=d,A=1,T=0;for(t=1;9>=t;t++)A*=E,T+=this.D[t]*A;var S=this.lat0+484813681109536e-20*T*1e5,P=this.long0+M;return e.x=P,e.y=S,e},i.names=["New_Zealand_Map_Grid","nzmg"]},{}],56:[function(e,t,i){var r=e("../common/tsfnz"),n=e("../common/adjust_lon"),o=e("../common/phi2z"),a=Math.PI/2,s=Math.PI/4;i.init=function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var e=Math.sin(this.lat0),t=Math.cos(this.lat0),i=this.e*e;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(t,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var o=r(this.e,this.lat0,e),a=this.bl/t*Math.sqrt((1-this.es)/(1-i*i));1>a*a&&(a=1);var s,l;if(isNaN(this.longc)){var c=r(this.e,this.lat1,Math.sin(this.lat1)),u=r(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(a+Math.sqrt(a*a-1))*Math.pow(o,this.bl):this.el=(a-Math.sqrt(a*a-1))*Math.pow(o,this.bl);var h=Math.pow(c,this.bl),d=Math.pow(u,this.bl);l=.5*((s=this.el/h)-1/s);var p=(this.el*this.el-d*h)/(this.el*this.el+d*h),f=(d-h)/(d+h),m=n(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(p*Math.tan(.5*this.bl*m)/f)/this.bl,this.long0=n(this.long0);var g=n(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*g)/l),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else s=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=s*Math.pow(o,this.bl),l=.5*(s-1/s),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(l*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))},i.forward=function(e){var t,i,o,l=e.x,c=e.y,u=n(l-this.long0);if(Math.abs(Math.abs(c)-a)<=1e-10)o=c>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(s+o*this.gamma0*.5)),t=-1*o*a*this.al/this.bl;else{var h=r(this.e,c,Math.sin(c)),d=this.el/Math.pow(h,this.bl),p=.5*(d-1/d),f=.5*(d+1/d),m=Math.sin(this.bl*u),g=(p*Math.sin(this.gamma0)-m*Math.cos(this.gamma0))/f;i=Math.abs(Math.abs(g)-1)<=1e-10?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-g)/(1+g))/this.bl,t=Math.abs(Math.cos(this.bl*u))<=1e-10?this.al*this.bl*u:this.al*Math.atan2(p*Math.cos(this.gamma0)+m*Math.sin(this.gamma0),Math.cos(this.bl*u))/this.bl}return this.no_rot?(e.x=this.x0+t,e.y=this.y0+i):(t-=this.uc,e.x=this.x0+i*Math.cos(this.alpha)+t*Math.sin(this.alpha),e.y=this.y0+t*Math.cos(this.alpha)-i*Math.sin(this.alpha)),e},i.inverse=function(e){var t,i;this.no_rot?(i=e.y-this.y0,t=e.x-this.x0):(i=(e.x-this.x0)*Math.cos(this.alpha)-(e.y-this.y0)*Math.sin(this.alpha),t=(e.y-this.y0)*Math.cos(this.alpha)+(e.x-this.x0)*Math.sin(this.alpha),t+=this.uc);var r=Math.exp(-1*this.bl*i/this.al),s=.5*(r-1/r),l=.5*(r+1/r),c=Math.sin(this.bl*t/this.al),u=(c*Math.cos(this.gamma0)+s*Math.sin(this.gamma0))/l,h=Math.pow(this.el/Math.sqrt((1+u)/(1-u)),1/this.bl);return Math.abs(u-1)<1e-10?(e.x=this.long0,e.y=a):Math.abs(u+1)<1e-10?(e.x=this.long0,e.y=-1*a):(e.y=o(this.e,h),e.x=n(this.long0-Math.atan2(s*Math.cos(this.gamma0)-c*Math.sin(this.gamma0),Math.cos(this.bl*t/this.al))/this.bl)),e},i.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},{"../common/adjust_lon":5,"../common/phi2z":16,"../common/tsfnz":24}],57:[function(e,t,i){var r=e("../common/e0fn"),n=e("../common/e1fn"),o=e("../common/e2fn"),a=e("../common/e3fn"),s=e("../common/adjust_lon"),l=e("../common/adjust_lat"),c=e("../common/mlfn"),u=e("../common/gN");i.init=function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=n(this.es),this.e2=o(this.es),this.e3=a(this.es),this.ml0=this.a*c(this.e0,this.e1,this.e2,this.e3,this.lat0)},i.forward=function(e){var t,i,r,n=e.x,o=e.y,a=s(n-this.long0);if(r=a*Math.sin(o),this.sphere)Math.abs(o)<=1e-10?(t=this.a*a,i=-1*this.a*this.lat0):(t=this.a*Math.sin(r)/Math.tan(o),i=this.a*(l(o-this.lat0)+(1-Math.cos(r))/Math.tan(o)));else if(Math.abs(o)<=1e-10)t=this.a*a,i=-1*this.ml0;else{var h=u(this.a,this.e,Math.sin(o))/Math.tan(o);t=h*Math.sin(r),i=this.a*c(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+h*(1-Math.cos(r))}return e.x=t+this.x0,e.y=i+this.y0,e},i.inverse=function(e){var t,i,r,n,o,a,l,u,h;if(r=e.x-this.x0,n=e.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=1e-10)t=s(r/this.a+this.long0),i=0;else{a=this.lat0+n/this.a,l=r*r/this.a/this.a+a*a,u=a;var d;for(o=20;o;--o)if(d=Math.tan(u),h=-1*(a*(u*d+1)-u-.5*(u*u+l)*d)/((u-a)/d-1),u+=h,Math.abs(h)<=1e-10){i=u;break}t=s(this.long0+Math.asin(r*Math.tan(u)/this.a)/Math.sin(i))}else if(Math.abs(n+this.ml0)<=1e-10)i=0,t=s(this.long0+r/this.a);else{a=(this.ml0+n)/this.a,l=r*r/this.a/this.a+a*a,u=a;var p,f,m,g,v;for(o=20;o;--o)if(v=this.e*Math.sin(u),p=Math.sqrt(1-v*v)*Math.tan(u),f=this.a*c(this.e0,this.e1,this.e2,this.e3,u),m=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),g=f/this.a,h=(a*(p*g+1)-g-.5*p*(g*g+l))/(this.es*Math.sin(2*u)*(g*g+l-2*a*g)/(4*p)+(a-g)*(p*m-2/Math.sin(2*u))-m),u-=h,Math.abs(h)<=1e-10){i=u;break}p=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),t=s(this.long0+Math.asin(r*p/this.a)/Math.sin(i))}return e.x=t,e.y=i,e},i.names=["Polyconic","poly"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/mlfn":14}],58:[function(e,t,i){var r=e("../common/adjust_lon"),n=e("../common/adjust_lat"),o=e("../common/pj_enfn"),a=e("../common/pj_mlfn"),s=e("../common/pj_inv_mlfn"),l=Math.PI/2,c=e("../common/asinz");i.init=function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=o(this.es)},i.forward=function(e){var t,i,n=e.x,o=e.y;if(n=r(n-this.long0),this.sphere){if(this.m)for(var s=this.n*Math.sin(o),l=20;l;--l){var c=(this.m*o+Math.sin(o)-s)/(this.m+Math.cos(o));if(o-=c,Math.abs(c)<1e-10)break}else o=1!==this.n?Math.asin(this.n*Math.sin(o)):o;t=this.a*this.C_x*n*(this.m+Math.cos(o)),i=this.a*this.C_y*o}else{var u=Math.sin(o),h=Math.cos(o);i=this.a*a(o,u,h,this.en),t=this.a*n*h/Math.sqrt(1-this.es*u*u)}return e.x=t,e.y=i,e},i.inverse=function(e){var t,i,o,a;return e.x-=this.x0,o=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,o/=this.C_x*(this.m+Math.cos(t)),this.m?t=c((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=c(Math.sin(t)/this.n)),o=r(o+this.long0),t=n(t)):(t=s(e.y/this.a,this.es,this.en),a=Math.abs(t),l>a?(a=Math.sin(t),i=this.long0+e.x*Math.sqrt(1-this.es*a*a)/(this.a*Math.cos(t)),o=r(i)):l>a-1e-10&&(o=this.long0)),e.x=o,e.y=t,e},i.names=["Sinusoidal","sinu"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/asinz":6,"../common/pj_enfn":17,"../common/pj_inv_mlfn":18,"../common/pj_mlfn":19}],59:[function(e,t,i){i.init=function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),i=this.a,r=1/this.rf,n=2*r-Math.pow(r,2),o=this.e=Math.sqrt(n);this.R=this.k0*i*Math.sqrt(1-n)/(1-n*Math.pow(t,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*s+this.alpha*o/2*l},i.forward=function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+i)+this.K,n=2*(Math.atan(Math.exp(r))-Math.PI/4),o=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(o))),s=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(o));return e.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,e.x=this.R*a+this.x0,e},i.inverse=function(e){for(var t=e.x-this.x0,i=e.y-this.y0,r=t/this.R,n=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(r)),a=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(n))),s=this.lambda0+a/this.alpha,l=0,c=o,u=-1e3,h=0;Math.abs(c-u)>1e-7;){if(++h>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=s,e.y=c,e},i.names=["somerc"]},{}],60:[function(e,t,i){var r=Math.PI/2,n=e("../common/sign"),o=e("../common/msfnz"),a=e("../common/tsfnz"),s=e("../common/phi2z"),l=e("../common/adjust_lon");i.ssfn_=function(e,t,i){return t*=i,Math.tan(.5*(r+e))*Math.pow((1-t)/(1+t),.5*i)},i.init=function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*(1+n(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=1e-10&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*this.cons*o(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/a(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=o(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-r,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},i.forward=function(e){var t,i,n,o,s,c,u=e.x,h=e.y,d=Math.sin(h),p=Math.cos(h),f=l(u-this.long0);return Math.abs(Math.abs(u-this.long0)-Math.PI)<=1e-10&&Math.abs(h+this.lat0)<=1e-10?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*d+this.coslat0*p*Math.cos(f)),e.x=this.a*t*p*Math.sin(f)+this.x0,e.y=this.a*t*(this.coslat0*d-this.sinlat0*p*Math.cos(f))+this.y0,e):(i=2*Math.atan(this.ssfn_(h,d,this.e))-r,o=Math.cos(i),n=Math.sin(i),Math.abs(this.coslat0)<=1e-10?(s=a(this.e,h*this.con,this.con*d),c=2*this.a*this.k0*s/this.cons,e.x=this.x0+c*Math.sin(u-this.long0),e.y=this.y0-this.con*c*Math.cos(u-this.long0),e):(Math.abs(this.sinlat0)<1e-10?(t=2*this.a*this.k0/(1+o*Math.cos(f)),e.y=t*n):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*o*Math.cos(f))),e.y=t*(this.cosX0*n-this.sinX0*o*Math.cos(f))+this.y0),e.x=t*o*Math.sin(f)+this.x0,e))},i.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t,i,n,o,a,c=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var u=2*Math.atan(c/(.5*this.a*this.k0));return t=this.long0,i=this.lat0,1e-10>=c?(e.x=t,e.y=i,e):(i=Math.asin(Math.cos(u)*this.sinlat0+e.y*Math.sin(u)*this.coslat0/c),t=l(Math.abs(this.coslat0)<1e-10?this.lat0>0?this.long0+Math.atan2(e.x,-1*e.y):this.long0+Math.atan2(e.x,e.y):this.long0+Math.atan2(e.x*Math.sin(u),c*this.coslat0*Math.cos(u)-e.y*this.sinlat0*Math.sin(u))),e.x=t,e.y=i,e)}if(Math.abs(this.coslat0)<=1e-10){if(1e-10>=c)return i=this.lat0,t=this.long0,e.x=t,e.y=i,e;e.x*=this.con,e.y*=this.con,n=c*this.cons/(2*this.a*this.k0),i=this.con*s(this.e,n),t=this.con*l(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else o=2*Math.atan(c*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,1e-10>=c?a=this.X0:(a=Math.asin(Math.cos(o)*this.sinX0+e.y*Math.sin(o)*this.cosX0/c),t=l(this.long0+Math.atan2(e.x*Math.sin(o),c*this.cosX0*Math.cos(o)-e.y*this.sinX0*Math.sin(o)))),i=-1*s(this.e,Math.tan(.5*(r+a)));return e.x=t,e.y=i,e},i.names=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],61:[function(e,t,i){var r=e("./gauss"),n=e("../common/adjust_lon");i.init=function(){r.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},i.forward=function(e){var t,i,o,a;return e.x=n(e.x-this.long0),r.forward.apply(this,[e]),t=Math.sin(e.y),i=Math.cos(e.y),o=Math.cos(e.x),a=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*i*o),e.x=a*i*Math.sin(e.x),e.y=a*(this.cosc0*t-this.sinc0*i*o),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},i.inverse=function(e){var t,i,o,a,s;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,s=Math.sqrt(e.x*e.x+e.y*e.y)){var l=2*Math.atan2(s,this.R2);t=Math.sin(l),i=Math.cos(l),a=Math.asin(i*this.sinc0+e.y*t*this.cosc0/s),o=Math.atan2(e.x*t,s*this.cosc0*i-e.y*this.sinc0*t)}else a=this.phic0,o=0;return e.x=o,e.y=a,r.inverse.apply(this,[e]),e.x=n(e.x+this.long0),e},i.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},{"../common/adjust_lon":5,"./gauss":46}],62:[function(e,t,i){var r=e("../common/e0fn"),n=e("../common/e1fn"),o=e("../common/e2fn"),a=e("../common/e3fn"),s=e("../common/mlfn"),l=e("../common/adjust_lon"),c=Math.PI/2,u=e("../common/sign"),h=e("../common/asinz");i.init=function(){this.e0=r(this.es),this.e1=n(this.es),this.e2=o(this.es),this.e3=a(this.es),this.ml0=this.a*s(this.e0,this.e1,this.e2,this.e3,this.lat0)},i.forward=function(e){var t,i,r,n=e.x,o=e.y,a=l(n-this.long0),c=Math.sin(o),u=Math.cos(o);if(this.sphere){var h=u*Math.sin(a);if(Math.abs(Math.abs(h)-1)<1e-10)return 93;i=.5*this.a*this.k0*Math.log((1+h)/(1-h)),t=Math.acos(u*Math.cos(a)/Math.sqrt(1-h*h)),0>o&&(t=-t),r=this.a*this.k0*(t-this.lat0)}else{var d=u*a,p=Math.pow(d,2),f=this.ep2*Math.pow(u,2),m=Math.tan(o),g=Math.pow(m,2);t=1-this.es*Math.pow(c,2);var v=this.a/Math.sqrt(t),y=this.a*s(this.e0,this.e1,this.e2,this.e3,o);i=this.k0*v*d*(1+p/6*(1-g+f+p/20*(5-18*g+Math.pow(g,2)+72*f-58*this.ep2)))+this.x0,r=this.k0*(y-this.ml0+v*m*(p*(.5+p/24*(5-g+9*f+4*Math.pow(f,2)+p/30*(61-58*g+Math.pow(g,2)+600*f-330*this.ep2)))))+this.y0}return e.x=i,e.y=r,e},i.inverse=function(e){var t,i,r,n,o,a;if(this.sphere){var s=Math.exp(e.x/(this.a*this.k0)),d=.5*(s-1/s),p=this.lat0+e.y/(this.a*this.k0),f=Math.cos(p);t=Math.sqrt((1-f*f)/(1+d*d)),o=h(t),0>p&&(o=-o),a=0===d&&0===f?this.long0:l(Math.atan2(d,f)+this.long0)}else{var m=e.x-this.x0,g=e.y-this.y0;for(i=t=(this.ml0+g/this.k0)/this.a,n=0;r=(t+this.e1*Math.sin(2*i)-this.e2*Math.sin(4*i)+this.e3*Math.sin(6*i))/this.e0-i,i+=r,!(Math.abs(r)<=1e-10);n++)if(n>=6)return 95;if(Math.abs(i)<c){var v=Math.sin(i),y=Math.cos(i),b=Math.tan(i),x=this.ep2*Math.pow(y,2),w=Math.pow(x,2),_=Math.pow(b,2),E=Math.pow(_,2);t=1-this.es*Math.pow(v,2);var M=this.a/Math.sqrt(t),A=M*(1-this.es)/t,T=m/(M*this.k0),S=Math.pow(T,2);o=i-M*b*S/A*(.5-S/24*(5+3*_+10*x-4*w-9*this.ep2-S/30*(61+90*_+298*x+45*E-252*this.ep2-3*w))),a=l(this.long0+T*(1-S/6*(1+2*_+x-S/20*(5-2*x+28*_-3*w+8*this.ep2+24*E)))/y)}else o=c*u(g),a=this.long0}return e.x=a,e.y=o,e},i.names=["Transverse_Mercator","Transverse Mercator","tmerc"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/mlfn":14,"../common/sign":21}],63:[function(e,t,i){var r=e("./tmerc");i.dependsOn="tmerc",i.init=function(){this.zone&&(this.lat0=0,this.long0=.017453292519943295*(6*Math.abs(this.zone)-183),this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,r.init.apply(this),this.forward=r.forward,this.inverse=r.inverse)},i.names=["Universal Transverse Mercator System","utm"]},{"./tmerc":62}],64:[function(e,t,i){var r=e("../common/adjust_lon"),n=Math.PI/2,o=e("../common/asinz");i.init=function(){this.R=this.a},i.forward=function(e){var t,i,a=e.x,s=e.y,l=r(a-this.long0);Math.abs(s)<=1e-10&&(t=this.x0+this.R*l,i=this.y0);var c=o(2*Math.abs(s/Math.PI));(Math.abs(l)<=1e-10||Math.abs(Math.abs(s)-n)<=1e-10)&&(t=this.x0,i=s>=0?this.y0+Math.PI*this.R*Math.tan(.5*c):this.y0+Math.PI*this.R*-Math.tan(.5*c));var u=.5*Math.abs(Math.PI/l-l/Math.PI),h=u*u,d=Math.sin(c),p=Math.cos(c),f=p/(d+p-1),m=f*f,g=f*(2/d-1),v=g*g,y=Math.PI*this.R*(u*(f-v)+Math.sqrt(h*(f-v)*(f-v)-(v+h)*(m-v)))/(v+h);0>l&&(y=-y),t=this.x0+y;var b=h+f;return y=Math.PI*this.R*(g*b-u*Math.sqrt((v+h)*(h+1)-b*b))/(v+h),i=s>=0?this.y0+y:this.y0-y,e.x=t,e.y=i,e},i.inverse=function(e){var t,i,n,o,a,s,l,c,u,h,d,p,f;return e.x-=this.x0,e.y-=this.y0,d=Math.PI*this.R,n=e.x/d,o=e.y/d,a=n*n+o*o,s=-Math.abs(o)*(1+a),l=s-2*o*o+n*n,c=-2*s+1+2*o*o+a*a,f=o*o/c+(2*l*l*l/c/c/c-9*s*l/c/c)/27,u=(s-l*l/3/c)/c,h=2*Math.sqrt(-u/3),d=3*f/u/h,Math.abs(d)>1&&(d=d>=0?1:-1),p=Math.acos(d)/3,i=e.y>=0?(-h*Math.cos(p+Math.PI/3)-l/3/c)*Math.PI:-(-h*Math.cos(p+Math.PI/3)-l/3/c)*Math.PI,t=Math.abs(n)<1e-10?this.long0:r(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(n*n-o*o)+a*a))/2/n),e.x=t,e.y=i,e},i.names=["Van_der_Grinten_I","VanDerGrinten","vandg"]},{"../common/adjust_lon":5,"../common/asinz":6}],65:[function(e,t,i){var r=1,n=2,o=e("./datum_transform"),a=e("./adjust_axis"),s=e("./Proj"),c=e("./common/toPoint");t.exports=function l(e,t,i){function m(e,t){return(e.datum.datum_type===r||e.datum.datum_type===n)&&"WGS84"!==t.datumCode}var u;return Array.isArray(i)&&(i=c(i)),e.datum&&t.datum&&(m(e,t)||m(t,e))&&(u=new s("WGS84"),l(e,u,i),e=u),"enu"!==e.axis&&a(e,!1,i),"longlat"===e.projName?(i.x*=.017453292519943295,i.y*=.017453292519943295):(e.to_meter&&(i.x*=e.to_meter,i.y*=e.to_meter),e.inverse(i)),e.from_greenwich&&(i.x+=e.from_greenwich),i=o(e.datum,t.datum,i),t.from_greenwich&&(i.x-=t.from_greenwich),"longlat"===t.projName?(i.x*=57.29577951308232,i.y*=57.29577951308232):(t.forward(i),t.to_meter&&(i.x/=t.to_meter,i.y/=t.to_meter)),"enu"!==t.axis&&a(t,!0,i),i}},{"./Proj":2,"./adjust_axis":3,"./common/toPoint":23,"./datum_transform":31}],66:[function(t,i,r){function d(t,i,r){t[i]=r.map(function(t){var i={};return e(t,i),i}).reduce(function(e,t){return o(e,t)},{})}function e(t,i){var r;return Array.isArray(t)?("PARAMETER"===(r=t.shift())&&(r=t.shift()),void(1===t.length?Array.isArray(t[0])?(i[r]={},e(t[0],i[r])):i[r]=t[0]:t.length?"TOWGS84"===r?i[r]=t:(i[r]={},["UNIT","PRIMEM","VERT_DATUM"].indexOf(r)>-1?(i[r]={name:t[0].toLowerCase(),convert:t[1]},3===t.length&&(i[r].auth=t[2])):"SPHEROID"===r?(i[r]={name:t[0],a:t[1],rf:t[2]},4===t.length&&(i[r].auth=t[3])):["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(r)>-1?(t[0]=["name",t[0]],d(i,r,t)):t.every(function(e){return Array.isArray(e)})?d(i,r,t):e(t,i[r])):i[r]=!0)):void(i[t]=!0)}function g(e){return e*n}var n=.017453292519943295,o=t("./extend");i.exports=function(t,i){var r=JSON.parse((","+t).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]').replace(/,\["VERTCS".+/,"")),n=r.shift(),a=r.shift();r.unshift(["name",a]),r.unshift(["type",n]),r.unshift("output");var s={};return e(r,s),function h(e){function b(t){var i=e.to_meter||1;return parseFloat(t,10)*i}"GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=parseFloat(e.UNIT.convert,10)*e.DATUM.SPHEROID.a):e.to_meter=parseFloat(e.UNIT.convert,10))),e.GEOGCS&&(e.GEOGCS.DATUM?e.datumCode=e.GEOGCS.DATUM.name.toLowerCase():e.datumCode=e.GEOGCS.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),("new_zealand_geodetic_datum_1949"===e.datumCode||"new_zealand_1949"===e.datumCode)&&(e.datumCode="nzgd49"),"wgs_1984"===e.datumCode&&("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),e.GEOGCS.DATUM&&e.GEOGCS.DATUM.SPHEROID&&(e.ellps=e.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=e.GEOGCS.DATUM.SPHEROID.a,e.rf=parseFloat(e.GEOGCS.DATUM.SPHEROID.rf,10)),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",g],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",g],["x0","false_easting",b],["y0","false_northing",b],["long0","central_meridian",g],["lat0","latitude_of_origin",g],["lat0","standard_parallel_1",g],["lat1","standard_parallel_1",g],["lat2","standard_parallel_2",g],["alpha","azimuth",g],["srsCode","name"]].forEach(function(t){return function f(e,t){var i=t[0],r=t[1];!(i in e)&&r in e&&(e[i]=e[r],3===t.length&&(e[i]=t[2](e[i])))}(e,t)}),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=g(e.lat1>0?90:-90),e.lat_ts=e.lat1)}(s.output),o(i,s.output)}},{"./extend":34}],67:[function(t,r,a){function d(e){return e*(Math.PI/180)}function e(e){return e/Math.PI*180}function g(t){var i=t.northing,r=t.easting,n=t.zoneLetter,o=t.zoneNumber;if(0>o||o>60)return null;var a,s,l,c,u,h,d,p,f,m=.00669438,v=(1-Math.sqrt(1-m))/(1+Math.sqrt(1-m)),y=r-5e5,b=i;"N">n&&(b-=1e7),d=6*(o-1)-180+3,a=m/(1-m),f=(p=b/.9996/6367449.145945056)+(3*v/2-27*v*v*v/32)*Math.sin(2*p)+(21*v*v/16-55*v*v*v*v/32)*Math.sin(4*p)+151*v*v*v/96*Math.sin(6*p),s=6378137/Math.sqrt(1-m*Math.sin(f)*Math.sin(f)),l=Math.tan(f)*Math.tan(f),c=a*Math.cos(f)*Math.cos(f),u=6335439.32722994/Math.pow(1-m*Math.sin(f)*Math.sin(f),1.5),h=y/(.9996*s);var x=f-s*Math.tan(f)/u*(h*h/2-(5+3*l+10*c-4*c*c-9*a)*h*h*h*h/24+(61+90*l+298*c+45*l*l-252*a-3*c*c)*h*h*h*h*h*h/720);x=e(x);var w=(h-(1+2*l+c)*h*h*h/6+(5-2*c+28*l-3*c*c+8*a+24*l*l)*h*h*h*h*h/120)/Math.cos(f);w=d+e(w);var _;if(t.accuracy){var E=g({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});_={top:E.lat,right:E.lon,bottom:x,left:w}}else _={lat:x,lon:w};return _}function i(e,t){var i="00000"+e.easting,r="00000"+e.northing;return e.zoneNumber+e.zoneLetter+function j(e,t,i){var r=k(i),n=Math.floor(e/1e5),o=Math.floor(t/1e5)%20;return function l(e,t,i){var r=i-1,n=c.charCodeAt(r),o=u.charCodeAt(r),a=n+e-1,s=o+t,l=!1;a>w&&(a=a-w+v-1,l=!0),(a===y||y>n&&a>y||(a>y||y>n)&&l)&&a++,(a===b||b>n&&a>b||(a>b||b>n)&&l)&&++a===y&&a++,a>w&&(a=a-w+v-1),s>x?(s=s-x+v-1,l=!0):l=!1,(s===y||y>o&&s>y||(s>y||y>o)&&l)&&s++,(s===b||b>o&&s>b||(s>b||b>o)&&l)&&++s===y&&s++,s>x&&(s=s-x+v-1);return String.fromCharCode(a)+String.fromCharCode(s)}(n,o,r)}(e.easting,e.northing,e.zoneNumber)+i.substr(i.length-5,t)+r.substr(r.length-5,t)}function k(e){var t=e%s;return 0===t&&(t=s),t}function m(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,i=e.length,r=null,a="",s=0;!/[A-Z]/.test(t=e.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+e;a+=t,s++}var l=parseInt(a,10);if(0===s||s+3>i)throw"MGRSPoint bad conversion from: "+e;var h=e.charAt(s++);if("A">=h||"B"===h||"Y"===h||h>="Z"||"I"===h||"O"===h)throw"MGRSPoint zone letter "+h+" not handled: "+e;r=e.substring(s,s+=2);for(var d=k(l),f=function n(e,t){for(var i=c.charCodeAt(t-1),r=1e5,n=!1;i!==e.charCodeAt(0);){if(++i===y&&i++,i===b&&i++,i>w){if(n)throw"Bad character: "+e;i=v,n=!0}r+=1e5}return r}(r.charAt(0),d),m=function o(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var i=u.charCodeAt(t-1),r=0,n=!1;i!==e.charCodeAt(0);){if(++i===y&&i++,i===b&&i++,i>x){if(n)throw"Bad character: "+e;i=v,n=!0}r+=1e5}return r}(r.charAt(1),d);m<function p(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}(h);)m+=2e6;var g=i-s;if(g%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var _,E,M,A,T,S=g/2,P=0,C=0;return S>0&&(_=1e5/Math.pow(10,S),E=e.substring(s,s+S),P=parseFloat(E)*_,M=e.substring(s+S),C=parseFloat(M)*_),A=P+f,T=C+m,{easting:A,northing:T,zoneLetter:h,zoneNumber:l,accuracy:_}}var s=6,c="AJSAJS",u="AFAFAF",v=65,y=73,b=79,x=86,w=90;a.forward=function(e,t){return t=t||5,i(function f(e){var t,i,r,n,o,a,s,l=e.lat,c=e.lon,u=.00669438,p=d(l),f=d(c);s=Math.floor((c+180)/6)+1,180===c&&(s=60),l>=56&&64>l&&c>=3&&12>c&&(s=32),l>=72&&84>l&&(c>=0&&9>c?s=31:c>=9&&21>c?s=33:c>=21&&33>c?s=35:c>=33&&42>c&&(s=37)),a=d(6*(s-1)-180+3),t=u/(1-u),i=6378137/Math.sqrt(1-u*Math.sin(p)*Math.sin(p)),r=Math.tan(p)*Math.tan(p),n=t*Math.cos(p)*Math.cos(p);var m=.9996*i*((o=Math.cos(p)*(f-a))+(1-r+n)*o*o*o/6+(5-18*r+r*r+72*n-58*t)*o*o*o*o*o/120)+5e5,g=.9996*(6378137*(.9983242984503243*p-.002514607064228144*Math.sin(2*p)+2639046602129982e-21*Math.sin(4*p)-3.418046101696858e-9*Math.sin(6*p))+i*Math.tan(p)*(o*o/2+(5-r+9*n+4*n*n)*o*o*o*o/24+(61-58*r+r*r+600*n-330*t)*o*o*o*o*o*o/720));return 0>l&&(g+=1e7),{northing:Math.round(g),easting:Math.round(m),zoneNumber:s,zoneLetter:function h(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}(l)}}({lat:e[1],lon:e[0]}),t)},a.inverse=function(e){var t=g(m(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]},a.toPoint=function(e){var t=g(m(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}},{}],68:[function(e,t,i){t.exports={name:"proj4",version:"2.3.12",description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",main:"lib/index.js",directories:{test:"test",doc:"docs"},scripts:{test:"./node_modules/istanbul/lib/cli.js test ./node_modules/mocha/bin/_mocha test/test.js"},repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},author:"",license:"MIT",jam:{main:"dist/proj4.js",include:["dist/proj4.js","README.md","AUTHORS","LICENSE.md"]},devDependencies:{"grunt-cli":"~0.1.13",grunt:"~0.4.2","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~0.8.0",chai:"~1.8.1",mocha:"~1.17.1","grunt-mocha-phantomjs":"~0.4.0",browserify:"~3.24.5","grunt-browserify":"~1.3.0","grunt-contrib-uglify":"~0.3.2",curl:"git://github.com/cujojs/curl.git",istanbul:"~0.2.4",tin:"~0.4.0"},dependencies:{mgrs:"~0.0.2"}}},{}],"./includedProjections":[function(e,t,i){t.exports=e("hTEDpn")},{}],hTEDpn:[function(e,t,i){var r=[e("./lib/projections/tmerc"),e("./lib/projections/utm"),e("./lib/projections/sterea"),e("./lib/projections/stere"),e("./lib/projections/somerc"),e("./lib/projections/omerc"),e("./lib/projections/lcc"),e("./lib/projections/krovak"),e("./lib/projections/cass"),e("./lib/projections/laea"),e("./lib/projections/aea"),e("./lib/projections/gnom"),e("./lib/projections/cea"),e("./lib/projections/eqc"),e("./lib/projections/poly"),e("./lib/projections/nzmg"),e("./lib/projections/mill"),e("./lib/projections/sinu"),e("./lib/projections/moll"),e("./lib/projections/eqdc"),e("./lib/projections/vandg"),e("./lib/projections/aeqd")];t.exports=function(e){r.forEach(function(t){e.Proj.projections.add(t)})}},{"./lib/projections/aea":40,"./lib/projections/aeqd":41,"./lib/projections/cass":42,"./lib/projections/cea":43,"./lib/projections/eqc":44,"./lib/projections/eqdc":45,"./lib/projections/gnom":47,"./lib/projections/krovak":48,"./lib/projections/laea":49,"./lib/projections/lcc":50,"./lib/projections/mill":53,"./lib/projections/moll":54,"./lib/projections/nzmg":55,"./lib/projections/omerc":56,"./lib/projections/poly":57,"./lib/projections/sinu":58,"./lib/projections/somerc":59,"./lib/projections/stere":60,"./lib/projections/sterea":61,"./lib/projections/tmerc":62,"./lib/projections/utm":63,"./lib/projections/vandg":64}]},{},[36])(36)})},766:function(e,t,i){(function(i){var r,n=function(){this._tweens={},this._tweensAddedDuringUpdate={}};n.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(e=void 0!==e?e:o.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]];n&&!1===n.update(e)&&(n._isPlaying=!1,t||delete this._tweens[i[r]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var o=new n;o.Group=n,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof window&&void 0!==i?o.now=function(){var e=i.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?o.now=window.performance.now.bind(window.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime;for(var t in this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,i,r;if(e<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(i=(e-this._startTime)/this._duration)>1?1:i,r=this._easingFunction(i);for(t in this._valuesEnd)if(void 0!==this._valuesStart[t]){var n=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,r):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?n+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=n+(o-n)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===i){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){return(e*=2)<1?e*e*(3.5949095*e-2.5949095)*.5:.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),a=o.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[i],e[i-1],i-r):a(e[n],e[n+1>i?i:n+1],r-n)},Bezier:function(e,t){for(var i=0,r=e.length-1,n=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=r;s++)i+=n(1-t,r-s)*n(t,s)*e[s]*a(r,s);return i},CatmullRom:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),a=o.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(n=Math.floor(r=i*(1+t))),a(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],r-n)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[i]-(a(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):a(e[n?n-1:0],e[n],e[i<n+1?i:n+1],e[i<n+2?i:n+2],r-n)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=o.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var r=t;r>1;r--)i*=r;return e[t]=i,i}}(),CatmullRom:function(e,t,i,r,n){var o=.5*(i-e),a=.5*(r-t),s=n*n;return(2*t-2*i+o+a)*(n*s)+(-3*t+3*i-2*o-a)*s+o*n+t}}},void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}).call(t,i(2))},767:function(e,t,i){var r=function(){function addPanel(e){return t.appendChild(e.dom),e}function showPanel(i){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===i?"block":"none";e=i}this.fps=0;var e=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(i){i.preventDefault(),showPanel(++e%t.children.length)},!1);var i=(performance||Date).now(),n=i,o=0,a=addPanel(new r.Panel("FPS","#0ff","#002")),s=addPanel(new r.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=addPanel(new r.Panel("MB","#f08","#201"));return showPanel(0),{REVISION:16,dom:t,addPanel:addPanel,showPanel:showPanel,begin:function(){i=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(s.update(e-i,200),e>n+3e3&&(this.fps=1e3*o/(e-n),a.update(this.fps,100),n=e,o=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:showPanel}};r.Panel=function(e,t,i){var r=1/0,n=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,u=2*a,h=3*a,d=15*a,p=74*a,f=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(h,d,p,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h,d,p,f),{dom:m,update:function(l,v){r=Math.min(r,l),n=Math.max(n,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,s,d),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(r)+"-"+o(n)+")",c,u),g.drawImage(m,h+a,d,p-a,f,h,d,p-a,f),g.fillRect(h+p-a,d,a,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h+p-a,d,a,o((1-l/v)*f))}}},e.exports=r},768:function(e,t){function BinaryHeap(e){this.content=[],this.scoreFunction=e}e.exports=BinaryHeap,BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},remove:function(e){for(var t=this.content.length,i=0;i<t;i++)if(this.content[i]==e){var r=this.content.pop();if(i==t-1)break;this.content[i]=r,this.bubbleUp(i),this.sinkDown(i);break}},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e],i=this.scoreFunction(t);e>0;){var r=Math.floor((e+1)/2)-1,n=this.content[r];if(i>=this.scoreFunction(n))break;this.content[r]=t,this.content[e]=n,e=r}},sinkDown:function(e){for(var t=this.content.length,i=this.content[e],r=this.scoreFunction(i);;){var n=2*(e+1),o=n-1,a=null;if(o<t){var s=this.content[o],l=this.scoreFunction(s);l<r&&(a=o)}if(n<t){var c=this.content[n];this.scoreFunction(c)<(null==a?r:l)&&(a=n)}if(null==a)break;this.content[e]=this.content[a],this.content[a]=i,e=a}}}},769:function(e,t,i){var r;!function(t,i){"use strict";"object"==typeof e&&"object"==typeof e.exports?e.exports=t.document?i(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return i(e)}:i(t)}("undefined"!=typeof window?window:this,function(i,n){"use strict";function DOMEval(e,t){var i=(t=t||a).createElement("script");i.text=e,t.head.appendChild(i).parentNode.removeChild(i)}function isArrayLike(e){var t=!!e&&"length"in e&&e.length,i=y.type(e);return"function"!==i&&!y.isWindow(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}function winnow(e,t,i){return y.isFunction(t)?y.grep(e,function(e,r){return!!t.call(e,r,e)!==i}):t.nodeType?y.grep(e,function(e){return e===t!==i}):"string"!=typeof t?y.grep(e,function(e){return h.call(t,e)>-1!==i}):P.test(t)?y.filter(t,e,i):(t=y.filter(t,e),y.grep(e,function(e){return h.call(t,e)>-1!==i&&1===e.nodeType}))}function sibling(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function Identity(e){return e}function Thrower(e){throw e}function adoptValue(e,t,i){var r;try{e&&y.isFunction(r=e.promise)?r.call(e).done(t).fail(i):e&&y.isFunction(r=e.then)?r.call(e,t,i):t.call(void 0,e)}catch(e){i.call(void 0,e)}}function completed(){a.removeEventListener("DOMContentLoaded",completed),i.removeEventListener("load",completed),y.ready()}function Data(){this.expando=y.expando+Data.uid++}function dataAttr(e,t,i){var r;if(void 0===i&&1===e.nodeType)if(r="data-"+t.replace(z,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(r))){try{i=function getData(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:H.test(e)?JSON.parse(e):e)}(i)}catch(e){}U.set(e,t,i)}else i=void 0;return i}function adjustCSS(e,t,i,r){var n,o=1,a=20,s=r?function(){return r.cur()}:function(){return y.css(e,t,"")},l=s(),c=i&&i[3]||(y.cssNumber[t]?"":"px"),u=(y.cssNumber[t]||"px"!==c&&+l)&&V.exec(y.css(e,t));if(u&&u[3]!==c){c=c||u[3],i=i||[],u=+l||1;do{u/=o=o||".5",y.style(e,t,u+c)}while(o!==(o=s()/l)&&1!==o&&--a)}return i&&(u=+u||+l||0,n=i[1]?u+(i[1]+1)*i[2]:+i[2],r&&(r.unit=c,r.start=u,r.end=n)),n}function getDefaultDisplay(e){var t,i=e.ownerDocument,r=e.nodeName,n=X[r];return n||(t=i.body.appendChild(i.createElement(r)),n=y.css(t,"display"),t.parentNode.removeChild(t),"none"===n&&(n="block"),X[r]=n,n)}function showHide(e,t){for(var i,r,n=[],o=0,a=e.length;o<a;o++)(r=e[o]).style&&(i=r.style.display,t?("none"===i&&(n[o]=F.get(r,"display")||null,n[o]||(r.style.display="")),""===r.style.display&&W(r)&&(n[o]=getDefaultDisplay(r))):"none"!==i&&(n[o]="none",F.set(r,"display",i)));for(o=0;o<a;o++)null!=n[o]&&(e[o].style.display=n[o]);return e}function getAll(e,t){var i;return i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&y.nodeName(e,t)?y.merge([e],i):i}function setGlobalEval(e,t){for(var i=0,r=e.length;i<r;i++)F.set(e[i],"globalEval",!t||F.get(t[i],"globalEval"))}function buildFragment(e,t,i,r,n){for(var o,a,s,l,c,u,h=t.createDocumentFragment(),d=[],p=0,f=e.length;p<f;p++)if((o=e[p])||0===o)if("object"===y.type(o))y.merge(d,o.nodeType?[o]:o);else if(Z.test(o)){for(a=a||h.appendChild(t.createElement("div")),s=($.exec(o)||["",""])[1].toLowerCase(),l=Q[s]||Q._default,a.innerHTML=l[1]+y.htmlPrefilter(o)+l[2],u=l[0];u--;)a=a.lastChild;y.merge(d,a.childNodes),(a=h.firstChild).textContent=""}else d.push(t.createTextNode(o));for(h.textContent="",p=0;o=d[p++];)if(r&&y.inArray(o,r)>-1)n&&n.push(o);else if(c=y.contains(o.ownerDocument,o),a=getAll(h.appendChild(o),"script"),c&&setGlobalEval(a),i)for(u=0;o=a[u++];)K.test(o.type||"")&&i.push(o);return h}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return a.activeElement}catch(e){}}function on(e,t,i,r,n,o){var a,s;if("object"==typeof t){"string"!=typeof i&&(r=r||i,i=void 0);for(s in t)on(e,s,i,r,t[s],o);return e}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),!1===n)n=returnFalse;else if(!n)return e;return 1===o&&(a=n,(n=function(e){return y().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=y.guid++)),e.each(function(){y.event.add(this,t,n,r,i)})}function manipulationTarget(e,t){return y.nodeName(e,"table")&&y.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e:e}function disableScript(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function restoreScript(e){var t=ae.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function cloneCopyEvent(e,t){var i,r,n,o,a,s,l,c;if(1===t.nodeType){if(F.hasData(e)&&(o=F.access(e),a=F.set(t,o),c=o.events)){delete a.handle,a.events={};for(n in c)for(i=0,r=c[n].length;i<r;i++)y.event.add(t,n,c[n][i])}U.hasData(e)&&(s=U.access(e),l=y.extend({},s),U.set(t,l))}}function fixInput(e,t){var i=t.nodeName.toLowerCase();"input"===i&&Y.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function domManip(e,t,i,r){t=c.apply([],t);var n,o,a,s,l,u,h=0,d=e.length,p=d-1,f=t[0],m=y.isFunction(f);if(m||d>1&&"string"==typeof f&&!v.checkClone&&oe.test(f))return e.each(function(n){var o=e.eq(n);m&&(t[0]=f.call(this,n,o.html())),domManip(o,t,i,r)});if(d&&(n=buildFragment(t,e[0].ownerDocument,!1,e,r),o=n.firstChild,1===n.childNodes.length&&(n=o),o||r)){for(s=(a=y.map(getAll(n,"script"),disableScript)).length;h<d;h++)l=n,h!==p&&(l=y.clone(l,!0,!0),s&&y.merge(a,getAll(l,"script"))),i.call(e[h],l,h);if(s)for(u=a[a.length-1].ownerDocument,y.map(a,restoreScript),h=0;h<s;h++)l=a[h],K.test(l.type||"")&&!F.access(l,"globalEval")&&y.contains(u,l)&&(l.src?y._evalUrl&&y._evalUrl(l.src):DOMEval(l.textContent.replace(se,""),u))}return e}function remove(e,t,i){for(var r,n=t?y.filter(t,e):e,o=0;null!=(r=n[o]);o++)i||1!==r.nodeType||y.cleanData(getAll(r)),r.parentNode&&(i&&y.contains(r.ownerDocument,r)&&setGlobalEval(getAll(r,"script")),r.parentNode.removeChild(r));return e}function curCSS(e,t,i){var r,n,o,a,s=e.style;return(i=i||ue(e))&&(""!==(a=i.getPropertyValue(t)||i[t])||y.contains(e.ownerDocument,e)||(a=y.style(e,t)),!v.pixelMarginRight()&&ce.test(a)&&le.test(t)&&(r=s.width,n=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=i.width,s.width=r,s.minWidth=n,s.maxWidth=o)),void 0!==a?a+"":a}function addGetHookIf(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}function vendorPropName(e){if(e in me)return e;for(var t=e[0].toUpperCase()+e.slice(1),i=fe.length;i--;)if((e=fe[i]+t)in me)return e}function setPositiveNumber(e,t,i){var r=V.exec(t);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):t}function augmentWidthOrHeight(e,t,i,r,n){var o,a=0;for(o=i===(r?"border":"content")?4:"width"===t?1:0;o<4;o+=2)"margin"===i&&(a+=y.css(e,i+j[o],!0,n)),r?("content"===i&&(a-=y.css(e,"padding"+j[o],!0,n)),"margin"!==i&&(a-=y.css(e,"border"+j[o]+"Width",!0,n))):(a+=y.css(e,"padding"+j[o],!0,n),"padding"!==i&&(a+=y.css(e,"border"+j[o]+"Width",!0,n)));return a}function getWidthOrHeight(e,t,i){var r,n=!0,o=ue(e),a="border-box"===y.css(e,"boxSizing",!1,o);if(e.getClientRects().length&&(r=e.getBoundingClientRect()[t]),r<=0||null==r){if(((r=curCSS(e,t,o))<0||null==r)&&(r=e.style[t]),ce.test(r))return r;n=a&&(v.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+augmentWidthOrHeight(e,t,i||(a?"border":"content"),n,o)+"px"}function Tween(e,t,i,r,n){return new Tween.prototype.init(e,t,i,r,n)}function raf(){ve&&(i.requestAnimationFrame(raf),y.fx.tick())}function createFxNow(){return i.setTimeout(function(){ge=void 0}),ge=y.now()}function genFx(e,t){var i,r=0,n={height:e};for(t=t?1:0;r<4;r+=2-t)n["margin"+(i=j[r])]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function createTween(e,t,i){for(var r,n=(Animation.tweeners[t]||[]).concat(Animation.tweeners["*"]),o=0,a=n.length;o<a;o++)if(r=n[o].call(i,t,e))return r}function Animation(e,t,i){var r,n,o=0,a=Animation.prefilters.length,s=y.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var t=ge||createFxNow(),i=Math.max(0,c.startTime+c.duration-t),r=1-(i/c.duration||0),o=0,a=c.tweens.length;o<a;o++)c.tweens[o].run(r);return s.notifyWith(e,[c,r,i]),r<1&&a?i:(s.resolveWith(e,[c]),!1)},c=s.promise({elem:e,props:y.extend({},t),opts:y.extend(!0,{specialEasing:{},easing:y.easing._default},i),originalProperties:t,originalOptions:i,startTime:ge||createFxNow(),duration:i.duration,tweens:[],createTween:function(t,i){var r=y.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop:function(t){var i=0,r=t?c.tweens.length:0;if(n)return this;for(n=!0;i<r;i++)c.tweens[i].run(1);return t?(s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c,t])):s.rejectWith(e,[c,t]),this}}),u=c.props;for(!function propFilter(e,t){var i,r,n,o,a;for(i in e)if(r=y.camelCase(i),n=t[r],o=e[i],y.isArray(o)&&(n=o[1],o=e[i]=o[0]),i!==r&&(e[r]=o,delete e[i]),(a=y.cssHooks[r])&&"expand"in a){o=a.expand(o),delete e[r];for(i in o)i in e||(e[i]=o[i],t[i]=n)}else t[r]=n}(u,c.opts.specialEasing);o<a;o++)if(r=Animation.prefilters[o].call(c,e,u,c.opts))return y.isFunction(r.stop)&&(y._queueHooks(c.elem,c.opts.queue).stop=y.proxy(r.stop,r)),r;return y.map(u,createTween,c),y.isFunction(c.opts.start)&&c.opts.start.call(e,c),y.fx.timer(y.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function stripAndCollapse(e){return(e.match(D)||[]).join(" ")}function getClass(e){return e.getAttribute&&e.getAttribute("class")||""}function buildParams(e,t,i,r){var n;if(y.isArray(t))y.each(t,function(t,n){i||Ce.test(e)?r(e,n):buildParams(e+"["+("object"==typeof n&&null!=n?t:"")+"]",n,i,r)});else if(i||"object"!==y.type(t))r(e,t);else for(n in t)buildParams(e+"["+n+"]",t[n],i,r)}function addToPrefiltersOrTransports(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var r,n=0,o=t.toLowerCase().match(D)||[];if(y.isFunction(i))for(;r=o[n++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(i)):(e[r]=e[r]||[]).push(i)}}function inspectPrefiltersOrTransports(e,t,i,r){function inspect(a){var s;return n[a]=!0,y.each(e[a]||[],function(e,a){var l=a(t,i,r);return"string"!=typeof l||o||n[l]?o?!(s=l):void 0:(t.dataTypes.unshift(l),inspect(l),!1)}),s}var n={},o=e===He;return inspect(t.dataTypes[0])||!n["*"]&&inspect("*")}function ajaxExtend(e,t){var i,r,n=y.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((n[i]?e:r||(r={}))[i]=t[i]);return r&&y.extend(!0,e,r),e}function getWindow(e){return y.isWindow(e)?e:9===e.nodeType&&e.defaultView}var o=[],a=i.document,s=Object.getPrototypeOf,l=o.slice,c=o.concat,u=o.push,h=o.indexOf,d={},p=d.toString,f=d.hasOwnProperty,m=f.toString,g=m.call(Object),v={},y=function(e,t){return new y.fn.init(e,t)},b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x=/^-ms-/,w=/-([a-z])/g,_=function(e,t){return t.toUpperCase()};y.fn=y.prototype={jquery:"3.1.1",constructor:y,length:0,toArray:function(){return l.call(this)},get:function(e){return null==e?l.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=y.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return y.each(this,e)},map:function(e){return this.pushStack(y.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(l.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:o.sort,splice:o.splice},y.extend=y.fn.extend=function(){var e,t,i,r,n,o,a=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[s]||{},s++),"object"==typeof a||y.isFunction(a)||(a={}),s===l&&(a=this,s--);s<l;s++)if(null!=(e=arguments[s]))for(t in e)i=a[t],a!==(r=e[t])&&(c&&r&&(y.isPlainObject(r)||(n=y.isArray(r)))?(n?(n=!1,o=i&&y.isArray(i)?i:[]):o=i&&y.isPlainObject(i)?i:{},a[t]=y.extend(c,o,r)):void 0!==r&&(a[t]=r));return a},y.extend({expando:"jQuery"+("3.1.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===y.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=y.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,i;return!(!e||"[object Object]"!==p.call(e))&&(!(t=s(e))||"function"==typeof(i=f.call(t,"constructor")&&t.constructor)&&m.call(i)===g)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?d[p.call(e)]||"object":typeof e},globalEval:function(e){DOMEval(e)},camelCase:function(e){return e.replace(x,"ms-").replace(w,_)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var i,r=0;if(isArrayLike(e))for(i=e.length;r<i&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(b,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(isArrayLike(Object(e))?y.merge(i,"string"==typeof e?[e]:e):u.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:h.call(t,e,i)},merge:function(e,t){for(var i=+t.length,r=0,n=e.length;r<i;r++)e[n++]=t[r];return e.length=n,e},grep:function(e,t,i){for(var r=[],n=0,o=e.length,a=!i;n<o;n++)!t(e[n],n)!==a&&r.push(e[n]);return r},map:function(e,t,i){var r,n,o=0,a=[];if(isArrayLike(e))for(r=e.length;o<r;o++)null!=(n=t(e[o],o,i))&&a.push(n);else for(o in e)null!=(n=t(e[o],o,i))&&a.push(n);return c.apply([],a)},guid:1,proxy:function(e,t){var i,r,n;if("string"==typeof t&&(i=e[t],t=e,e=i),y.isFunction(e))return r=l.call(arguments,2),n=function(){return e.apply(t||this,r.concat(l.call(arguments)))},n.guid=e.guid=e.guid||y.guid++,n},now:Date.now,support:v}),"function"==typeof Symbol&&(y.fn[Symbol.iterator]=o[Symbol.iterator]),y.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){d["[object "+t+"]"]=t.toLowerCase()});var E=function(e){function Sizzle(e,t,r,n){var o,s,c,u,h,f,v,y=t&&t.ownerDocument,_=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==_&&9!==_&&11!==_)return r;if(!n&&((t?t.ownerDocument||t:w)!==p&&d(t),t=t||p,m)){if(11!==_&&(h=Q.exec(e)))if(o=h[1]){if(9===_){if(!(c=t.getElementById(o)))return r;if(c.id===o)return r.push(c),r}else if(y&&(c=y.getElementById(o))&&b(t,c)&&c.id===o)return r.push(c),r}else{if(h[2])return B.apply(r,t.getElementsByTagName(e)),r;if((o=h[3])&&i.getElementsByClassName&&t.getElementsByClassName)return B.apply(r,t.getElementsByClassName(o)),r}if(i.qsa&&!T[e+" "]&&(!g||!g.test(e))){if(1!==_)y=t,v=e;else if("object"!==t.nodeName.toLowerCase()){for((u=t.getAttribute("id"))?u=u.replace(te,ie):t.setAttribute("id",u=x),s=(f=a(e)).length;s--;)f[s]="#"+u+" "+toSelector(f[s]);v=f.join(","),y=Z.test(e)&&testContext(t.parentNode)||t}if(v)try{return B.apply(r,y.querySelectorAll(v)),r}catch(e){}finally{u===x&&t.removeAttribute("id")}}}return l(e.replace(z,"$1"),t,r,n)}function createCache(){function cache(t,i){return e.push(t+" ")>r.cacheLength&&delete cache[e.shift()],cache[t+" "]=i}var e=[];return cache}function markFunction(e){return e[x]=!0,e}function assert(e){var t=p.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function addHandle(e,t){for(var i=e.split("|"),n=i.length;n--;)r.attrHandle[i[n]]=t}function siblingCheck(e,t){var i=t&&e,r=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function createInputPseudo(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function createButtonPseudo(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function createDisabledPseudo(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ne(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function createPositionalPseudo(e){return markFunction(function(t){return t=+t,markFunction(function(i,r){for(var n,o=e([],i.length,t),a=o.length;a--;)i[n=o[a]]&&(i[n]=!(r[n]=i[n]))})})}function testContext(e){return e&&void 0!==e.getElementsByTagName&&e}function setFilters(){}function toSelector(e){for(var t=0,i=e.length,r="";t<i;t++)r+=e[t].value;return r}function addCombinator(e,t,i){var r=t.dir,n=t.next,o=n||r,a=i&&"parentNode"===o,s=E++;return t.first?function(t,i,n){for(;t=t[r];)if(1===t.nodeType||a)return e(t,i,n);return!1}:function(t,i,l){var c,u,h,d=[_,s];if(l){for(;t=t[r];)if((1===t.nodeType||a)&&e(t,i,l))return!0}else for(;t=t[r];)if(1===t.nodeType||a)if(h=t[x]||(t[x]={}),u=h[t.uniqueID]||(h[t.uniqueID]={}),n&&n===t.nodeName.toLowerCase())t=t[r]||t;else{if((c=u[o])&&c[0]===_&&c[1]===s)return d[2]=c[2];if(u[o]=d,d[2]=e(t,i,l))return!0}return!1}}function elementMatcher(e){return e.length>1?function(t,i,r){for(var n=e.length;n--;)if(!e[n](t,i,r))return!1;return!0}:e[0]}function condense(e,t,i,r,n){for(var o,a=[],s=0,l=e.length,c=null!=t;s<l;s++)(o=e[s])&&(i&&!i(o,r,n)||(a.push(o),c&&t.push(s)));return a}function setMatcher(e,t,i,r,n,o){return r&&!r[x]&&(r=setMatcher(r)),n&&!n[x]&&(n=setMatcher(n,o)),markFunction(function(o,a,s,l){var c,u,h,d=[],p=[],f=a.length,m=o||function multipleContexts(e,t,i){for(var r=0,n=t.length;r<n;r++)Sizzle(e,t[r],i);return i}(t||"*",s.nodeType?[s]:s,[]),g=!e||!o&&t?m:condense(m,d,e,s,l),v=i?n||(o?e:f||r)?[]:a:g;if(i&&i(g,v,s,l),r)for(c=condense(v,p),r(c,[],s,l),u=c.length;u--;)(h=c[u])&&(v[p[u]]=!(g[p[u]]=h));if(o){if(n||e){if(n){for(c=[],u=v.length;u--;)(h=v[u])&&c.push(g[u]=h);n(null,v=[],c,l)}for(u=v.length;u--;)(h=v[u])&&(c=n?I(o,h):d[u])>-1&&(o[c]=!(a[c]=h))}}else v=condense(v===a?v.splice(f,v.length):v),n?n(null,a,v,l):B.apply(a,v)})}function matcherFromTokens(e){for(var t,i,n,o=e.length,a=r.relative[e[0].type],s=a||r.relative[" "],l=a?1:0,u=addCombinator(function(e){return e===t},s,!0),h=addCombinator(function(e){return I(t,e)>-1},s,!0),d=[function(e,i,r){var n=!a&&(r||i!==c)||((t=i).nodeType?u(e,i,r):h(e,i,r));return t=null,n}];l<o;l++)if(i=r.relative[e[l].type])d=[addCombinator(elementMatcher(d),i)];else{if((i=r.filter[e[l].type].apply(null,e[l].matches))[x]){for(n=++l;n<o&&!r.relative[e[n].type];n++);return setMatcher(l>1&&elementMatcher(d),l>1&&toSelector(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(z,"$1"),i,l<n&&matcherFromTokens(e.slice(l,n)),n<o&&matcherFromTokens(e=e.slice(n)),n<o&&toSelector(e))}d.push(i)}return elementMatcher(d)}var t,i,r,n,o,a,s,l,c,u,h,d,p,f,m,g,v,y,b,x="sizzle"+1*new Date,w=e.document,_=0,E=0,M=createCache(),A=createCache(),T=createCache(),S=function(e,t){return e===t&&(h=!0),0},P={}.hasOwnProperty,C=[],R=C.pop,L=C.push,B=C.push,D=C.slice,I=function(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},O="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",N="[\\x20\\t\\r\\n\\f]",k="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",F="\\["+N+"*("+k+")(?:"+N+"*([*^$|!~]?=)"+N+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+k+"))|)"+N+"*\\]",U=":("+k+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+F+")*)|.*)\\)|)",H=new RegExp(N+"+","g"),z=new RegExp("^"+N+"+|((?:^|[^\\\\])(?:\\\\.)*)"+N+"+$","g"),G=new RegExp("^"+N+"*,"+N+"*"),V=new RegExp("^"+N+"*([>+~]|"+N+")"+N+"*"),j=new RegExp("="+N+"*([^\\]'\"]*?)"+N+"*\\]","g"),W=new RegExp(U),q=new RegExp("^"+k+"$"),X={ID:new RegExp("^#("+k+")"),CLASS:new RegExp("^\\.("+k+")"),TAG:new RegExp("^("+k+"|[*])"),ATTR:new RegExp("^"+F),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+N+"*(even|odd|(([+-]|)(\\d*)n|)"+N+"*(?:([+-]|)"+N+"*(\\d+)|))"+N+"*\\)|)","i"),bool:new RegExp("^(?:"+O+")$","i"),needsContext:new RegExp("^"+N+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+N+"*((?:-\\d)?\\d*)"+N+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,$=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/[+~]/,J=new RegExp("\\\\([\\da-f]{1,6}"+N+"?|("+N+")|.)","ig"),ee=function(e,t,i){var r="0x"+t-65536;return r!=r||i?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},re=function(){d()},ne=addCombinator(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{B.apply(C=D.call(w.childNodes),w.childNodes),C[w.childNodes.length].nodeType}catch(e){B={apply:C.length?function(e,t){L.apply(e,D.call(t))}:function(e,t){for(var i=e.length,r=0;e[i++]=t[r++];);e.length=i-1}}}i=Sizzle.support={},o=Sizzle.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},d=Sizzle.setDocument=function(e){var t,n,a=e?e.ownerDocument||e:w;return a!==p&&9===a.nodeType&&a.documentElement?(p=a,f=p.documentElement,m=!o(p),w!==p&&(n=p.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",re,!1):n.attachEvent&&n.attachEvent("onunload",re)),i.attributes=assert(function(e){return e.className="i",!e.getAttribute("className")}),i.getElementsByTagName=assert(function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length}),i.getElementsByClassName=K.test(p.getElementsByClassName),i.getById=assert(function(e){return f.appendChild(e).id=x,!p.getElementsByName||!p.getElementsByName(x).length}),i.getById?(r.filter.ID=function(e){var t=e.replace(J,ee);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var i=t.getElementById(e);return i?[i]:[]}}):(r.filter.ID=function(e){var t=e.replace(J,ee);return function(e){var i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var i,r,n,o=t.getElementById(e);if(o){if((i=o.getAttributeNode("id"))&&i.value===e)return[o];for(n=t.getElementsByName(e),r=0;o=n[r++];)if((i=o.getAttributeNode("id"))&&i.value===e)return[o]}return[]}}),r.find.TAG=i.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):i.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,r=[],n=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[n++];)1===i.nodeType&&r.push(i);return r}return o},r.find.CLASS=i.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&m)return t.getElementsByClassName(e)},v=[],g=[],(i.qsa=K.test(p.querySelectorAll))&&(assert(function(e){f.appendChild(e).innerHTML="<a id='"+x+"'></a><select id='"+x+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&g.push("[*^$]="+N+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||g.push("\\["+N+"*(?:value|"+O+")"),e.querySelectorAll("[id~="+x+"-]").length||g.push("~="),e.querySelectorAll(":checked").length||g.push(":checked"),e.querySelectorAll("a#"+x+"+*").length||g.push(".#.+[+~]")}),assert(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&g.push("name"+N+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&g.push(":enabled",":disabled"),f.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(i.matchesSelector=K.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&assert(function(e){i.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),v.push("!=",U)}),g=g.length&&new RegExp(g.join("|")),v=v.length&&new RegExp(v.join("|")),t=K.test(f.compareDocumentPosition),b=t||K.test(f.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},S=t?function(e,t){if(e===t)return h=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!i.sortDetached&&t.compareDocumentPosition(e)===r?e===p||e.ownerDocument===w&&b(w,e)?-1:t===p||t.ownerDocument===w&&b(w,t)?1:u?I(u,e)-I(u,t):0:4&r?-1:1)}:function(e,t){if(e===t)return h=!0,0;var i,r=0,n=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!n||!o)return e===p?-1:t===p?1:n?-1:o?1:u?I(u,e)-I(u,t):0;if(n===o)return siblingCheck(e,t);for(i=e;i=i.parentNode;)a.unshift(i);for(i=t;i=i.parentNode;)s.unshift(i);for(;a[r]===s[r];)r++;return r?siblingCheck(a[r],s[r]):a[r]===w?-1:s[r]===w?1:0},p):p},Sizzle.matches=function(e,t){return Sizzle(e,null,null,t)},Sizzle.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&d(e),t=t.replace(j,"='$1']"),i.matchesSelector&&m&&!T[t+" "]&&(!v||!v.test(t))&&(!g||!g.test(t)))try{var r=y.call(e,t);if(r||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return Sizzle(t,p,null,[e]).length>0},Sizzle.contains=function(e,t){return(e.ownerDocument||e)!==p&&d(e),b(e,t)},Sizzle.attr=function(e,t){(e.ownerDocument||e)!==p&&d(e);var n=r.attrHandle[t.toLowerCase()],o=n&&P.call(r.attrHandle,t.toLowerCase())?n(e,t,!m):void 0;return void 0!==o?o:i.attributes||!m?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},Sizzle.escape=function(e){return(e+"").replace(te,ie)},Sizzle.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},Sizzle.uniqueSort=function(e){var t,r=[],n=0,o=0;if(h=!i.detectDuplicates,u=!i.sortStable&&e.slice(0),e.sort(S),h){for(;t=e[o++];)t===e[o]&&(n=r.push(o));for(;n--;)e.splice(r[n],1)}return u=null,e},n=Sizzle.getText=function(e){var t,i="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=n(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)i+=n(t);return i},(r=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(J,ee),e[3]=(e[3]||e[4]||e[5]||"").replace(J,ee),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||Sizzle.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&Sizzle.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&W.test(i)&&(t=a(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(J,ee).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=M[e+" "];return t||(t=new RegExp("(^|"+N+")"+e+"("+N+"|$)"))&&M(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,i){return function(r){var n=Sizzle.attr(r,e);return null==n?"!="===t:!t||(n+="","="===t?n===i:"!="===t?n!==i:"^="===t?i&&0===n.indexOf(i):"*="===t?i&&n.indexOf(i)>-1:"$="===t?i&&n.slice(-i.length)===i:"~="===t?(" "+n.replace(H," ")+" ").indexOf(i)>-1:"|="===t&&(n===i||n.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,r,n){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===n?function(e){return!!e.parentNode}:function(t,i,l){var c,u,h,d,p,f,m=o!==a?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s,b=!1;if(g){if(o){for(;m;){for(d=t;d=d[m];)if(s?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[a?g.firstChild:g.lastChild],a&&y){for(b=(p=(c=(u=(h=(d=g)[x]||(d[x]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]||[])[0]===_&&c[1])&&c[2],d=p&&g.childNodes[p];d=++p&&d&&d[m]||(b=p=0)||f.pop();)if(1===d.nodeType&&++b&&d===t){u[e]=[_,p,b];break}}else if(y&&(b=p=(c=(u=(h=(d=t)[x]||(d[x]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]||[])[0]===_&&c[1]),!1===b)for(;(d=++p&&d&&d[m]||(b=p=0)||f.pop())&&((s?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++b||(y&&((u=(h=d[x]||(d[x]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]=[_,b]),d!==t)););return(b-=n)===r||b%r==0&&b/r>=0}}},PSEUDO:function(e,t){var i,n=r.pseudos[e]||r.setFilters[e.toLowerCase()]||Sizzle.error("unsupported pseudo: "+e);return n[x]?n(t):n.length>1?(i=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?markFunction(function(e,i){for(var r,o=n(e,t),a=o.length;a--;)e[r=I(e,o[a])]=!(i[r]=o[a])}):function(e){return n(e,0,i)}):n}},pseudos:{not:markFunction(function(e){var t=[],i=[],r=s(e.replace(z,"$1"));return r[x]?markFunction(function(e,t,i,n){for(var o,a=r(e,null,n,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,n,o){return t[0]=e,r(t,null,o,i),t[0]=null,!i.pop()}}),has:markFunction(function(e){return function(t){return Sizzle(e,t).length>0}}),contains:markFunction(function(e){return e=e.replace(J,ee),function(t){return(t.textContent||t.innerText||n(t)).indexOf(e)>-1}}),lang:markFunction(function(e){return q.test(e||"")||Sizzle.error("unsupported lang: "+e),e=e.replace(J,ee).toLowerCase(),function(t){var i;do{if(i=m?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:createDisabledPseudo(!1),disabled:createDisabledPseudo(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return $.test(e.nodeName)},input:function(e){return Y.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(e,t){return[t-1]}),eq:createPositionalPseudo(function(e,t,i){return[i<0?i+t:i]}),even:createPositionalPseudo(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:createPositionalPseudo(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:createPositionalPseudo(function(e,t,i){for(var r=i<0?i+t:i;--r>=0;)e.push(r);return e}),gt:createPositionalPseudo(function(e,t,i){for(var r=i<0?i+t:i;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=createInputPseudo(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=createButtonPseudo(t);return setFilters.prototype=r.filters=r.pseudos,r.setFilters=new setFilters,a=Sizzle.tokenize=function(e,t){var i,n,o,a,s,l,c,u=A[e+" "];if(u)return t?0:u.slice(0);for(s=e,l=[],c=r.preFilter;s;){i&&!(n=G.exec(s))||(n&&(s=s.slice(n[0].length)||s),l.push(o=[])),i=!1,(n=V.exec(s))&&(i=n.shift(),o.push({value:i,type:n[0].replace(z," ")}),s=s.slice(i.length));for(a in r.filter)!(n=X[a].exec(s))||c[a]&&!(n=c[a](n))||(i=n.shift(),o.push({value:i,type:a,matches:n}),s=s.slice(i.length));if(!i)break}return t?s.length:s?Sizzle.error(e):A(e,l).slice(0)},s=Sizzle.compile=function(e,t){var i,n=[],o=[],s=T[e+" "];if(!s){for(t||(t=a(e)),i=t.length;i--;)(s=matcherFromTokens(t[i]))[x]?n.push(s):o.push(s);(s=T(e,function matcherFromGroupMatchers(e,t){var i=t.length>0,n=e.length>0,o=function(o,a,s,l,u){var h,f,g,v=0,y="0",b=o&&[],x=[],w=c,E=o||n&&r.find.TAG("*",u),M=_+=null==w?1:Math.random()||.1,A=E.length;for(u&&(c=a===p||a||u);y!==A&&null!=(h=E[y]);y++){if(n&&h){for(f=0,a||h.ownerDocument===p||(d(h),s=!m);g=e[f++];)if(g(h,a||p,s)){l.push(h);break}u&&(_=M)}i&&((h=!g&&h)&&v--,o&&b.push(h))}if(v+=y,i&&y!==v){for(f=0;g=t[f++];)g(b,x,a,s);if(o){if(v>0)for(;y--;)b[y]||x[y]||(x[y]=R.call(l));x=condense(x)}B.apply(l,x),u&&!o&&x.length>0&&v+t.length>1&&Sizzle.uniqueSort(l)}return u&&(_=M,c=w),b};return i?markFunction(o):o}(o,n))).selector=e}return s},l=Sizzle.select=function(e,t,i,n){var o,l,c,u,h,d="function"==typeof e&&e,p=!n&&a(e=d.selector||e);if(i=i||[],1===p.length){if((l=p[0]=p[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&9===t.nodeType&&m&&r.relative[l[1].type]){if(!(t=(r.find.ID(c.matches[0].replace(J,ee),t)||[])[0]))return i;d&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(o=X.needsContext.test(e)?0:l.length;o--&&(c=l[o],!r.relative[u=c.type]);)if((h=r.find[u])&&(n=h(c.matches[0].replace(J,ee),Z.test(l[0].type)&&testContext(t.parentNode)||t))){if(l.splice(o,1),!(e=n.length&&toSelector(l)))return B.apply(i,n),i;break}}return(d||s(e,p))(n,t,!m,i,!t||Z.test(e)&&testContext(t.parentNode)||t),i},i.sortStable=x.split("").sort(S).join("")===x,i.detectDuplicates=!!h,d(),i.sortDetached=assert(function(e){return 1&e.compareDocumentPosition(p.createElement("fieldset"))}),assert(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),i.attributes&&assert(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||addHandle("value",function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),assert(function(e){return null==e.getAttribute("disabled")})||addHandle(O,function(e,t,i){var r;if(!i)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),Sizzle}(i);y.find=E,y.expr=E.selectors,y.expr[":"]=y.expr.pseudos,y.uniqueSort=y.unique=E.uniqueSort,y.text=E.getText,y.isXMLDoc=E.isXML,y.contains=E.contains,y.escapeSelector=E.escape;var M=function(e,t,i){for(var r=[],n=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&y(e).is(i))break;r.push(e)}return r},A=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},T=y.expr.match.needsContext,S=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,P=/^.[^:#\[\.,]*$/;y.filter=function(e,t,i){var r=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?y.find.matchesSelector(r,e)?[r]:[]:y.find.matches(e,y.grep(t,function(e){return 1===e.nodeType}))},y.fn.extend({find:function(e){var t,i,r=this.length,n=this;if("string"!=typeof e)return this.pushStack(y(e).filter(function(){for(t=0;t<r;t++)if(y.contains(n[t],this))return!0}));for(i=this.pushStack([]),t=0;t<r;t++)y.find(e,n[t],i);return r>1?y.uniqueSort(i):i},filter:function(e){return this.pushStack(winnow(this,e||[],!1))},not:function(e){return this.pushStack(winnow(this,e||[],!0))},is:function(e){return!!winnow(this,"string"==typeof e&&T.test(e)?y(e):e||[],!1).length}});var C,R=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(y.fn.init=function(e,t,i){var r,n;if(!e)return this;if(i=i||C,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:R.exec(e))||!r[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof y?t[0]:t,y.merge(this,y.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:a,!0)),S.test(r[1])&&y.isPlainObject(t))for(r in t)y.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(n=a.getElementById(r[2]))&&(this[0]=n,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):y.isFunction(e)?void 0!==i.ready?i.ready(e):e(y):y.makeArray(e,this)}).prototype=y.fn,C=y(a);var L=/^(?:parents|prev(?:Until|All))/,B={children:!0,contents:!0,next:!0,prev:!0};y.fn.extend({has:function(e){var t=y(e,this),i=t.length;return this.filter(function(){for(var e=0;e<i;e++)if(y.contains(this,t[e]))return!0})},closest:function(e,t){var i,r=0,n=this.length,o=[],a="string"!=typeof e&&y(e);if(!T.test(e))for(;r<n;r++)for(i=this[r];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&y.find.matchesSelector(i,e))){o.push(i);break}return this.pushStack(o.length>1?y.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?h.call(y(e),this[0]):h.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(y.uniqueSort(y.merge(this.get(),y(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),y.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return M(e,"parentNode")},parentsUntil:function(e,t,i){return M(e,"parentNode",i)},next:function(e){return sibling(e,"nextSibling")},prev:function(e){return sibling(e,"previousSibling")},nextAll:function(e){return M(e,"nextSibling")},prevAll:function(e){return M(e,"previousSibling")},nextUntil:function(e,t,i){return M(e,"nextSibling",i)},prevUntil:function(e,t,i){return M(e,"previousSibling",i)},siblings:function(e){return A((e.parentNode||{}).firstChild,e)},children:function(e){return A(e.firstChild)},contents:function(e){return e.contentDocument||y.merge([],e.childNodes)}},function(e,t){y.fn[e]=function(i,r){var n=y.map(this,t,i);return"Until"!==e.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=y.filter(r,n)),this.length>1&&(B[e]||y.uniqueSort(n),L.test(e)&&n.reverse()),this.pushStack(n)}});var D=/[^\x20\t\r\n\f]+/g;y.Callbacks=function(e){e="string"==typeof e?function createOptions(e){var t={};return y.each(e.match(D)||[],function(e,i){t[i]=!0}),t}(e):y.extend({},e);var t,i,r,n,o=[],a=[],s=-1,l=function(){for(n=e.once,r=t=!0;a.length;s=-1)for(i=a.shift();++s<o.length;)!1===o[s].apply(i[0],i[1])&&e.stopOnFalse&&(s=o.length,i=!1);e.memory||(i=!1),t=!1,n&&(o=i?[]:"")},c={add:function(){return o&&(i&&!t&&(s=o.length-1,a.push(i)),function add(t){y.each(t,function(t,i){y.isFunction(i)?e.unique&&c.has(i)||o.push(i):i&&i.length&&"string"!==y.type(i)&&add(i)})}(arguments),i&&!t&&l()),this},remove:function(){return y.each(arguments,function(e,t){for(var i;(i=y.inArray(t,o,i))>-1;)o.splice(i,1),i<=s&&s--}),this},has:function(e){return e?y.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return n=a=[],o=i="",this},disabled:function(){return!o},lock:function(){return n=a=[],i||t||(o=i=""),this},locked:function(){return!!n},fireWith:function(e,i){return n||(i=[e,(i=i||[]).slice?i.slice():i],a.push(i),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},y.extend({Deferred:function(e){var t=[["notify","progress",y.Callbacks("memory"),y.Callbacks("memory"),2],["resolve","done",y.Callbacks("once memory"),y.Callbacks("once memory"),0,"resolved"],["reject","fail",y.Callbacks("once memory"),y.Callbacks("once memory"),1,"rejected"]],r="pending",n={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return n.then(null,e)},pipe:function(){var e=arguments;return y.Deferred(function(i){y.each(t,function(t,r){var n=y.isFunction(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=n&&n.apply(this,arguments);e&&y.isFunction(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[r[0]+"With"](this,n?[e]:arguments)})}),e=null}).promise()},then:function(e,r,n){function resolve(e,t,r,n){return function(){var a=this,s=arguments,l=function(){var i,l;if(!(e<o)){if((i=r.apply(a,s))===t.promise())throw new TypeError("Thenable self-resolution");l=i&&("object"==typeof i||"function"==typeof i)&&i.then,y.isFunction(l)?n?l.call(i,resolve(o,t,Identity,n),resolve(o,t,Thrower,n)):(o++,l.call(i,resolve(o,t,Identity,n),resolve(o,t,Thrower,n),resolve(o,t,Identity,t.notifyWith))):(r!==Identity&&(a=void 0,s=[i]),(n||t.resolveWith)(a,s))}},c=n?l:function(){try{l()}catch(i){y.Deferred.exceptionHook&&y.Deferred.exceptionHook(i,c.stackTrace),e+1>=o&&(r!==Thrower&&(a=void 0,s=[i]),t.rejectWith(a,s))}};e?c():(y.Deferred.getStackHook&&(c.stackTrace=y.Deferred.getStackHook()),i.setTimeout(c))}}var o=0;return y.Deferred(function(i){t[0][3].add(resolve(0,i,y.isFunction(n)?n:Identity,i.notifyWith)),t[1][3].add(resolve(0,i,y.isFunction(e)?e:Identity)),t[2][3].add(resolve(0,i,y.isFunction(r)?r:Thrower))}).promise()},promise:function(e){return null!=e?y.extend(e,n):n}},o={};return y.each(t,function(e,i){var a=i[2],s=i[5];n[i[1]]=a.add,s&&a.add(function(){r=s},t[3-e][2].disable,t[0][2].lock),a.add(i[3].fire),o[i[0]]=function(){return o[i[0]+"With"](this===o?void 0:this,arguments),this},o[i[0]+"With"]=a.fireWith}),n.promise(o),e&&e.call(o,o),o},when:function(e){var t=arguments.length,i=t,r=Array(i),n=l.call(arguments),o=y.Deferred(),a=function(e){return function(i){r[e]=this,n[e]=arguments.length>1?l.call(arguments):i,--t||o.resolveWith(r,n)}};if(t<=1&&(adoptValue(e,o.done(a(i)).resolve,o.reject),"pending"===o.state()||y.isFunction(n[i]&&n[i].then)))return o.then();for(;i--;)adoptValue(n[i],a(i),o.reject);return o.promise()}});var I=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;y.Deferred.exceptionHook=function(e,t){i.console&&i.console.warn&&e&&I.test(e.name)&&i.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},y.readyException=function(e){i.setTimeout(function(){throw e})};var O=y.Deferred();y.fn.ready=function(e){return O.then(e).catch(function(e){y.readyException(e)}),this},y.extend({isReady:!1,readyWait:1,holdReady:function(e){e?y.readyWait++:y.ready(!0)},ready:function(e){(!0===e?--y.readyWait:y.isReady)||(y.isReady=!0,!0!==e&&--y.readyWait>0||O.resolveWith(a,[y]))}}),y.ready.then=O.then,"complete"===a.readyState||"loading"!==a.readyState&&!a.documentElement.doScroll?i.setTimeout(y.ready):(a.addEventListener("DOMContentLoaded",completed),i.addEventListener("load",completed));var N=function(e,t,i,r,n,o,a){var s=0,l=e.length,c=null==i;if("object"===y.type(i)){n=!0;for(s in i)N(e,t,s,i[s],!0,o,a)}else if(void 0!==r&&(n=!0,y.isFunction(r)||(a=!0),c&&(a?(t.call(e,r),t=null):(c=t,t=function(e,t,i){return c.call(y(e),i)})),t))for(;s<l;s++)t(e[s],i,a?r:r.call(e[s],s,t(e[s],i)));return n?e:c?t.call(e):l?t(e[0],i):o},k=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};Data.uid=1,Data.prototype={cache:function(e){var t=e[this.expando];return t||(t={},k(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var r,n=this.cache(e);if("string"==typeof t)n[y.camelCase(t)]=i;else for(r in t)n[y.camelCase(r)]=t[r];return n},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][y.camelCase(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,r=e[this.expando];if(void 0!==r){if(void 0!==t){i=(t=y.isArray(t)?t.map(y.camelCase):(t=y.camelCase(t))in r?[t]:t.match(D)||[]).length;for(;i--;)delete r[t[i]]}(void 0===t||y.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!y.isEmptyObject(t)}};var F=new Data,U=new Data,H=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,z=/[A-Z]/g;y.extend({hasData:function(e){return U.hasData(e)||F.hasData(e)},data:function(e,t,i){return U.access(e,t,i)},removeData:function(e,t){U.remove(e,t)},_data:function(e,t,i){return F.access(e,t,i)},_removeData:function(e,t){F.remove(e,t)}}),y.fn.extend({data:function(e,t){var i,r,n,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(n=U.get(o),1===o.nodeType&&!F.get(o,"hasDataAttrs"))){for(i=a.length;i--;)a[i]&&0===(r=a[i].name).indexOf("data-")&&(r=y.camelCase(r.slice(5)),dataAttr(o,r,n[r]));F.set(o,"hasDataAttrs",!0)}return n}return"object"==typeof e?this.each(function(){U.set(this,e)}):N(this,function(t){var i;if(o&&void 0===t){if(void 0!==(i=U.get(o,e)))return i;if(void 0!==(i=dataAttr(o,e)))return i}else this.each(function(){U.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){U.remove(this,e)})}}),y.extend({queue:function(e,t,i){var r;if(e)return t=(t||"fx")+"queue",r=F.get(e,t),i&&(!r||y.isArray(i)?r=F.access(e,t,y.makeArray(i)):r.push(i)),r||[]},dequeue:function(e,t){t=t||"fx";var i=y.queue(e,t),r=i.length,n=i.shift(),o=y._queueHooks(e,t),a=function(){y.dequeue(e,t)};"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===t&&i.unshift("inprogress"),delete o.stop,n.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return F.get(e,i)||F.access(e,i,{empty:y.Callbacks("once memory").add(function(){F.remove(e,[t+"queue",i])})})}}),y.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?y.queue(this[0],e):void 0===t?this:this.each(function(){var i=y.queue(this,e,t);y._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&y.dequeue(this,e)})},dequeue:function(e){return this.each(function(){y.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,r=1,n=y.Deferred(),o=this,a=this.length,s=function(){--r||n.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(i=F.get(o[a],e+"queueHooks"))&&i.empty&&(r++,i.empty.add(s));return s(),n.promise(t)}});var G=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,V=new RegExp("^(?:([+-])=|)("+G+")([a-z%]*)$","i"),j=["Top","Right","Bottom","Left"],W=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&y.contains(e.ownerDocument,e)&&"none"===y.css(e,"display")},q=function(e,t,i,r){var n,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];n=i.apply(e,r||[]);for(o in t)e.style[o]=a[o];return n},X={};y.fn.extend({show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){W(this)?y(this).show():y(this).hide()})}});var Y=/^(?:checkbox|radio)$/i,$=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,K=/^$|\/(?:java|ecma)script/i,Q={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Q.optgroup=Q.option,Q.tbody=Q.tfoot=Q.colgroup=Q.caption=Q.thead,Q.th=Q.td;var Z=/<|&#?\w+;/;!function(){var e=a.createDocumentFragment().appendChild(a.createElement("div")),t=a.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),v.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",v.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var J=a.documentElement,ee=/^key/,te=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ie=/^([^.]*)(?:\.(.+)|)/;y.event={global:{},add:function(e,t,i,r,n){var o,a,s,l,c,u,h,d,p,f,m,g=F.get(e);if(g)for(i.handler&&(i=(o=i).handler,n=o.selector),n&&y.find.matchesSelector(J,n),i.guid||(i.guid=y.guid++),(l=g.events)||(l=g.events={}),(a=g.handle)||(a=g.handle=function(t){return void 0!==y&&y.event.triggered!==t.type?y.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(D)||[""]).length;c--;)p=m=(s=ie.exec(t[c])||[])[1],f=(s[2]||"").split(".").sort(),p&&(h=y.event.special[p]||{},p=(n?h.delegateType:h.bindType)||p,h=y.event.special[p]||{},u=y.extend({type:p,origType:m,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&y.expr.match.needsContext.test(n),namespace:f.join(".")},o),(d=l[p])||((d=l[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,r,f,a)||e.addEventListener&&e.addEventListener(p,a)),h.add&&(h.add.call(e,u),u.handler.guid||(u.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,u):d.push(u),y.event.global[p]=!0)},remove:function(e,t,i,r,n){var o,a,s,l,c,u,h,d,p,f,m,g=F.hasData(e)&&F.get(e);if(g&&(l=g.events)){for(c=(t=(t||"").match(D)||[""]).length;c--;)if(s=ie.exec(t[c])||[],p=m=s[1],f=(s[2]||"").split(".").sort(),p){for(h=y.event.special[p]||{},d=l[p=(r?h.delegateType:h.bindType)||p]||[],s=s[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=d.length;o--;)u=d[o],!n&&m!==u.origType||i&&i.guid!==u.guid||s&&!s.test(u.namespace)||r&&r!==u.selector&&("**"!==r||!u.selector)||(d.splice(o,1),u.selector&&d.delegateCount--,h.remove&&h.remove.call(e,u));a&&!d.length&&(h.teardown&&!1!==h.teardown.call(e,f,g.handle)||y.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)y.event.remove(e,p+t[c],i,r,!0);y.isEmptyObject(l)&&F.remove(e,"handle events")}},dispatch:function(e){var t,i,r,n,o,a,s=y.event.fix(e),l=new Array(arguments.length),c=(F.get(this,"events")||{})[s.type]||[],u=y.event.special[s.type]||{};for(l[0]=s,t=1;t<arguments.length;t++)l[t]=arguments[t];if(s.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,s)){for(a=y.event.handlers.call(this,s,c),t=0;(n=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=n.elem,i=0;(o=n.handlers[i++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,void 0!==(r=((y.event.special[o.origType]||{}).handle||o.handler).apply(n.elem,l))&&!1===(s.result=r)&&(s.preventDefault(),s.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,s),s.result}},handlers:function(e,t){var i,r,n,o,a,s=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(o=[],a={},i=0;i<l;i++)void 0===a[n=(r=t[i]).selector+" "]&&(a[n]=r.needsContext?y(n,this).index(c)>-1:y.find(n,this,null,[c]).length),a[n]&&o.push(r);o.length&&s.push({elem:c,handlers:o})}return c=this,l<t.length&&s.push({elem:c,handlers:t.slice(l)}),s},addProp:function(e,t){Object.defineProperty(y.Event.prototype,e,{enumerable:!0,configurable:!0,get:y.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[y.expando]?e:new y.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&y.nodeName(this,"input"))return this.click(),!1},_default:function(e){return y.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},y.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},y.Event=function(e,t){if(!(this instanceof y.Event))return new y.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?returnTrue:returnFalse,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&y.extend(this,t),this.timeStamp=e&&e.timeStamp||y.now(),this[y.expando]=!0},y.Event.prototype={constructor:y.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},y.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&ee.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&te.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},y.event.addProp),y.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){y.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,r=e.relatedTarget,n=e.handleObj;return r&&(r===this||y.contains(this,r))||(e.type=n.origType,i=n.handler.apply(this,arguments),e.type=t),i}}}),y.fn.extend({on:function(e,t,i,r){return on(this,e,t,i,r)},one:function(e,t,i,r){return on(this,e,t,i,r,1)},off:function(e,t,i){var r,n;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,y(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return!1!==t&&"function"!=typeof t||(i=t,t=void 0),!1===i&&(i=returnFalse),this.each(function(){y.event.remove(this,e,i,t)})}});var re=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,ne=/<script|<style|<link/i,oe=/checked\s*(?:[^=]|=\s*.checked.)/i,ae=/^true\/(.*)/,se=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;y.extend({htmlPrefilter:function(e){return e.replace(re,"<$1></$2>")},clone:function(e,t,i){var r,n,o,a,s=e.cloneNode(!0),l=y.contains(e.ownerDocument,e);if(!(v.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||y.isXMLDoc(e)))for(a=getAll(s),r=0,n=(o=getAll(e)).length;r<n;r++)fixInput(o[r],a[r]);if(t)if(i)for(o=o||getAll(e),a=a||getAll(s),r=0,n=o.length;r<n;r++)cloneCopyEvent(o[r],a[r]);else cloneCopyEvent(e,s);return(a=getAll(s,"script")).length>0&&setGlobalEval(a,!l&&getAll(e,"script")),s},cleanData:function(e){for(var t,i,r,n=y.event.special,o=0;void 0!==(i=e[o]);o++)if(k(i)){if(t=i[F.expando]){if(t.events)for(r in t.events)n[r]?y.event.remove(i,r):y.removeEvent(i,r,t.handle);i[F.expando]=void 0}i[U.expando]&&(i[U.expando]=void 0)}}}),y.fn.extend({detach:function(e){return remove(this,e,!0)},remove:function(e){return remove(this,e)},text:function(e){return N(this,function(e){return void 0===e?y.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return domManip(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){manipulationTarget(this,e).appendChild(e)}})},prepend:function(){return domManip(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=manipulationTarget(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return domManip(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return domManip(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(y.cleanData(getAll(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return y.clone(this,e,t)})},html:function(e){return N(this,function(e){var t=this[0]||{},i=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ne.test(e)&&!Q[($.exec(e)||["",""])[1].toLowerCase()]){e=y.htmlPrefilter(e);try{for(;i<r;i++)1===(t=this[i]||{}).nodeType&&(y.cleanData(getAll(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return domManip(this,arguments,function(t){var i=this.parentNode;y.inArray(this,e)<0&&(y.cleanData(getAll(this)),i&&i.replaceChild(t,this))},e)}}),y.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){y.fn[e]=function(e){for(var i,r=[],n=y(e),o=n.length-1,a=0;a<=o;a++)i=a===o?this:this.clone(!0),y(n[a])[t](i),u.apply(r,i.get());return this.pushStack(r)}});var le=/^margin/,ce=new RegExp("^("+G+")(?!px)[a-z%]+$","i"),ue=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=i),t.getComputedStyle(e)};!function(){function computeStyleTests(){if(s){s.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",s.innerHTML="",J.appendChild(o);var a=i.getComputedStyle(s);e="1%"!==a.top,n="2px"===a.marginLeft,t="4px"===a.width,s.style.marginRight="50%",r="4px"===a.marginRight,J.removeChild(o),s=null}}var e,t,r,n,o=a.createElement("div"),s=a.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",v.clearCloneStyle="content-box"===s.style.backgroundClip,o.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",o.appendChild(s),y.extend(v,{pixelPosition:function(){return computeStyleTests(),e},boxSizingReliable:function(){return computeStyleTests(),t},pixelMarginRight:function(){return computeStyleTests(),r},reliableMarginLeft:function(){return computeStyleTests(),n}}))}();var he=/^(none|table(?!-c[ea]).+)/,de={position:"absolute",visibility:"hidden",display:"block"},pe={letterSpacing:"0",fontWeight:"400"},fe=["Webkit","Moz","ms"],me=a.createElement("div").style;y.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=curCSS(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,o,a,s=y.camelCase(t),l=e.style;if(t=y.cssProps[s]||(y.cssProps[s]=vendorPropName(s)||s),a=y.cssHooks[t]||y.cssHooks[s],void 0===i)return a&&"get"in a&&void 0!==(n=a.get(e,!1,r))?n:l[t];"string"==(o=typeof i)&&(n=V.exec(i))&&n[1]&&(i=adjustCSS(e,t,n),o="number"),null!=i&&i==i&&("number"===o&&(i+=n&&n[3]||(y.cssNumber[s]?"":"px")),v.clearCloneStyle||""!==i||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(i=a.set(e,i,r))||(l[t]=i))}},css:function(e,t,i,r){var n,o,a,s=y.camelCase(t);return t=y.cssProps[s]||(y.cssProps[s]=vendorPropName(s)||s),(a=y.cssHooks[t]||y.cssHooks[s])&&"get"in a&&(n=a.get(e,!0,i)),void 0===n&&(n=curCSS(e,t,r)),"normal"===n&&t in pe&&(n=pe[t]),""===i||i?(o=parseFloat(n),!0===i||isFinite(o)?o||0:n):n}}),y.each(["height","width"],function(e,t){y.cssHooks[t]={get:function(e,i,r){if(i)return!he.test(y.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?getWidthOrHeight(e,t,r):q(e,de,function(){return getWidthOrHeight(e,t,r)})},set:function(e,i,r){var n,o=r&&ue(e),a=r&&augmentWidthOrHeight(e,t,r,"border-box"===y.css(e,"boxSizing",!1,o),o);return a&&(n=V.exec(i))&&"px"!==(n[3]||"px")&&(e.style[t]=i,i=y.css(e,t)),setPositiveNumber(0,i,a)}}}),y.cssHooks.marginLeft=addGetHookIf(v.reliableMarginLeft,function(e,t){if(t)return(parseFloat(curCSS(e,"marginLeft"))||e.getBoundingClientRect().left-q(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),y.each({margin:"",padding:"",border:"Width"},function(e,t){y.cssHooks[e+t]={expand:function(i){for(var r=0,n={},o="string"==typeof i?i.split(" "):[i];r<4;r++)n[e+j[r]+t]=o[r]||o[r-2]||o[0];return n}},le.test(e)||(y.cssHooks[e+t].set=setPositiveNumber)}),y.fn.extend({css:function(e,t){return N(this,function(e,t,i){var r,n,o={},a=0;if(y.isArray(t)){for(r=ue(e),n=t.length;a<n;a++)o[t[a]]=y.css(e,t[a],!1,r);return o}return void 0!==i?y.style(e,t,i):y.css(e,t)},e,t,arguments.length>1)}}),y.Tween=Tween,(Tween.prototype={constructor:Tween,init:function(e,t,i,r,n,o){this.elem=e,this.prop=i,this.easing=n||y.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(y.cssNumber[i]?"":"px")},cur:function(){var e=Tween.propHooks[this.prop];return e&&e.get?e.get(this):Tween.propHooks._default.get(this)},run:function(e){var t,i=Tween.propHooks[this.prop];return this.options.duration?this.pos=t=y.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):Tween.propHooks._default.set(this),this}}).init.prototype=Tween.prototype,(Tween.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=y.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){y.fx.step[e.prop]?y.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[y.cssProps[e.prop]]&&!y.cssHooks[e.prop]?e.elem[e.prop]=e.now:y.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Tween.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},y.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},y.fx=Tween.prototype.init,y.fx.step={};var ge,ve,ye=/^(?:toggle|show|hide)$/,be=/queueHooks$/;y.Animation=y.extend(Animation,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return adjustCSS(i.elem,e,V.exec(t),i),i}]},tweener:function(e,t){y.isFunction(e)?(t=e,e=["*"]):e=e.match(D);for(var i,r=0,n=e.length;r<n;r++)i=e[r],Animation.tweeners[i]=Animation.tweeners[i]||[],Animation.tweeners[i].unshift(t)},prefilters:[function defaultPrefilter(e,t,i){var r,n,o,a,s,l,c,u,h="width"in t||"height"in t,d=this,p={},f=e.style,m=e.nodeType&&W(e),g=F.get(e,"fxshow");i.queue||(null==(a=y._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,d.always(function(){d.always(function(){a.unqueued--,y.queue(e,"fx").length||a.empty.fire()})}));for(r in t)if(n=t[r],ye.test(n)){if(delete t[r],o=o||"toggle"===n,n===(m?"hide":"show")){if("show"!==n||!g||void 0===g[r])continue;m=!0}p[r]=g&&g[r]||y.style(e,r)}if((l=!y.isEmptyObject(t))||!y.isEmptyObject(p)){h&&1===e.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=g&&g.display)&&(c=F.get(e,"display")),"none"===(u=y.css(e,"display"))&&(c?u=c:(showHide([e],!0),c=e.style.display||c,u=y.css(e,"display"),showHide([e]))),("inline"===u||"inline-block"===u&&null!=c)&&"none"===y.css(e,"float")&&(l||(d.done(function(){f.display=c}),null==c&&(u=f.display,c="none"===u?"":u)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",d.always(function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]})),l=!1;for(r in p)l||(g?"hidden"in g&&(m=g.hidden):g=F.access(e,"fxshow",{display:c}),o&&(g.hidden=!m),m&&showHide([e],!0),d.done(function(){m||showHide([e]),F.remove(e,"fxshow");for(r in p)y.style(e,r,p[r])})),l=createTween(m?g[r]:0,r,d),r in g||(g[r]=l.start,m&&(l.end=l.start,l.start=0))}}],prefilter:function(e,t){t?Animation.prefilters.unshift(e):Animation.prefilters.push(e)}}),y.speed=function(e,t,i){var r=e&&"object"==typeof e?y.extend({},e):{complete:i||!i&&t||y.isFunction(e)&&e,duration:e,easing:i&&t||t&&!y.isFunction(t)&&t};return y.fx.off||a.hidden?r.duration=0:"number"!=typeof r.duration&&(r.duration in y.fx.speeds?r.duration=y.fx.speeds[r.duration]:r.duration=y.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){y.isFunction(r.old)&&r.old.call(this),r.queue&&y.dequeue(this,r.queue)},r},y.fn.extend({fadeTo:function(e,t,i,r){return this.filter(W).css("opacity",0).show().end().animate({opacity:t},e,i,r)},animate:function(e,t,i,r){var n=y.isEmptyObject(e),o=y.speed(t,i,r),a=function(){var t=Animation(this,y.extend({},e),o);(n||F.get(this,"finish"))&&t.stop(!0)};return a.finish=a,n||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,i){var r=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=y.timers,a=F.get(this);if(n)a[n]&&a[n].stop&&r(a[n]);else for(n in a)a[n]&&a[n].stop&&be.test(n)&&r(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(i),t=!1,o.splice(n,1));!t&&i||y.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,i=F.get(this),r=i[e+"queue"],n=i[e+"queueHooks"],o=y.timers,a=r?r.length:0;for(i.finish=!0,y.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete i.finish})}}),y.each(["toggle","show","hide"],function(e,t){var i=y.fn[t];y.fn[t]=function(e,r,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(genFx(t,!0),e,r,n)}}),y.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){y.fn[e]=function(e,i,r){return this.animate(t,e,i,r)}}),y.timers=[],y.fx.tick=function(){var e,t=0,i=y.timers;for(ge=y.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||y.fx.stop(),ge=void 0},y.fx.timer=function(e){y.timers.push(e),e()?y.fx.start():y.timers.pop()},y.fx.interval=13,y.fx.start=function(){ve||(ve=i.requestAnimationFrame?i.requestAnimationFrame(raf):i.setInterval(y.fx.tick,y.fx.interval))},y.fx.stop=function(){i.cancelAnimationFrame?i.cancelAnimationFrame(ve):i.clearInterval(ve),ve=null},y.fx.speeds={slow:600,fast:200,_default:400},y.fn.delay=function(e,t){return e=y.fx?y.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,r){var n=i.setTimeout(t,e);r.stop=function(){i.clearTimeout(n)}})},function(){var e=a.createElement("input"),t=a.createElement("select").appendChild(a.createElement("option"));e.type="checkbox",v.checkOn=""!==e.value,v.optSelected=t.selected,(e=a.createElement("input")).value="t",e.type="radio",v.radioValue="t"===e.value}();var xe,we=y.expr.attrHandle;y.fn.extend({attr:function(e,t){return N(this,y.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){y.removeAttr(this,e)})}}),y.extend({attr:function(e,t,i){var r,n,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?y.prop(e,t,i):(1===o&&y.isXMLDoc(e)||(n=y.attrHooks[t.toLowerCase()]||(y.expr.match.bool.test(t)?xe:void 0)),void 0!==i?null===i?void y.removeAttr(e,t):n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:(e.setAttribute(t,i+""),i):n&&"get"in n&&null!==(r=n.get(e,t))?r:null==(r=y.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!v.radioValue&&"radio"===t&&y.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,r=0,n=t&&t.match(D);if(n&&1===e.nodeType)for(;i=n[r++];)e.removeAttribute(i)}}),xe={set:function(e,t,i){return!1===t?y.removeAttr(e,i):e.setAttribute(i,i),i}},y.each(y.expr.match.bool.source.match(/\w+/g),function(e,t){var i=we[t]||y.find.attr;we[t]=function(e,t,r){var n,o,a=t.toLowerCase();return r||(o=we[a],we[a]=n,n=null!=i(e,t,r)?a:null,we[a]=o),n}});var _e=/^(?:input|select|textarea|button)$/i,Ee=/^(?:a|area)$/i;y.fn.extend({prop:function(e,t){return N(this,y.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[y.propFix[e]||e]})}}),y.extend({prop:function(e,t,i){var r,n,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&y.isXMLDoc(e)||(t=y.propFix[t]||t,n=y.propHooks[t]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:e[t]=i:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=y.find.attr(e,"tabindex");return t?parseInt(t,10):_e.test(e.nodeName)||Ee.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),v.optSelected||(y.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),y.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){y.propFix[this.toLowerCase()]=this}),y.fn.extend({addClass:function(e){var t,i,r,n,o,a,s,l=0;if(y.isFunction(e))return this.each(function(t){y(this).addClass(e.call(this,t,getClass(this)))});if("string"==typeof e&&e)for(t=e.match(D)||[];i=this[l++];)if(n=getClass(i),r=1===i.nodeType&&" "+stripAndCollapse(n)+" "){for(a=0;o=t[a++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");n!==(s=stripAndCollapse(r))&&i.setAttribute("class",s)}return this},removeClass:function(e){var t,i,r,n,o,a,s,l=0;if(y.isFunction(e))return this.each(function(t){y(this).removeClass(e.call(this,t,getClass(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(D)||[];i=this[l++];)if(n=getClass(i),r=1===i.nodeType&&" "+stripAndCollapse(n)+" "){for(a=0;o=t[a++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");n!==(s=stripAndCollapse(r))&&i.setAttribute("class",s)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):y.isFunction(e)?this.each(function(i){y(this).toggleClass(e.call(this,i,getClass(this),t),t)}):this.each(function(){var t,r,n,o;if("string"===i)for(r=0,n=y(this),o=e.match(D)||[];t=o[r++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else void 0!==e&&"boolean"!==i||((t=getClass(this))&&F.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":F.get(this,"__className__")||""))})},hasClass:function(e){var t,i,r=0;for(t=" "+e+" ";i=this[r++];)if(1===i.nodeType&&(" "+stripAndCollapse(getClass(i))+" ").indexOf(t)>-1)return!0;return!1}});var Me=/\r/g;y.fn.extend({val:function(e){var t,i,r,n=this[0];if(arguments.length)return r=y.isFunction(e),this.each(function(i){var n;1===this.nodeType&&(null==(n=r?e.call(this,i,y(this).val()):e)?n="":"number"==typeof n?n+="":y.isArray(n)&&(n=y.map(n,function(e){return null==e?"":e+""})),(t=y.valHooks[this.type]||y.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))});if(n)return(t=y.valHooks[n.type]||y.valHooks[n.nodeName.toLowerCase()])&&"get"in t&&void 0!==(i=t.get(n,"value"))?i:"string"==typeof(i=n.value)?i.replace(Me,""):null==i?"":i}}),y.extend({valHooks:{option:{get:function(e){var t=y.find.attr(e,"value");return null!=t?t:stripAndCollapse(y.text(e))}},select:{get:function(e){var t,i,r,n=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],l=a?o+1:n.length;for(r=o<0?l:a?o:0;r<l;r++)if(((i=n[r]).selected||r===o)&&!i.disabled&&(!i.parentNode.disabled||!y.nodeName(i.parentNode,"optgroup"))){if(t=y(i).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var i,r,n=e.options,o=y.makeArray(t),a=n.length;a--;)((r=n[a]).selected=y.inArray(y.valHooks.option.get(r),o)>-1)&&(i=!0);return i||(e.selectedIndex=-1),o}}}}),y.each(["radio","checkbox"],function(){y.valHooks[this]={set:function(e,t){if(y.isArray(t))return e.checked=y.inArray(y(e).val(),t)>-1}},v.checkOn||(y.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Ae=/^(?:focusinfocus|focusoutblur)$/;y.extend(y.event,{trigger:function(e,t,r,n){var o,s,l,c,u,h,d,p=[r||a],m=f.call(e,"type")?e.type:e,g=f.call(e,"namespace")?e.namespace.split("."):[];if(s=l=r=r||a,3!==r.nodeType&&8!==r.nodeType&&!Ae.test(m+y.event.triggered)&&(m.indexOf(".")>-1&&(m=(g=m.split(".")).shift(),g.sort()),u=m.indexOf(":")<0&&"on"+m,e=e[y.expando]?e:new y.Event(m,"object"==typeof e&&e),e.isTrigger=n?2:3,e.namespace=g.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:y.makeArray(t,[e]),d=y.event.special[m]||{},n||!d.trigger||!1!==d.trigger.apply(r,t))){if(!n&&!d.noBubble&&!y.isWindow(r)){for(c=d.delegateType||m,Ae.test(c+m)||(s=s.parentNode);s;s=s.parentNode)p.push(s),l=s;l===(r.ownerDocument||a)&&p.push(l.defaultView||l.parentWindow||i)}for(o=0;(s=p[o++])&&!e.isPropagationStopped();)e.type=o>1?c:d.bindType||m,(h=(F.get(s,"events")||{})[e.type]&&F.get(s,"handle"))&&h.apply(s,t),(h=u&&s[u])&&h.apply&&k(s)&&(e.result=h.apply(s,t),!1===e.result&&e.preventDefault());return e.type=m,n||e.isDefaultPrevented()||d._default&&!1!==d._default.apply(p.pop(),t)||!k(r)||u&&y.isFunction(r[m])&&!y.isWindow(r)&&((l=r[u])&&(r[u]=null),y.event.triggered=m,r[m](),y.event.triggered=void 0,l&&(r[u]=l)),e.result}},simulate:function(e,t,i){var r=y.extend(new y.Event,i,{type:e,isSimulated:!0});y.event.trigger(r,null,t)}}),y.fn.extend({trigger:function(e,t){return this.each(function(){y.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return y.event.trigger(e,t,i,!0)}}),y.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){y.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),y.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.focusin="onfocusin"in i,v.focusin||y.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){y.event.simulate(t,e.target,y.event.fix(e))};y.event.special[t]={setup:function(){var r=this.ownerDocument||this,n=F.access(r,t);n||r.addEventListener(e,i,!0),F.access(r,t,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=F.access(r,t)-1;n?F.access(r,t,n):(r.removeEventListener(e,i,!0),F.remove(r,t))}}});var Te=i.location,Se=y.now(),Pe=/\?/;y.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new i.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||y.error("Invalid XML: "+e),t};var Ce=/\[\]$/,Re=/\r?\n/g,Le=/^(?:submit|button|image|reset|file)$/i,Be=/^(?:input|select|textarea|keygen)/i;y.param=function(e,t){var i,r=[],n=function(e,t){var i=y.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(y.isArray(e)||e.jquery&&!y.isPlainObject(e))y.each(e,function(){n(this.name,this.value)});else for(i in e)buildParams(i,e[i],t,n);return r.join("&")},y.fn.extend({serialize:function(){return y.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=y.prop(this,"elements");return e?y.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!y(this).is(":disabled")&&Be.test(this.nodeName)&&!Le.test(e)&&(this.checked||!Y.test(e))}).map(function(e,t){var i=y(this).val();return null==i?null:y.isArray(i)?y.map(i,function(e){return{name:t.name,value:e.replace(Re,"\r\n")}}):{name:t.name,value:i.replace(Re,"\r\n")}}).get()}});var De=/%20/g,Ie=/#.*$/,Oe=/([?&])_=[^&]*/,Ne=/^(.*?):[ \t]*([^\r\n]*)$/gm,ke=/^(?:GET|HEAD)$/,Fe=/^\/\//,Ue={},He={},ze="*/".concat("*"),Ge=a.createElement("a");Ge.href=Te.href,y.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Te.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Te.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ze,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":y.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ajaxExtend(ajaxExtend(e,y.ajaxSettings),t):ajaxExtend(y.ajaxSettings,e)},ajaxPrefilter:addToPrefiltersOrTransports(Ue),ajaxTransport:addToPrefiltersOrTransports(He),ajax:function(e,t){function done(e,t,a,s){var c,d,p,w,_,E=t;u||(u=!0,l&&i.clearTimeout(l),r=void 0,o=s||"",M.readyState=e>0?4:0,c=e>=200&&e<300||304===e,a&&(w=function ajaxHandleResponses(e,t,i){for(var r,n,o,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(n in s)if(s[n]&&s[n].test(r)){l.unshift(n);break}if(l[0]in i)o=l[0];else{for(n in i){if(!l[0]||e.converters[n+" "+l[0]]){o=n;break}a||(a=n)}o=o||a}if(o)return o!==l[0]&&l.unshift(o),i[o]}(f,M,a)),w=function ajaxConvert(e,t,i,r){var n,o,a,s,l,c={},u=e.dataTypes.slice();if(u[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];for(o=u.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=u.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(a=c[l+" "+o]||c["* "+o]))for(n in c)if((s=n.split(" "))[1]===o&&(a=c[l+" "+s[0]]||c["* "+s[0]])){!0===a?a=c[n]:!0!==c[n]&&(o=s[0],u.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}(f,w,M,c),c?(f.ifModified&&((_=M.getResponseHeader("Last-Modified"))&&(y.lastModified[n]=_),(_=M.getResponseHeader("etag"))&&(y.etag[n]=_)),204===e||"HEAD"===f.type?E="nocontent":304===e?E="notmodified":(E=w.state,d=w.data,c=!(p=w.error))):(p=E,!e&&E||(E="error",e<0&&(e=0))),M.status=e,M.statusText=(t||E)+"",c?v.resolveWith(m,[d,E,M]):v.rejectWith(m,[M,E,p]),M.statusCode(x),x=void 0,h&&g.trigger(c?"ajaxSuccess":"ajaxError",[M,f,c?d:p]),b.fireWith(m,[M,E]),h&&(g.trigger("ajaxComplete",[M,f]),--y.active||y.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,n,o,s,l,c,u,h,d,p,f=y.ajaxSetup({},t),m=f.context||f,g=f.context&&(m.nodeType||m.jquery)?y(m):y.event,v=y.Deferred(),b=y.Callbacks("once memory"),x=f.statusCode||{},w={},_={},E="canceled",M={readyState:0,getResponseHeader:function(e){var t;if(u){if(!s)for(s={};t=Ne.exec(o);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return u?o:null},setRequestHeader:function(e,t){return null==u&&(e=_[e.toLowerCase()]=_[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==u&&(f.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)M.always(e[M.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||E;return r&&r.abort(t),done(0,t),this}};if(v.promise(M),f.url=((e||f.url||Te.href)+"").replace(Fe,Te.protocol+"//"),f.type=t.method||t.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(D)||[""],null==f.crossDomain){c=a.createElement("a");try{c.href=f.url,c.href=c.href,f.crossDomain=Ge.protocol+"//"+Ge.host!=c.protocol+"//"+c.host}catch(e){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=y.param(f.data,f.traditional)),inspectPrefiltersOrTransports(Ue,f,t,M),u)return M;(h=y.event&&f.global)&&0==y.active++&&y.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!ke.test(f.type),n=f.url.replace(Ie,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(De,"+")):(p=f.url.slice(n.length),f.data&&(n+=(Pe.test(n)?"&":"?")+f.data,delete f.data),!1===f.cache&&(n=n.replace(Oe,"$1"),p=(Pe.test(n)?"&":"?")+"_="+Se+++p),f.url=n+p),f.ifModified&&(y.lastModified[n]&&M.setRequestHeader("If-Modified-Since",y.lastModified[n]),y.etag[n]&&M.setRequestHeader("If-None-Match",y.etag[n])),(f.data&&f.hasContent&&!1!==f.contentType||t.contentType)&&M.setRequestHeader("Content-Type",f.contentType),M.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+ze+"; q=0.01":""):f.accepts["*"]);for(d in f.headers)M.setRequestHeader(d,f.headers[d]);if(f.beforeSend&&(!1===f.beforeSend.call(m,M,f)||u))return M.abort();if(E="abort",b.add(f.complete),M.done(f.success),M.fail(f.error),r=inspectPrefiltersOrTransports(He,f,t,M)){if(M.readyState=1,h&&g.trigger("ajaxSend",[M,f]),u)return M;f.async&&f.timeout>0&&(l=i.setTimeout(function(){M.abort("timeout")},f.timeout));try{u=!1,r.send(w,done)}catch(e){if(u)throw e;done(-1,e)}}else done(-1,"No Transport");return M},getJSON:function(e,t,i){return y.get(e,t,i,"json")},getScript:function(e,t){return y.get(e,void 0,t,"script")}}),y.each(["get","post"],function(e,t){y[t]=function(e,i,r,n){return y.isFunction(i)&&(n=n||r,r=i,i=void 0),y.ajax(y.extend({url:e,type:t,dataType:n,data:i,success:r},y.isPlainObject(e)&&e))}}),y._evalUrl=function(e){return y.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},y.fn.extend({wrapAll:function(e){var t;return this[0]&&(y.isFunction(e)&&(e=e.call(this[0])),t=y(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return y.isFunction(e)?this.each(function(t){y(this).wrapInner(e.call(this,t))}):this.each(function(){var t=y(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=y.isFunction(e);return this.each(function(i){y(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){y(this).replaceWith(this.childNodes)}),this}}),y.expr.pseudos.hidden=function(e){return!y.expr.pseudos.visible(e)},y.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},y.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(e){}};var Ve={0:200,1223:204},je=y.ajaxSettings.xhr();v.cors=!!je&&"withCredentials"in je,v.ajax=je=!!je,y.ajaxTransport(function(e){var t,r;if(v.cors||je&&!e.crossDomain)return{send:function(n,o){var a,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)s[a]=e.xhrFields[a];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(a in n)s.setRequestHeader(a,n[a]);t=function(e){return function(){t&&(t=r=s.onload=s.onerror=s.onabort=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(Ve[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=t(),r=s.onerror=t("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&i.setTimeout(function(){t&&r()})},t=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}}),y.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),y.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return y.globalEval(e),e}}}),y.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),y.ajaxTransport("script",function(e){if(e.crossDomain){var t,i;return{send:function(r,n){t=y("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&n("error"===e.type?404:200,e.type)}),a.head.appendChild(t[0])},abort:function(){i&&i()}}}});var We=[],qe=/(=)\?(?=&|$)|\?\?/;y.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=We.pop()||y.expando+"_"+Se++;return this[e]=!0,e}}),y.ajaxPrefilter("json jsonp",function(e,t,r){var n,o,a,s=!1!==e.jsonp&&(qe.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&qe.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=y.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(qe,"$1"+n):!1!==e.jsonp&&(e.url+=(Pe.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return a||y.error(n+" was not called"),a[0]},e.dataTypes[0]="json",o=i[n],i[n]=function(){a=arguments},r.always(function(){void 0===o?y(i).removeProp(n):i[n]=o,e[n]&&(e.jsonpCallback=t.jsonpCallback,We.push(n)),a&&y.isFunction(o)&&o(a[0]),a=o=void 0}),"script"}),v.createHTMLDocument=function(){var e=a.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),y.parseHTML=function(e,t,i){if("string"!=typeof e)return[];"boolean"==typeof t&&(i=t,t=!1);var r,n,o;return t||(v.createHTMLDocument?((r=(t=a.implementation.createHTMLDocument("")).createElement("base")).href=a.location.href,t.head.appendChild(r)):t=a),n=S.exec(e),o=!i&&[],n?[t.createElement(n[1])]:(n=buildFragment([e],t,o),o&&o.length&&y(o).remove(),y.merge([],n.childNodes))},y.fn.load=function(e,t,i){var r,n,o,a=this,s=e.indexOf(" ");return s>-1&&(r=stripAndCollapse(e.slice(s)),e=e.slice(0,s)),y.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(n="POST"),a.length>0&&y.ajax({url:e,type:n||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?y("<div>").append(y.parseHTML(e)).find(r):e)}).always(i&&function(e,t){a.each(function(){i.apply(this,o||[e.responseText,t,e])})}),this},y.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){y.fn[t]=function(e){return this.on(t,e)}}),y.expr.pseudos.animated=function(e){return y.grep(y.timers,function(t){return e===t.elem}).length},y.offset={setOffset:function(e,t,i){var r,n,o,a,s,l,c=y.css(e,"position"),u=y(e),h={};"static"===c&&(e.style.position="relative"),s=u.offset(),o=y.css(e,"top"),l=y.css(e,"left"),("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1?(a=(r=u.position()).top,n=r.left):(a=parseFloat(o)||0,n=parseFloat(l)||0),y.isFunction(t)&&(t=t.call(e,i,y.extend({},s))),null!=t.top&&(h.top=t.top-s.top+a),null!=t.left&&(h.left=t.left-s.left+n),"using"in t?t.using.call(e,h):u.css(h)}},y.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){y.offset.setOffset(this,e,t)});var t,i,r,n,o=this[0];if(o)return o.getClientRects().length?(r=o.getBoundingClientRect()).width||r.height?(n=o.ownerDocument,i=getWindow(n),t=n.documentElement,{top:r.top+i.pageYOffset-t.clientTop,left:r.left+i.pageXOffset-t.clientLeft}):r:{top:0,left:0}},position:function(){if(this[0]){var e,t,i=this[0],r={top:0,left:0};return"fixed"===y.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),y.nodeName(e[0],"html")||(r=e.offset()),r={top:r.top+y.css(e[0],"borderTopWidth",!0),left:r.left+y.css(e[0],"borderLeftWidth",!0)}),{top:t.top-r.top-y.css(i,"marginTop",!0),left:t.left-r.left-y.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===y.css(e,"position");)e=e.offsetParent;return e||J})}}),y.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i="pageYOffset"===t;y.fn[e]=function(r){return N(this,function(e,r,n){var o=getWindow(e);if(void 0===n)return o?o[t]:e[r];o?o.scrollTo(i?o.pageXOffset:n,i?n:o.pageYOffset):e[r]=n},e,r,arguments.length)}}),y.each(["top","left"],function(e,t){y.cssHooks[t]=addGetHookIf(v.pixelPosition,function(e,i){if(i)return i=curCSS(e,t),ce.test(i)?y(e).position()[t]+"px":i})}),y.each({Height:"height",Width:"width"},function(e,t){y.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,r){y.fn[r]=function(n,o){var a=arguments.length&&(i||"boolean"!=typeof n),s=i||(!0===n||!0===o?"margin":"border");return N(this,function(t,i,n){var o;return y.isWindow(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===n?y.css(t,i,s):y.style(t,i,n,s)},t,a?n:void 0,a)}})}),y.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,r){return this.on(t,e,i,r)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}}),y.parseJSON=JSON.parse,void 0===(r=function(){return y}.apply(t,[]))||(e.exports=r);var Xe=i.jQuery,Ye=i.$;return y.noConflict=function(e){return i.$===y&&(i.$=Ye),e&&i.jQuery===y&&(i.jQuery=Xe),y},n||(i.jQuery=i.$=y),y})},770:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/angle.png?49f7fbc9a0eafbca74f3826fefab1c5d"},771:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/area.svg?09d1a18fd57054a96e7f77339fb2a1c3"},772:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/clip_volume.svg?d31f11c672335e86d68e81a8ddc7df11"},773:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/close.svg?4433cee843f821a0f596c17a1b0f5d5d"},774:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/distance.svg?69634f25b5943a70c6b7eb313f488d24"},775:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/earth_controls.png?d2121795dc3faa74b6fa088825ad99d1"},776:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/earth_controls.svg?9f3acfcc380e36f664efe9f013cc5766"},777:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/earth_controls_1.png?e3dad5b203031cc3e201dc0d4c63ba07"},778:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/file_dxf.svg?deb613e63c7e17ef552de92faf4fef73"},779:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/file_geojson.svg?5d27f9a8ef09e038a0f7a9a6c60f7436"},780:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/flip_y_z.png?185e583369360c0d7b44aca8330ba7d5"},781:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/flip_y_z.svg?8aff36eee84e39128dc31dbbcc306d2e"},782:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/focus.svg?c0898a950a7c18f3ac497145544f1fbf"},783:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/fps_controls.png?964bde4f30b6824d70a13671f827ecb0"},784:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/fps_controls.svg?9a3135bab5c5d0c9abcb760fe6a6c72e"},785:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/frontview.svg?b42a2dbd3a0a06eb42c40c6baf0b9b61"},786:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/goto.svg?efe4fe323d49ffcf0e5e165ec127f709"},787:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/height.svg?40b097dd869047a02647f0a86422fd1c"},788:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/leftview.svg?e2dadcf6a5d7f87b3eb7188134c10531"},789:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/map_icon.png?8f8956399aebd273c4b5c605630a8f16"},790:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/menu_button.svg?943eeeb18819226648f38077d3695aab"},791:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/menu_icon.svg?ce5df0dd552917b80412235337887441"},792:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/orbit_controls.svg?0a1f10b6d067399800114d166125ae43"},793:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/point.svg?714fb67fef2ff1c365a36f28b5303711"},794:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/profile.svg?d75d6d68a4cf7c43f0895d6e6719cff2"},795:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/remove.svg?a8778aa9e7d5b595799c679939f490dd"},796:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/reset_tools.svg?a8778aa9e7d5b595799c679939f490dd"},797:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/rotate.svg?b7ed0b426a0f5fad6a2eb772125c89da"},798:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/round_dropdown.svg?8f5c69b2a4b5576322ff2798d54b7068"},799:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/round_icon.svg?127a9551590017118d3f4d12c55e4601"},800:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/scale.svg?58a37e447b2b6afba53d271b5c0837dd"},801:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/sphere.png?b3fcea7d696bb153092ff68568770411"},802:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/sphere.svg?5835945a9b70b8402b53e3a8bfa525a4"},803:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/target.svg?340c824d86015516d2c6e206e9156c74"},804:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/topview.svg?99841e16d9fe47ae1b4f5cfa24cc0003"},805:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/translate.svg?d2cec94d221875305a0ec3eccb6ec1fd"},806:function(e,t,i){e.exports=i.p+"assets/potree/resources/icons/volume.svg?ed393526f520f4eb63cebc38674a0d3d"},807:function(e,t,i){e.exports=i.p+"assets/potree/resources/textures/skybox2/nx.jpg?1d8773631ee5eb09cc2d61907c180b35"},808:function(e,t,i){e.exports=i.p+"assets/potree/resources/textures/skybox2/ny.jpg?e179e8106e31dcc4d20300f868f9dbd2"},809:function(e,t,i){e.exports=i.p+"assets/potree/resources/textures/skybox2/nz.jpg?a7a2c81654c47337bc36fc507cd81c75"},810:function(e,t,i){e.exports=i.p+"assets/potree/resources/textures/skybox2/px.jpg?9adc817c9ecc03814f0b382be656b2bc"},811:function(e,t,i){e.exports=i.p+"assets/potree/resources/textures/skybox2/py.jpg?3c07951ec7fd69ae29d0dc2534af3eba"},812:function(e,t,i){e.exports=i.p+"assets/potree/resources/textures/skybox2/pz.jpg?defb5bfc7fa36945004bb73fd5fa3980"},813:function(e,t,i){e.exports=i.p+"assets/potree/workers/BinaryDecoderWorker.js?ec9d8d9be80d3a49bcf103d9e0715487"},814:function(e,t,i){e.exports=i.p+"assets/potree/workers/GreyhoundBinaryDecoderWorker.js?dbcdbb2e6cdba02483715dcb638b9942"},815:function(e,t,i){e.exports=i.p+"assets/potree/workers/lasdecoder-worker.js?8a04fd2d6402c7f4b0b217a1762ddd4e"},816:function(e,t,i){e.exports=i.p+"assets/potree/workers/laslaz-worker.js?b5ddabdeb21b064b103d2464a38ca82e"},817:function(e,t){function Potree(){}function LRU(){this.first=null,this.last=null,this.items={},this.elements=0,this.numPoints=0}function ProgressBar(){this._progress=0,this._message="",this.maxOpacity=.6,this.element=document.createElement("div"),this.elProgress=document.createElement("div"),this.elProgressMessage=document.createElement("div"),this.element.innerHTML="",this.element.style.position="fixed",this.element.style.bottom="40px",this.element.style.width="200px",this.element.style.marginLeft="-100px",this.element.style.left="50%",this.element.style.borderRadius="5px",this.element.style.border="1px solid #727678",this.element.style.height="16px",this.element.style.padding="1px",this.element.style.textAlign="center",this.element.style.backgroundColor="#6ba8e5",this.element.style.opacity=this.maxOpacity,this.element.style.pointerEvents="none",this.elProgress.innerHTML=" ",this.elProgress.style.backgroundColor="#b8e1fc",this.elProgress.style.position="absolute",this.elProgress.style.borderRadius="5px",this.elProgress.style.width="0%",this.elProgress.style.height="100%",this.elProgress.style.margin="0px",this.elProgress.style.padding="0px",this.elProgressMessage.style.position="absolute",this.elProgressMessage.style.width="100%",this.elProgressMessage.innerHTML="loading 1 / 10",document.body.appendChild(this.element),this.element.appendChild(this.elProgress),this.element.appendChild(this.elProgressMessage),this.hide()}function initNavigation(){var e=document.getElementById("navigation");e.appendChild(l(Potree.resourcePath+"/icons/earth_controls_1.png","[title]tt.earth_control",function(){viewer.setNavigationMode(Potree.EarthControls)})),e.appendChild(l(Potree.resourcePath+"/icons/fps_controls.png","[title]tt.flight_control",function(){viewer.setNavigationMode(Potree.FirstPersonControls)})),e.appendChild(l(Potree.resourcePath+"/icons/orbit_controls.svg","[title]tt.orbit_control",function(){viewer.setNavigationMode(Potree.OrbitControls)})),e.appendChild(l(Potree.resourcePath+"/icons/focus.svg","[title]tt.focus_control",function(){viewer.fitToScreen()})),e.appendChild(l(Potree.resourcePath+"/icons/topview.svg","[title]tt.top_view_control",function(){viewer.setTopView()})),e.appendChild(l(Potree.resourcePath+"/icons/frontview.svg","[title]tt.front_view_control",function(){viewer.setFrontView()})),e.appendChild(l(Potree.resourcePath+"/icons/leftview.svg","[title]tt.left_view_control",function(){viewer.setLeftView()}));var t=new THREE.Vector2(1,1e4),i=function(e){return Math.pow((e-t.x)/t.y,.25)};$("#sldMoveSpeed").slider({value:i(viewer.getMoveSpeed()),min:0,max:1,step:.01,slide:function(e,i){viewer.setMoveSpeed(function(e){return Math.pow(e,4)*t.y+t.x}(i.value))}}),viewer.addEventListener("move_speed_changed",function(e){$("#lblMoveSpeed")[0].innerHTML=viewer.getMoveSpeed().toFixed(1),$("#sldMoveSpeed").slider({value:i(viewer.getMoveSpeed())})}),$("#lblMoveSpeed")[0].innerHTML=viewer.getMoveSpeed().toFixed(1)}e.exports=Potree,Potree.version={major:1,minor:5,suffix:"RC"},console.log("Potree "+Potree.version.major+"."+Potree.version.minor+Potree.version.suffix),Potree.pointBudget=1e6,Potree.framenumber=0,Potree.Shaders={},Potree.webgl={shaders:{},vaos:{},vbos:{}},Potree.scriptPath=null,document.currentScript.src?"/"==(Potree.scriptPath=new URL(document.currentScript.src+"/..").href).slice(-1)&&(Potree.scriptPath=Potree.scriptPath.slice(0,-1)):console.error("Potree was unable to find its script path using document.currentScript. Is Potree included with a script tag? Does your browser support this function?"),Potree.resourcePath=(window.location&&window.location.origin)+"/public/iconem-potree/resources",Potree.timerQueries={},Potree.timerQueriesEnabled=!1,Potree.startQuery=function(e,t){if(!Potree.timerQueriesEnabled)return null;void 0===Potree.timerQueries[e]&&(Potree.timerQueries[e]=[]);let i=t.getExtension("EXT_disjoint_timer_query"),r=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,r),Potree.timerQueries[e].push(r),r},Potree.endQuery=function(e,t){if(!Potree.timerQueriesEnabled)return;let i=t.getExtension("EXT_disjoint_timer_query");i.endQueryEXT(i.TIME_ELAPSED_EXT)},Potree.resolveQueries=function(e){if(!Potree.timerQueriesEnabled)return;let t=e.getExtension("EXT_disjoint_timer_query");for(let e in Potree.timerQueries){let i=Potree.timerQueries[e];if(i.length>0){let r=i[0],n=t.getQueryObjectEXT(r,t.QUERY_RESULT_AVAILABLE_EXT),o=viewer.renderer.getContext().getParameter(t.GPU_DISJOINT_EXT);if(n&&!o){let n=t.getQueryObjectEXT(r,t.QUERY_RESULT_EXT)/1e6;console.log(e+": "+n+"ms"),i.shift()}}0===i.length&&delete Potree.timerQueries[e]}},Potree.MOUSE={LEFT:1,RIGHT:2,MIDDLE:4},Potree.loadPointCloud=function(e,t,i){let r=function(e){e.name=t,i({type:"pointcloud_loaded",pointcloud:e})};e&&(0===e.indexOf("greyhound://")?Potree.GreyhoundLoader.load(e,function(e){if(e){let t=new Potree.PointCloudOctree(e);r(t)}else i({type:"loading_failed"})}):e.indexOf("cloud.js")>0?Potree.POCLoader.load(e,function(e){if(e){let t=new Potree.PointCloudOctree(e);r(t)}else i({type:"loading_failed"})}.bind(this)):e.indexOf(".vpc")>0?Potree.PointCloudArena4DGeometry.load(e,function(e){if(e){let t=new Potree.PointCloudArena4D(e);r(t)}else i({type:"loading_failed"})}):i({type:"loading_failed"}))},Potree.updatePointClouds=function(e,t,i){Potree.lru||(Potree.lru=new LRU);for(let t=0;t<e.length;t++){let i=e[t];for(let e=0;e<i.profileRequests.length;e++)i.profileRequests[e].update()}let r=Potree.updateVisibility(e,t,i);for(let r=0;r<e.length;r++){let n=e[r];n.updateMaterial(n.material,n.visibleNodes,t,i),n.updateVisibleBounds()}return Potree.getLRU().freeMemory(),r},Potree.getLRU=function(){return Potree.lru||(Potree.lru=new LRU),Potree.lru},Potree.updateVisibility=function(e,t,i){let r=0,n=[],o=[],a=[],s=1/0,l=function updateVisibilityStructures(e,t,i){let r=[],n=[],o=new BinaryHeap(function(e){return 1/e.weight});for(let i=0;i<e.length;i++){let a=e[i];if(!a.initialized())continue;a.numVisibleNodes=0,a.numVisiblePoints=0,a.deepestVisibleLevel=0,a.visibleNodes=[],a.visibleGeometry=[],t.updateMatrixWorld();let s=new THREE.Frustum,l=t.matrixWorldInverse,c=a.matrixWorld,u=t.projectionMatrix,h=(new THREE.Matrix4).multiply(u).multiply(l).multiply(c);s.setFromMatrix(h),r.push(s);let d=t.matrixWorld,p=(new THREE.Matrix4).getInverse(c),f=(new THREE.Matrix4).multiply(p).multiply(d),m=(new THREE.Vector3).setFromMatrixPosition(f);n.push(m),a.visible&&null!==a.root&&o.push({pointcloud:i,node:a.root,weight:Number.MAX_VALUE}),a.root.isTreeNode()&&a.hideDescendants(a.root.sceneNode);for(let e=0;e<a.boundingBoxNodes.length;e++)a.boundingBoxNodes[e].visible=!1}return{frustums:r,camObjPositions:n,priorityQueue:o}}(e,t),c=l.frustums,u=l.camObjPositions,h=l.priorityQueue;for(;h.size()>0;){let l=h.pop(),d=l.node,p=l.parent,f=e[l.pointcloud],m=d.getBoundingBox(),g=c[l.pointcloud],v=u[l.pointcloud],y=g.intersectsBox(m),b=f.maxLevel||1/0,x=d.getLevel(),w=y;if(w=w&&!(r+d.getNumPoints()>Potree.pointBudget),w=w&&x<b,d.spacing?s=Math.min(s,d.spacing):d.geometryNode&&d.geometryNode.spacing&&(s=Math.min(s,d.geometryNode.spacing)),r+d.getNumPoints()>Potree.pointBudget)break;if(!w)continue;if(0,r+=d.getNumPoints(),f.numVisibleNodes++,f.numVisiblePoints+=d.getNumPoints(),!d.isGeometryNode()||p&&!p.isTreeNode()||(d.isLoaded()?d=f.toTreeNode(d,p):(a.push(d),o.push(d))),d.isTreeNode())if(Potree.getLRU().touch(d.geometryNode),d.sceneNode.visible=!0,d.sceneNode.material=f.material,n.push(d),f.visibleNodes.push(d),d.parent?d.sceneNode.matrixWorld.multiplyMatrices(d.parent.sceneNode.matrixWorld,d.sceneNode.matrix):d.sceneNode.matrixWorld.multiplyMatrices(f.matrixWorld,d.sceneNode.matrix),f.showBoundingBox&&!d.boundingBoxNode){let e=new THREE.BoxHelper(d.getBoundingBox());f.add(e),f.boundingBoxNodes.push(e),d.boundingBoxNode=e,d.boundingBoxNode.matrixWorld.copy(d.sceneNode.matrixWorld)}else f.showBoundingBox?(d.boundingBoxNode.visible=!0,d.boundingBoxNode.matrixWorld.copy(d.sceneNode.matrixWorld)):!f.showBoundingBox&&d.boundingBoxNode&&(d.boundingBoxNode.visible=!1);let _=d.getChildren();for(let e=0;e<_.length;e++){let r=_[e],n=r.getBoundingSphere(),o=n.center.distanceTo(v),a=n.radius,s=t.fov*Math.PI/180,c=Math.tan(s/2),u=a*(.5*i.domElement.clientHeight/(c*o));if(u<f.minimumNodePixelSize)continue;let p=u;o-a<0&&(p=Number.MAX_VALUE),h.push({pointcloud:l.pointcloud,node:r,parent:d,weight:p})}}for(let e=0;e<Math.min(5,a.length);e++)a[e].load();return Potree.updateDEMs(i,n),{visibleNodes:n,numVisiblePoints:r,lowestSpacing:s}},Potree.updateDEMs=function(e,t){return},Potree.Shader=class{constructor(e,t,i,r){this.vertexShader=e,this.fragmentShader=t,this.program=i,this.uniforms=r}},Potree.VBO=class{constructor(e,t,i){this.name=e,this.id=t,this.attribute=i}},Potree.VAO=class{constructor(e,t,i){this.id=e,this.geometry=t,this.vbos=i}},Potree.compileShader=function(e,t,i){let r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t),e.compileShader(r);if(!e.getShaderParameter(r,e.COMPILE_STATUS)){console.error("could not compile vertex shader:");let i=e.getShaderInfoLog(r);return void console.error(i,t)}let n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,i),e.compileShader(n);if(!e.getShaderParameter(n,e.COMPILE_STATUS))return console.error("could not compile fragment shader:"),void console.error(i);let o=e.createProgram();e.attachShader(o,r),e.attachShader(o,n),e.linkProgram(o);if(!e.getProgramParameter(o,e.LINK_STATUS))return console.error("could not compile shader:"),console.error(t),void console.error(i);e.useProgram(o);let a={};{let t=e.getProgramParameter(o,e.ACTIVE_UNIFORMS);for(let i=0;i<t;i++){let t=e.getActiveUniform(o,i).name,r=e.getUniformLocation(o,t);a[t]=r}}return new Potree.Shader(t,i,o,a)},Potree.createVAO=function(e,t){if(1==Potree.vaos[t.uuid])return Potree.vaos[t.uuid];let i=e.getExtension("OES_vertex_array_object"),r=i.createVertexArrayOES();i.bindVertexArrayOES(r);let n={};for(let i in t.attributes){let r=t.attributes[i],o=e.FLOAT;r.array instanceof Uint8Array?o=e.UNSIGNED_BYTE:r.array instanceof Uint16Array?o=e.UNSIGNED_SHORT:r.array instanceof Uint32Array?o=e.UNSIGNED_INT:r.array instanceof Int8Array?o=e.BYTE:r.array instanceof Int16Array?o=e.SHORT:r.array instanceof Int32Array?o=e.INT:r.array instanceof Float32Array&&(o=e.FLOAT);let a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,r.array,e.STATIC_DRAW),n[i]=new Potree.VBO(i,a,r)}i.bindVertexArrayOES(null);let o=new Potree.VAO(r,t,n);return Potree.vaos[t.uuid]=o,o},Potree.renderPointcloud=function(e,t,i){let r=i.context,n=e.material;if(null===r.getExtension("OES_vertex_array_object"))return void console.error("OES_vertex_array_object extension not supported");n.needsUpdate&&(Potree.pointcloudShader=Potree.compileShader(r,n.vertexShader,n.fragmentShader),n.needsUpdate=!1);let o=Potree.pointcloudShader,a=o.uniforms;r.useProgram(o.program),r.uniformMatrix4fv(a.projectionMatrix,!1,t.projectionMatrix.elements),r.uniformMatrix4fv(a.viewMatrix,!1,t.matrixWorldInverse.elements),r.uniform1f(a.fov,this.material.fov),r.uniform1f(a.screenWidth,n.screenWidth),r.uniform1f(a.screenHeight,n.screenHeight),r.uniform1f(a.spacing,n.spacing),r.uniform1f(a.near,n.near),r.uniform1f(a.far,n.far),r.uniform1f(a.size,n.size),r.uniform1f(a.minSize,n.minSize),r.uniform1f(a.maxSize,n.maxSize),r.uniform1f(a.octreeSize,e.pcoGeometry.boundingBox.getSize().x);{let e=r.getAttribLocation(program,"position"),t=r.getAttribLocation(program,"color"),i=r.getAttribLocation(program,"normal"),n=r.getAttribLocation(program,"classification"),o=r.getAttribLocation(program,"indices");r.enableVertexAttribArray(e),r.enableVertexAttribArray(t),r.enableVertexAttribArray(i),r.enableVertexAttribArray(n),r.enableVertexAttribArray(o)}let s=e.visibleNodes;for(let e of s){e.sceneNode.geometry}},Potree.PointCloudTreeNode=class{constructor(){}getChildren(){throw"override function"}getBoundingBox(){throw"override function"}isLoaded(){throw"override function"}isGeometryNode(){throw"override function"}isTreeNode(){throw"override function"}getLevel(){throw"override function"}getBoundingSphere(){throw"override function"}},Potree.PointCloudTree=class extends THREE.Object3D{constructor(){super()}initialized(){return null!==this.root}},Potree.WorkerPool=class{constructor(){this.workers={}}getWorker(e){if(this.workers[e]||(this.workers[e]=[]),0===this.workers[e].length){let t=new Worker(e);this.workers[e].push(t)}return this.workers[e].pop()}returnWorker(e,t){this.workers[e].push(t)}},Potree.workerPool=new Potree.WorkerPool,Potree.Shaders["pointcloud.vs"]=["","precision mediump float;","precision mediump int;","","","","","#define max_clip_boxes 30","","attribute vec3 position;","attribute vec3 color;","attribute vec3 normal;","attribute float intensity;","attribute float classification;","attribute float returnNumber;","attribute float numberOfReturns;","attribute float pointSourceID;","attribute vec4 indices;","","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","","","uniform float screenWidth;","uniform float screenHeight;","uniform float fov;","uniform float spacing;","uniform float near;","uniform float far;","","#if defined use_clip_box","\tuniform mat4 clipBoxes[max_clip_boxes];","\tuniform vec3 clipBoxPositions[max_clip_boxes];","#endif","","","uniform float heightMin;","uniform float heightMax;","uniform float intensityMin;","uniform float intensityMax;","uniform float size;\t\t\t\t// pixel size factor","uniform float minSize;\t\t\t// minimum pixel size","uniform float maxSize;\t\t\t// maximum pixel size","uniform float octreeSize;","uniform vec3 bbSize;","uniform vec3 uColor;","uniform float opacity;","uniform float clipBoxCount;","","uniform vec2 intensityRange;","uniform float intensityGamma;","uniform float intensityContrast;","uniform float intensityBrightness;","uniform float rgbGamma;","uniform float rgbContrast;","uniform float rgbBrightness;","uniform float transition;","uniform float wRGB;","uniform float wIntensity;","uniform float wElevation;","uniform float wClassification;","uniform float wReturnNumber;","uniform float wSourceID;","","","uniform sampler2D visibleNodes;","uniform sampler2D gradient;","uniform sampler2D classificationLUT;","uniform sampler2D depthMap;","","varying float\tvOpacity;","varying vec3\tvColor;","varying float\tvLinearDepth;","varying float\tvLogDepth;","varying vec3\tvViewPosition;","varying float \tvRadius;","varying vec3\tvWorldPosition;","varying vec3\tvNormal;","","","// ---------------------","// OCTREE","// ---------------------","","#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_octree)","/**"," * number of 1-bits up to inclusive index position"," * number is treated as if it were an integer in the range 0-255"," *"," */","float numberOfOnes(float number, float index){","\tfloat tmp = mod(number, pow(2.0, index + 1.0));","\tfloat numOnes = 0.0;","\tfor(float i = 0.0; i < 8.0; i++){","\t\tif(mod(tmp, 2.0) != 0.0){","\t\t\tnumOnes++;","\t\t}","\t\ttmp = floor(tmp / 2.0);","\t}","\treturn numOnes;","}","","","/**"," * checks whether the bit at index is 1"," * number is treated as if it were an integer in the range 0-255"," *"," */","bool isBitSet(float number, float index){","\treturn mod(floor(number / pow(2.0, index)), 2.0) != 0.0;","}","","","/**"," * find the LOD at the point position"," */","float getLOD(){","\tvec3 offset = vec3(0.0, 0.0, 0.0);","\tfloat iOffset = 0.0;","\tfloat depth = 0.0;","\tfor(float i = 0.0; i <= 1000.0; i++){","\t\tfloat nodeSizeAtLevel = octreeSize  / pow(2.0, i);","\t\tvec3 index3d = (position - offset) / nodeSizeAtLevel;","\t\tindex3d = floor(index3d + 0.5);","\t\tfloat index = 4.0*index3d.x + 2.0*index3d.y + index3d.z;","\t\t","\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));","\t\tfloat mask = value.r * 255.0;","\t\tif(isBitSet(mask, index)){","\t\t\t// there are more visible child nodes at this position","\t\t\tiOffset = iOffset + value.g * 255.0 + numberOfOnes(mask, index - 1.0);","\t\t\tdepth++;","\t\t}else{","\t\t\t// no more visible child nodes at this position","\t\t\treturn depth;","\t\t}","\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;","\t}","\t\t","\treturn depth;","}","","float getPointSizeAttenuation(){","\treturn pow(1.9, getLOD());","}","","","#endif","","","// ---------------------","// KD-TREE","// ---------------------","","#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_kdtree)","","float getLOD(){","\tvec3 offset = vec3(0.0, 0.0, 0.0);","\tfloat iOffset = 0.0;","\tfloat depth = 0.0;","\t\t","\t\t","\tvec3 size = bbSize;\t","\tvec3 pos = position;","\t\t","\tfor(float i = 0.0; i <= 1000.0; i++){","\t\t","\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));","\t\t","\t\tint children = int(value.r * 255.0);","\t\tfloat next = value.g * 255.0;","\t\tint split = int(value.b * 255.0);","\t\t","\t\tif(next == 0.0){","\t\t \treturn depth;","\t\t}","\t\t","\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);","\t\tif(split == 1){","\t\t\tsplitv.x = 1.0;","\t\t}else if(split == 2){","\t\t \tsplitv.y = 1.0;","\t\t}else if(split == 4){","\t\t \tsplitv.z = 1.0;","\t\t}","\t\t","\t\tiOffset = iOffset + next;","\t\t","\t\tfloat factor = length(pos * splitv / size);","\t\tif(factor < 0.5){","\t\t \t// left","\t\t    if(children == 0 || children == 2){","\t\t    \treturn depth;","\t\t    }","\t\t}else{","\t\t  \t// right","\t\t    pos = pos - size * splitv * 0.5;","\t\t    if(children == 0 || children == 1){","\t\t    \treturn depth;","\t\t    }","\t\t    if(children == 3){","\t\t    \tiOffset = iOffset + 1.0;","\t\t    }","\t\t}","\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);","\t\t","\t\tdepth++;","\t}","\t\t","\t\t","\treturn depth;\t","}","","float getPointSizeAttenuation(){","\treturn 0.5 * pow(1.3, getLOD());","}","","#endif","","// formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/","float getContrastFactor(float contrast){","\treturn (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);","}","","vec3 getRGB(){","\tvec3 rgb = color;","\t","\trgb = pow(rgb, vec3(rgbGamma));","\trgb = rgb + rgbBrightness;","\trgb = (rgb - 0.5) * getContrastFactor(rgbContrast) + 0.5;","\trgb = clamp(rgb, 0.0, 1.0);","\t","\treturn rgb;","}","","float getIntensity(){","\tfloat w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);","\tw = pow(w, intensityGamma);","\tw = w + intensityBrightness;","\tw = (w - 0.5) * getContrastFactor(intensityContrast) + 0.5;","\tw = clamp(w, 0.0, 1.0);","\t","\treturn w;","}","","vec3 getElevation(){","\tvec4 world = modelMatrix * vec4( position, 1.0 );","\tfloat w = (world.z - heightMin) / (heightMax-heightMin);","\tvec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;","\t","\treturn cElevation;","}","","vec4 getClassification(){","\tvec2 uv = vec2(classification / 255.0, 0.5);","\tvec4 classColor = texture2D(classificationLUT, uv);","\t","\treturn classColor;","}","","vec3 getReturnNumber(){","\tif(numberOfReturns == 1.0){","\t\treturn vec3(1.0, 1.0, 0.0);","\t}else{","\t\tif(returnNumber == 1.0){","\t\t\treturn vec3(1.0, 0.0, 0.0);","\t\t}else if(returnNumber == numberOfReturns){","\t\t\treturn vec3(0.0, 0.0, 1.0);","\t\t}else{","\t\t\treturn vec3(0.0, 1.0, 0.0);","\t\t}","\t}","}","","vec3 getSourceID(){","\tfloat w = mod(pointSourceID, 10.0) / 10.0;","\treturn texture2D(gradient, vec2(w,1.0 - w)).rgb;","}","","vec3 getCompositeColor(){","\tvec3 c;","\tfloat w;","","\tc += wRGB * getRGB();","\tw += wRGB;","\t","\tc += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);","\tw += wIntensity;","\t","\tc += wElevation * getElevation();","\tw += wElevation;","\t","\tc += wReturnNumber * getReturnNumber();","\tw += wReturnNumber;","\t","\tc += wSourceID * getSourceID();","\tw += wSourceID;","\t","\tvec4 cl = wClassification * getClassification();","    c += cl.a * cl.rgb;","\tw += wClassification * cl.a;","","\tc = c / w;","\t","\tif(w == 0.0){","\t\t//c = color;","\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);","\t}","\t","\treturn c;","}","","void main() {","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvViewPosition = mvPosition.xyz;","\tgl_Position = projectionMatrix * mvPosition;","\tvOpacity = opacity;","\tvLinearDepth = gl_Position.w;","\tvLogDepth = log2(gl_Position.w);","\tvNormal = normalize(normalMatrix * normal);","","\t// ---------------------","\t// POINT COLOR","\t// ---------------------","\tvec4 cl = getClassification(); ","\t","\t#ifdef color_type_rgb","\t\tvColor = getRGB();","\t#elif defined color_type_height","\t\tvColor = getElevation();","\t#elif defined color_type_rgb_height","\t\tvec3 cHeight = getElevation();","\t\tvColor = (1.0 - transition) * getRGB() + transition * cHeight;","\t#elif defined color_type_depth","\t\tfloat linearDepth = -mvPosition.z ;","\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;","\t\tvColor = vec3(linearDepth, expDepth, 0.0);","\t#elif defined color_type_intensity","\t\tfloat w = getIntensity();","\t\tvColor = vec3(w, w, w);","\t#elif defined color_type_intensity_gradient","\t\tfloat w = getIntensity();","\t\tvColor = texture2D(gradient, vec2(w,1.0-w)).rgb;","\t#elif defined color_type_color","\t\tvColor = uColor;","\t#elif defined color_type_lod","\t\tfloat depth = getLOD();","\t\tfloat w = depth / 10.0;","\t\tvColor = texture2D(gradient, vec2(w,1.0-w)).rgb;","\t#elif defined color_type_point_index","\t\tvColor = indices.rgb;","\t#elif defined color_type_classification","\t\tvColor = cl.rgb;","\t#elif defined color_type_return_number","\t\tvColor = getReturnNumber();","\t#elif defined color_type_source","\t\tvColor = getSourceID();","\t#elif defined color_type_normal","\t\tvColor = (modelMatrix * vec4(normal, 0.0)).xyz;","\t#elif defined color_type_phong","\t\tvColor = color;","\t#elif defined color_type_composite","\t\tvColor = getCompositeColor();","\t#endif","\t","\t#if !defined color_type_composite","\t\tif(cl.a == 0.0){","\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);","\t\t\t","\t\t\treturn;","\t\t}","\t#endif","\t","\t// ---------------------","\t// POINT SIZE","\t// ---------------------","\tfloat pointSize = 1.0;","\t","\tfloat slope = tan(fov / 2.0);","\tfloat projFactor =  -0.5 * screenHeight / (slope * vViewPosition.z);","\t","\tfloat r = spacing * 1.5;","\tvRadius = r;","\t#if defined fixed_point_size","\t\tpointSize = size;","\t#elif defined attenuated_point_size","\t\tpointSize = size * projFactor;","\t#elif defined adaptive_point_size","\t\tfloat worldSpaceSize = size * r / getPointSizeAttenuation();","\t\tpointSize = worldSpaceSize * projFactor;","\t#endif","","\tpointSize = max(minSize, pointSize);","\tpointSize = min(maxSize, pointSize);","\t","\tvRadius = pointSize / projFactor;","\t","\tgl_PointSize = pointSize;","\t","\t","\t// ---------------------","\t// CLIPPING","\t// ---------------------","\t","\t#if defined use_clip_box","\t\tbool insideAny = false;","\t\tfor(int i = 0; i < max_clip_boxes; i++){","\t\t\tif(i == int(clipBoxCount)){","\t\t\t\tbreak;","\t\t\t}","\t\t","\t\t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4( position, 1.0 );","\t\t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;","\t\t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;","\t\t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;","\t\t\tinsideAny = insideAny || inside;","\t\t}","\t\tif(!insideAny){","\t","\t\t\t#if defined clip_outside","\t\t\t\tgl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);","\t\t\t#elif defined clip_highlight_inside && !defined(color_type_depth)","\t\t\t\tfloat c = (vColor.r + vColor.g + vColor.b) / 6.0;","\t\t\t#endif","\t\t}else{","\t\t\t#if defined clip_highlight_inside","\t\t\tvColor.r += 0.5;","\t\t\t#endif","\t\t}","\t#endif","\t","}",""].join("\n"),Potree.Shaders["pointcloud.fs"]=["","precision mediump float;","precision mediump int;","","#if defined use_interpolation","\t#extension GL_EXT_frag_depth : enable","#endif","","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","","","uniform mat4 projectionMatrix;","uniform float opacity;","","uniform float blendHardness;","uniform float blendDepthSupplement;","uniform float fov;","uniform float spacing;","uniform float near;","uniform float far;","uniform float pcIndex;","uniform float screenWidth;","uniform float screenHeight;","","uniform sampler2D depthMap;","","varying vec3\tvColor;","varying float\tvOpacity;","varying float\tvLinearDepth;","varying float\tvLogDepth;","varying vec3\tvViewPosition;","varying float\tvRadius;","varying vec3\tvNormal;","","float specularStrength = 1.0;","","void main() {","","\tvec3 color = vColor;","\tfloat depth = gl_FragCoord.z;","","\t#if defined(circle_point_shape) || defined(use_interpolation) || defined (weighted_splats)","\t\tfloat u = 2.0 * gl_PointCoord.x - 1.0;","\t\tfloat v = 2.0 * gl_PointCoord.y - 1.0;","\t#endif","\t","\t#if defined(circle_point_shape) || defined (weighted_splats)","\t\tfloat cc = u*u + v*v;","\t\tif(cc > 1.0){","\t\t\tdiscard;","\t\t}","\t#endif","\t","\t#if defined weighted_splats","\t\tvec2 uv = gl_FragCoord.xy / vec2(screenWidth, screenHeight);","\t\tfloat sDepth = texture2D(depthMap, uv).r;","\t\tif(vLinearDepth > sDepth + vRadius + blendDepthSupplement){","\t\t\tdiscard;","\t\t}","\t#endif","\t\t","\t#if defined color_type_point_index","\t\tgl_FragColor = vec4(color, pcIndex / 255.0);","\t#else","\t\tgl_FragColor = vec4(color, vOpacity);","\t#endif","","\tvec3 normal = normalize( vNormal );","\tnormal.z = abs(normal.z);","\tvec3 viewPosition = normalize( vViewPosition );","\t","\t#if defined(color_type_phong)","","\t// code taken from three.js phong light fragment shader","\t","\t\t#if MAX_POINT_LIGHTS > 0","","\t\t\tvec3 pointDiffuse = vec3( 0.0 );","\t\t\tvec3 pointSpecular = vec3( 0.0 );","","\t\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","","\t\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","\t\t\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;","","\t\t\t\tfloat lDistance = 1.0;","\t\t\t\tif ( pointLightDistance[ i ] > 0.0 )","\t\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","","\t\t\t\tlVector = normalize( lVector );","","\t\t\t\t\t\t// diffuse","","\t\t\t\tfloat dotProduct = dot( normal, lVector );","","\t\t\t\t#ifdef WRAP_AROUND","","\t\t\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );","\t\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","","\t\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","","\t\t\t\t#else","","\t\t\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );","","\t\t\t\t#endif","","\t\t\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","","\t\t\t\t\t\t// specular","","\t\t\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );","\t\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","\t\t\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","","\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","","\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );","\t\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","\t\t\t\tpointSpecular = vec3(0.0, 0.0, 0.0);","\t\t\t}","\t\t","\t\t#endif","\t\t","\t\t#if MAX_DIR_LIGHTS > 0","","\t\t\tvec3 dirDiffuse = vec3( 0.0 );","\t\t\tvec3 dirSpecular = vec3( 0.0 );","","\t\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","","\t\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","\t\t\t\tvec3 dirVector = normalize( lDirection.xyz );","","\t\t\t\t\t\t// diffuse","","\t\t\t\tfloat dotProduct = dot( normal, dirVector );","","\t\t\t\t#ifdef WRAP_AROUND","","\t\t\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );","\t\t\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","","\t\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","","\t\t\t\t#else","","\t\t\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );","","\t\t\t\t#endif","","\t\t\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","","\t\t\t\t// specular","","\t\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );","\t\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","\t\t\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","","\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","","\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","\t\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","\t\t\t}","","\t\t#endif","\t\t","\t\tvec3 totalDiffuse = vec3( 0.0 );","\t\tvec3 totalSpecular = vec3( 0.0 );","\t\t","\t\t#if MAX_POINT_LIGHTS > 0","","\t\t\ttotalDiffuse += pointDiffuse;","\t\t\ttotalSpecular += pointSpecular;","","\t\t#endif","\t\t","\t\t#if MAX_DIR_LIGHTS > 0","","\t\t\ttotalDiffuse += dirDiffuse;","\t\t\ttotalSpecular += dirSpecular;","","\t\t#endif","\t\t","\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","","\t#endif","\t","\t#if defined weighted_splats","\t    //float w = pow(1.0 - (u*u + v*v), blendHardness);","\t\t","\t\tfloat wx = 2.0 * length(2.0 * gl_PointCoord - 1.0);","\t\tfloat w = exp(-wx * wx * 0.5);","\t\t","\t\t//float distance = length(2.0 * gl_PointCoord - 1.0);","\t\t//float w = exp( -(distance * distance) / blendHardness);","\t\t","\t\tgl_FragColor.rgb = gl_FragColor.rgb * w;","\t\tgl_FragColor.a = w;","\t#endif","\t","\t#if defined use_interpolation","\t\tfloat wi = 0.0 - ( u*u + v*v);","\t\tvec4 pos = vec4(vViewPosition, 1.0);","\t\tpos.z += wi * vRadius;","\t\tfloat linearDepth = -pos.z;","\t\tpos = projectionMatrix * pos;","\t\tpos = pos / pos.w;","\t\tfloat expDepth = pos.z;","\t\tdepth = (pos.z + 1.0) / 2.0;","\t\tgl_FragDepthEXT = depth;","\t\t","\t\t#if defined(color_type_depth)","\t\t\tcolor.r = linearDepth;","\t\t\tcolor.g = expDepth;","\t\t#endif","\t\t","\t\t#if defined(use_edl)","\t\t\tgl_FragColor.a = log2(linearDepth);","\t\t#endif","\t\t","\t#else","\t\t#if defined(use_edl)","\t\t\tgl_FragColor.a = vLogDepth;","\t\t#endif","\t#endif","\t","\t","\t\t","\t","\t","\t","\t","}","","",""].join("\n"),Potree.Shaders["normalize.vs"]=["","varying vec2 vUv;","","void main() {","    vUv = uv;","","    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position,1.0);","}"].join("\n"),Potree.Shaders["normalize.fs"]=["","#extension GL_EXT_frag_depth : enable","","uniform sampler2D depthMap;","uniform sampler2D texture;","","varying vec2 vUv;","","void main() {","    float depth = texture2D(depthMap, vUv).g; ","\t","\tif(depth <= 0.0){","\t\tdiscard;","\t}","\t","    vec4 color = texture2D(texture, vUv); ","\tcolor = color / color.w;","    ","\tgl_FragColor = vec4(color.xyz, 1.0); ","\t","\tgl_FragDepthEXT = depth;","}"].join("\n"),Potree.Shaders["edl.vs"]=["","","varying vec2 vUv;","","void main() {","    vUv = uv;","\t","\tvec4 mvPosition = modelViewMatrix * vec4(position,1.0);","","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),Potree.Shaders["edl.fs"]=["// ","// adapted from the EDL shader code from Christian Boucheny in cloud compare:","// https://github.com/cloudcompare/trunk/tree/master/plugins/qEDL/shaders/EDL","//","","//#define NEIGHBOUR_COUNT 4","","uniform float screenWidth;","uniform float screenHeight;","uniform vec2 neighbours[NEIGHBOUR_COUNT];","uniform float edlStrength;","uniform float radius;","uniform float opacity;","","uniform sampler2D colorMap;","","varying vec2 vUv;","","const float infinity = 1.0 / 0.0;","","float response(float depth){","\tvec2 uvRadius = radius / vec2(screenWidth, screenHeight);","\t","\tfloat sum = 0.0;","\t","\tfor(int i = 0; i < NEIGHBOUR_COUNT; i++){","\t\tvec2 uvNeighbor = vUv + uvRadius * neighbours[i];","\t\t","\t\tfloat neighbourDepth = texture2D(colorMap, uvNeighbor).a;","\t\t","\t\tif(neighbourDepth == 0.0){","\t\t\tneighbourDepth = infinity;","\t\t}","\t\t","\t\tsum += max(0.0, depth - neighbourDepth);","\t}","\t","\treturn sum / float(NEIGHBOUR_COUNT);","}","","void main(){","\tvec4 color = texture2D(colorMap, vUv);","\t","\tfloat depth = color.a;","\tif(depth == 0.0){","\t\tdepth = infinity;","\t}","\t","\tfloat res = response(depth);","\tfloat shade = exp(-res * 300.0 * edlStrength);","\t","\tif(color.a == 0.0 && res == 0.0){","\t\tdiscard;","\t}","\t","\tgl_FragColor = vec4(color.rgb * shade, opacity);","}",""].join("\n"),Potree.Shaders["blur.vs"]=["","varying vec2 vUv;","","void main() {","    vUv = uv;","","    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position,1.0);","}"].join("\n"),Potree.Shaders["blur.fs"]=["","uniform mat4 projectionMatrix;","","uniform float screenWidth;","uniform float screenHeight;","uniform float near;","uniform float far;","","uniform sampler2D map;","","varying vec2 vUv;","","void main() {","","\tfloat dx = 1.0 / screenWidth;","\tfloat dy = 1.0 / screenHeight;","","\tvec3 color = vec3(0.0, 0.0, 0.0);","\tcolor += texture2D(map, vUv + vec2(-dx, -dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(  0, -dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(+dx, -dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(-dx,   0)).rgb;","\tcolor += texture2D(map, vUv + vec2(  0,   0)).rgb;","\tcolor += texture2D(map, vUv + vec2(+dx,   0)).rgb;","\tcolor += texture2D(map, vUv + vec2(-dx,  dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(  0,  dy)).rgb;","\tcolor += texture2D(map, vUv + vec2(+dx,  dy)).rgb;","    ","\tcolor = color / 9.0;","\t","\tgl_FragColor = vec4(color, 1.0);","\t","\t","}"].join("\n"),THREE.EventDispatcher.prototype.removeEventListeners=function(e){void 0!==this._listeners&&this._listeners[e]&&delete this._listeners[e]},THREE.PerspectiveCamera.prototype.zoomTo=function(e,t){if(e.geometry||e.boundingSphere||e.boundingBox){e.geometry&&null===e.geometry.boundingSphere&&e.geometry.computeBoundingSphere(),e.updateMatrixWorld();var i;i=e.boundingSphere?e.boundingSphere:e.geometry&&e.geometry.boundingSphere?e.geometry.boundingSphere:e.boundingBox.getBoundingSphere();var r=t||1,n=(i=i.clone().applyMatrix4(e.matrixWorld)).radius,o=this.fov*Math.PI/180;this.aspect<1&&(o*=this.aspect);var a=Math.abs(n/Math.sin(o/2))*r,s=this.getWorldDirection().multiplyScalar(-a);this.position.copy(i.center.clone().add(s))}},THREE.Ray.prototype.distanceToPlaneWithNegative=function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;return-(this.origin.dot(e.normal)+e.constant)/t},(Potree.POCLoader=function(){}).load=function load(e,t){try{var i=new Potree.PointCloudOctreeGeometry;i.url=e;var r=new XMLHttpRequest;r.open("GET",e,!0),r.onreadystatechange=function(){if(4===r.readyState&&(200===r.status||0===r.status)){var n=JSON.parse(r.responseText),o=new Potree.Version(n.version);0===n.octreeDir.indexOf("http")?i.octreeDir=n.octreeDir:i.octreeDir=e+"/../"+n.octreeDir,i.spacing=n.spacing,i.hierarchyStepSize=n.hierarchyStepSize,i.pointAttributes=n.pointAttributes;var a=new THREE.Vector3(n.boundingBox.lx,n.boundingBox.ly,n.boundingBox.lz),s=new THREE.Vector3(n.boundingBox.ux,n.boundingBox.uy,n.boundingBox.uz),l=(v=new THREE.Box3(a,s)).clone();n.tightBoundingBox&&(l.min.copy(new THREE.Vector3(n.tightBoundingBox.lx,n.tightBoundingBox.ly,n.tightBoundingBox.lz)),l.max.copy(new THREE.Vector3(n.tightBoundingBox.ux,n.tightBoundingBox.uy,n.tightBoundingBox.uz)));let b=a.clone();v.min.sub(b),v.max.sub(b),l.min.sub(b),l.max.sub(b),i.projection=n.projection,i.boundingBox=v,i.tightBoundingBox=l,i.boundingSphere=v.getBoundingSphere(),i.tightBoundingSphere=l.getBoundingSphere(),i.offset=b,"LAS"===n.pointAttributes?i.loader=new Potree.LasLazLoader(n.version):"LAZ"===n.pointAttributes?i.loader=new Potree.LasLazLoader(n.version):(i.loader=new Potree.BinaryLoader(n.version,v,n.scale),i.pointAttributes=new Potree.PointAttributes(i.pointAttributes));var c={},u=new Potree.PointCloudOctreeGeometryNode(d="r",i,v);if(u.level=0,u.hasChildren=!0,u.spacing=i.spacing,o.upTo("1.5")?u.numPoints=n.hierarchy[0][1]:u.numPoints=0,i.root=u,i.root.load(),c[d]=u,o.upTo("1.4"))for(var h=1;h<n.hierarchy.length;h++){var d=n.hierarchy[h][0],p=n.hierarchy[h][1],f=parseInt(d.charAt(d.length-1)),m=c[d.substring(0,d.length-1)],g=d.length-1,v=Potree.POCLoader.createChildAABB(m.boundingBox,f),y=new Potree.PointCloudOctreeGeometryNode(d,i,v);y.level=g,y.numPoints=p,y.spacing=i.spacing/Math.pow(2,g),m.addChild(y),c[d]=y}i.nodes=c,t(i)}},r.send(null)}catch(i){console.log("loading failed: '"+e+"'"),console.log(i),t()}},Potree.POCLoader.loadPointAttributes=function(e){for(var t=e.pointAttributes,i=new Potree.PointAttributes,r=0;r<t.length;r++){var n=Potree.PointAttribute[t[r]];i.add(n)}return i},Potree.POCLoader.createChildAABB=function(e,t){THREE.Vector3;var i=e.min,r=e.max,n=(new THREE.Vector3).copy(r).sub(i).multiplyScalar(.5),o=new THREE.Vector3(n.x,0,0),a=new THREE.Vector3(0,n.y,0),s=new THREE.Vector3(0,0,n.z),l=i,c=(new THREE.Vector3).add(i).add(n);return 1===t?(i=(new THREE.Vector3).copy(l).add(s),r=(new THREE.Vector3).copy(c).add(s)):3===t?(i=(new THREE.Vector3).copy(l).add(s).add(a),r=(new THREE.Vector3).copy(c).add(s).add(a)):0===t?(i=l,r=c):2===t?(i=(new THREE.Vector3).copy(l).add(a),r=(new THREE.Vector3).copy(c).add(a)):5===t?(i=(new THREE.Vector3).copy(l).add(s).add(o),r=(new THREE.Vector3).copy(c).add(s).add(o)):7===t?(i=(new THREE.Vector3).copy(l).add(n),r=(new THREE.Vector3).copy(c).add(n)):4===t?(i=(new THREE.Vector3).copy(l).add(o),r=(new THREE.Vector3).copy(c).add(o)):6===t&&(i=(new THREE.Vector3).copy(l).add(o).add(a),r=(new THREE.Vector3).copy(c).add(o).add(a)),new THREE.Box3(i,r)},(Potree.PointAttributeNames={}).POSITION_CARTESIAN=0,Potree.PointAttributeNames.COLOR_PACKED=1,Potree.PointAttributeNames.COLOR_FLOATS_1=2,Potree.PointAttributeNames.COLOR_FLOATS_255=3,Potree.PointAttributeNames.NORMAL_FLOATS=4,Potree.PointAttributeNames.FILLER=5,Potree.PointAttributeNames.INTENSITY=6,Potree.PointAttributeNames.CLASSIFICATION=7,Potree.PointAttributeNames.NORMAL_SPHEREMAPPED=8,Potree.PointAttributeNames.NORMAL_OCT16=9,Potree.PointAttributeNames.NORMAL=10,Potree.PointAttributeTypes={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,size:8}};var i=0;for(var r in Potree.PointAttributeTypes)Potree.PointAttributeTypes[i]=Potree.PointAttributeTypes[r],i++;(Potree.PointAttribute=function(e,t,i){this.name=e,this.type=t,this.numElements=i,this.byteSize=this.numElements*this.type.size}).POSITION_CARTESIAN=new Potree.PointAttribute(Potree.PointAttributeNames.POSITION_CARTESIAN,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,3),Potree.PointAttribute.RGBA_PACKED=new Potree.PointAttribute(Potree.PointAttributeNames.COLOR_PACKED,Potree.PointAttributeTypes.DATA_TYPE_INT8,4),Potree.PointAttribute.COLOR_PACKED=Potree.PointAttribute.RGBA_PACKED,Potree.PointAttribute.RGB_PACKED=new Potree.PointAttribute(Potree.PointAttributeNames.COLOR_PACKED,Potree.PointAttributeTypes.DATA_TYPE_INT8,3),Potree.PointAttribute.NORMAL_FLOATS=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL_FLOATS,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,3),Potree.PointAttribute.FILLER_1B=new Potree.PointAttribute(Potree.PointAttributeNames.FILLER,Potree.PointAttributeTypes.DATA_TYPE_UINT8,1),Potree.PointAttribute.INTENSITY=new Potree.PointAttribute(Potree.PointAttributeNames.INTENSITY,Potree.PointAttributeTypes.DATA_TYPE_UINT16,1),Potree.PointAttribute.CLASSIFICATION=new Potree.PointAttribute(Potree.PointAttributeNames.CLASSIFICATION,Potree.PointAttributeTypes.DATA_TYPE_UINT8,1),Potree.PointAttribute.NORMAL_SPHEREMAPPED=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL_SPHEREMAPPED,Potree.PointAttributeTypes.DATA_TYPE_UINT8,2),Potree.PointAttribute.NORMAL_OCT16=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL_OCT16,Potree.PointAttributeTypes.DATA_TYPE_UINT8,2),Potree.PointAttribute.NORMAL=new Potree.PointAttribute(Potree.PointAttributeNames.NORMAL,Potree.PointAttributeTypes.DATA_TYPE_FLOAT,3),(Potree.PointAttributes=function(e){if(this.attributes=[],this.byteSize=0,this.size=0,null!=e)for(var t=0;t<e.length;t++){var i=e[t],r=Potree.PointAttribute[i];this.attributes.push(r),this.byteSize+=r.byteSize,this.size++}}).prototype.add=function(e){this.attributes.push(e),this.byteSize+=e.byteSize,this.size++},Potree.PointAttributes.prototype.hasColors=function(){for(var e in this.attributes){if(this.attributes[e].name===Potree.PointAttributeNames.COLOR_PACKED)return!0}return!1},Potree.PointAttributes.prototype.hasNormals=function(){for(var e in this.attributes){var t=this.attributes[e];if(t===Potree.PointAttribute.NORMAL_SPHEREMAPPED||t===Potree.PointAttribute.NORMAL_FLOATS||t===Potree.PointAttribute.NORMAL||t===Potree.PointAttribute.NORMAL_OCT16)return!0}return!1},(Potree.BinaryLoader=function(e,t,i){this.version="string"==typeof e?new Potree.Version(e):e,this.boundingBox=t,this.scale=i}).prototype.load=function(e){if(!e.loaded){var t=this,i=e.getURL();this.version.equalOrHigher("1.4")&&(i+=".bin");var r=new XMLHttpRequest;r.open("GET",i,!0),r.responseType="arraybuffer",r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status){var n=r.response;t.parse(e,n)}else console.log("Failed to load file! HTTP status: "+r.status+", file: "+i)};try{r.send(null)}catch(e){console.log("fehler beim laden der punktwolke: "+e)}}},Potree.BinaryLoader.prototype.parse=function(e,t){var i=t.byteLength/e.pcoGeometry.pointAttributes.byteSize,r=e.pcoGeometry.pointAttributes;this.version.upTo("1.5")&&(e.numPoints=i);let n=Potree.scriptPath+"/workers/BinaryDecoderWorker.js",o=Potree.workerPool.getWorker(n);o.onmessage=function(t){var r=t.data,a=r.attributeBuffers,s=new THREE.Box3((new THREE.Vector3).fromArray(r.tightBoundingBox.min),(new THREE.Vector3).fromArray(r.tightBoundingBox.max));Potree.workerPool.returnWorker(n,o);var l=new THREE.BufferGeometry;for(var c in a)if(a.hasOwnProperty(c)){var u=a[c].buffer;a[c].attribute.numElements;parseInt(c)===Potree.PointAttributeNames.POSITION_CARTESIAN?l.addAttribute("position",new THREE.BufferAttribute(new Float32Array(u),3)):parseInt(c)===Potree.PointAttributeNames.COLOR_PACKED?l.addAttribute("color",new THREE.BufferAttribute(new Uint8Array(u),3,!0)):parseInt(c)===Potree.PointAttributeNames.INTENSITY?l.addAttribute("intensity",new THREE.BufferAttribute(new Float32Array(u),1)):parseInt(c)===Potree.PointAttributeNames.CLASSIFICATION?l.addAttribute("classification",new THREE.BufferAttribute(new Uint8Array(u),1)):parseInt(c)===Potree.PointAttributeNames.NORMAL_SPHEREMAPPED?l.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(u),3)):parseInt(c)===Potree.PointAttributeNames.NORMAL_OCT16?l.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(u),3)):parseInt(c)===Potree.PointAttributeNames.NORMAL&&l.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(u),3))}if(l.addAttribute("indices",new THREE.BufferAttribute(new Float32Array(r.indices),1)),!l.attributes.normal){u=new Float32Array(3*i);l.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(u),3))}l.boundingBox=e.boundingBox,e.geometry=l,e.tightBoundingBox=s,e.loaded=!0,e.loading=!1,e.pcoGeometry.numNodesLoading--};var a={buffer:t,pointAttributes:r,version:this.version.version,min:[e.boundingBox.min.x,e.boundingBox.min.y,e.boundingBox.min.z],offset:[e.pcoGeometry.offset.x,e.pcoGeometry.offset.y,e.pcoGeometry.offset.z],scale:this.scale};o.postMessage(a,[a.buffer])},(Potree.GreyhoundBinaryLoader=function(e,t,i){this.version="string"==typeof e?new Potree.Version(e):e,this.boundingBox=t,this.scale=i}).prototype.load=function(e){if(!e.loaded){var t=this,i=e.getURL(),r=new XMLHttpRequest;r.open("GET",i,!0),r.responseType="arraybuffer",r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status){var n=r.response;t.parse(e,n)}else console.log("Failed to load file! HTTP status:",r.status,"file:",i)};try{r.send(null)}catch(e){console.log("error loading point cloud: "+e)}}},Potree.GreyhoundBinaryLoader.prototype.parse=function(e,t){var i=function networkToNative(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255}(new DataView(t,t.byteLength-4,4).getUint32(0)),r=e.pcoGeometry.pointAttributes;e.numPoints=i;let n=Potree.scriptPath+"/workers/GreyhoundBinaryDecoderWorker.js",o=Potree.workerPool.getWorker(n);o.onmessage=function(t){var r=t.data,a=r.attributeBuffers,s=new THREE.Box3((new THREE.Vector3).fromArray(r.tightBoundingBox.min),(new THREE.Vector3).fromArray(r.tightBoundingBox.max));Potree.workerPool.returnWorker(n,o);var l=new THREE.BufferGeometry,c=function(e,t,i){l.addAttribute(e,new THREE.BufferAttribute(new Float32Array(t),i))};for(var u in a)if(a.hasOwnProperty(u)){var h=a[u].buffer,d=(a[u].attribute.numElements,Potree.PointAttributeNames);switch(parseInt(u)){case d.POSITION_CARTESIAN:c("position",h,3);break;case d.COLOR_PACKED:l.addAttribute("color",new THREE.BufferAttribute(new Uint8Array(h),3,!0));break;case d.INTENSITY:c("intensity",h,1);break;case d.CLASSIFICATION:c("classification",h,1);break;case d.NORMAL_SPHEREMAPPED:case d.NORMAL_OCT16:case d.NORMAL:c("normal",h,3)}}c("indices",r.indices,1),l.attributes.normal||c("normal",new Float32Array(3*i),3),l.boundingBox=e.boundingBox,e.geometry=l,e.tightBoundingBox=s,e.loaded=!0,e.loading=!1,--e.pcoGeometry.numNodesLoading};var a=e.boundingBox;e.pcoGeometry;let s=e.pcoGeometry.boundingBox.getCenter();var l={buffer:t,pointAttributes:r,version:this.version.version,schema:e.pcoGeometry.schema,min:[a.min.x,a.min.y,a.min.z],max:[a.max.x,a.max.y,a.max.z],offset:s.toArray(),scale:this.scale,normalize:e.pcoGeometry.normalize};o.postMessage(l,[l.buffer])};var n=function(e){e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(window.location.href);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null};(Potree.GreyhoundLoader=function(){}).loadInfoJSON=function load(e,t){};var o=function(e){return e.reduce((e,t)=>e+t.size,0)},a=function(e,t,i){var r=[{name:"X",size:4,type:"floating"},{name:"Y",size:4,type:"floating"},{name:"Z",size:4,type:"floating"},{name:"Red",size:2,type:"unsigned"},{name:"Green",size:2,type:"unsigned"},{name:"Blue",size:2,type:"unsigned"},{name:"Intensity",size:2,type:"unsigned"}];!function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status||0===i.status?t(null,i.response):t(i.responseText))},i.send(null)}(e+"read?depth="+t+"&schema="+JSON.stringify(r),function(e,t){if(e)throw new Error(e);for(var n=new DataView(t),a=t.byteLength-4,s=(n.getUint32(a,!0),o(r)),l=!1,c=!1,u=0;u<a&&((n.getUint16(u+12,!0)>255||n.getUint16(u+14,!0)>255||n.getUint16(u+16,!0)>255)&&(l=!0),n.getUint16(18,!0)>255&&(c=!0),!l||!c);u+=s);l&&console.log("Normalizing color"),c&&console.log("Normalizing intensity"),i(null,{color:l,intensity:c})})};Potree.GreyhoundLoader.load=function load(e,t){try{var i=e.split("greyhound://")[1];1==i.split("http://").length&&(i="http://"+i),function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||0===i.status?t(null,i.responseText):t(i.responseText))},i.send(null)}(i+"info",function(e,r){if(e)throw new Error(e);var s=JSON.parse(r),l=new Potree.Version("1.4"),c=s.bounds,u=(s.boundsConforming,c[3],c[0],c[4],c[1],c[5],c[2],s.scale);u=s.scale||.01;Array.isArray(u)&&(u=Math.min(u[0],u[1],u[2])),n("scale")&&(u=parseFloat(n("scale")));var h=Math.max(8,s.baseDepth),d=["POSITION_CARTESIAN"],p=!1,f=!1,m=!1;s.schema.forEach(function(e){"Intensity"===e.name&&d.push("INTENSITY"),"Classification"===e.name&&d.push("CLASSIFICATION"),"Red"===e.name?p=!0:"Green"===e.name?f=!0:"Blue"===e.name&&(m=!0)}),p&&f&&m&&d.push("COLOR_PACKED");var g=new Potree.PointCloudGreyhoundGeometry;g.serverURL=i,g.spacing=(c[3]-c[0])/Math.pow(2,h),g.baseDepth=h,g.hierarchyStepSize=5,g.schema=function(e){var t=[{name:"X",size:4,type:"signed"},{name:"Y",size:4,type:"signed"},{name:"Z",size:4,type:"signed"}];return e.forEach(function(e){"COLOR_PACKED"===e?(t.push({name:"Red",size:2,type:"unsigned"}),t.push({name:"Green",size:2,type:"unsigned"}),t.push({name:"Blue",size:2,type:"unsigned"})):"INTENSITY"===e?t.push({name:"Intensity",size:2,type:"unsigned"}):"CLASSIFICATION"===e&&t.push({name:"Classification",size:1,type:"unsigned"})}),t}(d);var v=o(g.schema);g.pointAttributes=new Potree.PointAttributes(d),g.pointAttributes.byteSize=v;var y=new THREE.Box3((new THREE.Vector3).fromArray(c,0),(new THREE.Vector3).fromArray(c,3)),b=y.min.clone();y.max.sub(y.min),y.min.set(0,0,0),g.projection=s.srs,g.boundingBox=y,g.boundingSphere=y.getBoundingSphere(),g.scale=u,g.offset=b,console.log("Scale:",u),console.log("Offset:",b),console.log("Bounds:",y),g.loader=new Potree.GreyhoundBinaryLoader(l,y,g.scale);var x={},w=new Potree.PointCloudGreyhoundGeometryNode("r",g,y,u,b);w.level=0,w.hasChildren=!0,w.numPoints=s.numPoints,w.spacing=g.spacing,g.root=w,g.root.load(),x.r=w,g.nodes=x,a(i,s.baseDepth,function(e,i){i.color&&(g.normalize.color=!0),i.intensity&&(g.normalize.intensity=!0),t(g)})})}catch(i){console.log("loading failed: '"+e+"'"),console.log(i),t()}},Potree.GreyhoundLoader.loadPointAttributes=function(e){for(var t=e.pointAttributes,i=new Potree.PointAttributes,r=0;r<t.length;r++){var n=Potree.PointAttribute[t[r]];i.add(n)}return i},Potree.GreyhoundLoader.createChildAABB=function(e,t){THREE.Vector3;var i=e.min,r=e.max,n=(new THREE.Vector3).copy(r).sub(i).multiplyScalar(.5),o=new THREE.Vector3(n.x,0,0),a=new THREE.Vector3(0,n.y,0),s=new THREE.Vector3(0,0,n.z),l=i,c=(new THREE.Vector3).add(i).add(n);return 1===t?(i=(new THREE.Vector3).copy(l).add(s),r=(new THREE.Vector3).copy(c).add(s)):3===t?(i=(new THREE.Vector3).copy(l).add(s).add(a),r=(new THREE.Vector3).copy(c).add(s).add(a)):0===t?(i=l,r=c):2===t?(i=(new THREE.Vector3).copy(l).add(a),r=(new THREE.Vector3).copy(c).add(a)):5===t?(i=(new THREE.Vector3).copy(l).add(s).add(o),r=(new THREE.Vector3).copy(c).add(s).add(o)):7===t?(i=(new THREE.Vector3).copy(l).add(n),r=(new THREE.Vector3).copy(c).add(n)):4===t?(i=(new THREE.Vector3).copy(l).add(o),r=(new THREE.Vector3).copy(c).add(o)):6===t&&(i=(new THREE.Vector3).copy(l).add(o).add(a),r=(new THREE.Vector3).copy(c).add(o).add(a)),new THREE.Box3(i,r)},(Potree.LasLazLoader=function(e){this.version="string"==typeof e?new Potree.Version(e):e}).prototype.load=function(e){if(!e.loaded){var t=e.pcoGeometry.pointAttributes,i=e.getURL();this.version.equalOrHigher("1.4")&&(i+="."+t.toLowerCase());var r=this,n=new XMLHttpRequest;n.open("GET",i,!0),n.responseType="arraybuffer",n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var t=n.response;r.parse(e,t)}else console.log("Failed to load file! HTTP status: "+n.status+", file: "+i)},n.send(null)}},Potree.LasLazLoader.progressCB=function(e){},Potree.LasLazLoader.prototype.parse=function loadData(e,t){var i=new LASFile(t),r=new Potree.LasLazBatcher(e);return Promise.resolve(i).cancellable().then(function(e){return e.open().then(function(){return e.isOpen=!0,e}).catch(Promise.CancellationError,function(t){return e.close().then(function(){throw t})})}).then(function(e){return e.getHeader().then(function(t){return[e,t]})}).then(function(e){var t=e[0],i=e[1],n=0,o=i.pointsCount,a=function(){return t.readData(1e6,0,1).then(function(e){return r.push(new LASDecoder(e.buffer,i.pointsFormatId,i.pointsStructSize,e.count,i.scale,i.offset,i.mins,i.maxs)),n+=e.count,Potree.LasLazLoader.progressCB(n/o),e.hasMoreData?a():(i.totalRead=n,i.versionAsString=t.versionAsString,i.isCompressed=t.isCompressed,[t,i,r])})};return a()}).then(function(e){var t=e[0];return Potree.LasLazLoader.progressCB(1),t.close().then(function(){return t.isOpen=!1,Promise.delay(200).cancellable()}).then(function(){return e.slice(1)})}).catch(Promise.CancellationError,function(e){if(i.isOpen)return i.close().then(function(){throw i.isOpen=!1,e});throw e})},Potree.LasLazLoader.prototype.handle=function(e,t){},Potree.LasLazBatcher=function(e){this.push=function(t){let i=Potree.scriptPath+"/workers/lasdecoder-worker.js",r=Potree.workerPool.getWorker(i);var n=new THREE.Vector3(t.mins[0],t.mins[1],t.mins[2]),o=new THREE.Vector3(t.maxs[0],t.maxs[1],t.maxs[2]);n.add(e.pcoGeometry.offset),o.add(e.pcoGeometry.offset),r.onmessage=function(a){for(var s=new THREE.BufferGeometry,l=t.pointsCount,c=a.data.position,u=new Uint8Array(a.data.color),h=a.data.intensity,d=new Uint8Array(a.data.classification),p=new Uint8Array(a.data.returnNumber),f=new Uint8Array(a.data.numberOfReturns),m=new Uint16Array(a.data.pointSourceID),g=new ArrayBuffer(4*l),v=new Uint32Array(g),y=new THREE.Box3,b=new Float32Array(c),x=0;x<l;x++)v[x]=x,y.expandByPoint(new THREE.Vector3(b[3*x+0],b[3*x+1],b[3*x+2]));s.addAttribute("position",new THREE.BufferAttribute(new Float32Array(c),3)),s.addAttribute("color",new THREE.BufferAttribute(u,3,!0)),s.addAttribute("intensity",new THREE.BufferAttribute(new Float32Array(h),1)),s.addAttribute("classification",new THREE.BufferAttribute(d,1)),s.addAttribute("returnNumber",new THREE.BufferAttribute(p,1)),s.addAttribute("numberOfReturns",new THREE.BufferAttribute(f,1)),s.addAttribute("pointSourceID",new THREE.BufferAttribute(m,1)),s.addAttribute("indices",new THREE.BufferAttribute(g,1)),s.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*l),3));var w=new THREE.Box3((new THREE.Vector3).fromArray(a.data.tightBoundingBox.min),(new THREE.Vector3).fromArray(a.data.tightBoundingBox.max));s.boundingBox=new THREE.Box3(n,o),e.tightBoundingBox=w,e.geometry=s,e.loaded=!0,e.loading=!1,e.pcoGeometry.numNodesLoading--,Potree.workerPool.returnWorker(i,r)};var a={buffer:t.arrayb,numPoints:t.pointsCount,pointSize:t.pointSize,pointFormatID:2,scale:t.scale,offset:t.offset,mins:[e.pcoGeometry.boundingBox.min.x,e.pcoGeometry.boundingBox.min.y,e.pcoGeometry.boundingBox.min.z],maxs:[e.pcoGeometry.boundingBox.max.x,e.pcoGeometry.boundingBox.max.y,e.pcoGeometry.boundingBox.max.z],bbOffset:[e.pcoGeometry.offset.x,e.pcoGeometry.offset.y,e.pcoGeometry.offset.z]};r.postMessage(a,[a.buffer])}},Potree.Gradients={RAINBOW:[[0,new THREE.Color(.278,0,.714)],[1/6,new THREE.Color(0,0,1)],[2/6,new THREE.Color(0,1,1)],[.5,new THREE.Color(0,1,0)],[4/6,new THREE.Color(1,1,0)],[5/6,new THREE.Color(1,.64,0)],[1,new THREE.Color(1,0,0)]],GRAYSCALE:[[0,new THREE.Color(0,0,0)],[1,new THREE.Color(1,1,1)]]},Potree.Classification={DEFAULT:{0:new THREE.Vector4(.5,.5,.5,1),1:new THREE.Vector4(.5,.5,.5,1),2:new THREE.Vector4(.63,.32,.18,1),3:new THREE.Vector4(0,1,0,1),4:new THREE.Vector4(0,.8,0,1),5:new THREE.Vector4(0,.6,0,1),6:new THREE.Vector4(1,.66,0,1),7:new THREE.Vector4(1,0,1,1),8:new THREE.Vector4(1,0,0,1),9:new THREE.Vector4(0,0,1,1),12:new THREE.Vector4(1,1,0,1),DEFAULT:new THREE.Vector4(.3,.6,.6,.5)}},Potree.PointSizeType={FIXED:0,ATTENUATED:1,ADAPTIVE:2},Potree.PointShape={SQUARE:0,CIRCLE:1},Potree.PointColorType={RGB:0,COLOR:1,DEPTH:2,HEIGHT:3,ELEVATION:3,INTENSITY:4,INTENSITY_GRADIENT:5,LOD:6,LEVEL_OF_DETAIL:6,POINT_INDEX:7,CLASSIFICATION:8,RETURN_NUMBER:9,SOURCE:10,NORMAL:11,PHONG:12,RGB_HEIGHT:13,COMPOSITE:50},Potree.ClipMode={DISABLED:0,CLIP_OUTSIDE:1,HIGHLIGHT_INSIDE:2},Potree.TreeType={OCTREE:0,KDTREE:1},(Potree.PointCloudMaterial=function(e){THREE.Material.call(this),e=e||{},this.visibleNodesTexture=Potree.utils.generateDataTexture(2048,1,new THREE.Color(16777215)),this.visibleNodesTexture.minFilter=THREE.NearestFilter,this.visibleNodesTexture.magFilter=THREE.NearestFilter;let t=e.size||1,i=e.minSize||1,r=e.maxSize||50,n=e.treeType||Potree.TreeType.OCTREE;this._pointSizeType=Potree.PointSizeType.ATTENUATED,this._pointShape=Potree.PointShape.SQUARE,this._interpolate=!1,this._pointColorType=Potree.PointColorType.RGB,this._useClipBox=!1,this.numClipBoxes=0,this._clipMode=Potree.ClipMode.DISABLED,this._weighted=!1,this._depthMap=null,this._gradient=Potree.Gradients.RAINBOW,this._classification=Potree.Classification.DEFAULT,this.gradientTexture=Potree.PointCloudMaterial.generateGradientTexture(this._gradient),this.classificationTexture=Potree.PointCloudMaterial.generateClassificationTexture(this._classification),this.lights=!1,this.fog=!1,this._treeType=n,this._useEDL=!1,this.attributes={position:{type:"fv",value:[]},color:{type:"fv",value:[]},normal:{type:"fv",value:[]},intensity:{type:"f",value:[]},classification:{type:"f",value:[]},returnNumber:{type:"f",value:[]},numberOfReturns:{type:"f",value:[]},pointSourceID:{type:"f",value:[]},normal:{type:"f",value:[]}},this.uniforms={spacing:{type:"f",value:1},blendHardness:{type:"f",value:2},blendDepthSupplement:{type:"f",value:0},fov:{type:"f",value:1},screenWidth:{type:"f",value:1},screenHeight:{type:"f",value:1},near:{type:"f",value:.1},far:{type:"f",value:1},uColor:{type:"c",value:new THREE.Color(16777215)},opacity:{type:"f",value:1},size:{type:"f",value:t},minSize:{type:"f",value:i},maxSize:{type:"f",value:r},octreeSize:{type:"f",value:0},bbSize:{type:"fv",value:[0,0,0]},heightMin:{type:"f",value:0},heightMax:{type:"f",value:1},intensityMin:{type:"f",value:0},intensityMax:{type:"f",value:1},clipBoxCount:{type:"f",value:0},visibleNodes:{type:"t",value:this.visibleNodesTexture},pcIndex:{type:"f",value:0},gradient:{type:"t",value:this.gradientTexture},classificationLUT:{type:"t",value:this.classificationTexture},clipBoxes:{type:"Matrix4fv",value:[]},clipBoxPositions:{type:"fv",value:null},depthMap:{type:"t",value:null},diffuse:{type:"fv",value:[1,1,1]},transition:{type:"f",value:.5},intensityRange:{type:"fv",value:[0,65e3]},intensityGamma:{type:"f",value:1},intensityContrast:{type:"f",value:0},intensityBrightness:{type:"f",value:0},rgbGamma:{type:"f",value:1},rgbContrast:{type:"f",value:0},rgbBrightness:{type:"f",value:0},wRGB:{type:"f",value:1},wIntensity:{type:"f",value:0},wElevation:{type:"f",value:0},wClassification:{type:"f",value:0},wReturnNumber:{type:"f",value:0},wSourceID:{type:"f",value:0}},this.defaultAttributeValues.normal=[0,0,0],this.defaultAttributeValues.classification=[0,0,0],this.vertexShader=this.getDefines()+Potree.Shaders["pointcloud.vs"],this.fragmentShader=this.getDefines()+Potree.Shaders["pointcloud.fs"],this.vertexColors=THREE.VertexColors}).prototype=new THREE.RawShaderMaterial,Potree.PointCloudMaterial.prototype.updateShaderSource=function(){this.vertexShader=this.getDefines()+Potree.Shaders["pointcloud.vs"],this.fragmentShader=this.getDefines()+Potree.Shaders["pointcloud.fs"],this.depthMap&&(this.uniforms.depthMap.value=this.depthMap),1===this.opacity?(this.blending=THREE.NoBlending,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0):(this.blending=THREE.AdditiveBlending,this.transparent=!0,this.depthTest=!1,this.depthWrite=!0),this.weighted&&(this.blending=THREE.AdditiveBlending,this.transparent=!0,this.depthTest=!0,this.depthWrite=!1),this.needsUpdate=!0},Potree.PointCloudMaterial.prototype.getDefines=function(){var e="";return this.pointSizeType===Potree.PointSizeType.FIXED?e+="#define fixed_point_size\n":this.pointSizeType===Potree.PointSizeType.ATTENUATED?e+="#define attenuated_point_size\n":this.pointSizeType===Potree.PointSizeType.ADAPTIVE&&(e+="#define adaptive_point_size\n"),this.pointShape===Potree.PointShape.SQUARE?e+="#define square_point_shape\n":this.pointShape===Potree.PointShape.CIRCLE&&(e+="#define circle_point_shape\n"),this._interpolate&&(e+="#define use_interpolation\n"),this._useEDL&&(e+="#define use_edl\n"),this._pointColorType===Potree.PointColorType.RGB?e+="#define color_type_rgb\n":this._pointColorType===Potree.PointColorType.COLOR?e+="#define color_type_color\n":this._pointColorType===Potree.PointColorType.DEPTH?e+="#define color_type_depth\n":this._pointColorType===Potree.PointColorType.HEIGHT?e+="#define color_type_height\n":this._pointColorType===Potree.PointColorType.INTENSITY?e+="#define color_type_intensity\n":this._pointColorType===Potree.PointColorType.INTENSITY_GRADIENT?e+="#define color_type_intensity_gradient\n":this._pointColorType===Potree.PointColorType.LOD?e+="#define color_type_lod\n":this._pointColorType===Potree.PointColorType.POINT_INDEX?e+="#define color_type_point_index\n":this._pointColorType===Potree.PointColorType.CLASSIFICATION?e+="#define color_type_classification\n":this._pointColorType===Potree.PointColorType.RETURN_NUMBER?e+="#define color_type_return_number\n":this._pointColorType===Potree.PointColorType.SOURCE?e+="#define color_type_source\n":this._pointColorType===Potree.PointColorType.NORMAL?e+="#define color_type_normal\n":this._pointColorType===Potree.PointColorType.PHONG?e+="#define color_type_phong\n":this._pointColorType===Potree.PointColorType.RGB_HEIGHT?e+="#define color_type_rgb_height\n":this._pointColorType===Potree.PointColorType.COMPOSITE&&(e+="#define color_type_composite\n"),this.clipMode===Potree.ClipMode.DISABLED?e+="#define clip_disabled\n":this.clipMode===Potree.ClipMode.CLIP_OUTSIDE?e+="#define clip_outside\n":this.clipMode===Potree.ClipMode.HIGHLIGHT_INSIDE&&(e+="#define clip_highlight_inside\n"),this._treeType===Potree.TreeType.OCTREE?e+="#define tree_type_octree\n":this._treeType===Potree.TreeType.KDTREE&&(e+="#define tree_type_kdtree\n"),this.weighted&&(e+="#define weighted_splats\n"),this.numClipBoxes>0&&(e+="#define use_clip_box\n"),e},Potree.PointCloudMaterial.prototype.setClipBoxes=function(e){if(e){this.clipBoxes=e;var t=this.numClipBoxes!=e.length&&(0===e.length||0===this.numClipBoxes);this.numClipBoxes=e.length,this.uniforms.clipBoxCount.value=this.numClipBoxes,t&&this.updateShaderSource(),this.uniforms.clipBoxes.value=new Float32Array(16*this.numClipBoxes),this.uniforms.clipBoxPositions.value=new Float32Array(3*this.numClipBoxes);for(var i=0;i<this.numClipBoxes;i++){var r=e[i];this.uniforms.clipBoxes.value.set(r.inverse.elements,16*i),this.uniforms.clipBoxPositions.value[3*i+0]=r.position.x,this.uniforms.clipBoxPositions.value[3*i+1]=r.position.y,this.uniforms.clipBoxPositions.value[3*i+2]=r.position.z}}},Object.defineProperty(Potree.PointCloudMaterial.prototype,"gradient",{get:function(){return this._gradient},set:function(e){this._gradient!==e&&(this._gradient=e,this.gradientTexture=Potree.PointCloudMaterial.generateGradientTexture(this._gradient),this.uniforms.gradient.value=this.gradientTexture)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"classification",{get:function(){return this._classification},set:function(e){this._classification=e,this.classificationTexture=Potree.PointCloudMaterial.generateClassificationTexture(this._classification),this.uniforms.classificationLUT.value=this.classificationTexture}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"spacing",{get:function(){return this.uniforms.spacing.value},set:function(e){this.uniforms.spacing.value!==e&&(this.uniforms.spacing.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"useClipBox",{get:function(){return this._useClipBox},set:function(e){this._useClipBox!==e&&(this._useClipBox=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"weighted",{get:function(){return this._weighted},set:function(e){this._weighted!==e&&(this._weighted=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"fov",{get:function(){return this.uniforms.fov.value},set:function(e){this.uniforms.fov.value!==e&&(this.uniforms.fov.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"screenWidth",{get:function(){return this.uniforms.screenWidth.value},set:function(e){this.uniforms.screenWidth.value!==e&&(this.uniforms.screenWidth.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"screenHeight",{get:function(){return this.uniforms.screenHeight.value},set:function(e){this.uniforms.screenHeight.value!==e&&(this.uniforms.screenHeight.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"near",{get:function(){return this.uniforms.near.value},set:function(e){this.uniforms.near.value!==e&&(this.uniforms.near.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"far",{get:function(){return this.uniforms.far.value},set:function(e){this.uniforms.far.value!==e&&(this.uniforms.far.value=e)}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"opacity",{get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity&&this.uniforms.opacity.value!==e&&(this.uniforms.opacity.value=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"pointColorType",{get:function(){return this._pointColorType},set:function(e){this._pointColorType!==e&&(this._pointColorType=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"depthMap",{get:function(){return this._depthMap},set:function(e){this._depthMap!==e&&(this._depthMap=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"pointSizeType",{get:function(){return this._pointSizeType},set:function(e){this._pointSizeType!==e&&(this._pointSizeType=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"clipMode",{get:function(){return this._clipMode},set:function(e){this._clipMode!==e&&(this._clipMode=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"interpolate",{get:function(){return this._interpolate},set:function(e){this._interpolate!==e&&(this._interpolate=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"useEDL",{get:function(){return this._useEDL},set:function(e){this._useEDL!==e&&(this._useEDL=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"color",{get:function(){return this.uniforms.uColor.value},set:function(e){this.uniforms.uColor.value!==e&&(this.uniforms.uColor.value.copy(e),this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"pointShape",{get:function(){return this._pointShape},set:function(e){this._pointShape!==e&&(this._pointShape=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"treeType",{get:function(){return this._treeType},set:function(e){this._treeType!=e&&(this._treeType=e,this.updateShaderSource())}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"bbSize",{get:function(){return this.uniforms.bbSize.value},set:function(e){this.uniforms.bbSize.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"size",{get:function(){return this.uniforms.size.value},set:function(e){this.uniforms.size.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"heightMin",{get:function(){return this.uniforms.heightMin.value},set:function(e){this.uniforms.heightMin.value=e}}),Object.defineProperty(Potree.PointCloudMaterial.prototype,"heightMax",{get:function(){return this.uniforms.heightMax.value},set:function(e){this.uniforms.heightMax.value=e}}),Potree.PointCloudMaterial.generateGradientTexture=function(e){canvas=document.createElement("canvas"),canvas.width=64,canvas.height=64;var t=canvas.getContext("2d");t.rect(0,0,64,64);for(var i=t.createLinearGradient(0,0,64,64),r=0;r<e.length;r++){var n=e[r];i.addColorStop(n[0],"#"+n[1].getHexString())}t.fillStyle=i,t.fill();var o=new THREE.Texture(canvas);return o.needsUpdate=!0,textureImage=o.image,o},Potree.PointCloudMaterial.generateClassificationTexture=function(e){for(var t=new Uint8Array(262144),i=0;i<256;i++)for(var r=0;r<256;r++){var n,o=i+256*r;n=e[i]?e[i]:e[i%32]?e[i%32]:e.DEFAULT,t[4*o+0]=255*n.x,t[4*o+1]=255*n.y,t[4*o+2]=255*n.z,t[4*o+3]=255*n.w}var a=new THREE.DataTexture(t,256,256,THREE.RGBAFormat);return a.magFilter=THREE.NearestFilter,a.needsUpdate=!0,a},(Potree.EyeDomeLightingMaterial=function(e){THREE.Material.call(this),e=e||{},this._neighbourCount=4,this.neighbours=new Float32Array(2*this.neighbourCount);for(var t=0;t<this.neighbourCount;t++)this.neighbours[2*t+0]=Math.cos(2*t*Math.PI/this.neighbourCount),this.neighbours[2*t+1]=Math.sin(2*t*Math.PI/this.neighbourCount);new THREE.Vector3(0,0,1).normalize();var i={screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},edlStrength:{type:"f",value:1},radius:{type:"f",value:1},neighbours:{type:"2fv",value:this.neighbours},depthMap:{type:"t",value:null},colorMap:{type:"t",value:null},opacity:{type:"f",value:1}};this.setValues({uniforms:i,vertexShader:this.getDefines()+Potree.Shaders["edl.vs"],fragmentShader:this.getDefines()+Potree.Shaders["edl.fs"],lights:!1})}).prototype=new THREE.ShaderMaterial,Potree.EyeDomeLightingMaterial.prototype.getDefines=function(){var e="";return e+="#define NEIGHBOUR_COUNT "+this.neighbourCount+"\n"},Potree.EyeDomeLightingMaterial.prototype.updateShaderSource=function(){var e={};this.pointColorType===Potree.PointColorType.INTENSITY||this.pointColorType===Potree.PointColorType.INTENSITY_GRADIENT?e.intensity={type:"f",value:[]}:this.pointColorType===Potree.PointColorType.CLASSIFICATION||(this.pointColorType===Potree.PointColorType.RETURN_NUMBER?(e.returnNumber={type:"f",value:[]},e.numberOfReturns={type:"f",value:[]}):this.pointColorType===Potree.PointColorType.SOURCE?e.pointSourceID={type:"f",value:[]}:this.pointColorType!==Potree.PointColorType.NORMAL&&this.pointColorType!==Potree.PointColorType.PHONG||(e.normal={type:"f",value:[]})),e.classification={type:"f",value:0};var t=this.getDefines()+Potree.Shaders["edl.vs"],i=this.getDefines()+Potree.Shaders["edl.fs"];this.setValues({vertexShader:t,fragmentShader:i}),this.uniforms.neighbours.value=this.neighbours,this.needsUpdate=!0},Object.defineProperty(Potree.EyeDomeLightingMaterial.prototype,"neighbourCount",{get:function(){return this._neighbourCount},set:function(e){if(this._neighbourCount!==e){this._neighbourCount=e,this.neighbours=new Float32Array(2*this._neighbourCount);for(var t=0;t<this._neighbourCount;t++)this.neighbours[2*t+0]=Math.cos(2*t*Math.PI/this._neighbourCount),this.neighbours[2*t+1]=Math.sin(2*t*Math.PI/this._neighbourCount);this.updateShaderSource()}}}),(Potree.BlurMaterial=function(e){THREE.Material.call(this),e=e||{};this.setValues({uniforms:{near:{type:"f",value:0},far:{type:"f",value:0},screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},map:{type:"t",value:null}},vertexShader:Potree.Shaders["blur.vs"],fragmentShader:Potree.Shaders["blur.fs"]})}).prototype=new THREE.ShaderMaterial,Potree.InputHandler=class extends THREE.EventDispatcher{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.domElement=this.renderer.domElement,this.scene=null,this.interactiveScenes=[],this.inputListeners=[],this.drag=null,this.mouse=new THREE.Vector2(0,0),this.selection=[],this.hoveredElements=[],this.pressedKeys={},this.wheelDelta=0,this.speed=1,this.logMessages=!1,-1===this.domElement.tabIndex&&(this.domElement.tabIndex=2222),this.domElement.addEventListener("contextmenu",e=>{e.preventDefault()},!1),this.domElement.addEventListener("click",this.onMouseClick.bind(this),!1),this.domElement.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.domElement.addEventListener("mouseup",this.onMouseUp.bind(this),!1),this.domElement.addEventListener("mousemove",this.onMouseMove.bind(this),!1),this.domElement.addEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.domElement.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),!1),this.domElement.addEventListener("dblclick",this.onDoubleClick.bind(this)),this.domElement.addEventListener("keydown",this.onKeyDown.bind(this)),this.domElement.addEventListener("keyup",this.onKeyUp.bind(this)),this.domElement.addEventListener("touchstart",this.onTouchStart.bind(this)),this.domElement.addEventListener("touchend",this.onTouchEnd.bind(this)),this.domElement.addEventListener("touchmove",this.onTouchMove.bind(this))}addInputListener(e){this.inputListeners.push(e)}removeInputListener(e){this.inputListeners=this.inputListeners.filter(t=>t!==e)}onTouchStart(e){if(this.logMessages&&console.log(this.constructor.name+": onTouchStart"),e.preventDefault(),1===e.touches.length){let t=this.domElement.getBoundingClientRect(),i=e.touches[0].pageX-t.left,r=e.touches[0].pageY-t.top;this.mouse.set(i,r),this.startDragging(null)}for(let t of this.inputListeners)t.dispatchEvent({type:e.type,touches:e.touches,changedTouches:e.changedTouches})}onTouchEnd(e){this.logMessages&&console.log(this.constructor.name+": onTouchEnd"),e.preventDefault();for(let e of this.inputListeners)e.dispatchEvent({type:"drop",drag:this.drag,viewer:this.viewer});this.drag=null;for(let t of this.inputListeners)t.dispatchEvent({type:e.type,touches:e.touches,changedTouches:e.changedTouches})}onTouchMove(e){if(this.logMessages&&console.log(this.constructor.name+": onTouchMove"),e.preventDefault(),1===e.touches.length){let t=this.domElement.getBoundingClientRect(),i=e.touches[0].pageX-t.left,r=e.touches[0].pageY-t.top;if(this.mouse.set(i,r),this.drag){this.drag.mouse=1,this.drag.lastDrag.x=i-this.drag.end.x,this.drag.lastDrag.y=r-this.drag.end.y,this.drag.end.set(i,r),this.logMessages&&console.log(this.constructor.name+": drag: ");for(let e of this.inputListeners)e.dispatchEvent({type:"drag",drag:this.drag,viewer:this.viewer})}}for(let t of this.inputListeners)t.dispatchEvent({type:e.type,touches:e.touches,changedTouches:e.changedTouches})}onKeyDown(e){this.logMessages&&console.log(this.constructor.name+": onKeyDown"),46===e.keyCode&&this.selection.length>0&&(this.dispatchEvent({type:"delete",selection:this.selection}),this.deselectAll()),this.dispatchEvent({type:"keydown",keyCode:e.keyCode,event:e}),this.pressedKeys[e.keyCode]=!0,e.preventDefault()}onKeyUp(e){this.logMessages&&console.log(this.constructor.name+": onKeyUp"),delete this.pressedKeys[e.keyCode],e.preventDefault()}onDoubleClick(e){this.logMessages&&console.log(this.constructor.name+": onDoubleClick");let t=!1;for(let e of this.hoveredElements)if(e._listeners&&e._listeners.dblclick){e.object.dispatchEvent({type:"dblclick",mouse:this.mouse,object:e.object}),t=!0;break}if(!t)for(let e of this.inputListeners)e.dispatchEvent({type:"dblclick",mouse:this.mouse,object:null});e.preventDefault()}onMouseClick(e){this.logMessages&&console.log(this.constructor.name+": onMouseClick"),e.preventDefault()}onMouseDown(e){if(this.logMessages&&console.log(this.constructor.name+": onMouseDown"),e.preventDefault(),0===this.hoveredElements.length)for(let e of this.inputListeners)e.dispatchEvent({type:"mousedown",viewer:this.viewer,mouse:this.mouse});if(!this.drag){let e=this.hoveredElements.find(e=>e.object._listeners&&e.object._listeners.drag&&e.object._listeners.drag.length>0);e?this.startDragging(e.object,{location:e.point}):this.startDragging(null)}this.scene&&(this.viewStart=this.scene.view.clone())}onMouseUp(e){this.logMessages&&console.log(this.constructor.name+": onMouseUp"),e.preventDefault();let t=0===this.getNormalizedDrag().length();if(e.button===THREE.MOUSE.LEFT){if(t){let e=this.hoveredElements.find(e=>e.object._listeners&&e.object._listeners.select);e?(e=e.object,this.isSelected(e)?this.selection.filter(t=>t!==e).forEach(e=>this.toggleSelection(e)):(this.deselectAll(),this.toggleSelection(e))):this.deselectAll()}}else e.button===THREE.MOUSE.RIGHT&&t&&this.deselectAll();if(0===this.hoveredElements.length)for(let e of this.inputListeners)e.dispatchEvent({type:"mouseup",viewer:this.viewer,mouse:this.mouse});if(this.drag){if(this.drag.object)this.drag.object.dispatchEvent({type:"drop",drag:this.drag,viewer:this.viewer});else{this.logMessages&&console.log(this.constructor.name+": drop: ");for(let e of this.inputListeners)e.dispatchEvent({type:"drop",drag:this.drag,viewer:this.viewer})}this.drag=null}}onMouseMove(e){this.logMessages&&console.log(this.constructor.name+": onMouseMove"),e.preventDefault();let t=this.domElement.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;if(this.mouse.set(i,r),this.drag)if(this.drag.mouse=e.buttons,this.drag.lastDrag.x=i-this.drag.end.x,this.drag.lastDrag.y=r-this.drag.end.y,this.drag.end.set(i,r),this.drag.object)this.logMessages&&console.log(this.constructor.name+": drag: "+this.drag.object.name),this.drag.object.dispatchEvent({type:"drag",drag:this.drag,viewer:this.viewer});else{this.logMessages&&console.log(this.constructor.name+": drag: ");for(let e of this.inputListeners)e.dispatchEvent({type:"drag",drag:this.drag,viewer:this.viewer})}let n=this.getHoveredElements(),o=n.map(e=>e.object),a=this.hoveredElements.map(e=>e.object),s=o.find(e=>e._listeners&&e._listeners.mouseover),l=a.find(e=>e._listeners&&e._listeners.mouseover);s!==l&&(s&&s.dispatchEvent({type:"mouseover",object:s}),l&&l.dispatchEvent({type:"mouseleave",object:l})),this.hoveredElements=n}onMouseWheel(e){this.logMessages&&console.log(this.constructor.name+": onMouseWheel"),e.preventDefault();let t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail);let i=Math.sign(t);if(this.hoveredElement)this.hoveredElement.object.dispatchEvent({type:"mousewheel",delta:i,object:this.hoveredElement.object});else for(let e of this.inputListeners)e.dispatchEvent({type:"mousewheel",delta:i,object:null})}startDragging(e,t=null){if(this.drag={start:this.mouse.clone(),end:this.mouse.clone(),lastDrag:new THREE.Vector2(0,0),startView:this.scene.view.clone(),object:e},t)for(let e of Object.keys(t))this.drag[e]=t[e]}getMousePointCloudIntersection(e){return Potree.utils.getMousePointCloudIntersection(this.mouse,this.scene.camera,this.renderer,this.scene.pointclouds)}toggleSelection(e){let t=this.selection,i=this.selection.indexOf(e);-1===i?(this.selection.push(e),e.dispatchEvent({type:"select"})):(this.selection.splice(i,1),e.dispatchEvent({type:"deselect"})),this.dispatchEvent({type:"selection_changed",oldSelection:t,selection:this.selection})}deselectAll(){for(let e of this.selection)e.dispatchEvent({type:"deselect"});let e=this.selection;this.selection.length>0&&(this.selection=[],this.dispatchEvent({type:"selection_changed",oldSelection:e,selection:this.selection}))}isSelected(e){return-1!==this.selection.indexOf(e)}registerInteractiveScene(e){-1===this.interactiveScenes.indexOf(e)&&this.interactiveScenes.push(e)}unregisterInteractiveScene(e){let t=this.interactiveScenes.indexOf(e);t>-1&&this.interactiveScenes.splice(t,1)}getHoveredElement(){let e=this.getHoveredElements();return e.length>0?e[0]:null}getHoveredElements(){let e=this.interactiveScenes.concat(this.scene.scene),t=["mouseover","mouseleave","drag","drop","click","select","deselect"],i=[];for(let r of e)r.traverseVisible(e=>{if(e._listeners&&e.visible){t.filter(t=>void 0!==e._listeners[t]).length>0&&i.push(e)}});let r={x:this.mouse.x/this.domElement.clientWidth*2-1,y:-this.mouse.y/this.domElement.clientHeight*2+1},n=new THREE.Vector3(r.x,r.y,.5);n.unproject(this.scene.camera);let o=new THREE.Raycaster;o.ray.set(this.scene.camera.position,n.sub(this.scene.camera.position).normalize()),o.linePrecision=.2;return o.intersectObjects(i,!1)}setScene(e){this.deselectAll(),this.scene=e}update(e){}getNormalizedDrag(){if(!this.drag)return new THREE.Vector2(0,0);let e=(new THREE.Vector2).subVectors(this.drag.end,this.drag.start);return e.x=e.x/this.domElement.clientWidth,e.y=e.y/this.domElement.clientHeight,e}getNormalizedLastDrag(){if(!this.drag)return new THREE.Vector2(0,0);let e=this.drag.lastDrag.clone();return e.x=e.x/this.domElement.clientWidth,e.y=e.y/this.domElement.clientHeight,e}},Potree.FirstPersonControls=class extends THREE.EventDispatcher{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.scene=null,this.sceneControls=new THREE.Scene,this.rotationSpeed=200,this.moveSpeed=10,this.keys={FORWARD:["W".charCodeAt(0),38],BACKWARD:["S".charCodeAt(0),40],LEFT:["A".charCodeAt(0),37],RIGHT:["D".charCodeAt(0),39],UP:["R".charCodeAt(0),33],DOWN:["F".charCodeAt(0),34]},this.fadeFactor=50,this.yawDelta=0,this.pitchDelta=0,this.translationDelta=new THREE.Vector3(0,0,0),this.translationWorldDelta=new THREE.Vector3(0,0,0),this.tweens=[];this.addEventListener("drag",e=>{if(null!==e.drag.object)return;void 0===e.drag.startHandled&&(e.drag.startHandled=!0,this.dispatchEvent({type:"start"}));let t=this.viewer.getMoveSpeed(),i=e.drag.lastDrag.x/this.renderer.domElement.clientWidth,r=e.drag.lastDrag.y/this.renderer.domElement.clientHeight;e.drag.mouse===Potree.MOUSE.LEFT?(this.yawDelta+=i*this.rotationSpeed,this.pitchDelta+=r*this.rotationSpeed):e.drag.mouse===Potree.MOUSE.RIGHT&&(this.translationDelta.x-=i*t*100,this.translationDelta.z+=r*t*100)}),this.addEventListener("drop",e=>{this.dispatchEvent({type:"end"})}),this.addEventListener("mousewheel",e=>{let t=this.viewer.getMoveSpeed();e.delta<0?t*=.9:e.delta>0&&(t/=.9),t=Math.max(t,.1),this.viewer.setMoveSpeed(t)}),this.addEventListener("dblclick",e=>{this.zoomToLocation(e.mouse)})}setScene(e){this.scene=e}zoomToLocation(e){let t=this.scene.camera,i=Potree.utils.getMousePointCloudIntersection(e,t,this.renderer,this.scene.pointclouds);if(null===i)return;let r={x:+e.x/this.renderer.domElement.clientWidth*2-1,y:-e.y/this.renderer.domElement.clientHeight*2+1},n=0;{let e=new THREE.Vector3(r.x,r.y,.5);e.unproject(t);let o=e.sub(t.position).normalize(),a=new THREE.Ray(t.position,o),s=i.pointcloud.nodesOnRay(i.pointcloud.visibleNodes,a),l=s[s.length-1].getBoundingSphere().radius;n=Math.min(this.scene.view.radius,l),n=Math.max(.2,n)}let o=this.scene.view.direction.multiplyScalar(-1),a=(new THREE.Vector3).addVectors(i.location,o.multiplyScalar(n));i.location;var s=TWEEN.Easing.Quartic.Out;{let e={x:0},t=new TWEEN.Tween(e).to({x:1},600);t.easing(s),this.tweens.push(t);let r=this.scene.view.position.clone(),n=a.clone(),o=this.scene.view.radius,l=a.distanceTo(i.location);t.onUpdate(()=>{let t=e.x;this.scene.view.position.x=(1-t)*r.x+t*n.x,this.scene.view.position.y=(1-t)*r.y+t*n.y,this.scene.view.position.z=(1-t)*r.z+t*n.z,this.scene.view.radius=(1-t)*o+t*l,this.viewer.setMoveSpeed(this.scene.view.radius/2.5)}),t.onComplete(()=>{this.tweens=this.tweens.filter(e=>e!==t)}),t.start()}}update(e){let t=this.scene.view;[this.yawDelta,this.pitchDelta,this.translationDelta.length(),this.translationWorldDelta.length()].some(e=>Math.abs(e)>.001)&&this.tweens.length>0&&(this.tweens.forEach(e=>e.stop()),this.tweens=[]);{let e=this.viewer.inputHandler,t=this.keys.FORWARD.some(t=>e.pressedKeys[t]),i=this.keys.BACKWARD.some(t=>e.pressedKeys[t]),r=this.keys.LEFT.some(t=>e.pressedKeys[t]),n=this.keys.RIGHT.some(t=>e.pressedKeys[t]),o=this.keys.UP.some(t=>e.pressedKeys[t]),a=this.keys.DOWN.some(t=>e.pressedKeys[t]);t&&i?this.translationDelta.y=0:t?this.translationDelta.y=this.viewer.getMoveSpeed():i&&(this.translationDelta.y=-this.viewer.getMoveSpeed()),r&&n?this.translationDelta.x=0:r?this.translationDelta.x=-this.viewer.getMoveSpeed():n&&(this.translationDelta.x=this.viewer.getMoveSpeed()),o&&a?this.translationWorldDelta.z=0:o?this.translationWorldDelta.z=this.viewer.getMoveSpeed():a&&(this.translationWorldDelta.z=-this.viewer.getMoveSpeed())}{let i=t.yaw,r=t.pitch;i-=this.yawDelta*e,r-=this.pitchDelta*e,t.yaw=i,t.pitch=r}t.translate(this.translationDelta.x*e,this.translationDelta.y*e,this.translationDelta.z*e),t.translateWorld(this.translationWorldDelta.x*e,this.translationWorldDelta.y*e,this.translationWorldDelta.z*e),t.radius=3*this.viewer.getMoveSpeed();{let t=Math.max(0,1-this.fadeFactor*e);this.yawDelta*=t,this.pitchDelta*=t,this.translationDelta.multiplyScalar(t),this.translationWorldDelta.multiplyScalar(t)}}},(Potree.GeoControls=function(e,t){function onMouseWheel(e){if(!1!==i.enabled&&!0!==i.noZoom){e.preventDefault();var t=e.detail<0||e.wheelDelta>0?1:-1,r=i.moveSpeed+.1*i.moveSpeed*t;r=Math.max(.1,r),i.setMoveSpeed(r),i.dispatchEvent(v),i.dispatchEvent(y)}}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.track=null,this.trackPos=0,this.rotateSpeed=1,this.moveSpeed=10,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,A:"A".charCodeAt(0),S:"S".charCodeAt(0),D:"D".charCodeAt(0),W:"W".charCodeAt(0),Q:"Q".charCodeAt(0),E:"E".charCodeAt(0),R:"R".charCodeAt(0),F:"F".charCodeAt(0)};var i=this,r=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,a=new THREE.Vector2,s=new THREE.Vector2,l=new THREE.Vector2,c=new THREE.Vector3,u=(new THREE.Vector3,0),h=0,d=new THREE.Vector3;this.shiftDown=!1;var p=new THREE.Vector3,f={NONE:-1,ROTATE:0,SPEEDCHANGE:1,PAN:2},m=f.NONE;this.position0=this.object.position.clone();var g={type:"change"},v={type:"start"},y={type:"end"};this.setTrack=function(e){this.track!==e&&(this.track=e,this.trackPos=null)},this.setTrackPos=function(e,t){var r=Math.max(0,Math.min(1,e)),n=this.trackPos||r,o=this.track.getTangentAt(r),a=this.track.getTangentAt(n);if(o.equals(a));else{var s=(new THREE.Vector3).crossVectors(a,o).normalize(),l=a.angleTo(o),c=(new THREE.Matrix4).makeRotationAxis(s,l),u=this.object.getWorldDirection().clone();u=u.applyMatrix4(c);var h=(new THREE.Vector3).addVectors(this.object.position,u);this.object.lookAt(h),this.object.updateMatrixWorld();var p={type:"path_relative_rotation",angle:l,axis:s,controls:i};this.dispatchEvent(p)}if(null===this.trackPos){h=(new THREE.Vector3).addVectors(this.object.position,o);this.object.lookAt(h)}if(this.trackPos=r,r!==n){p={type:"move",translation:d.clone()};this.dispatchEvent(p)}},this.getTrackPos=function(){return this.trackPos},this.rotateLeft=function(e){h-=e},this.rotateUp=function(e){u-=e},this.panLeft=function(e){var t=this.object.matrix.elements;c.set(t[0],t[1],t[2]),c.multiplyScalar(-e),d.add(c)},this.panUp=function(e){var t=this.object.matrix.elements;c.set(t[4],t[5],t[6]),c.multiplyScalar(e),d.add(c)},this.panForward=function(e){if(this.track)this.setTrackPos(this.getTrackPos()-e/this.track.getLength());else{var t=this.object.matrix.elements;c.set(t[8],t[9],t[10]),c.multiplyScalar(e),d.add(c)}},this.pan=function(e,t){var r=i.domElement===document?i.domElement.body:i.domElement;if(void 0!==i.object.fov){var n=i.object.position.clone().length();n*=Math.tan(i.object.fov/2*Math.PI/180),i.panLeft(2*e*n/r.clientHeight),i.panUp(2*t*n/r.clientHeight)}else void 0!==i.object.top?(i.panLeft(e*(i.object.right-i.object.left)/r.clientWidth),i.panUp(t*(i.object.top-i.object.bottom)/r.clientHeight)):console.warn("WARNING: GeoControls.js encountered an unknown camera type - pan disabled.")},this.update=function(e){this.object.rotation.order="ZYX";var t=this.object;this.object=new THREE.Object3D,this.object.position.copy(t.position),this.object.rotation.copy(t.rotation),this.object.updateMatrix(),this.object.updateMatrixWorld();var r=this.object.position;if(void 0!==e){var n=i.shiftDown?4:1;this.moveRight&&this.panLeft(-e*this.moveSpeed*n),this.moveLeft&&this.panLeft(e*this.moveSpeed*n),(this.moveForward||this.moveForwardMouse)&&this.panForward(-e*this.moveSpeed*n),this.moveBackward&&this.panForward(e*this.moveSpeed*n),this.rotLeft&&i.rotateLeft(-.5*Math.PI*e/i.rotateSpeed),this.rotRight&&i.rotateLeft(.5*Math.PI*e/i.rotateSpeed),this.raiseCamera&&i.panUp(e*this.moveSpeed*n),this.lowerCamera&&i.panUp(-e*this.moveSpeed*n)}if(!d.equals(new THREE.Vector3(0,0,0))){var o={type:"move",translation:d.clone()};this.dispatchEvent(o)}if(r.add(d),0!==h||0!==u){o={type:"rotate",thetaDelta:h,phiDelta:u};this.dispatchEvent(o)}this.object.updateMatrix();var a=(new THREE.Matrix4).makeRotationY(h),s=(new THREE.Matrix4).multiplyMatrices(a,this.object.matrix);this.object.quaternion.setFromRotationMatrix(s),this.object.rotation.x+=u,this.object.updateMatrixWorld();var l={type:"proposeTransform",oldPosition:t.position,newPosition:this.object.position,objections:0,counterProposals:[]};if(this.dispatchEvent(l),l.objections>0&&l.counterProposals.length>0){var c=l.counterProposals;this.object.position.copy(c[0]),l.objections=0,l.counterProposals=[]}if(l.objections>0||t.position.copy(this.object.position),t.rotation.copy(this.object.rotation),this.object=t,h=0,u=0,1,d.set(0,0,0),p.distanceTo(this.object.position)>0&&(this.dispatchEvent(g),p.copy(this.object.position)),this.track){var f=this.track.getPointAt(this.trackPos);t.position.copy(f)}},this.reset=function(){m=f.NONE,this.object.position.copy(this.position0)},this.setMoveSpeed=function(e){i.moveSpeed!==e&&(i.moveSpeed=e,i.dispatchEvent({type:"move_speed_changed",controls:i}))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function onMouseDown(e){!1!==i.enabled&&(e.preventDefault(),0===e.button?(m=f.ROTATE,r.set(e.clientX,e.clientY)):1===e.button?(m=f.PAN,a.set(e.clientX,e.clientY)):2===e.button&&(i.moveForwardMouse=!0),i.dispatchEvent(v))},!1),this.domElement.addEventListener("mousewheel",onMouseWheel,!1),this.domElement.addEventListener("DOMMouseScroll",onMouseWheel,!1),i.domElement.addEventListener("mousemove",function onMouseMove(e){if(!1!==i.enabled){e.preventDefault();var t=i.domElement===document?i.domElement.body:i.domElement;m===f.ROTATE?(n.set(e.clientX,e.clientY),o.subVectors(n,r),i.rotateLeft(2*Math.PI*o.x/t.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*o.y/t.clientHeight*i.rotateSpeed),r.copy(n)):m===f.PAN&&(s.set(e.clientX,e.clientY),l.subVectors(s,a),l.multiplyScalar(.002).multiplyScalar(i.moveSpeed),i.pan(l.x,l.y),a.copy(s))}},!1),i.domElement.addEventListener("mouseup",function onMouseUp(e){!1!==i.enabled&&(2===e.button?i.moveForwardMouse=!1:(i.dispatchEvent(y),m=f.NONE))},!1),-1===this.domElement.tabIndex&&(this.domElement.tabIndex=2222),i.domElement.addEventListener("keydown",function onKeyDown(e){if(!1!==i.enabled)switch(i.shiftDown=e.shiftKey,e.keyCode){case i.keys.UP:i.moveForward=!0;break;case i.keys.BOTTOM:i.moveBackward=!0;break;case i.keys.LEFT:i.moveLeft=!0;break;case i.keys.RIGHT:i.moveRight=!0;break;case i.keys.W:i.moveForward=!0;break;case i.keys.S:i.moveBackward=!0;break;case i.keys.A:i.moveLeft=!0;break;case i.keys.D:i.moveRight=!0;break;case i.keys.Q:i.rotLeft=!0;break;case i.keys.E:i.rotRight=!0;break;case i.keys.R:i.raiseCamera=!0;break;case i.keys.F:i.lowerCamera=!0}},!1),i.domElement.addEventListener("keyup",function onKeyUp(e){switch(i.shiftDown=e.shiftKey,e.keyCode){case i.keys.W:i.moveForward=!1;break;case i.keys.S:i.moveBackward=!1;break;case i.keys.A:i.moveLeft=!1;break;case i.keys.D:i.moveRight=!1;break;case i.keys.UP:i.moveForward=!1;break;case i.keys.BOTTOM:i.moveBackward=!1;break;case i.keys.LEFT:i.moveLeft=!1;break;case i.keys.RIGHT:i.moveRight=!1;break;case i.keys.Q:i.rotLeft=!1;break;case i.keys.E:i.rotRight=!1;break;case i.keys.R:i.raiseCamera=!1;break;case i.keys.F:i.lowerCamera=!1}},!1)}).prototype=Object.create(THREE.EventDispatcher.prototype),Potree.OrbitControls=class extends THREE.EventDispatcher{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.scene=null,this.sceneControls=new THREE.Scene,this.rotationSpeed=5,this.fadeFactor=10,this.yawDelta=0,this.pitchDelta=0,this.panDelta=new THREE.Vector2(0,0),this.radiusDelta=0,this.tweens=[];let t=null;this.addEventListener("touchstart",e=>{t=e}),this.addEventListener("touchend",e=>{t=e}),this.addEventListener("touchmove",e=>{if(2===e.touches.length&&2===t.touches.length){let i=t,r=e,n=i.touches[0].pageX-i.touches[1].pageX,o=i.touches[0].pageY-i.touches[1].pageY,a=Math.sqrt(n*n+o*o),s=r.touches[0].pageX-r.touches[1].pageX,l=r.touches[0].pageY-r.touches[1].pageY,c=Math.sqrt(s*s+l*l)/a,u=this.scene.view.radius+this.radiusDelta,h=u/c;this.radiusDelta=h-u}t=e}),this.addEventListener("drag",e=>{if(null!==e.drag.object)return;void 0===e.drag.startHandled&&(e.drag.startHandled=!0,this.dispatchEvent({type:"start"}));let t=e.drag.lastDrag.x/this.renderer.domElement.clientWidth,i=e.drag.lastDrag.y/this.renderer.domElement.clientHeight;e.drag.mouse===Potree.MOUSE.LEFT?(this.yawDelta+=t*this.rotationSpeed,this.pitchDelta+=i*this.rotationSpeed):e.drag.mouse===Potree.MOUSE.RIGHT&&(this.panDelta.x+=t,this.panDelta.y+=i)}),this.addEventListener("drop",e=>{this.dispatchEvent({type:"end"})}),this.addEventListener("mousewheel",e=>{let t=this.scene.view.radius+this.radiusDelta;this.radiusDelta+=-e.delta*t*.1}),this.addEventListener("dblclick",e=>{this.zoomToLocation(e.mouse)})}setScene(e){this.scene=e}zoomToLocation(e){let t=this.scene.camera,i=Potree.utils.getMousePointCloudIntersection(e,t,this.renderer,this.scene.pointclouds);if(null===i)return;let r={x:+e.x/this.renderer.domElement.clientWidth*2-1,y:-e.y/this.renderer.domElement.clientHeight*2+1},n=0;{let e=new THREE.Vector3(r.x,r.y,.5);e.unproject(t);let o=e.sub(t.position).normalize(),a=new THREE.Ray(t.position,o),s=i.pointcloud.nodesOnRay(i.pointcloud.visibleNodes,a),l=s[s.length-1].getBoundingSphere().radius;n=Math.min(this.scene.view.radius,l),n=Math.max(.2,n)}let o=this.scene.view.direction.multiplyScalar(-1),a=(new THREE.Vector3).addVectors(i.location,o.multiplyScalar(n));i.location;var s=TWEEN.Easing.Quartic.Out;{let e={x:0},t=new TWEEN.Tween(e).to({x:1},600);t.easing(s),this.tweens.push(t);let r=this.scene.view.position.clone(),n=a.clone(),o=this.scene.view.radius,l=a.distanceTo(i.location);t.onUpdate(()=>{let t=e.x;this.scene.view.position.x=(1-t)*r.x+t*n.x,this.scene.view.position.y=(1-t)*r.y+t*n.y,this.scene.view.position.z=(1-t)*r.z+t*n.z,this.scene.view.radius=(1-t)*o+t*l,this.viewer.setMoveSpeed(this.scene.view.radius/2.5)}),t.onComplete(()=>{this.tweens=this.tweens.filter(e=>e!==t)}),t.start()}}update(e){let t=this.scene.view;[this.yawDelta,this.pitchDelta,this.radiusDelta,this.panDelta.length()].some(e=>Math.abs(e)>.001)&&this.tweens.length>0&&(this.tweens.forEach(e=>e.stop()),this.tweens=[]);{let i=Math.min(1,this.fadeFactor*e),r=t.yaw,n=t.pitch,o=t.getPivot();r-=i*this.yawDelta,n-=i*this.pitchDelta,t.yaw=r,t.pitch=n;let a=this.scene.view.direction.multiplyScalar(-t.radius),s=(new THREE.Vector3).addVectors(o,a);t.position.copy(s)}{let i=Math.min(1,this.fadeFactor*e)*t.radius*3,r=-this.panDelta.x*i,n=this.panDelta.y*i;t.pan(r,n)}{let i=Math.min(1,this.fadeFactor*e),r=t.radius+i*this.radiusDelta,n=t.direction.multiplyScalar(-r),o=(new THREE.Vector3).addVectors(t.getPivot(),n);t.radius=r,t.position.copy(o)}{let e=t.radius/2.5;this.viewer.setMoveSpeed(e)}{let t=Math.min(1,this.fadeFactor*e),i=Math.max(0,1-this.fadeFactor*e);this.yawDelta*=i,this.pitchDelta*=i,this.panDelta.multiplyScalar(i),this.radiusDelta-=t*this.radiusDelta}}},Potree.EarthControls=class extends THREE.EventDispatcher{constructor(e){super(e),this.viewer=e,this.renderer=e.renderer,this.scene=null,this.sceneControls=new THREE.Scene,this.rotationSpeed=10,this.fadeFactor=20,this.wheelDelta=0,this.zoomDelta=new THREE.Vector3,this.camStart=null,this.tweens=[],this.pivotIndicator;{let e=new THREE.SphereGeometry(1,16,16),t=new THREE.MeshNormalMaterial;this.pivotIndicator=new THREE.Mesh(e,t),this.pivotIndicator.visible=!1,this.sceneControls.add(this.pivotIndicator)}this.addEventListener("drag",e=>{if(null!==e.drag.object)return;if(!this.pivot)return;void 0===e.drag.startHandled&&(e.drag.startHandled=!0,this.dispatchEvent({type:"start"}));let t=this.camStart,i=this.viewer.scene.view,r=e.drag.end,n=this.viewer.renderer.domElement;if(e.drag.mouse===Potree.MOUSE.LEFT){let e={x:r.x/n.clientWidth*2-1,y:-r.y/n.clientHeight*2+1},o=new THREE.Vector3(e.x,e.y,.5);o.unproject(t);let a=o.sub(t.position).normalize(),s=new THREE.Ray(t.position,a),l=(new THREE.Plane).setFromNormalAndCoplanarPoint(new THREE.Vector3(0,0,1),this.pivot),c=s.distanceToPlane(l);if(c>0){let e=(new THREE.Vector3).addVectors(t.position,a.clone().multiplyScalar(c)),r=(new THREE.Vector3).subVectors(e,this.pivot),n=t.position.clone().sub(r);i.position.copy(n);{let e=n.distanceTo(this.pivot);i.radius=e;let t=i.radius/2.5;this.viewer.setMoveSpeed(t)}}}else if(e.drag.mouse===Potree.MOUSE.RIGHT){let t={x:e.drag.lastDrag.x/this.renderer.domElement.clientWidth,y:e.drag.lastDrag.y/this.renderer.domElement.clientHeight},r=-t.x*this.rotationSpeed*.5,n=-t.y*this.rotationSpeed*.2,o=i.pitch,a=i.clone();a.pitch=a.pitch+n,n=a.pitch-o;let s=(new THREE.Vector3).subVectors(i.position,this.pivot),l=(new THREE.Vector3).subVectors(i.getPivot(),this.pivot),c=i.getSide();s.applyAxisAngle(c,n),l.applyAxisAngle(c,n),s.applyAxisAngle(new THREE.Vector3(0,0,1),r),l.applyAxisAngle(new THREE.Vector3(0,0,1),r);let u=(new THREE.Vector3).addVectors(this.pivot,s);(new THREE.Vector3).addVectors(this.pivot,l),i.position.copy(u),i.yaw+=r,i.pitch+=n}}),this.addEventListener("drop",e=>{this.dispatchEvent({type:"end"})}),this.addEventListener("mousewheel",e=>{this.wheelDelta+=e.delta}),this.addEventListener("mousedown",e=>{let t=Potree.utils.getMousePointCloudIntersection(e.mouse,this.scene.camera,this.renderer,this.scene.pointclouds);t&&(this.pivot=t.location,this.camStart=this.scene.camera.clone(),this.pivotIndicator.visible=!0,this.pivotIndicator.position.copy(t.location))}),this.addEventListener("mouseup",e=>{this.camStart=null,this.pivot=null,this.pivotIndicator.visible=!1}),this.addEventListener("dblclick",e=>{this.zoomToLocation(e.mouse)})}setScene(e){this.scene=e}zoomToLocation(e){let t=this.scene.camera,i=Potree.utils.getMousePointCloudIntersection(e,t,this.renderer,this.scene.pointclouds);if(null===i)return;let r={x:+e.x/this.renderer.domElement.clientWidth*2-1,y:-e.y/this.renderer.domElement.clientHeight*2+1},n=0;{let e=new THREE.Vector3(r.x,r.y,.5);e.unproject(t);let o=e.sub(t.position).normalize(),a=new THREE.Ray(t.position,o),s=i.pointcloud.nodesOnRay(i.pointcloud.visibleNodes,a),l=s[s.length-1].getBoundingSphere().radius;n=Math.min(this.scene.view.radius,l),n=Math.max(.2,n)}let o=this.scene.view.direction.multiplyScalar(-1),a=(new THREE.Vector3).addVectors(i.location,o.multiplyScalar(n));i.location;var s=TWEEN.Easing.Quartic.Out;{let e={x:0},t=new TWEEN.Tween(e).to({x:1},600);t.easing(s),this.tweens.push(t);let r=this.scene.view.position.clone(),n=a.clone(),o=this.scene.view.radius,l=a.distanceTo(i.location);t.onUpdate(()=>{let t=e.x;this.scene.view.position.x=(1-t)*r.x+t*n.x,this.scene.view.position.y=(1-t)*r.y+t*n.y,this.scene.view.position.z=(1-t)*r.z+t*n.z,this.scene.view.radius=(1-t)*o+t*l,this.viewer.setMoveSpeed(this.scene.view.radius/2.5)}),t.onComplete(()=>{this.tweens=this.tweens.filter(e=>e!==t)}),t.start()}}update(e){let t=this.scene.view,i=Math.pow(.5,this.fadeFactor*e),r=1-i,n=this.scene.camera;if(0!==this.wheelDelta){let e=Potree.utils.getMousePointCloudIntersection(this.viewer.inputHandler.mouse,this.scene.camera,this.renderer,this.scene.pointclouds);if(e){let i=(new THREE.Vector3).addVectors(t.position,this.zoomDelta),r=.2*e.location.distanceTo(i)*this.wheelDelta,n=(new THREE.Vector3).subVectors(e.location,t.position);n.normalize(),i.add(n.multiplyScalar(r)),this.zoomDelta.subVectors(i,t.position);{let r=i.distanceTo(e.location);t.radius=r;let n=t.radius/2.5;this.viewer.setMoveSpeed(n)}}}if(0!==this.zoomDelta.length()){let e=this.zoomDelta.clone().multiplyScalar(r),i=(new THREE.Vector3).addVectors(t.position,e);t.position.copy(i)}if(this.pivotIndicator.visible){let e=this.pivotIndicator.position.distanceTo(t.position),i=this.renderer.domElement.clientHeight,r=10/Potree.utils.projectedRadius(1,n.fov*Math.PI/180,e,i);this.pivotIndicator.scale.set(r,r,r)}this.zoomDelta.multiplyScalar(i),this.wheelDelta=0}},LRU.prototype.size=function(){return this.elements},LRU.prototype.contains=function(e){return null==this.items[e.id]},LRU.prototype.touch=function(e){if(e.loaded){var t;null==this.items[e.id]?((t=new function LRUItem(e){this.previous=null,this.next=null,this.node=e}(e)).previous=this.last,this.last=t,null!==t.previous&&(t.previous.next=t),this.items[e.id]=t,this.elements++,null===this.first&&(this.first=t),this.numPoints+=e.numPoints):null===(t=this.items[e.id]).previous?null!==t.next&&(this.first=t.next,this.first.previous=null,t.previous=this.last,t.next=null,this.last=t,t.previous.next=t):null===t.next||(t.previous.next=t.next,t.next.previous=t.previous,t.previous=this.last,t.next=null,this.last=t,t.previous.next=t)}},LRU.prototype.remove=function remove(e){var t=this.items[e.id];t&&(1===this.elements?(this.first=null,this.last=null):(t.previous||(this.first=t.next,this.first.previous=null),t.next||(this.last=t.previous,this.last.next=null),t.previous&&t.next&&(t.previous.next=t.next,t.next.previous=t.previous)),delete this.items[e.id],this.elements--,this.numPoints-=e.numPoints)},LRU.prototype.getLRUItem=function(){if(null===this.first)return null;return this.first.node},LRU.prototype.toString=function(){for(var e="{ ",t=this.first;null!==t;)e+=t.node.id,null!==t.next&&(e+=", "),t=t.next;return e+="}",e+="("+this.size()+")"},LRU.prototype.freeMemory=function(){if(!(this.elements<=1))for(;this.numPoints>Potree.pointLoadLimit;){var e=this.first.node;this.disposeDescendants(e)}},LRU.prototype.disposeDescendants=function(e){var t=[];for(t.push(e);t.length>0;){var i=t.pop();i.dispose(),this.remove(i);for(var r in i.children)if(i.children.hasOwnProperty(r)){i.children[r].loaded&&t.push(i.children[r])}}},(Potree.Annotation=function(e,t={}){var i=this;if(Potree.Annotation.counter++,this.scene=e,this.ordinal=t.title||Potree.Annotation.counter,this.title=t.title||"No Title",this.description=t.description||"",this.position=t.position||new THREE.Vector3(0,0,0),this.cameraPosition=t.cameraPosition instanceof Array?(new THREE.Vector3).fromArray(t.cameraPosition):t.cameraPosition,this.cameraTarget=t.cameraTarget instanceof Array?(new THREE.Vector3).fromArray(t.cameraTarget):t.cameraTarget,this.view=t.view||null,this.keepOpen=!1,this.descriptionVisible=!1,this.showDescription=!0,this.actions=t.actions||[],this.appearance=t.appearance||null,this.isHighlighted=!1,this.domElement=document.createElement("div"),this.domElement.style.position="absolute",this.domElement.style.opacity="0.5",this.domElement.style.padding="10px",this.domElement.className="annotation",null!==this.appearance?(this.elOrdinal=document.createElement("div"),this.elOrdinal.style.position="relative",this.elOrdinal.style.zIndex="100",this.elOrdinal.style.width="fit-content",this.elOrdinal.innerHTML=this.appearance,this.domElement.appendChild(this.elOrdinal)):(this.elOrdinal=document.createElement("div"),this.elOrdinal.style.position="relative",this.elOrdinal.style.color="white",this.elOrdinal.style.backgroundColor="black",this.elOrdinal.style.borderRadius="1.5em",this.elOrdinal.style.fontSize="1em",this.elOrdinal.style.opacity="1",this.elOrdinal.style.margin="auto",this.elOrdinal.style.zIndex="100",this.elOrdinal.style.width="fit-content",this.domElement.appendChild(this.elOrdinal),this.elOrdinalText=document.createElement("span"),this.elOrdinalText.style.display="inline-block",this.elOrdinalText.style.verticalAlign="middle",this.elOrdinalText.style.lineHeight="1.5em",this.elOrdinalText.style.textAlign="center",this.elOrdinalText.style.fontFamily="Arial",this.elOrdinalText.style.fontWeight="bold",this.elOrdinalText.style.padding="1px 8px 0px 8px",this.elOrdinalText.style.cursor="default",this.elOrdinalText.innerHTML=this.ordinal,this.elOrdinalText.style.userSelect="none",this.elOrdinal.appendChild(this.elOrdinalText),this.elOrdinal.onmouseenter=function(){},this.elOrdinal.onmouseleave=function(){},this.elOrdinalText.onclick=(()=>{this.hasView()&&this.moveHere(this.scene.camera),this.dispatchEvent({type:"click",target:this})})),this.domDescription=document.createElement("div"),this.domDescription.style.position="relative",this.domDescription.style.color="white",this.domDescription.style.backgroundColor="black",this.domDescription.style.padding="10px",this.domDescription.style.margin="5px 0px 0px 0px",this.domDescription.style.borderRadius="4px",this.domDescription.style.display="none",this.domDescription.style.maxWidth="500px",this.domElement.appendChild(this.domDescription),this.actions.length>0){this.elOrdinalText.style.padding="1px 3px 0px 8px";for(let e of this.actions){let t=document.createElement("img");t.src=e.icon,t.style.width="24px",t.style.height="24px",t.style.filter="invert(1)",t.style.display="inline-block",t.style.verticalAlign="middle",t.style.lineHeight="1.5em",t.style.textAlign="center",t.style.fontFamily="Arial",t.style.fontWeight="bold",t.style.padding="1px 8px 0px 1px",t.style.cursor="default",this.elOrdinal.appendChild(t),t.onclick=function(){e.onclick()}}}{let e=Potree.resourcePath+"/icons/close.svg",t=$(`<span><img src="${e}" width="16px"></span>`);t.css("filter","invert(100%)"),t.css("float","right"),t.css("opacity","0.5"),t.css("margin","0px 0px 8px 8px"),t.hover(e=>{t.css("opacity","1")},e=>{t.css("opacity","0.5")}),t.click(e=>{this.setHighlighted(!1)}),$(this.domDescription).append(t),this.elDescriptionText=document.createElement("span"),this.elDescriptionText.style.color="#ffffff",this.elDescriptionText.innerHTML=this.description,this.domDescription.appendChild(this.elDescriptionText)}this.domElement.onmouseenter=(()=>{this.setHighlighted(!0)}),$(this.domElement).on("touchstart",e=>{this.setHighlighted(!this.isHighlighted)}),this.domElement.onmouseleave=(()=>{this.setHighlighted(!1)}),this.setHighlighted=function(e){e?(this.domElement.style.opacity="0.8",this.elOrdinal.style.boxShadow="0 0 5px #fff",this.domElement.style.zIndex="1000",this.description&&(this.descriptionVisible=!0,this.domDescription.style.display="block",this.domDescription.style.position="relative")):(this.domElement.style.opacity="0.5",this.elOrdinal.style.boxShadow="",this.domElement.style.zIndex="100",this.descriptionVisible=!1,this.domDescription.style.display="none"),this.isHighlighted=e},this.hasView=function(){let e=this.cameraTarget instanceof THREE.Vector3;return e=e&&this.cameraPosition instanceof THREE.Vector3},this.moveHere=function(e){if(this.hasView()){var t=TWEEN.Easing.Quartic.Out;{let e=new TWEEN.Tween(i.scene.view.position).to(i.cameraPosition,800);e.easing(t),e.start()}var r=e.position.distanceTo(i.cameraTarget),n=(new THREE.Vector3).addVectors(e.position,e.getWorldDirection().clone().multiplyScalar(r)),o=new TWEEN.Tween(n).to(i.cameraTarget,800);o.easing(t),o.onUpdate(function(){i.scene.view.lookAt(n)}),o.onComplete(function(){i.scene.view.lookAt(n),i.dispatchEvent({type:"focusing_finished",target:i})}),i.dispatchEvent({type:"focusing_started",target:i}),o.start()}},this.dispose=function(){this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement)}}).prototype=Object.create(THREE.EventDispatcher.prototype),Potree.Annotation.counter=0,Potree.ProfileData=function(e){this.profile=e,this.segments=[],this.boundingBox=new THREE.Box3,this.projectedBoundingBox=new THREE.Box2;for(var t=new THREE.Vector3,i=0;i<e.points.length-1;i++){var r=e.points[i],n=e.points[i+1],o=new THREE.Vector3(r.x,r.y,0),a=new THREE.Vector3(n.x,n.y,0),s=(new THREE.Vector3).addVectors(a,o).multiplyScalar(.5),l=o.distanceTo(a),c=(new THREE.Vector3).subVectors(a,o).normalize(),u=new THREE.Vector3(0,0,1),h=(new THREE.Vector3).crossVectors(c,u).normalize(),d={start:r,end:n,cutPlane:(new THREE.Plane).setFromNormalAndCoplanarPoint(h,o),halfPlane:(new THREE.Plane).setFromNormalAndCoplanarPoint(c,s),length:l,points:null,project:function(e,i,o){var a=r,s=n,l=t.clone(),c=new THREE.Vector3(1,0,0),u=(new THREE.Vector3).subVectors(s,a);u.z=0,u.normalize();var h=Math.acos(c.dot(u));return u.y>0&&(h=-h),function(e){var t=(new THREE.Matrix4).makeTranslation(-a.x,-a.y,0),i=(new THREE.Matrix4).makeRotationZ(-h),r=(new THREE.Matrix4).makeTranslation(l.x,0,0),n=e.clone();return n.applyMatrix4(t),n.applyMatrix4(i),n.applyMatrix4(r),n}}()};this.segments.push(d),t.x+=l,t.z+=n.z-r.z}this.projectedBoundingBox.min.x=0,this.projectedBoundingBox.min.z=Number.POSITIVE_INFINITY,this.projectedBoundingBox.max.x=t.x,this.projectedBoundingBox.max.z=Number.NEGATIVE_INFINITY,this.size=function(){for(var e=0,t=0;t<this.segments.length;t++)this.segments[t].points&&(e+=this.segments[t].points.numPoints);return e}},Potree.ProfileRequest=function(e,t,i,r){this.pointcloud=e,this.profile=t,this.maxDepth=i||Number.MAX_VALUE,this.callback=r,this.temporaryResult=new Potree.ProfileData(this.profile),this.pointsServed=0,this.priorityQueue=new BinaryHeap(function(e){return 1/e.weight}),this.initialize=function(){this.priorityQueue.push({node:e.pcoGeometry.root,weight:1}),this.traverse(e.pcoGeometry.root)},this.traverse=function(t){for(var i=[],r=0;r<8;r++){(o=t.children[r])&&e.nodeIntersectsProfile(o,this.profile)&&i.push(o)}for(;i.length>0;){var n=(t=i.pop()).boundingSphere.radius;if(this.priorityQueue.push({node:t,weight:n}),t.level<this.maxDepth)for(r=0;r<8;r++){var o;(o=t.children[r])&&e.nodeIntersectsProfile(o,this.profile)&&i.push(o)}}},this.update=function(){for(var t=[],i=0;i<Math.min(2,this.priorityQueue.size());i++){var n=this.priorityQueue.pop(),o=n.node;o.loaded?(t.push(o),Potree.getLRU().touch(o),o.level%o.pcoGeometry.hierarchyStepSize==0&&o.hasChildren&&this.traverse(o)):(console.log("loading "+o.name),o.load(),this.priorityQueue.push(n))}if(t.length>0&&(this.getPointsInsideProfile(t,this.temporaryResult),this.temporaryResult.size()>100&&(this.pointsServed+=this.temporaryResult.size(),r.onProgress({request:this,points:this.temporaryResult}),this.temporaryResult=new Potree.ProfileData(this.profile))),0===this.priorityQueue.size()){this.temporaryResult.size()>0&&(this.pointsServed+=this.temporaryResult.size(),r.onProgress({request:this,points:this.temporaryResult}),this.temporaryResult=new Potree.ProfileData(this.profile)),r.onFinish({request:this});var a=e.profileRequests.indexOf(this);a>=0&&e.profileRequests.splice(a,1)}},this.getPointsInsideProfile=function(i,r){for(var n=0;n<r.segments.length;n++){for(var o=r.segments[n],a=0;a<i.length;a++){var s=i[a],l=s.geometry,c=l.attributes.position.array,u=s.numPoints;if(!o.points){o.points={},o.points.boundingBox=new THREE.Box3;for(var h in l.attributes)l.attributes.hasOwnProperty(h)&&("indices"===h||(o.points[h]=[]))}for(var d=0;d<u;d++){var p=new THREE.Vector3(c[3*d],c[3*d+1],c[3*d+2]);p.applyMatrix4(e.matrixWorld);var f=Math.abs(o.cutPlane.distanceToPoint(p)),m=Math.abs(o.halfPlane.distanceToPoint(p));if(f<t.width/2&&m<o.length/2){o.points.boundingBox.expandByPoint(p);for(var h in l.attributes)if(l.attributes.hasOwnProperty(h))if("position"===h)o.points[h].push(p);else if("indices"===h);else{var g=l.attributes[h];if(1===g.itemSize)o.points[h].push(g.array[d]);else{for(var v=[],y=0;y<g.itemSize;y++)v.push(g.array[d*g.itemSize+y]);o.points[h].push(v)}}}else;}}o.points.numPoints=o.points.position.length,o.points.numPoints>0&&(r.boundingBox.expandByPoint(o.points.boundingBox.min),r.boundingBox.expandByPoint(o.points.boundingBox.max),r.projectedBoundingBox.expandByPoint(new THREE.Vector2(0,r.boundingBox.min.y)),r.projectedBoundingBox.expandByPoint(new THREE.Vector2(0,r.boundingBox.max.y)))}},this.cancel=function(){r.onCancel(),this.priorityQueue=new BinaryHeap(function(e){return 1/e.weight});var t=e.profileRequests.indexOf(this);t>=0&&e.profileRequests.splice(t,1)},this.initialize()},Potree.PointCloudOctreeNode=class extends Potree.PointCloudTreeNode{constructor(){super(),this.children={},this.sceneNode=null,this.octree=null}getNumPoints(){return this.geometryNode.numPoints}isLoaded(){return!0}isTreeNode(){return!0}isGeometryNode(){return!1}getLevel(){return this.geometryNode.level}getBoundingSphere(){return this.geometryNode.boundingSphere}getBoundingBox(){return this.geometryNode.boundingBox}getChildren(){for(var e=[],t=0;t<8;t++)this.children[t]&&e.push(this.children[t]);return e}},Potree.PointCloudOctree=class extends Potree.PointCloudTree{constructor(e,t){super(),this.pcoGeometry=e,this.boundingBox=this.pcoGeometry.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(),this.material=t||new Potree.PointCloudMaterial,this.visiblePointsTarget=2e6,this.minimumNodePixelSize=150,this.level=0,this.position.copy(e.offset),this.updateMatrix(),this.showBoundingBox=!1,this.boundingBoxNodes=[],this.loadQueue=[],this.visibleBounds=new THREE.Box3,this.visibleNodes=[],this.visibleGeometry=[],this.pickTarget=null,this.generateDEM=!1,this.profileRequests=[],this.name="",this.projection=e.projection,this.root=this.pcoGeometry.root}setName(e){this.name!==e&&(this.name=e,this.dispatchEvent({type:"name_changed",name:e,pointcloud:this}))}getName(){return name}toTreeNode(e,t){var i=new Potree.PointCloudOctreeNode,r=new THREE.Points(e.geometry,this.material);i.geometryNode=e,i.sceneNode=r,i.pointcloud=this,i.children={};for(var n in e.children)i.children[n]=e.children[n];if(t){var o=parseInt(e.name[e.name.length-1]);t.sceneNode.add(r),t.children[o]=i}else this.root=i,this.add(r);return e.oneTimeDisposeHandlers.push(function(){var r=parseInt(e.name[e.name.length-1]);t.sceneNode.remove(i.sceneNode),t.children[r]=e}),i}updateVisibleBounds(){for(var e=[],t=0;t<this.visibleNodes.length;t++){for(var i=this.visibleNodes[t],r=!0,n=0;n<i.children.length;n++){var o=i.children[n];o instanceof Potree.PointCloudOctreeNode?r=r&&!o.sceneNode.visible:o instanceof Potree.PointCloudOctreeGeometryNode&&(r=!0)}r&&e.push(i)}this.visibleBounds.min=new THREE.Vector3(1/0,1/0,1/0),this.visibleBounds.max=new THREE.Vector3(-1/0,-1/0,-1/0);for(t=0;t<e.length;t++){i=e[t];this.visibleBounds.expandByPoint(i.getBoundingBox().min),this.visibleBounds.expandByPoint(i.getBoundingBox().max)}}updateMaterial(e,t,i,r){e.fov=i.fov*(Math.PI/180),e.screenWidth=r.domElement.clientWidth,e.screenHeight=r.domElement.clientHeight,e.spacing=this.pcoGeometry.spacing*Math.max(this.scale.x,this.scale.y,this.scale.z),e.near=i.near,e.far=i.far,e.uniforms.octreeSize.value=this.pcoGeometry.boundingBox.getSize().x,e.pointSizeType>=0&&(e.pointSizeType!==Potree.PointSizeType.ADAPTIVE&&e.pointColorType!==Potree.PointColorType.LOD||this.updateVisibilityTexture(e,t))}updateVisibilityTexture(e,t){if(e){var i=e.visibleNodesTexture,r=i.image.data;(t=t.slice()).sort(function(e,t){var i=e.geometryNode.name,r=t.geometryNode.name;return i.length!=r.length?i.length-r.length:i<r?-1:i>r?1:0});for(var n=0;n<t.length;n++){for(var o=t[n],a=[],s=0;s<8;s++){(l=o.children[s])instanceof Potree.PointCloudOctreeNode&&l.sceneNode.visible&&t.indexOf(l)>=0&&a.push(l)}a.sort(function(e,t){return e.geometryNode.name<t.geometryNode.name?-1:e.geometryNode.name>t.geometryNode.name?1:0}),r[3*n+0]=0,r[3*n+1]=0,r[3*n+2]=0;for(s=0;s<a.length;s++){var l=a[s],c=parseInt(l.geometryNode.name.substr(-1));if(r[3*n+0]+=Math.pow(2,c),0===s){var u=t.indexOf(l);r[3*n+1]=u-n}}}i.needsUpdate=!0}}nodeIntersectsProfile(e,t){for(var i=e.boundingBox.clone().applyMatrix4(this.matrixWorld).getBoundingSphere(),r=0;r<t.points.length-1;r++){var n=new THREE.Vector3(t.points[r].x,i.center.y,t.points[r].z),o=new THREE.Vector3(t.points[r+1].x,i.center.y,t.points[r+1].z),a=new THREE.Ray(n,(new THREE.Vector3).subVectors(o,n).normalize()),s=new THREE.Ray(o,(new THREE.Vector3).subVectors(n,o).normalize());if(a.intersectsSphere(i)&&s.intersectsSphere(i))return!0}return!1}nodesOnRay(e,t){for(var i=[],r=t.clone(),n=0;n<e.length;n++){var o=e[n],a=o.getBoundingSphere().clone().applyMatrix4(o.sceneNode.matrixWorld);r.intersectsSphere(a)&&i.push(o)}return i}updateMatrixWorld(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0)}hideDescendants(e){for(var t=[],i=0;i<e.children.length;i++){(r=e.children[i]).visible&&t.push(r)}for(;t.length>0;){(e=t.shift()).visible=!1;for(i=0;i<e.children.length;i++){var r;(r=e.children[i]).visible&&t.push(r)}}}moveToOrigin(){this.position.set(0,0,0),this.updateMatrixWorld(!0);var e=this.boundingBox,t=this.matrixWorld,i=Potree.utils.computeTransformedBoundingBox(e,t);this.position.set(0,0,0).sub(i.getCenter())}moveToGroundPlane(){this.updateMatrixWorld(!0);var e=this.boundingBox,t=this.matrixWorld,i=Potree.utils.computeTransformedBoundingBox(e,t);this.position.y+=-i.min.y}getBoundingBoxWorld(){this.updateMatrixWorld(!0);var e=this.boundingBox,t=this.matrixWorld;return Potree.utils.computeTransformedBoundingBox(e,t)}getPointsInProfile(e,t,i){if(i){var r=new Potree.ProfileRequest(this,e,t,i);return this.profileRequests.push(r),r}for(var n={segments:[],boundingBox:new THREE.Box3,projectedBoundingBox:new THREE.Box2},o=0;o<e.points.length-1;o++){var a=e.points[o],s=e.points[o+1],l=this.getProfile(a,s,e.width,t),c={start:a,end:s,points:l,project:null};n.segments.push(c),n.boundingBox.expandByPoint(l.boundingBox.min),n.boundingBox.expandByPoint(l.boundingBox.max)}var u=new THREE.Vector3;for(o=0;o<n.segments.length;o++){a=(c=n.segments[o]).start,s=c.end;var h=function(e,t,i,r){var o=a,l=s,c=u.clone(),h=n.boundingBox.clone(),d=new THREE.Vector3(1,0,0),p=(new THREE.Vector3).subVectors(l,o);p.y=0,p.normalize();var f=Math.acos(d.dot(p));return p.z>0&&(f=-f),function(e){var t=(new THREE.Matrix4).makeTranslation(-o.x,-h.min.y,-o.z),i=(new THREE.Matrix4).makeRotationY(-f),r=(new THREE.Matrix4).makeTranslation(c.x,0,0),n=e.clone();return n.applyMatrix4(t),n.applyMatrix4(i),n.applyMatrix4(r),n}}();c.project=h,u.x+=new THREE.Vector3(a.x,0,a.z).distanceTo(new THREE.Vector3(s.x,0,s.z)),u.y+=s.y-a.y}return n.projectedBoundingBox.min.x=0,n.projectedBoundingBox.min.y=n.boundingBox.min.y,n.projectedBoundingBox.max.x=u.x,n.projectedBoundingBox.max.y=n.boundingBox.max.y,n}getProfile(e,t,i,r,n){if(void 0===n){var o=[];o.push(this);for(var a=(new THREE.Vector3).addVectors(t,e).multiplyScalar(.5),s=(new THREE.Vector3).subVectors(t,e).length(),l=(new THREE.Vector3).subVectors(t,e).normalize(),c=new THREE.Vector3(0,1,0),u=(new THREE.Vector3).crossVectors(l,c).normalize(),h=(new THREE.Plane).setFromNormalAndCoplanarPoint(u,e),d=(new THREE.Plane).setFromNormalAndCoplanarPoint(l,a),p=null,f=new THREE.Box3;o.length>0;){var m=o.shift();if(m instanceof THREE.Points){var g=m.geometry,v=g.attributes.position.array,y=m.numPoints;if(!p){p={};for(var b in g.attributes)g.attributes.hasOwnProperty(b)&&("indices"===b||(p[b]=[]))}for(var x=0;x<y;x++){var w=new THREE.Vector3(v[3*x],v[3*x+1],v[3*x+2]);w.applyMatrix4(this.matrixWorld);var _=Math.abs(h.distanceToPoint(w)),E=Math.abs(d.distanceToPoint(w));if(_<i/2&&E<s/2){f.expandByPoint(w);for(var b in g.attributes)if(g.attributes.hasOwnProperty(b))if("position"===b)p[b].push(w);else if("indices"===b);else{var M=g.attributes[b];if(1===M.itemSize)p[b].push(M.array[x+T]);else{for(var A=[],T=0;T<M.itemSize;T++)A.push(M.array[x*M.itemSize+T]);p[b].push(A)}}0}}}if(m==this||m.level<r)for(x=0;x<m.children.length;x++){var S=m.children[x];if(S instanceof THREE.Points){var P=S.boundingSphere.clone().applyMatrix4(S.matrixWorld);h.distanceToSphere(P)<P.radius&&o.push(S)}}}p.numPoints=p.position.length;var C=function(i,r){var n=e,o=t,a=new THREE.Vector3(1,0,0),s=(new THREE.Vector3).subVectors(o,n);s.y=0,s.normalize();var l=Math.acos(a.dot(s));return s.z>0&&(l=-l),function(e){var t=(new THREE.Matrix4).makeTranslation(-n.x,-n.y,-n.z),i=(new THREE.Matrix4).makeRotationY(-l),r=e.clone();return r.applyMatrix4(t),r.applyMatrix4(i),r}}();return p.project=C,p.boundingBox=f,p}var R=new Potree.ProfileRequest(e,t,i,r,n);this.profileRequests.push(R)}getVisibleExtent(){return this.visibleBounds.applyMatrix4(this.matrixWorld)}pick(e,t,i,r={}){let n=e.context,o=function(e){void 0===e._glstate&&(e._glstate={});let t=e._glstate,i=n.createShader(n.VERTEX_SHADER);n.shaderSource(i,e.vertexShader),n.compileShader(i);if(!n.getShaderParameter(i,n.COMPILE_STATUS)){console.error("could not compile vertex shader:");let t=n.getShaderInfoLog(i);return void console.error(t,e.vertexShader)}let r=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(r,e.fragmentShader),n.compileShader(r);if(!n.getShaderParameter(r,n.COMPILE_STATUS))return console.error("could not compile fragment shader:"),void console.error(e.fragmentShader);var o=n.createProgram();n.attachShader(o,i),n.attachShader(o,r),n.linkProgram(o);if(!n.getProgramParameter(o,n.LINK_STATUS))return console.error("could not compile shader:"),console.error(e.vertexShader),void console.error(e.fragmentShader);t.program=o,n.useProgram(o);{let e={},i=n.getProgramParameter(o,n.ACTIVE_UNIFORMS);for(let t=0;t<i;t++){var a=n.getActiveUniform(o,t).name,s=n.getUniformLocation(o,a);e[a]=s}t.uniforms=e,t.textures={}}};void 0===Potree.PointCloudOctree.pickMaterial&&(Potree.PointCloudOctree.pickMaterial=new Potree.PointCloudMaterial,Potree.PointCloudOctree.pickMaterial.pointColorType=Potree.PointColorType.POINT_INDEX,o(Potree.PointCloudOctree.pickMaterial));let a=Potree.PointCloudOctree.pickMaterial,s=r.pickWindowSize||17,l=r.pickOutsideClipRegion||!1,c=this.nodesOnRay(this.visibleNodes,i);if(0===c.length)return null;{let i=!1;a.pointSizeType!==this.material.pointSizeType&&(a.pointSizeType=this.material.pointSizeType,i=!0),a.pointShape!==this.material.pointShape&&(a.pointShape=this.material.pointShape,i=!0),a.interpolate!==this.material.interpolate&&(a.interpolate=this.material.interpolate,i=!0),a.size=this.material.size,a.minSize=this.material.minSize,a.maxSize=this.material.maxSize,a.classification=this.material.classification,l?a.clipMode=Potree.ClipMode.DISABLED:(a.clipMode=this.material.clipMode,this.material.clipMode===Potree.ClipMode.CLIP_OUTSIDE?a.setClipBoxes(this.material.clipBoxes):a.setClipBoxes([])),this.updateMaterial(a,c,t,e),i&&o(a)}var u=Math.ceil(e.domElement.clientWidth),h=Math.ceil(e.domElement.clientHeight),d=(new THREE.Vector3).addVectors(t.position,i.direction).project(t);d.addScalar(1).multiplyScalar(.5),d.x*=u,d.y*=h,this.pickTarget?this.pickTarget.width==u&&this.pickTarget.height==h||(this.pickTarget.dispose(),this.pickTarget=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat})):this.pickTarget=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),this.pickTarget.setSize(u,h),n.enable(n.SCISSOR_TEST),n.scissor(d.x-(s-1)/2,d.y-(s-1)/2,s,s),n.disable(n.SCISSOR_TEST),e.setRenderTarget(this.pickTarget),e.state.setDepthTest(a.depthTest),e.state.setDepthWrite(a.depthWrite),e.state.setBlending(THREE.NoBlending),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil);let p=a._glstate,f=p.program,m=p.uniforms;n.useProgram(f),n.uniformMatrix4fv(m.projectionMatrix,!1,new Float32Array(t.projectionMatrix.elements)),n.uniformMatrix4fv(m.viewMatrix,!1,new Float32Array(t.matrixWorldInverse.elements));{if(void 0===p.textures.visibleNodes){let e=a.visibleNodesTexture.image,t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,n.RGB,e.width,e.height,0,n.RGB,n.UNSIGNED_BYTE,e.data),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),p.textures.visibleNodes={id:t}}let e=p.textures.visibleNodes.id,t=a.visibleNodesTexture.image;n.uniform1i(m.visibleNodes,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,n.RGB,t.width,t.height,0,n.RGB,n.UNSIGNED_BYTE,t.data)}n.uniform1f(m.fov,this.material.fov),n.uniform1f(m.screenWidth,this.material.screenWidth),n.uniform1f(m.screenHeight,this.material.screenHeight),n.uniform1f(m.spacing,this.material.spacing),n.uniform1f(m.near,this.material.near),n.uniform1f(m.far,this.material.far),n.uniform1f(m.size,this.material.size),n.uniform1f(m.minSize,this.material.minSize),n.uniform1f(m.maxSize,this.material.maxSize),n.uniform1f(m.octreeSize,this.pcoGeometry.boundingBox.getSize().x);{let e=n.getAttribLocation(f,"position"),t=n.getAttribLocation(f,"normal"),i=n.getAttribLocation(f,"classification"),r=n.getAttribLocation(f,"indices");n.enableVertexAttribArray(e),n.enableVertexAttribArray(t),n.enableVertexAttribArray(i),n.enableVertexAttribArray(r)}for(let i=0;i<c.length;i++){let r=c[i],o=r.sceneNode,s=o.geometry;a.pcIndex=i+1;let l=(new THREE.Matrix4).multiplyMatrices(t.matrixWorldInverse,o.matrixWorld);n.uniformMatrix4fv(m.modelMatrix,!1,new Float32Array(o.matrixWorld.elements)),n.uniformMatrix4fv(m.modelViewMatrix,!1,new Float32Array(l.elements));let u=n.getAttribLocation(f,"position"),h=(n.getAttribLocation(f,"normal"),n.getAttribLocation(f,"classification"),n.getAttribLocation(f,"indices")),d=e.properties.get(s.attributes.position).__webglBuffer;if(void 0===d)continue;let p={enabled:[]};for(let e=0;e<16;e++)p.enabled[e]=n.getVertexAttrib(e,n.VERTEX_ATTRIB_ARRAY_ENABLED),n.disableVertexAttribArray(e);n.bindBuffer(n.ARRAY_BUFFER,d),n.vertexAttribPointer(u,3,n.FLOAT,!1,0,0),n.enableVertexAttribArray(u);let g=e.properties.get(s.attributes.indices).__webglBuffer;n.bindBuffer(n.ARRAY_BUFFER,g),n.vertexAttribPointer(h,4,n.UNSIGNED_BYTE,!0,0,0),n.enableVertexAttribArray(h),n.uniform1f(m.pcIndex,a.pcIndex);r.getNumPoints()>0&&n.drawArrays(n.POINTS,0,r.getNumPoints());for(let e=0;e<16;e++)n.disableVertexAttribArray(e);n.enableVertexAttribArray(0),n.enableVertexAttribArray(1)}var g=s*s,v=new ArrayBuffer(4*g),y=new Uint8Array(v),b=new Uint32Array(v);e.context.readPixels(d.x-(s-1)/2,d.y-(s-1)/2,s,s,e.context.RGBA,e.context.UNSIGNED_BYTE,y);var x=Number.MAX_VALUE,w=null;for(let e=0;e<s;e++)for(var _=0;_<s;_++){var E=e+_*s,M=Math.pow(e-(s-1)/2,2)+Math.pow(_-(s-1)/2,2),A=y[4*E+3];y[4*E+3]=0;var T=b[E];(0!==T||0!==A)&&M<x&&(w={pIndex:T,pcIndex:A-1},x=M)}if(w){var S={},P=c[w.pcIndex].sceneNode,C=P.geometry.attributes;for(var R in C)if(C.hasOwnProperty(R)){var L=P.geometry.attributes[R];if("position"===R){var B=L.array,D=B[3*w.pIndex+0],I=B[3*w.pIndex+1],O=B[3*w.pIndex+2],N=new THREE.Vector3(D,I,O);N.applyMatrix4(this.matrixWorld),S[R]=N}else if("indices"===R);else if(1===L.itemSize)S[R]=L.array[w.pIndex];else{for(var k=[],F=0;F<L.itemSize;F++)k.push(L.array[L.itemSize*w.pIndex+F]);S[R]=k}}return S}return null}get progress(){return this.visibleNodes.length/this.visibleGeometry.length}};Potree.PointCloudOctreeGeometry=function(){this.url=null,this.octreeDir=null,this.spacing=0,this.boundingBox=null,this.root=null,this.numNodesLoading=0,this.nodes=null,this.pointAttributes=null,this.hierarchyStepSize=-1,this.loader=null},(Potree.PointCloudOctreeGeometryNode=function(e,t,i){this.id=Potree.PointCloudOctreeGeometryNode.IDCount++,this.name=e,this.index=parseInt(e.charAt(e.length-1)),this.pcoGeometry=t,this.geometry=null,this.boundingBox=i,this.boundingSphere=i.getBoundingSphere(),this.children={},this.numPoints=0,this.level=null,this.loaded=!1,this.oneTimeDisposeHandlers=[]}).IDCount=0,Potree.PointCloudOctreeGeometryNode.prototype=Object.create(Potree.PointCloudTreeNode.prototype),Potree.PointCloudOctreeGeometryNode.prototype.isGeometryNode=function(){return!0},Potree.PointCloudOctreeGeometryNode.prototype.getLevel=function(){return this.level},Potree.PointCloudOctreeGeometryNode.prototype.isTreeNode=function(){return!1},Potree.PointCloudOctreeGeometryNode.prototype.isLoaded=function(){return this.loaded},Potree.PointCloudOctreeGeometryNode.prototype.getBoundingSphere=function(){return this.boundingSphere},Potree.PointCloudOctreeGeometryNode.prototype.getBoundingBox=function(){return this.boundingBox},Potree.PointCloudOctreeGeometryNode.prototype.getChildren=function(){for(var e=[],t=0;t<8;t++)this.children[t]&&e.push(this.children[t]);return e},Potree.PointCloudOctreeGeometryNode.prototype.getBoundingBox=function(){return this.boundingBox},Potree.PointCloudOctreeGeometryNode.prototype.getURL=function(){var e="",t=this.pcoGeometry.loader.version;return t.equalOrHigher("1.5")?e=this.pcoGeometry.octreeDir+"/"+this.getHierarchyPath()+"/"+this.name:t.equalOrHigher("1.4")?e=this.pcoGeometry.octreeDir+"/"+this.name:t.upTo("1.3")&&(e=this.pcoGeometry.octreeDir+"/"+this.name),e},Potree.PointCloudOctreeGeometryNode.prototype.getHierarchyPath=function(){for(var e="r/",t=this.pcoGeometry.hierarchyStepSize,i=this.name.substr(1),r=Math.floor(i.length/t),n=0;n<r;n++)e+=i.substr(n*t,t)+"/";return e=e.slice(0,-1)},Potree.PointCloudOctreeGeometryNode.prototype.addChild=function(e){this.children[e.index]=e,e.parent=this},Potree.PointCloudOctreeGeometryNode.prototype.load=function(){!0===this.loading||!0===this.loaded||this.pcoGeometry.numNodesLoading>3||(this.loading=!0,this.pcoGeometry.numNodesLoading++,this.pcoGeometry.loader.version.equalOrHigher("1.5")&&this.level%this.pcoGeometry.hierarchyStepSize==0&&this.hasChildren?this.loadHierachyThenPoints():this.loadPoints())},Potree.PointCloudOctreeGeometryNode.prototype.loadPoints=function(){this.pcoGeometry.loader.load(this)},Potree.PointCloudOctreeGeometryNode.prototype.loadHierachyThenPoints=function(){var e=this;if(e.level%e.pcoGeometry.hierarchyStepSize==0){var t=e.pcoGeometry.octreeDir+"/"+e.getHierarchyPath()+"/"+e.name+".hrc",i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.overrideMimeType("text/plain; charset=x-user-defined"),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||0===i.status){var t=i.response;!function(e,t){t.byteLength;var i=new DataView(t),r=[],n=i.getUint8(0),o=i.getUint32(1,!0);e.numPoints=o,r.push({children:n,numPoints:o,name:e.name});for(var a=[],s=5;r.length>0;){for(var l=r.shift(),c=1,u=0;u<8;u++){if(0!=(l.children&c)){var h=l.name+u,d=i.getUint8(s),p=i.getUint32(s+1,!0);r.push({children:d,numPoints:p,name:h}),a.push({children:d,numPoints:p,name:h}),s+=5}c*=2}if(s===t.byteLength)break}var f={};f[e.name]=e;var m=e.pcoGeometry;for(u=0;u<a.length;u++){var g=a[u].name,v=(o=a[u].numPoints,parseInt(g.charAt(g.length-1))),y=f[g.substring(0,g.length-1)],b=g.length-1,x=Potree.POCLoader.createChildAABB(y.boundingBox,v),w=new Potree.PointCloudOctreeGeometryNode(g,m,x);w.level=b,w.numPoints=o,w.hasChildren=a[u].children>0,w.spacing=m.spacing/Math.pow(2,b),y.addChild(w),f[g]=w}e.loadPoints()}(e,t)}else console.log("Failed to load file! HTTP status: "+i.status+", file: "+url)};try{i.send(null)}catch(e){console.log("fehler beim laden der punktwolke: "+e)}}},Potree.PointCloudOctreeGeometryNode.prototype.getNumPoints=function(){return this.numPoints},Potree.PointCloudOctreeGeometryNode.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose(),this.geometry=null,this.loaded=!1;for(var e=0;e<this.oneTimeDisposeHandlers.length;e++){(0,this.oneTimeDisposeHandlers[e])()}this.oneTimeDisposeHandlers=[]}},Object.assign(Potree.PointCloudOctreeGeometryNode.prototype,THREE.EventDispatcher.prototype),Potree.PointCloudGreyhoundGeometry=function(){this.spacing=0,this.boundingBox=null,this.root=null,this.numNodesLoading=0,this.nodes=null,this.pointAttributes={},this.hierarchyStepSize=-1,this.loader=null,this.schema=null,this.baseDepth=null,this.offset=null,this.projection=null,this.boundingSphere=null,this.serverURL=null,this.normalize={color:!1,intensity:!1}};var s=!1;(Potree.PointCloudGreyhoundGeometryNode=function(e,t,i,r,n){this.id=Potree.PointCloudGreyhoundGeometryNode.IDCount++,this.name=e,this.index=parseInt(e.charAt(e.length-1)),this.pcoGeometry=t,this.geometry=null,this.boundingBox=i,this.boundingSphere=i.getBoundingSphere(),this.scale=r,this.offset=n,this.children={},this.numPoints=0,this.level=null,this.loaded=!1,this.oneTimeDisposeHandlers=[];let o=this.boundingBox.clone();o.min.sub(this.pcoGeometry.boundingBox.getCenter()),o.max.sub(this.pcoGeometry.boundingBox.getCenter()),this.scale&&(o.min.multiplyScalar(1/this.scale),o.max.multiplyScalar(1/this.scale)),this.greyhoundBounds=o,this.greyhoundOffset=this.pcoGeometry.offset.clone().add(this.pcoGeometry.boundingBox.getSize().multiplyScalar(.5))}).IDCount=0,Potree.PointCloudGreyhoundGeometryNode.prototype=Object.create(Potree.PointCloudTreeNode.prototype),Potree.PointCloudGreyhoundGeometryNode.prototype.isGeometryNode=function(){return!0},Potree.PointCloudGreyhoundGeometryNode.prototype.isTreeNode=function(){return!1},Potree.PointCloudGreyhoundGeometryNode.prototype.isLoaded=function(){return this.loaded},Potree.PointCloudGreyhoundGeometryNode.prototype.getBoundingSphere=function(){return this.boundingSphere},Potree.PointCloudGreyhoundGeometryNode.prototype.getBoundingBox=function(){return this.boundingBox},Potree.PointCloudGreyhoundGeometryNode.prototype.getLevel=function(){return this.level},Potree.PointCloudGreyhoundGeometryNode.prototype.getChildren=function(){for(var e=[],t=0;t<8;++t)this.children[t]&&e.push(this.children[t]);return e},Potree.PointCloudGreyhoundGeometryNode.prototype.getURL=function(){var e=this.pcoGeometry.schema;let t=this.greyhoundBounds;var i=t.min.x+","+t.min.y+","+t.min.z+","+t.max.x+","+t.max.y+","+t.max.z,r=this.pcoGeometry.serverURL+"read?depthBegin="+(s?this.level+this.pcoGeometry.baseDepth:0)+"&depthEnd="+(this.level+this.pcoGeometry.baseDepth+1)+"&bounds=["+i+"]&schema="+JSON.stringify(e)+"&compress=true";if(this.scale&&(r+="&scale="+this.scale),this.greyhoundOffset){let e=this.greyhoundOffset;r+="&offset=["+e.x+","+e.y+","+e.z+"]"}if(1===this.level);return s||(s=!0),r},Potree.PointCloudGreyhoundGeometryNode.prototype.addChild=function(e){this.children[e.index]=e,e.parent=this},Potree.PointCloudGreyhoundGeometryNode.prototype.load=function(){!0===this.loading||!0===this.loaded||this.pcoGeometry.numNodesLoading>3||(this.loading=!0,this.pcoGeometry.numNodesLoading++,this.level%this.pcoGeometry.hierarchyStepSize==0&&this.hasChildren?this.loadHierarchyThenPoints():this.loadPoints())},Potree.PointCloudGreyhoundGeometryNode.prototype.loadPoints=function(){this.pcoGeometry.loader.load(this)},Potree.PointCloudGreyhoundGeometryNode.prototype.loadHierarchyThenPoints=function(){var e=[0,2,1,3,4,6,5,7],t=function(i,r,n){var o,a;Object.keys(i).forEach(function(s){if("n"!==s){switch(s){case"swd":o=i.swd,a=r+e[0];break;case"nwd":o=i.nwd,a=r+e[1];break;case"swu":o=i.swu,a=r+e[2];break;case"nwu":o=i.nwu,a=r+e[3];break;case"sed":o=i.sed,a=r+e[4];break;case"ned":o=i.ned,a=r+e[5];break;case"seu":o=i.seu,a=r+e[6];break;case"neu":o=i.neu,a=r+e[7]}n.push({children:function(t){var i=0;return Object.keys(t).forEach(function(t){"swd"===t?i+=1<<e[0]:"nwd"===t?i+=1<<e[1]:"swu"===t?i+=1<<e[2]:"nwu"===t?i+=1<<e[3]:"sed"===t?i+=1<<e[4]:"ned"===t?i+=1<<e[5]:"seu"===t?i+=1<<e[6]:"neu"===t&&(i+=1<<e[7])}),i}(o),numPoints:o.n,name:a}),t(o,a,n)}})};if(this.level%this.pcoGeometry.hierarchyStepSize==0){var i=this.level+this.pcoGeometry.baseDepth,r=i+this.pcoGeometry.hierarchyStepSize+2;let e=this.greyhoundBounds;var n=e.min.x+","+e.min.y+","+e.min.z+","+e.max.x+","+e.max.y+","+e.max.z,o=this.pcoGeometry.serverURL+"hierarchy?bounds=["+n+"]&depthBegin="+i+"&depthEnd="+r;if(this.scale&&(o+="&scale="+this.scale),this.greyhoundOffset){let e=this.greyhoundOffset;o+="&offset=["+e.x+","+e.y+","+e.z+"]"}var a=new XMLHttpRequest;a.open("GET",o,!0);var s=this;a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status||0===a.status){var e=JSON.parse(a.responseText)||{};!function(e,i){var r=[];e.numPoints=i.n,t(i,e.name,r);var n={};n[e.name]=e;for(var o=e.pcoGeometry,a=0;a<r.length;a++){var s=r[a].name,l=r[a].numPoints,c=parseInt(s.charAt(s.length-1)),u=n[s.substring(0,s.length-1)],h=s.length-1,d=Potree.GreyhoundLoader.createChildAABB(u.boundingBox,c),p=new Potree.PointCloudGreyhoundGeometryNode(s,o,d,e.scale,e.offset);p.level=h,p.numPoints=l,p.hasChildren=r[a].children>0,p.spacing=o.spacing/Math.pow(2,h),u.addChild(p),n[s]=p}e.loadPoints()}(s,e)}else console.log("Failed to load file! HTTP status:",a.status,"file:",o)};try{a.send(null)}catch(e){console.log("fehler beim laden der punktwolke: "+e)}}},Potree.PointCloudGreyhoundGeometryNode.prototype.getNumPoints=function(){return this.numPoints},Potree.PointCloudGreyhoundGeometryNode.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose(),this.geometry=null,this.loaded=!1;for(var e=0;e<this.oneTimeDisposeHandlers.length;e++){(0,this.oneTimeDisposeHandlers[e])()}this.oneTimeDisposeHandlers=[]}},Object.assign(Potree.PointCloudGreyhoundGeometryNode.prototype,THREE.EventDispatcher.prototype),(Potree.utils=class{static toString(e){return e instanceof THREE.Vector3?e.x.toFixed(2)+", "+e.y.toFixed(2)+", "+e.z.toFixed(2):""+e}static normalizeURL(e){let t=new URL(e);return t.protocol+"//"+t.hostname+t.pathname.replace(/\/+/g,"/")}static pathExists(e){let t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),200===t.status}static computeTransformedBoundingBox(e,t){let i=[new THREE.Vector3(e.min.x,e.min.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.min.x,e.min.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.max.x,e.min.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.min.x,e.max.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.min.x,e.min.y,e.max.z).applyMatrix4(t),new THREE.Vector3(e.min.x,e.max.y,e.max.z).applyMatrix4(t),new THREE.Vector3(e.max.x,e.max.y,e.min.z).applyMatrix4(t),new THREE.Vector3(e.max.x,e.min.y,e.max.z).applyMatrix4(t),new THREE.Vector3(e.max.x,e.max.y,e.max.z).applyMatrix4(t)],r=new THREE.Box3;return r.setFromPoints(i),r}static addCommas(e){let t=(e+="").split("."),i=t[0],r=t.length>1?"."+t[1]:"",n=/(\d+)(\d{3})/;for(;n.test(i);)i=i.replace(n,"$1,$2");return i+r}static createWorker(e){let t=new Blob([e],{type:"application/javascript"});return new Worker(URL.createObjectURL(t))}static loadSkybox(e){let t=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e5);t.up.set(0,0,1);let i=new THREE.Scene,r=[e+"px.jpg",e+"nx.jpg",e+"py.jpg",e+"ny.jpg",e+"pz.jpg",e+"nz.jpg"];for(var n=[],o=0;o<6;o++)n.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(r[o]),side:THREE.BackSide,depthTest:!1,depthWrite:!1}));var a=new THREE.CubeGeometry(5e3,5e3,5e3),s=new THREE.MultiMaterial(n),l=new THREE.Mesh(a,s);return i.add(l),i.rotation.x=Math.PI/2,{camera:t,scene:i}}static createGrid(e,t,i,r){let n=new THREE.LineBasicMaterial({color:r||8947848}),o=new THREE.Geometry;for(let r=0;r<=t;r++)o.vertices.push(new THREE.Vector3(-i*e/2,r*i-i*t/2,0)),o.vertices.push(new THREE.Vector3(+i*e/2,r*i-i*t/2,0));for(let r=0;r<=e;r++)o.vertices.push(new THREE.Vector3(r*i-i*e/2,-i*t/2,0)),o.vertices.push(new THREE.Vector3(r*i-i*e/2,+i*t/2,0));let a=new THREE.LineSegments(o,n,THREE.LinePieces);return a.receiveShadow=!0,a}static createBackgroundTexture(e,t){function gauss(e,t){return 1/(2*Math.PI)*Math.exp(-(e*e+t*t)/2)}let i=e*t,r=new Uint8Array(3*i),n=[1,1.5,1.7],o=gauss(0,0);for(let i=0;i<e;i++)for(let a=0;a<t;a++){let s=i+e*a,l=gauss(2*(i/e*2-1),2*(a/t*2-1))/o,c=(Math.random()+Math.random()+Math.random())/3;c=(.5*l+.5)*c*.03,c*=.4,r[3*s+0]=255*(l/15+.05+c)*n[0],r[3*s+1]=255*(l/15+.05+c)*n[1],r[3*s+2]=255*(l/15+.05+c)*n[2]}let a=new THREE.DataTexture(r,e,t,THREE.RGBFormat);return a.needsUpdate=!0,a}static getMousePointCloudIntersection(e,t,i,r){let n={x:e.x/i.domElement.clientWidth*2-1,y:-e.y/i.domElement.clientHeight*2+1},o=new THREE.Vector3(n.x,n.y,.5);o.unproject(t);let a=o.sub(t.position).normalize(),s=new THREE.Ray(t.position,a),l=null,c=1/0,u=null;for(let e of r){let r=e.pick(i,t,s);if(!r)continue;let n=t.position.distanceTo(r.position);n<c&&(c=n,l=e,u=r.position)}return l?{location:u,distance:c,pointcloud:l}:null}static pixelsArrayToImage(e,t,i){let r=document.createElement("canvas");r.width=t,r.height=i;let n=r.getContext("2d");e=new e.constructor(e);for(let t=0;t<e.length;t++)e[4*t+3]=255;let o=n.createImageData(t,i);o.data.set(e),n.putImageData(o,0,0);let a=new Image;return a.src=r.toDataURL(),a}static projectedRadius(e,t,i,r){let n=1/Math.tan(t/2)/i;return n=n*r/2,e*n}static topView(e,t){e.position.set(0,1,0),e.rotation.set(-Math.PI/2,0,0),e.zoomTo(t,1)}static frontView(e,t){e.position.set(0,0,1),e.rotation.set(0,0,0),e.zoomTo(t,1)}static leftView(e,t){e.position.set(-1,0,0),e.rotation.set(0,-Math.PI/2,0),e.zoomTo(t,1)}static rightView(e,t){e.position.set(1,0,0),e.rotation.set(0,Math.PI/2,0),e.zoomTo(t,1)}static frustumSphereIntersection(e,t){let i=e.planes,r=t.center,n=-t.radius,o=Number.MAX_VALUE;for(let e=0;e<6;e++){let t=i[e].distanceToPoint(r);if(t<n)return 0;o=Math.min(o,t)}return o>=t.radius?2:1}static generateDataTexture(e,t,i){let r=e*t,n=new Uint8Array(3*e*t),o=Math.floor(255*i.r),a=Math.floor(255*i.g),s=Math.floor(255*i.b);for(let e=0;e<r;e++)n[3*e]=o,n[3*e+1]=a,n[3*e+2]=s;let l=new THREE.DataTexture(n,e,t,THREE.RGBFormat);return l.needsUpdate=!0,l.magFilter=THREE.NearestFilter,l}static getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?null:decodeURIComponent(t[1].replace(/\+/g," "))}static setParameter(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let i=new RegExp("([\\?&])("+e+"=([^&#]*))").exec(location.search),r=window.location.href;if(null===i)0===window.location.search.length?r+="?":r+="&",r=r+e+"="+t;else{let n=e+"="+t;r=r.replace(i[2],n)}window.history.replaceState({},"",r)}}).screenPass=new function(){this.screenScene=new THREE.Scene,this.screenQuad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2,0)),this.screenQuad.material.depthTest=!0,this.screenQuad.material.depthWrite=!0,this.screenQuad.material.transparent=!0,this.screenScene.add(this.screenQuad),this.camera=new THREE.Camera,this.render=function(e,t,i){this.screenQuad.material=t,void 0===i?e.render(this.screenScene,this.camera):e.render(this.screenScene,this.camera,i)}},Potree.Features=function(){var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(null===t)return null;var i,r=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),n=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT),o=(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_FLOAT),t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT)),a=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT),s=(t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_FLOAT),r.precision>0&&o.precision>0),l=n.precision>0&&a.precision>0;return i=s?"highp":l?"mediump":"lowp",{SHADER_INTERPOLATION:{isSupported:function(){var e=!0;return e=e&&t.getExtension("EXT_frag_depth"),e=e&&t.getParameter(t.MAX_VARYING_VECTORS)>=8}},SHADER_SPLATS:{isSupported:function(){var e=!0;return e=e&&t.getExtension("EXT_frag_depth"),e=e&&t.getExtension("OES_texture_float"),e=e&&t.getParameter(t.MAX_VARYING_VECTORS)>=8}},SHADER_EDL:{isSupported:function(){var e=!0;return e=e&&t.getExtension("EXT_frag_depth"),e=e&&t.getExtension("OES_texture_float"),e=e&&t.getParameter(t.MAX_VARYING_VECTORS)>=8}},precision:i}}(),(Potree.TextSprite=function(e){THREE.Object3D.call(this);var t=new THREE.Texture;t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter;var i=new THREE.SpriteMaterial({map:t,depthTest:!1,depthWrite:!1});this.material=i,this.sprite=new THREE.Sprite(i),this.add(this.sprite),this.borderThickness=4,this.fontface="Arial",this.fontsize=28,this.borderColor={r:0,g:0,b:0,a:1},this.backgroundColor={r:255,g:255,b:255,a:1},this.textColor={r:255,g:255,b:255,a:1},this.text="",this.setText(e)}).prototype=new THREE.Object3D,Potree.TextSprite.prototype.setText=function(e){this.text!==e&&(this.text=e,this.update())},Potree.TextSprite.prototype.setTextColor=function(e){this.textColor=e,this.update()},Potree.TextSprite.prototype.setBorderColor=function(e){this.borderColor=e,this.update()},Potree.TextSprite.prototype.setBackgroundColor=function(e){this.backgroundColor=e,this.update()},Potree.TextSprite.prototype.update=function(){(t=(e=document.createElement("canvas")).getContext("2d")).font="Bold "+this.fontsize+"px "+this.fontface;var e,t,i=t.measureText(this.text).width,r=10+i+2*this.borderThickness,n=1.4*this.fontsize+2*this.borderThickness;(t=(e=document.createElement("canvas")).getContext("2d")).canvas.width=r,t.canvas.height=n,t.font="Bold "+this.fontsize+"px "+this.fontface,t.fillStyle="rgba("+this.backgroundColor.r+","+this.backgroundColor.g+","+this.backgroundColor.b+","+this.backgroundColor.a+")",t.strokeStyle="rgba("+this.borderColor.r+","+this.borderColor.g+","+this.borderColor.b+","+this.borderColor.a+")",t.lineWidth=this.borderThickness,this.roundRect(t,this.borderThickness/2,this.borderThickness/2,i+this.borderThickness+10,1.4*this.fontsize+this.borderThickness,6),t.strokeStyle="rgba(0, 0, 0, 1.0)",t.strokeText(this.text,this.borderThickness+5,this.fontsize+this.borderThickness),t.fillStyle="rgba("+this.textColor.r+","+this.textColor.g+","+this.textColor.b+","+this.textColor.a+")",t.fillText(this.text,this.borderThickness+5,this.fontsize+this.borderThickness);var o=new THREE.Texture(e);o.minFilter=THREE.LinearFilter,o.magFilter=THREE.LinearFilter,o.needsUpdate=!0,this.sprite.material.map=o,this.sprite.scale.set(.01*r,.01*n,1)},Potree.TextSprite.prototype.roundRect=function(e,t,i,r,n,o){e.beginPath(),e.moveTo(t+o,i),e.lineTo(t+r-o,i),e.quadraticCurveTo(t+r,i,t+r,i+o),e.lineTo(t+r,i+n-o),e.quadraticCurveTo(t+r,i+n,t+r-o,i+n),e.lineTo(t+o,i+n),e.quadraticCurveTo(t,i+n,t,i+n-o),e.lineTo(t,i+o),e.quadraticCurveTo(t,i,t+o,i),e.closePath(),e.fill(),e.stroke()},Potree.AnimationPath=class{constructor(e=[]){this.points=e,this.spline=new THREE.Spline(e),this.spline.reparametrizeByArcLength(1/this.spline.getLength().total),this.tween=null}get(e){return this.spline.getPoint(e)}animate(e=1){stop();let t=1e3*this.spline.getLength().total/e,i={t:0};this.tween=new TWEEN.Tween(i).to({t:1},t),this.tween.easing(TWEEN.Easing.Linear.None),this.tween.onUpdate(e=>{viewer.scene.view.position.copy(this.spline.getPoint(i.t))}),this.tween.start()}stop(){this.tween&&this.tween.stop()}resume(){this.tween&&this.tween.start()}getGeometry(){let e=new THREE.Geometry,t=0;for(let i=0;i<=1;i+=.01){let r=this.spline.getPoint(i);e.vertices[t]=new THREE.Vector3(r.x,r.y,r.z),t++}return e}},(Potree.Version=function(e){this.version=e;var t=-1===e.indexOf(".")?e.length:e.indexOf(".");this.versionMajor=parseInt(e.substr(0,t)),this.versionMinor=parseInt(e.substr(t+1)),0===this.versionMinor.length&&(this.versionMinor=0)}).prototype.newerThan=function(e){var t=new Potree.Version(e);return this.versionMajor>t.versionMajor||this.versionMajor===t.versionMajor&&this.versionMinor>t.versionMinor},Potree.Version.prototype.equalOrHigher=function(e){var t=new Potree.Version(e);return this.versionMajor>t.versionMajor||this.versionMajor===t.versionMajor&&this.versionMinor>=t.versionMinor},Potree.Version.prototype.upTo=function(e){return!this.newerThan(e)},Potree.Measure=class extends THREE.Object3D{constructor(){super(),this.points=[],this._showDistances=!0,this._showCoordinates=!1,this._showArea=!1,this._closed=!0,this._showAngles=!1,this._showHeight=!1,this.maxMarkers=Number.MAX_SAFE_INTEGER,this.sphereGeometry=new THREE.SphereGeometry(.4,10,10),this.color=new THREE.Color(16711680),this.spheres=[],this.edges=[],this.sphereLabels=[],this.edgeLabels=[],this.angleLabels=[],this.coordinateLabels=[],this.heightEdge,this.heightLabel;{let e=new THREE.Geometry;e.vertices.push(new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3),e.colors.push(this.color,this.color,this.color);let t=new THREE.LineDashedMaterial({color:16711680,dashSize:5,gapSize:2});t.depthTest=!1,this.heightEdge=new THREE.Line(e,t),this.heightEdge.visible=!1,this.add(this.heightEdge)}this.heightLabel=new Potree.TextSprite(""),this.heightLabel.setBorderColor({r:0,g:0,b:0,a:.8}),this.heightLabel.setBackgroundColor({r:0,g:0,b:0,a:.3}),this.heightLabel.setTextColor({r:180,g:220,b:180,a:1}),this.heightLabel.material.depthTest=!1,this.heightLabel.material.opacity=1,this.heightLabel.visible=!1,this.add(this.heightLabel),this.areaLabel=new Potree.TextSprite(""),this.areaLabel.setBorderColor({r:0,g:0,b:0,a:.8}),this.areaLabel.setBackgroundColor({r:0,g:0,b:0,a:.3}),this.areaLabel.setTextColor({r:180,g:220,b:180,a:1}),this.areaLabel.material.depthTest=!1,this.areaLabel.material.opacity=1,this.areaLabel.visible=!1,this.add(this.areaLabel)}createSphereMaterial(){return new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:this.color,depthTest:!1,depthWrite:!1})}addMarker(e){e instanceof THREE.Vector3&&(e={position:e}),this.points.push(e);let t=new THREE.Mesh(this.sphereGeometry,this.createSphereMaterial());this.add(t),this.spheres.push(t);{let e=new THREE.Geometry;e.vertices.push(new THREE.Vector3,new THREE.Vector3),e.colors.push(this.color,this.color,this.color);let t=new THREE.LineBasicMaterial({linewidth:1});t.depthTest=!1;let i=new THREE.Line(e,t);i.visible=!0,this.add(i),this.edges.push(i)}{let e=new Potree.TextSprite;e.setBorderColor({r:0,g:0,b:0,a:.8}),e.setBackgroundColor({r:0,g:0,b:0,a:.3}),e.material.depthTest=!1,e.visible=!1,this.edgeLabels.push(e),this.add(e)}{let e=new Potree.TextSprite;e.setBorderColor({r:0,g:0,b:0,a:.8}),e.setBackgroundColor({r:0,g:0,b:0,a:.3}),e.material.depthTest=!1,e.material.opacity=1,e.visible=!1,this.angleLabels.push(e),this.add(e)}{let e=new Potree.TextSprite;e.setBorderColor({r:0,g:0,b:0,a:.8}),e.setBackgroundColor({r:0,g:0,b:0,a:.3}),e.material.depthTest=!1,e.material.opacity=1,e.visible=!1,this.coordinateLabels.push(e),this.add(e)}t.addEventListener("drag",e=>{let t=Potree.utils.getMousePointCloudIntersection(e.drag.end,e.viewer.scene.camera,e.viewer.renderer,e.viewer.scene.pointclouds);if(t){let i=this.spheres.indexOf(e.drag.object);-1!==i&&(this.setPosition(i,t.location),this.dispatchEvent({type:"marker_moved",measurement:this,index:i}))}}),t.addEventListener("drop",e=>{let t=this.spheres.indexOf(e.drag.object);-1!==t&&this.dispatchEvent({type:"marker_dropped",measurement:this,index:t})}),t.addEventListener("mouseover",e=>e.object.material.emissive.setHex(8947848)),t.addEventListener("mouseleave",e=>e.object.material.emissive.setHex(0));let i={type:"marker_added",measurement:this,sphere:t};this.dispatchEvent(i),this.setMarker(this.points.length-1,e)}removeMarker(e){this.points.splice(e,1),this.remove(this.spheres[e]);let t=0===e?0:e-1;this.remove(this.edges[t]),this.edges.splice(t,1),this.remove(this.edgeLabels[t]),this.edgeLabels.splice(t,1),this.coordinateLabels.splice(e,1),this.spheres.splice(e,1),this.update(),this.dispatchEvent({type:"marker_removed",measurement:this})}setMarker(e,t){this.points[e]=t;let i={type:"marker_moved",measure:this,index:e,position:t.position.clone()};this.dispatchEvent(i),this.update()}setPosition(e,t){this.points[e].position.copy(t);let i={type:"marker_moved",measure:this,index:e,position:t.clone()};this.dispatchEvent(i),this.update()}getArea(){let e=0,t=this.points.length-1;for(let i=0;i<this.points.length;i++){let r=this.points[i].position,n=this.points[t].position;e+=(n.x+r.x)*(r.z-n.z),t=i}return Math.abs(e/2)}getTotalDistance(){if(0===this.points.length)return 0;let e=0;for(let t=1;t<this.points.length;t++){let i=this.points[t-1].position,r=this.points[t].position;e+=i.distanceTo(r)}if(this.closed&&this.points.length>1){let t=this.points[0].position;e+=this.points[this.points.length-1].position.distanceTo(t)}return e}getAngleBetweenLines(e,t,i){let r=(new THREE.Vector3).subVectors(t.position,e.position),n=(new THREE.Vector3).subVectors(i.position,e.position);return r.angleTo(n)}getAngle(e){if(this.points.length<3||e>=this.points.length)return 0;let t=0===e?this.points[this.points.length-1]:this.points[e-1],i=this.points[e],r=this.points[(e+1)%this.points.length];return this.getAngleBetweenLines(i,t,r)}update(){if(0===this.points.length)return;if(1===this.points.length){let e=this.points[0].position;this.spheres[0].position.copy(e);{let t=this.coordinateLabels[0],i=e.clone().add(new THREE.Vector3(0,1,0));t.position.copy(i);let r=Potree.utils.addCommas(e.x.toFixed(2))+" / "+Potree.utils.addCommas(e.y.toFixed(2))+" / "+Potree.utils.addCommas(e.z.toFixed(2));t.setText(r),t.visible=this.showCoordinates}return}let e=this.points.length-1,t=new THREE.Vector3;for(let i=0;i<=e;i++){let e=this.points[i];t.add(e.position)}t.divideScalar(this.points.length);for(let t=0;t<=e;t++){let i=t,r=t+1>e?0:t+1,n=0===t?e:t-1,o=this.points[i],a=this.points[r],s=this.points[n],l=this.spheres[i];l.position.copy(o.position),l.material.color=this.color;{let t=this.edges[i];t.material.color=this.color,t.position.copy(o.position),t.geometry.vertices[0].set(0,0,0),t.geometry.vertices[1].copy(a.position).sub(o.position),t.geometry.verticesNeedUpdate=!0,t.geometry.computeBoundingSphere(),t.visible=i<e||this.closed}{let r=this.edgeLabels[t],n=(new THREE.Vector3).add(o.position);n.add(a.position),n=n.multiplyScalar(.5);let s=o.position.distanceTo(a.position);r.position.copy(n),r.setText(Potree.utils.addCommas(s.toFixed(2))),r.visible=this.showDistances&&(i<e||this.closed)&&this.points.length>=2&&s>0}{let r=this.angleLabels[t],n=this.getAngleBetweenLines(o,s,a),l=a.position.clone().sub(s.position);l.multiplyScalar(.5),l=s.position.clone().add(l).sub(o.position).normalize();let c=Math.min(o.position.distanceTo(s.position),o.position.distanceTo(a.position));c/=9;let u=o.position.clone().add(l.multiplyScalar(c));r.position.copy(u);let h=Potree.utils.addCommas((n*(180/Math.PI)).toFixed(1))+"°";r.setText(h),r.visible=this.showAngles&&(i<e||this.closed)&&this.points.length>=3&&n>0}{let e=this.coordinateLabels[0],t=o.position.clone().add(new THREE.Vector3(0,1,0));e.position.copy(t);let i=Potree.utils.addCommas(o.position.x.toFixed(2))+" / "+Potree.utils.addCommas(o.position.y.toFixed(2))+" / "+Potree.utils.addCommas(o.position.z.toFixed(2));e.setText(i),e.visible=this.showCoordinates}}{let e=this.heightEdge;if(e.visible=this.showHeight,this.heightLabel.visible=this.showHeight,this.showHeight){let t=this.points.slice().sort((e,t)=>e.position.z-t.position.z),i=t[0].position.clone(),r=t[t.length-1].position.clone(),n=i.z,o=r.z,a=o-n,s=new THREE.Vector3(r.x,r.y,n),l=new THREE.Vector3(r.x,r.y,o);e.position.copy(i),e.geometry.vertices[0].set(0,0,0),e.geometry.vertices[1].copy(s).sub(i),e.geometry.vertices[2].copy(s).sub(i),e.geometry.vertices[3].copy(l).sub(i),e.geometry.verticesNeedUpdate=!0,e.geometry.computeBoundingSphere();let c=s.clone().add(l).multiplyScalar(.5);this.heightLabel.position.copy(c);let u=Potree.utils.addCommas(a.toFixed(2));this.heightLabel.setText(u)}}{this.areaLabel.position.copy(t),this.areaLabel.visible=this.showArea&&this.points.length>=3;let e=Potree.utils.addCommas(this.getArea().toFixed(1))+"²";this.areaLabel.setText(e)}}raycast(e,t){for(let i=0;i<this.points.length;i++){this.spheres[i].raycast(e,t)}for(let i=0;i<t.length;i++){let r=t[i];r.distance=e.ray.origin.distanceTo(r.point)}t.sort(function(e,t){return e.distance-t.distance})}get showCoordinates(){return this._showCoordinates}set showCoordinates(e){this._showCoordinates=e,this.update()}get showAngles(){return this._showAngles}set showAngles(e){this._showAngles=e,this.update()}get showHeight(){return this._showHeight}set showHeight(e){this._showHeight=e,this.update()}get showArea(){return this._showArea}set showArea(e){this._showArea=e,this.update()}get closed(){return this._closed}set closed(e){this._closed=e,this.update()}get showDistances(){return this._showDistances}set showDistances(e){this._showDistances=e,this.update()}},Potree.MeasuringTool=class extends THREE.EventDispatcher{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.addEventListener("start_inserting_measurement",e=>{this.viewer.dispatchEvent({type:"cancel_insertions"})}),this.sceneMeasurement=new THREE.Scene,this.sceneMeasurement.name="scene_measurement",this.light=new THREE.PointLight(16777215,1),this.sceneMeasurement.add(this.light),this.viewer.inputHandler.registerInteractiveScene(this.sceneMeasurement),this.onRemove=(e=>{this.sceneMeasurement.remove(e.measurement)}),this.onAdd=(e=>{this.sceneMeasurement.add(e.measurement)})}setScene(e){this.scene!==e&&(this.scene&&(this.scene.removeEventListener("measurement_added",this.onAdd),this.scene.removeEventListener("measurement_removed",this.onRemove)),this.scene=e,this.scene.addEventListener("measurement_added",this.onAdd),this.scene.addEventListener("measurement_removed",this.onRemove))}startInsertion(e={}){let t=this.viewer.renderer.domElement,i=new Potree.Measure;this.dispatchEvent({type:"start_inserting_measurement",measure:i}),i.showDistances=null==e.showDistances||e.showDistances,i.showArea=e.showArea||!1,i.showAngles=e.showAngles||!1,i.showCoordinates=e.showCoordinates||!1,i.showHeight=e.showHeight||!1,i.closed=e.closed||!1,i.maxMarkers=e.maxMarkers||1/0,this.sceneMeasurement.add(i);let r={removeLastMarker:i.maxMarkers>3,callback:null},n=e=>{e.button===THREE.MOUSE.LEFT?(i.addMarker(i.points[i.points.length-1].position.clone()),i.points.length>=i.maxMarkers&&r.callback(),this.viewer.inputHandler.startDragging(i.spheres[i.spheres.length-1])):e.button===THREE.MOUSE.RIGHT&&r.callback()};r.callback=(e=>{r.removeLastMarker&&i.removeMarker(i.points.length-1),t.removeEventListener("mouseup",n,!0),this.viewer.removeEventListener("cancel_insertions",r.callback)}),i.maxMarkers>1&&(this.viewer.addEventListener("cancel_insertions",r.callback),t.addEventListener("mouseup",n,!0)),i.addMarker(new THREE.Vector3(0,0,0)),this.viewer.inputHandler.startDragging(i.spheres[i.spheres.length-1]),this.viewer.scene.addMeasurement(i)}update(){let e=this.viewer.scene.camera,t=this.renderer.domElement,i=this.viewer.scene.measurements;this.light.position.copy(e.position);for(let r of i){for(let i of r.spheres){let r=e.position.distanceTo(i.getWorldPosition()),n=15/Potree.utils.projectedRadius(1,e.fov*Math.PI/180,r,t.clientHeight);i.scale.set(n,n,n)}let i=r.edgeLabels.concat(r.angleLabels);for(let r of i){let i=e.position.distanceTo(r.getWorldPosition()),n=70/Potree.utils.projectedRadius(1,e.fov*Math.PI/180,i,t.clientHeight);r.scale.set(n,n,n)}for(let i=0;i<r.coordinateLabels.length;i++){let n=r.coordinateLabels[i],o=r.spheres[i],a=(r.points[i],e.position.distanceTo(o.getWorldPosition())),s=o.getWorldPosition().clone().project(e);s.x=Math.round((s.x+1)*t.clientWidth/2),s.y=Math.round((1-s.y)*t.clientHeight/2),s.z=0,s.y-=30;let l=new THREE.Vector3(s.x/t.clientWidth*2-1,-s.y/t.clientHeight*2+1,.5);l.unproject(e);let c=l.sub(e.position).normalize();l=(new THREE.Vector3).addVectors(e.position,c.multiplyScalar(a)),n.position.copy(l);let u=70/Potree.utils.projectedRadius(1,e.fov*Math.PI/180,a,t.clientHeight);n.scale.set(u,u,u)}if(r.showHeight){let i=r.heightLabel;{let r=i.position.distanceTo(e.position),n=70/Potree.utils.projectedRadius(1,e.fov*Math.PI/180,r,t.clientHeight);i.scale.set(n,n,n)}{let i=r.heightEdge,n=i.geometry.vertices[0].clone().add(i.position),o=i.geometry.vertices[2].clone().add(i.position),a=i.geometry.vertices[3].clone().add(i.position),s=n.clone().project(e),l=o.clone().project(e),c=a.clone().project(e),u=e=>{let i=e.clone().addScalar(1).divideScalar(2);return i.x=i.x*t.clientWidth,i.y=i.y*t.clientHeight,i.z=0,i},h=u(s),d=u(l),p=u(c),f=(h.distanceTo(d),d.distanceTo(p),h.distanceTo(d)),m=d.distanceTo(p);i.geometry.lineDistances=[0,f,f,f+m],i.geometry.lineDistancesNeedUpdate=!0,i.material.dashSize=10,i.material.gapSize=10}}{let i=r.areaLabel,n=i.position.distanceTo(e.position),o=70/Potree.utils.projectedRadius(1,e.fov*Math.PI/180,n,t.clientHeight);i.scale.set(o,o,o)}}}},Potree.Profile=class extends THREE.Object3D{constructor(){super(),this.points=[],this.spheres=[],this.edges=[],this.boxes=[],this.width=1,this.height=20,this._modifiable=!0,this.sphereGeometry=new THREE.SphereGeometry(.4,10,10),this.color=new THREE.Color(16711680),this.lineColor=new THREE.Color(16711680)}createSphereMaterial(){return new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:16711680,depthTest:!1,depthWrite:!1})}addMarker(e){this.points.push(e);let t=new THREE.Mesh(this.sphereGeometry,this.createSphereMaterial());if(this.add(t),this.spheres.push(t),this.points.length>1){var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3,new THREE.Vector3),i.colors.push(this.lineColor,this.lineColor,this.lineColor);var r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:2,transparent:!0,opacity:.4});r.depthTest=!1;var n=new THREE.Line(i,r);n.visible=!1,this.add(n),this.edges.push(n);var o=new THREE.BoxGeometry(1,1,1),a=new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:.2}),s=new THREE.Mesh(o,a);s.visible=!1,this.add(s),this.boxes.push(s)}t.addEventListener("drag",e=>{let t=Potree.utils.getMousePointCloudIntersection(e.drag.end,e.viewer.scene.camera,e.viewer.renderer,e.viewer.scene.pointclouds);if(t){let i=this.spheres.indexOf(e.drag.object);-1!==i&&(this.setPosition(i,t.location),this.dispatchEvent({type:"marker_moved",profile:this,index:i}))}}),t.addEventListener("drop",e=>{let t=this.spheres.indexOf(e.drag.object);-1!==t&&this.dispatchEvent({type:"marker_dropped",profile:this,index:t})}),t.addEventListener("mouseover",e=>e.object.material.emissive.setHex(8947848)),t.addEventListener("mouseleave",e=>e.object.material.emissive.setHex(0));let l={type:"marker_added",profile:this,sphere:t};this.dispatchEvent(l),this.setPosition(this.points.length-1,e)}removeMarker(e){this.points.splice(e,1),this.remove(this.spheres[e]);var t=0===e?0:e-1;this.remove(this.edges[t]),this.edges.splice(t,1),this.remove(this.boxes[t]),this.boxes.splice(t,1),this.spheres.splice(e,1),this.update(),this.dispatchEvent({type:"marker_removed",profile:this})}setPosition(e,t){let i=this.points[e];i.copy(t);let r={type:"marker_moved",profile:this,index:e,position:i.clone()};this.dispatchEvent(r),this.update()}setWidth(e){this.width=e;let t={type:"width_changed",profile:this,width:e};this.dispatchEvent(t),this.update()}getWidth(){return this.width}update(){if(0===this.points.length)return;if(1===this.points.length){let e=this.points[0];return void this.spheres[0].position.copy(e)}let e=this.points[0].clone(),t=this.points[0].clone(),i=new THREE.Vector3,r=this.points.length-1;for(var n=0;n<=r;n++){let h=this.points[n],d=this.spheres[n],p=0===n?r:n-1,f=n===r?0:n+1,m=this.points[p],g=this.points[f],v=this.edges[p],y=this.edges[n],b=this.boxes[p];this.boxes[n],h.distanceTo(m),h.distanceTo(g),(new THREE.Vector3).addVectors(m,h).multiplyScalar(.5),(new THREE.Vector3).addVectors(h,g).multiplyScalar(.5);if(d.position.copy(h),this._modifiable?d.visible=!0:d.visible=!1,v&&(v.geometry.vertices[1].copy(h),v.geometry.verticesNeedUpdate=!0,v.geometry.computeBoundingSphere()),y&&(y.geometry.vertices[0].copy(h),y.geometry.verticesNeedUpdate=!0,y.geometry.computeBoundingSphere()),b){var o=m,a=h,s=o.clone().setZ(0).distanceTo(a.clone().setZ(0));b.scale.set(s,1e6,this.width),b.up.set(0,0,1);var l=(new THREE.Vector3).addVectors(o,a).multiplyScalar(.5),c=(new THREE.Vector3).subVectors(a,o),u=new THREE.Vector3(c.y,-c.x,0);b.position.set(0,0,0),b.lookAt(u),b.position.copy(l)}i.add(h),e.min(h),t.max(h)}i.multiplyScalar(1/this.points.length);for(n=0;n<this.boxes.length;n++){this.boxes[n].position.z=e.z+(t.z-e.z)/2}}raycast(e,t){for(let i=0;i<this.points.length;i++){this.spheres[i].raycast(e,t)}for(let i=0;i<t.length;i++){let r=t[i];r.distance=e.ray.origin.distanceTo(r.point)}t.sort(function(e,t){return e.distance-t.distance})}get modifiable(){return this._modifiable}set modifiable(e){this._modifiable=e,this.update()}},Potree.ProfileTool=class extends THREE.EventDispatcher{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.addEventListener("start_inserting_profile",e=>{this.viewer.dispatchEvent({type:"cancel_insertions"})}),this.sceneProfile=new THREE.Scene,this.sceneProfile.name="scene_profile",this.light=new THREE.PointLight(16777215,1),this.sceneProfile.add(this.light),this.viewer.inputHandler.registerInteractiveScene(this.sceneProfile),this.onRemove=(e=>this.sceneProfile.remove(e.profile)),this.onAdd=(e=>this.sceneProfile.add(e.profile))}setScene(e){this.scene!==e&&(this.scene&&(this.scene.removeEventListeners("profile_added",this.onAdd),this.scene.removeEventListeners("profile_removed",this.onRemove)),this.scene=e,this.scene.addEventListener("profile_added",this.onAdd),this.scene.addEventListener("profile_removed",this.onRemove))}startInsertion(e={}){let t=this.viewer.renderer.domElement,i=new Potree.Profile;this.dispatchEvent({type:"start_inserting_profile",profile:i}),this.sceneProfile.add(i);let r={callback:null},n=e=>{if(e.button===THREE.MOUSE.LEFT){if(i.points.length<=1){let e=this.viewer.scene.camera,r=e.position.distanceTo(i.points[0]),n=10/Potree.utils.projectedRadius(1,e.fov*Math.PI/180,r,t.clientHeight);i.setWidth(n)}i.addMarker(i.points[i.points.length-1].clone()),this.viewer.inputHandler.startDragging(i.spheres[i.spheres.length-1])}else e.button===THREE.MOUSE.RIGHT&&r.callback()};r.callback=(e=>{i.removeMarker(i.points.length-1),t.removeEventListener("mouseup",n,!0),this.viewer.removeEventListener("cancel_insertions",r.callback)}),this.viewer.addEventListener("cancel_insertions",r.callback),t.addEventListener("mouseup",n,!0),i.addMarker(new THREE.Vector3(0,0,0)),this.viewer.inputHandler.startDragging(i.spheres[i.spheres.length-1]),this.viewer.scene.addProfile(i)}update(){let e=this.viewer.scene.camera,t=this.renderer.domElement,i=this.viewer.scene.profiles;this.light.position.copy(e.position);for(let r of i)for(let i of r.spheres){let r=e.position.distanceTo(i.getWorldPosition()),n=15/Potree.utils.projectedRadius(1,e.fov*Math.PI/180,r,t.clientHeight);i.scale.set(n,n,n)}}},Potree.TransformationTool=class{constructor(e){this.viewer=e,this.sceneTransform=new THREE.Scene,this.translationNode=new THREE.Object3D,this.rotationNode=new THREE.Object3D,this.scaleNode=new THREE.Object3D,this.TRANSFORMATION_MODES={DEFAULT:0,TRANSLATE:1,ROTATE:2,SCALE:3},this.keys={TRANSLATE:["E".charCodeAt(0)],SCALE:["R".charCodeAt(0)],ROTATE:["T".charCodeAt(0)]},this.mode=this.TRANSFORMATION_MODES.DEFAULT,this.menu=new class{constructor(e){let t=this;this.items=[],this.x=0,this.y=0,this.circumference=32,this.element=$('<span class="hover_menu"></span>'),this.elIcon=$(`<span class="hover_menu_icon">\n\t\t\t<img src="${e}">\n\t\t</span>`),this.element.append(this.elIcon),this.element.click(function(){$(this).find(".hover_menu_item").fadeIn(200),$(this).find(".hover_menu_icon").fadeOut(200),$(this).css("left",t.x-t.circumference-$(this).width()/2+"px"),$(this).css("top",t.y-t.circumference-$(this).height()/2+"px"),$(this).css("border",t.circumference+"px solid transparent")}).mouseleave(function(){$(this).find(".hover_menu_item").fadeOut(200),$(this).find(".hover_menu_icon").fadeIn(200),$(this).css("left",t.x-$(this).width()/2+"px"),$(this).css("top",t.y-$(this).height()/2+"px"),$(this).css("border","0px solid black")})}addItem(e){this.items.push(e),this.element.append(e.element),e.element.hide(),this.arrange()}removeItem(e){this.items=this.items.filter(t=>t!==e),this.element.remove(e.element),this.arrange()}arrange(){let e=this.element.find(".hover_menu_item");e.each(function(t,i){let r=t/e.length*Math.PI*2,n=22*Math.cos(r),o=22*Math.sin(r);$(this).css("left",n).css("top",o)})}setPosition(e,t){this.x=e,this.y=t;let i=this.element.get(0).getBoundingClientRect();this.element.css("left",this.x-i.width/2+"px"),this.element.css("top",this.y-i.height/2+"px")}}(Potree.resourcePath+"/icons/menu_icon.svg"),this.selection=[],this.viewer.inputHandler.registerInteractiveScene(this.sceneTransform),this.viewer.inputHandler.addEventListener("selection_changed",e=>{this.selection=e.selection}),this.viewer.inputHandler.addEventListener("keydown",e=>{this.selection.length>0&&(this.keys.TRANSLATE.some(t=>t===e.keyCode)?this.setMode(this.TRANSFORMATION_MODES.TRANSLATE):this.keys.SCALE.some(t=>t===e.keyCode)?this.setMode(this.TRANSFORMATION_MODES.SCALE):this.keys.ROTATE.some(t=>t===e.keyCode)&&this.setMode(this.TRANSFORMATION_MODES.ROTATE))}),this.menu.addItem(new u(Potree.resourcePath+"/icons/translate.svg",e=>{this.setMode(this.TRANSFORMATION_MODES.TRANSLATE)})),this.menu.addItem(new u(Potree.resourcePath+"/icons/rotate.svg",e=>{this.setMode(this.TRANSFORMATION_MODES.ROTATE)})),this.menu.addItem(new u(Potree.resourcePath+"/icons/scale.svg",e=>{this.setMode(this.TRANSFORMATION_MODES.SCALE)})),this.menu.setPosition(100,100),$(this.viewer.renderArea).append(this.menu.element),this.menu.element.hide();{let t=(t,i,r)=>{let n=new THREE.MeshBasicMaterial({color:r,depthTest:!1,depthWrite:!1}),o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(0,0,0)),o.vertices.push(new THREE.Vector3(0,1,0));let a=new THREE.LineBasicMaterial({color:r,depthTest:!0,depthWrite:!0,transparent:!0}),s=new THREE.Line(o,a);s.name=t+"_shaft";let l=new THREE.CylinderGeometry(0,.04,.1,10,1,!1),c=n,u=new THREE.Mesh(l,c);u.name=t+"_head",u.position.y=1;let h=new THREE.Object3D;h.name=t,h.add(s),h.add(u);return s.addEventListener("mouseover",e=>{let t=new THREE.Color(16776960);a.color=t,c.color=t}),s.addEventListener("mouseleave",e=>{let t=new THREE.Color(r);a.color=t,c.color=t}),s.addEventListener("drag",t=>{let r=this.viewer.scene.camera;if(!t.drag.intersectionStart){t.drag.intersectionStart=t.drag.location,t.drag.objectStart=t.drag.object.getWorldPosition();let e=this.sceneTransform.position.clone(),n=i.clone().applyMatrix4(this.sceneTransform.matrixWorld),o=new THREE.Line3(e,n);t.drag.line=o;let a=o.closestPointToPoint(r.position,!1),s=(new THREE.Vector3).subVectors(r.position,a),l=(new THREE.Plane).setFromNormalAndCoplanarPoint(s,t.drag.intersectionStart);t.drag.dragPlane=l,t.drag.pivot=t.drag.intersectionStart}{let i=t.drag.end,n=e.renderer.domElement,o={x:i.x/n.clientWidth*2-1,y:-i.y/n.clientHeight*2+1},a=new THREE.Vector3(o.x,o.y,.5);a.unproject(r);let s=new THREE.Ray(r.position,a.sub(r.position)).intersectPlane(t.drag.dragPlane);if(s){let e=t.drag.line.closestPointToPoint(s,!1),i=(new THREE.Vector3).subVectors(e,t.drag.pivot);for(let e of this.selection)e.position.add(i);t.drag.pivot=t.drag.pivot.add(i)}}}),h},i=t("arrow_x",new THREE.Vector3(1,0,0),16711680),r=t("arrow_y",new THREE.Vector3(0,1,0),65280),n=t("arrow_z",new THREE.Vector3(0,0,1),255);i.rotation.z=-Math.PI/2,n.rotation.x=Math.PI/2,this.translationNode.add(i),this.translationNode.add(r),this.translationNode.add(n)}{let t=(t,i,r)=>{let n=new THREE.LineBasicMaterial({color:r,depthTest:!0,depthWrite:!0,transparent:!0}),o=new THREE.BufferGeometry,a=new Float32Array(99);for(let e=0;e<=32;e++){let t=e/32*Math.PI*2,i=1*Math.cos(t),r=1*Math.sin(t);a[3*e+0]=i,a[3*e+1]=r,a[3*e+2]=0}o.addAttribute("position",new THREE.BufferAttribute(a,3)),o.computeBoundingSphere();let s=new THREE.Line(o,n);s.name=t+"_circle",s.lookAt(i);return s.addEventListener("mouseover",e=>{let t=new THREE.Color(16776960);n.color=t}),s.addEventListener("mouseleave",e=>{let t=new THREE.Color(r);n.color=t}),s.addEventListener("drag",t=>{let r=this.viewer.scene.camera,n=i.clone().applyEuler(this.sceneTransform.rotation);if(!t.drag.intersectionStart){t.drag.objectStart=t.drag.object.getWorldPosition();let i=(new THREE.Plane).setFromNormalAndCoplanarPoint(n,this.sceneTransform.getWorldPosition());{let n=t.drag.end,o=e.renderer.domElement,a={x:n.x/o.clientWidth*2-1,y:-n.y/o.clientHeight*2+1},s=new THREE.Vector3(a.x,a.y,.5);s.unproject(r);let l=new THREE.Ray(r.position,s.sub(r.position)).intersectPlane(i);t.drag.intersectionStart=l}t.drag.dragPlane=i,t.drag.pivot=t.drag.intersectionStart}let o=t.drag.end,a=e.renderer.domElement,s={x:o.x/a.clientWidth*2-1,y:-o.y/a.clientHeight*2+1},l=new THREE.Vector3(s.x,s.y,.5);l.unproject(r);let c=new THREE.Ray(r.position,l.sub(r.position)).intersectPlane(t.drag.dragPlane);if(c){let e=this.sceneTransform.position,r=c,o=t.drag.pivot.clone().sub(e).normalize(),a=r.clone().sub(e).normalize(),s=Math.acos(o.dot(a));if(s*=Math.sign(o.cross(a).dot(n)),Number.isNaN(s))return;for(let e of this.selection)e.rotateOnAxis(i,s);t.drag.pivot=c}}),s};{let e=new THREE.SphereGeometry(1,32,32),t=new THREE.MeshBasicMaterial({color:11184810,transparent:!0,depthTest:!0,depthWrite:!0,opacity:.4}),i=new THREE.Mesh(e,t);i.name=name+"_sphere",i.scale.set(.9,.9,.9),this.rotationNode.add(i)}let i=t("yaw",new THREE.Vector3(0,0,1),16711680),r=t("pitch",new THREE.Vector3(1,0,0),65280),n=t("roll",new THREE.Vector3(0,1,0),255);this.rotationNode.add(i),this.rotationNode.add(r),this.rotationNode.add(n)}{let t=(t,i,r)=>{let n=new THREE.MeshBasicMaterial({color:r,depthTest:!1,depthWrite:!1}),o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(0,0,0)),o.vertices.push(new THREE.Vector3(0,1,0));let a=new THREE.LineBasicMaterial({color:r,depthTest:!0,depthWrite:!0,transparent:!0}),s=new THREE.Line(o,a);s.name=t+"_shaft";let l=new THREE.BoxGeometry(1,1,1),c=n,u=new THREE.Mesh(l,c);u.name=t+"_head",u.position.y=1,u.scale.set(.07,.07,.07);let h=new THREE.Object3D;h.add(s),h.add(u);return s.addEventListener("mouseover",e=>{let t=new THREE.Color(16776960);a.color=t,c.color=t}),s.addEventListener("mouseleave",e=>{let t=new THREE.Color(r);a.color=t,c.color=t}),s.addEventListener("drag",t=>{let r=this.viewer.scene.camera;if(!t.drag.intersectionStart){t.drag.intersectionStart=t.drag.location,t.drag.scaleStart=this.selection[0].scale.clone();let e=this.sceneTransform.position.clone(),n=i.clone().applyMatrix4(this.sceneTransform.matrixWorld),o=new THREE.Line3(e,n);t.drag.line=o;let a=o.closestPointToPoint(r.position,!1),s=(new THREE.Vector3).subVectors(r.position,a),l=(new THREE.Plane).setFromNormalAndCoplanarPoint(s,t.drag.intersectionStart);t.drag.dragPlane=l,t.drag.pivot=t.drag.intersectionStart}{let n=t.drag.end,o=e.renderer.domElement,a={x:n.x/o.clientWidth*2-1,y:-n.y/o.clientHeight*2+1},s=new THREE.Vector3(a.x,a.y,.5);s.unproject(r);let l=new THREE.Ray(r.position,s.sub(r.position)).intersectPlane(t.drag.dragPlane);if(l){t.drag.line.closestPointToPoint(l,!1);let e=this.sceneTransform.position.distanceTo(t.drag.pivot),r=this.sceneTransform.position.distanceTo(l)/e,n=new THREE.Vector3(0===i.x?1:r*i.x,0===i.y?1:r*i.y,0===i.z?1:r*i.z);for(let e of this.selection)e.scale.copy(t.drag.scaleStart.clone().multiply(n))}}}),h},i=t("arrow_x",new THREE.Vector3(1,0,0),16711680),r=t("arrow_y",new THREE.Vector3(0,1,0),65280),n=t("arrow_z",new THREE.Vector3(0,0,1),255);i.rotation.z=-Math.PI/2,n.rotation.x=Math.PI/2,this.scaleNode.add(i),this.scaleNode.add(r),this.scaleNode.add(n)}this.setMode(this.TRANSFORMATION_MODES.TRANSLATE)}getSelectionBoundingBox(){let e=new THREE.Vector3(1/0,1/0,1/0),t=new THREE.Vector3(-1/0,-1/0,-1/0);for(let i of this.selection){let r=null;if(i.boundingBox?r=i.boundingBox:i.geometry&&i.geometry.boundingBox&&(r=i.geometry.boundingBox),r){let n=r.clone().applyMatrix4(i.matrixWorld);e=e.min(n.min),t=t.max(n.max)}else{let r=i.getWorldPosition();e=e.min(r),t=t.max(r)}}return new THREE.Box3(e,t)}setMode(e){this.mode!==e&&(this.sceneTransform.remove(this.translationNode),this.sceneTransform.remove(this.rotationNode),this.sceneTransform.remove(this.scaleNode),e===this.TRANSFORMATION_MODES.TRANSLATE?this.sceneTransform.add(this.translationNode):e===this.TRANSFORMATION_MODES.ROTATE?this.sceneTransform.add(this.rotationNode):e===this.TRANSFORMATION_MODES.SCALE&&this.sceneTransform.add(this.scaleNode),this.mode=e)}update(){if(0===this.selection.length)return this.sceneTransform.visible=!1,void this.menu.element.hide();this.sceneTransform.visible=!0,this.menu.element.show(),1===this.selection.length&&this.sceneTransform.rotation.copy(this.selection[0].rotation);let e=this.viewer.scene,t=this.viewer.renderer,i=t.domElement,r=this.getSelectionBoundingBox().getCenter();this.sceneTransform.position.copy(r);{let i=e.camera.position.distanceTo(r),n=120/Potree.utils.projectedRadius(1,e.camera.fov*Math.PI/180,i,t.domElement.clientHeight);this.sceneTransform.scale.set(n,n,n)}{let t=r.clone().project(e.camera);t.x=i.clientWidth*(t.x+1)/2,t.y=i.clientHeight*(1-(t.y+1)/2),this.menu.setPosition(t.x,t.y)}}},Potree.Volume=class extends THREE.Object3D{constructor(e={}){super(),this.constructor.counter=void 0===this.constructor.counter?0:this.constructor.counter+1,this.name="volume_"+this.constructor.counter,this._clip=e.clip||!1,this._modifiable=e.modifiable||!0;let t=new THREE.BoxGeometry(1,1,1);t.computeBoundingBox();let i=new THREE.Geometry;i.vertices.push(new THREE.Vector3(-.5,-.5,.5)),i.vertices.push(new THREE.Vector3(.5,-.5,.5)),i.vertices.push(new THREE.Vector3(.5,-.5,.5)),i.vertices.push(new THREE.Vector3(.5,-.5,-.5)),i.vertices.push(new THREE.Vector3(.5,-.5,-.5)),i.vertices.push(new THREE.Vector3(-.5,-.5,-.5)),i.vertices.push(new THREE.Vector3(-.5,-.5,-.5)),i.vertices.push(new THREE.Vector3(-.5,-.5,.5)),i.vertices.push(new THREE.Vector3(-.5,.5,.5)),i.vertices.push(new THREE.Vector3(.5,.5,.5)),i.vertices.push(new THREE.Vector3(.5,.5,.5)),i.vertices.push(new THREE.Vector3(.5,.5,-.5)),i.vertices.push(new THREE.Vector3(.5,.5,-.5)),i.vertices.push(new THREE.Vector3(-.5,.5,-.5)),i.vertices.push(new THREE.Vector3(-.5,.5,-.5)),i.vertices.push(new THREE.Vector3(-.5,.5,.5)),i.vertices.push(new THREE.Vector3(-.5,-.5,.5)),i.vertices.push(new THREE.Vector3(-.5,.5,.5)),i.vertices.push(new THREE.Vector3(.5,-.5,.5)),i.vertices.push(new THREE.Vector3(.5,.5,.5)),i.vertices.push(new THREE.Vector3(.5,-.5,-.5)),i.vertices.push(new THREE.Vector3(.5,.5,-.5)),i.vertices.push(new THREE.Vector3(-.5,-.5,-.5)),i.vertices.push(new THREE.Vector3(-.5,.5,-.5));this.dimension=new THREE.Vector3(1,1,1),this.material=new THREE.MeshBasicMaterial({color:65280,transparent:!0,opacity:.3,depthTest:!0,depthWrite:!1}),this.box=new THREE.Mesh(t,this.material),this.box.geometry.computeBoundingBox(),this.boundingBox=this.box.geometry.boundingBox,this.add(this.box),this.frame=new THREE.LineSegments(i,new THREE.LineBasicMaterial({color:0})),this.add(this.frame),this.label=new Potree.TextSprite("0"),this.label.setBorderColor({r:0,g:255,b:0,a:0}),this.label.setBackgroundColor({r:0,g:255,b:0,a:0}),this.label.material.depthTest=!1,this.label.material.depthWrite=!1,this.label.material.transparent=!0,this.label.position.y-=.5,this.add(this.label),this.label.updateMatrixWorld=(()=>{var e=new THREE.Vector3;e.setFromMatrixPosition(this.matrixWorld),this.label.position.copy(e),this.label.updateMatrix(),this.label.matrixWorld.copy(this.label.matrix),this.label.matrixWorldNeedsUpdate=!1;for(var t=0,i=this.label.children.length;t<i;t++)this.label.children[t].updateMatrixWorld(!0)}),this.addEventListener("select",e=>{}),this.addEventListener("deselect",e=>{}),this.update()}getVolume(){return Math.abs(this.scale.x*this.scale.y*this.scale.z)}update(){this.boundingBox=this.box.geometry.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(),this._clip?(this.box.visible=!1,this.label.visible=!1):(this.box.visible=!0,this.label.visible=!0)}raycast(e,t){let i=[];if(this.box.raycast(e,i),i.length>0){var r=i[0];t.push({distance:r.distance,object:this,point:r.point.clone()})}}get clip(){return this._clip}set clip(e){this._clip=e,this.update()}get modifieable(){return this._modifiable}set modifieable(e){this._modifiable=e,this.update()}},Potree.VolumeTool=class extends THREE.EventDispatcher{constructor(e){super(),this.viewer=e,this.renderer=e.renderer,this.addEventListener("start_inserting_volume",e=>{this.viewer.dispatchEvent({type:"cancel_insertions"})}),this.sceneVolume=new THREE.Scene,this.sceneVolume.name="scene_volume",this.viewer.inputHandler.registerInteractiveScene(this.sceneVolume),this.onRemove=(e=>{this.sceneVolume.remove(e.volume)}),this.onAdd=(e=>{this.sceneVolume.add(e.volume)}),this.viewer.inputHandler.addEventListener("delete",e=>{e.selection.filter(e=>e instanceof Potree.Volume).forEach(e=>this.viewer.scene.removeVolume(e))})}setScene(e){this.scene!==e&&(this.scene&&(this.scene.removeEventListeners("volume_added",this.onAdd),this.scene.removeEventListeners("volume_removed",this.onRemove)),this.scene=e,this.scene.addEventListener("volume_added",this.onAdd),this.scene.addEventListener("volume_removed",this.onRemove))}startInsertion(e={}){this.viewer.renderer.domElement;let t=new Potree.Volume;t.clip=e.clip||!1,this.dispatchEvent({type:"start_inserting_volume",volume:t}),this.viewer.scene.addVolume(t);let i={callback:null},r=e=>{let i=this.viewer.scene.camera,r=Potree.utils.getMousePointCloudIntersection(e.drag.end,this.viewer.scene.camera,this.viewer.renderer,this.viewer.scene.pointclouds);if(r){t.position.copy(r.location);var n=t.getWorldPosition().applyMatrix4(i.matrixWorldInverse),o=(new THREE.Vector4(n.x,n.y,n.z).applyMatrix4(i.projectionMatrix),Math.abs(n.z/10));t.scale.set(o,o,o)}},n=e=>{t.removeEventListener("drag",r),t.removeEventListener("drop",n),i.callback()};i.callback=(e=>{t.removeEventListener("drag",r),t.removeEventListener("drop",n),this.viewer.removeEventListener("cancel_insertions",i.callback)}),t.addEventListener("drag",r),t.addEventListener("drop",n),this.viewer.addEventListener("cancel_insertions",i.callback),this.viewer.inputHandler.startDragging(t)}update(e){if(!this.scene)return;let t=this.viewer.scene.camera,i=this.viewer.renderer.domElement,r=this.viewer.scene.volumes;for(let e of r){let r=e.label;{let e=r.position.distanceTo(t.position),n=70/Potree.utils.projectedRadius(1,t.fov*Math.PI/180,e,i.clientHeight);r.scale.set(n,n,n)}let n=Potree.utils.addCommas(e.getVolume().toFixed(3))+"³";r.setText(n)}}},Potree.GeoJSONExporter=class{static toString(e){let t={type:"FeatureCollection",features:[]},i=e.showDistances&&!e.showArea&&!e.showAngles,r=e.showDistances&&e.showArea&&!e.showAngles;i?t.features.push({type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{}}):r&&t.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:[]},properties:{}});let n=e.points.map(e=>e.position.toArray());if(i?t.features[0].geometry.coordinates=n:r&&(n.push(n[0]),t.features[0].geometry.coordinates.push(n)),e.edgeLabels.forEach(function(e){var i={type:"Feature",geometry:{type:"Point",coordinates:e.position.toArray()},properties:{name:e.text}};t.features.push(i)}),i&&t.features.pop(),r){var o={type:"Feature",geometry:{type:"Point",coordinates:e.areaLabel.position.toArray()},properties:{name:e.areaLabel.text}};t.features.push(o)}return JSON.stringify(t)}},Potree.DXFExporter=class{static toString(e){let t=e.showDistances&&!e.showArea&&!e.showAngles,i=e.showDistances&&e.showArea&&!e.showAngles;if(!t&&!i)return;let r="0\nSECTION\n2\nENTITIES\n0\nPOLYLINE\n8\n0\n62\n1\n66\n1\n10\n0.0\n20\n0.0\n30\n0.0\n70\n{geomCode}\n".replace("{geomCode}",t?8:9),n=0,o=0,a=0;e.points.forEach(function(e){e=e.position,n=Math.max(n,e.x),o=Math.max(o,e.y),a=Math.max(a,e.z),r+="0\nVERTEX\n8\n0\n10\n{X}\n20\n{Y}\n30\n{Z}\n70\n32\n".replace("{X}",e.x).replace("{Y}",e.y).replace("{Z}",e.z)}),r+="0\nSEQEND\n0\nENDSEC\n";return"999\nDXF created from potree\n0\nSECTION\n2\nHEADER\n9\n$ACADVER\n1\nAC1006\n9\n$INSBASE\n10\n0.0\n20\n0.0\n30\n0.0\n9\n$EXTMIN\n10\n0.0\n20\n0.0\n30\n0\n9\n$EXTMAX\n10\n{xMax}\n20\n{yMax}\n30\n{zMax}\n0\nENDSEC\n".replace("{xMax}",n).replace("{yMax}",o).replace("{zMax}",a)+r+"0\nEOF"}},Potree.PointCloudArena4DNode=function(){this.left=null,this.right=null,this.sceneNode=null,this.kdtree=null,this.getNumPoints=function(){return this.geometryNode.numPoints},this.isLoaded=function(){return!0},this.isTreeNode=function(){return!0},this.isGeometryNode=function(){return!1},this.getLevel=function(){return this.geometryNode.level},this.getBoundingSphere=function(){return this.geometryNode.boundingSphere},this.getBoundingBox=function(){return this.geometryNode.boundingBox},this.toTreeNode=function(e){var t=null;if(this.left===e?t=this.left:this.right===e&&(t=this.right),t.loaded){var i=new Potree.PointCloudArena4DNode,r=THREE.PointCloud(t.geometry,this.kdtree.material);r.visible=!1,i.kdtree=this.kdtree,i.geometryNode=t,i.sceneNode=r,i.parent=this,i.left=this.geometryNode.left,i.right=this.geometryNode.right}},this.getChildren=function(){var e=[];return this.left&&e.push(this.left),this.right&&e.push(this.right),e}},Potree.PointCloudOctreeNode.prototype=Object.create(Potree.PointCloudTreeNode.prototype),(Potree.PointCloudArena4D=function(e){THREE.Object3D.call(this);var t=this;this.root=null,e.root?this.root=e.root:e.addEventListener("hierarchy_loaded",function(){t.root=e.root}),this.visiblePointsTarget=2e6,this.minimumNodePixelSize=150,this.position.sub(e.offset),this.updateMatrix(),this.numVisibleNodes=0,this.numVisiblePoints=0,this.boundingBoxNodes=[],this.loadQueue=[],this.visibleNodes=[],this.pcoGeometry=e,this.boundingBox=this.pcoGeometry.boundingBox,this.boundingSphere=this.pcoGeometry.boundingSphere,this.material=new Potree.PointCloudMaterial({vertexColors:THREE.VertexColors,size:.05,treeType:Potree.TreeType.KDTREE}),this.material.sizeType=Potree.PointSizeType.ATTENUATED,this.material.size=.05,this.profileRequests=[],this.name="",this.pickTarget,this.pickMaterial}).prototype=new Potree.PointCloudTree,Potree.PointCloudOctree.prototype.setName=function(e){this.name!==e&&(this.name=e,this.dispatchEvent({type:"name_changed",name:e,pointcloud:this}))},Potree.PointCloudOctree.prototype.getName=function(){return this.name},Potree.PointCloudArena4D.prototype.getLevel=function(){return this.level},Potree.PointCloudArena4D.prototype.toTreeNode=function(e,t){var i=new Potree.PointCloudArena4DNode,r=new THREE.Points(e.geometry,this.material);i.geometryNode=e,i.sceneNode=r,i.pointcloud=this,i.left=e.left,i.right=e.right,t?(t.sceneNode.add(r),t.left===e?t.left=i:t.right===e&&(t.right=i)):(this.root=i,this.add(r));return e.oneTimeDisposeHandlers.push(function(){t.sceneNode.remove(i.sceneNode),t.left===i?t.left=e:t.right===i&&(t.right=e)}),i},Potree.PointCloudArena4D.prototype.updateMaterial=function(e,t,i,r){e.fov=i.fov*(Math.PI/180),e.screenWidth=r.domElement.clientWidth,e.screenHeight=r.domElement.clientHeight,e.spacing=this.pcoGeometry.spacing,e.near=i.near,e.far=i.far,this.maxLevel>e.levels&&(e.levels=this.maxLevel+2);var n=this.boundingBox.getSize();e.bbSize=[n.x,n.y,n.z],e.pointSizeType&&(e.pointSizeType!==Potree.PointSizeType.ADAPTIVE&&e.pointColorType!==Potree.PointColorType.LOD||this.updateVisibilityTexture(e,t))},Potree.PointCloudArena4D.prototype.updateVisibleBounds=function(){},Potree.PointCloudArena4D.prototype.hideDescendants=function(e){for(var t=[],i=0;i<e.children.length;i++){(r=e.children[i]).visible&&t.push(r)}for(;t.length>0;){(e=t.shift()).visible=!1,e.boundingBoxNode&&(e.boundingBoxNode.visible=!1);for(i=0;i<e.children.length;i++){var r;(r=e.children[i]).visible&&t.push(r)}}},Potree.PointCloudArena4D.prototype.updateMatrixWorld=function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0)},Potree.PointCloudArena4D.prototype.nodesOnRay=function(e,t){for(var i=[],r=t.clone(),n=0;n<e.length;n++){var o=e[n],a=o.getBoundingSphere().clone().applyMatrix4(o.sceneNode.matrixWorld);o.getBoundingBox().clone().applyMatrix4(o.sceneNode.matrixWorld);r.intersectsSphere(a)&&i.push(o)}return i},Potree.PointCloudArena4D.prototype.pick=function(e,t,i,r){let n=e.context,o=function(e){void 0===e._glstate&&(e._glstate={});let t=e._glstate,i=n.createShader(n.VERTEX_SHADER);n.shaderSource(i,e.vertexShader),n.compileShader(i);if(!n.getShaderParameter(i,n.COMPILE_STATUS)){console.error("could not compile vertex shader:");let t=n.getShaderInfoLog(i);return void console.error(t,e.vertexShader)}let r=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(r,e.fragmentShader),n.compileShader(r);if(!n.getShaderParameter(r,n.COMPILE_STATUS))return console.error("could not compile fragment shader:"),void console.error(e.fragmentShader);var o=n.createProgram();n.attachShader(o,i),n.attachShader(o,r),n.linkProgram(o);if(!n.getProgramParameter(o,n.LINK_STATUS))return console.error("could not compile shader:"),console.error(e.vertexShader),void console.error(e.fragmentShader);t.program=o,n.useProgram(o);{let e={},i=n.getProgramParameter(o,n.ACTIVE_UNIFORMS);for(let t=0;t<i;t++){var a=n.getActiveUniform(o,t).name,s=n.getUniformLocation(o,a);e[a]=s}t.uniforms=e,t.textures={}}};void 0===Potree.PointCloudArena4D.pickMaterial&&(Potree.PointCloudArena4D.pickMaterial=new Potree.PointCloudMaterial({treeType:Potree.TreeType.KDTREE}),Potree.PointCloudArena4D.pickMaterial.pointColorType=Potree.PointColorType.POINT_INDEX,o(Potree.PointCloudArena4D.pickMaterial));let a=Potree.PointCloudArena4D.pickMaterial;let s=(r=r||{}).pickWindowSize||17,l=r.pickOutsideClipRegion||!1,c=this.nodesOnRay(this.visibleNodes,i);if(0===c.length)return null;{let i=!1;a.pointSizeType!==this.material.pointSizeType&&(a.pointSizeType=this.material.pointSizeType,i=!0),a.pointShape!==this.material.pointShape&&(a.pointShape=this.material.pointShape,i=!0),a.interpolate!==this.material.interpolate&&(a.interpolate=this.material.interpolate,i=!0),a.size=this.material.size,a.minSize=this.material.minSize,a.maxSize=this.material.maxSize,a.classification=this.material.classification,l?a.clipMode=Potree.ClipMode.DISABLED:(a.clipMode=this.material.clipMode,this.material.clipMode===Potree.ClipMode.CLIP_OUTSIDE?a.setClipBoxes(this.material.clipBoxes):a.setClipBoxes([])),this.updateMaterial(a,c,t,e),i&&o(a)}var u=Math.ceil(e.domElement.clientWidth),h=Math.ceil(e.domElement.clientHeight),d=(new THREE.Vector3).addVectors(t.position,i.direction).project(t);d.addScalar(1).multiplyScalar(.5),d.x*=u,d.y*=h,this.pickTarget?this.pickTarget.width==u&&this.pickTarget.height==h||(this.pickTarget.dispose(),this.pickTarget=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat})):this.pickTarget=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),this.pickTarget.setSize(u,h),n.enable(n.SCISSOR_TEST),n.scissor(d.x-(s-1)/2,d.y-(s-1)/2,s,s),n.disable(n.SCISSOR_TEST),e.setRenderTarget(this.pickTarget),e.state.setDepthTest(a.depthTest),e.state.setDepthWrite(a.depthWrite),e.state.setBlending(THREE.NoBlending),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil);let p=a._glstate,f=p.program,m=p.uniforms;n.useProgram(f),n.uniformMatrix4fv(m.projectionMatrix,!1,new Float32Array(t.projectionMatrix.elements)),n.uniformMatrix4fv(m.viewMatrix,!1,new Float32Array(t.matrixWorldInverse.elements));{if(void 0===p.textures.visibleNodes){let e=a.visibleNodesTexture.image,t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,n.RGB,e.width,e.height,0,n.RGB,n.UNSIGNED_BYTE,e.data),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),p.textures.visibleNodes={id:t}}let e=p.textures.visibleNodes.id,t=a.visibleNodesTexture.image;n.uniform1i(m.visibleNodes,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,n.RGB,t.width,t.height,0,n.RGB,n.UNSIGNED_BYTE,t.data)}let g=this.pcoGeometry.boundingBox.getSize();n.uniform1f(m.fov,this.material.fov),n.uniform1f(m.screenWidth,this.material.screenWidth),n.uniform1f(m.screenHeight,this.material.screenHeight),n.uniform1f(m.spacing,this.material.spacing),n.uniform1f(m.near,this.material.near),n.uniform1f(m.far,this.material.far),n.uniform1f(m.size,this.material.size),n.uniform1f(m.minSize,this.material.minSize),n.uniform1f(m.maxSize,this.material.maxSize),n.uniform1f(m.octreeSize,this.pcoGeometry.boundingBox.getSize().x),n.uniform3f(m.bbSize,g.x,g.y,g.z);{let e=n.getAttribLocation(f,"position"),t=n.getAttribLocation(f,"normal"),i=n.getAttribLocation(f,"classification"),r=n.getAttribLocation(f,"indices");n.enableVertexAttribArray(e),n.enableVertexAttribArray(t),n.enableVertexAttribArray(i),n.enableVertexAttribArray(r)}for(let i=0;i<c.length;i++){let r=c[i],o=r.sceneNode,s=o.geometry;a.pcIndex=i+1;let l=(new THREE.Matrix4).multiplyMatrices(t.matrixWorldInverse,o.matrixWorld);n.uniformMatrix4fv(m.modelMatrix,!1,new Float32Array(o.matrixWorld.elements)),n.uniformMatrix4fv(m.modelViewMatrix,!1,new Float32Array(l.elements));let u=n.getAttribLocation(f,"position"),h=(n.getAttribLocation(f,"normal"),n.getAttribLocation(f,"classification"),n.getAttribLocation(f,"indices")),d=e.properties.get(s.attributes.position).__webglBuffer;if(void 0===d)continue;let p={enabled:[]};for(let e=0;e<16;e++)p.enabled[e]=n.getVertexAttrib(e,n.VERTEX_ATTRIB_ARRAY_ENABLED),n.disableVertexAttribArray(e);n.bindBuffer(n.ARRAY_BUFFER,d),n.vertexAttribPointer(u,3,n.FLOAT,!1,0,0),n.enableVertexAttribArray(u);let g=e.properties.get(s.attributes.indices).__webglBuffer;n.bindBuffer(n.ARRAY_BUFFER,g),n.vertexAttribPointer(h,4,n.UNSIGNED_BYTE,!0,0,0),n.enableVertexAttribArray(h),n.uniform1f(m.pcIndex,a.pcIndex);r.getNumPoints()>0&&n.drawArrays(n.POINTS,0,r.getNumPoints());for(let e=0;e<16;e++)n.disableVertexAttribArray(e);n.enableVertexAttribArray(0),n.enableVertexAttribArray(1)}var v=s*s,y=new ArrayBuffer(4*v),b=new Uint8Array(y),x=new Uint32Array(y);e.context.readPixels(d.x-(s-1)/2,d.y-(s-1)/2,s,s,e.context.RGBA,e.context.UNSIGNED_BYTE,b);var w=Number.MAX_VALUE,_=null;for(let e=0;e<s;e++)for(var E=0;E<s;E++){var M=e+E*s,A=Math.pow(e-(s-1)/2,2)+Math.pow(E-(s-1)/2,2),T=b[4*M+3];b[4*M+3]=0;var S=x[M];(0!==S||0!==T)&&A<w&&(_={pIndex:S,pcIndex:T-1},w=A)}if(_){var P={},C=c[_.pcIndex].sceneNode,R=C.geometry.attributes;for(var L in R)if(R.hasOwnProperty(L)){var B=C.geometry.attributes[L];if("position"===L){var D=B.array,I=D[3*_.pIndex+0],O=D[3*_.pIndex+1],N=D[3*_.pIndex+2],k=new THREE.Vector3(I,O,N);k.applyMatrix4(this.matrixWorld),P[L]=k}else if("indices"===L);else if(1===B.itemSize)P[L]=B.array[_.pIndex];else{for(var F=[],U=0;U<B.itemSize;U++)F.push(B.array[B.itemSize*_.pIndex+U]);P[L]=F}}return P}return null},Potree.PointCloudArena4D.prototype.updateVisibilityTexture=function(e,t){if(e){var i=e.visibleNodesTexture,r=i.image.data;(t=t.slice()).sort(function(e,t){var i=e.geometryNode.level,r=t.geometryNode.level,n=e.geometryNode.number,o=t.geometryNode.number;return i!=r?i-r:n<o?-1:n>o?1:0});for(var n=[],o=0;o<t.length;o++)n.push(t[o].geometryNode.number);for(o=0;o<t.length;o++){var a=t[o],s=0,l=0,c=0;a.geometryNode.left&&n.indexOf(a.geometryNode.left.number)>0&&(s+=1,l=n.indexOf(a.geometryNode.left.number)-o),a.geometryNode.right&&n.indexOf(a.geometryNode.right.number)>0&&(s+=2,l=0===l?n.indexOf(a.geometryNode.right.number)-o:l),"X"===a.geometryNode.split?c=1:"Y"===a.geometryNode.split?c=2:"Z"===a.geometryNode.split&&(c=4),r[3*o+0]=s,r[3*o+1]=l,r[3*o+2]=c}i.needsUpdate=!0}},Object.defineProperty(Potree.PointCloudArena4D.prototype,"progress",{get:function(){return this.pcoGeometry.root?Potree.PointCloudArena4DGeometryNode.nodesLoading>0?0:1:0}}),(Potree.PointCloudArena4DGeometryNode=function(){this.left=null,this.right=null,this.boundingBox=null,this.number=null,this.pcoGeometry=null,this.loaded=!1,this.numPoints=0,this.level=0,this.children=[],this.oneTimeDisposeHandlers=[]}).nodesLoading=0,Potree.PointCloudArena4DGeometryNode.prototype.isGeometryNode=function(){return!0},Potree.PointCloudArena4DGeometryNode.prototype.isTreeNode=function(){return!1},Potree.PointCloudArena4DGeometryNode.prototype.isLoaded=function(){return this.loaded},Potree.PointCloudArena4DGeometryNode.prototype.getBoundingSphere=function(){return this.boundingSphere},Potree.PointCloudArena4DGeometryNode.prototype.getBoundingBox=function(){return this.boundingBox},Potree.PointCloudArena4DGeometryNode.prototype.getChildren=function(){var e=[];return this.left&&e.push(this.left),this.right&&e.push(this.right),e},Potree.PointCloudArena4DGeometryNode.prototype.getBoundingBox=function(){return this.boundingBox},Potree.PointCloudArena4DGeometryNode.prototype.getLevel=function(){return this.level},Potree.PointCloudArena4DGeometryNode.prototype.load=function(){if(!(this.loaded||this.loading||Potree.PointCloudArena4DGeometryNode.nodesLoading>=5)){this.loading=!0,Potree.PointCloudArena4DGeometryNode.nodesLoading++;var e=this.pcoGeometry.url+"?node="+this.number,t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer";var i=this;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){for(var e=t.response,r=new DataView(e),n=e.byteLength/17,o=new Float32Array(3*n),a=new Float32Array(3*n),s=new Uint32Array(n),l=0;l<n;l++){var c=r.getFloat32(17*l+0,!0)+i.boundingBox.min.x,u=r.getFloat32(17*l+4,!0)+i.boundingBox.min.y,h=r.getFloat32(17*l+8,!0)+i.boundingBox.min.z,d=r.getUint8(17*l+12,!0)/256,p=r.getUint8(17*l+13,!0)/256,f=r.getUint8(17*l+14,!0)/256;o[3*l+0]=c,o[3*l+1]=u,o[3*l+2]=h,a[3*l+0]=d,a[3*l+1]=p,a[3*l+2]=f,s[l]=l}var m=new THREE.BufferGeometry;m.addAttribute("position",new THREE.BufferAttribute(o,3)),m.addAttribute("color",new THREE.BufferAttribute(a,3)),m.addAttribute("indices",new THREE.BufferAttribute(s,1)),m.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*n),3)),i.geometry=m,i.loaded=!0,Potree.PointCloudArena4DGeometryNode.nodesLoading--,m.boundingBox=i.boundingBox,m.boundingSphere=i.boundingSphere,i.numPoints=n,i.loading=!1}},t.send(null)}},Potree.PointCloudArena4DGeometryNode.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose(),this.geometry=null,this.loaded=!1;for(var e=0;e<this.oneTimeDisposeHandlers.length;e++){(0,this.oneTimeDisposeHandlers[e])()}this.oneTimeDisposeHandlers=[]}},Potree.PointCloudArena4DGeometryNode.prototype.getNumPoints=function(){return this.numPoints},(Potree.PointCloudArena4DGeometry=function(){this.numPoints=0,this.version=0,this.boundingBox=null,this.numNodes=0,this.name=null,this.provider=null,this.url=null,this.root=null,this.levels=0,this._spacing=null,this.pointAttributes=new Potree.PointAttributes(["POSITION_CARTESIAN","COLOR_PACKED"])}).prototype=Object.create(THREE.EventDispatcher.prototype),Potree.PointCloudArena4DGeometry.load=function(e,t){var i=new XMLHttpRequest;i.open("GET",e+"?info",!0),i.onreadystatechange=function(){try{if(4===i.readyState&&200===i.status){var r=JSON.parse(i.responseText),n=new Potree.PointCloudArena4DGeometry;n.url=e,n.name=r.Name,n.provider=r.Provider,n.numNodes=r.Nodes,n.numPoints=r.Points,n.version=r.Version,n.boundingBox=new THREE.Box3((new THREE.Vector3).fromArray(r.BoundingBox.slice(0,3)),(new THREE.Vector3).fromArray(r.BoundingBox.slice(3,6))),r.Spacing&&(n.spacing=r.Spacing);var o=n.boundingBox.min.clone().multiplyScalar(-1);n.boundingBox.min.add(o),n.boundingBox.max.add(o),n.offset=o;var a=n.boundingBox.getCenter(),s=n.boundingBox.getSize().length()/2;n.boundingSphere=new THREE.Sphere(a,s),n.loadHierarchy(),t(n)}else 4===i.readyState&&t(null)}catch(e){console.error(e.message),t(null)}},i.send(null)},Potree.PointCloudArena4DGeometry.prototype.loadHierarchy=function(){var e=this.url+"?tree",t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer";var i=this;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){for(var e=t.response,r=e.byteLength/3,n=new DataView(e),o=[],a=null,s=0,l=(new Date).getTime(),c=0;c<r;c++){var u=n.getUint8(3*c+0,!0),h=(n.getUint16(3*c+1,!0),(1&u)>0),d=(2&u)>0,p=null;(4&u)>0?p="X":(8&u)>0&&(p="Y"),(16&u)>0&&(p="Z");var f=new Potree.PointCloudArena4DGeometryNode;if(f.hasLeft=h,f.hasRight=d,f.split=p,f.isLeaf=!h&&!d,f.number=c,f.left=null,f.right=null,f.pcoGeometry=i,f.level=o.length,s=Math.max(s,f.level),o.length>0){var m=o[o.length-1];f.boundingBox=m.boundingBox.clone();var g=m.boundingBox.getSize();if(m.hasLeft&&!m.left){m.left=f,m.children.push(f),"X"===m.split?f.boundingBox.max.x=f.boundingBox.min.x+g.x/2:"Y"===m.split?f.boundingBox.max.y=f.boundingBox.min.y+g.y/2:"Z"===m.split&&(f.boundingBox.max.z=f.boundingBox.min.z+g.z/2);var v=f.boundingBox.getCenter(),y=f.boundingBox.getSize().length()/2;f.boundingSphere=new THREE.Sphere(v,y)}else{m.right=f,m.children.push(f),"X"===m.split?f.boundingBox.min.x=f.boundingBox.min.x+g.x/2:"Y"===m.split?f.boundingBox.min.y=f.boundingBox.min.y+g.y/2:"Z"===m.split&&(f.boundingBox.min.z=f.boundingBox.min.z+g.z/2);v=f.boundingBox.getCenter(),y=f.boundingBox.getSize().length()/2;f.boundingSphere=new THREE.Sphere(v,y)}}else{(a=f).boundingBox=i.boundingBox.clone();v=a.boundingBox.getCenter(),y=a.boundingBox.getSize().length()/2;a.boundingSphere=new THREE.Sphere(v,y)}var b=f.boundingBox.getSize();if(f.spacing=(b.x+b.y+b.z)/3/75,o.push(f),f.isLeaf)for(var x=!1;!x&&o.length>0;){o.pop();var w=o[o.length-1];x=o.length>0&&w.hasRight&&null==w.right}}(new Date).getTime();i.root=a,i.levels=s,i.dispatchEvent({type:"hierarchy_loaded"})}},t.send(null)},Object.defineProperty(Potree.PointCloudArena4DGeometry.prototype,"spacing",{get:function(){return this._spacing?this._spacing:this.root?this.root.spacing:void 0},set:function(e){this._spacing=e}}),ProgressBar.prototype.hide=function(){this.element.style.opacity=0,this.element.style.transition="all 0.2s ease"},ProgressBar.prototype.show=function(){this.element.style.opacity=this.maxOpacity,this.element.style.transition="all 0.2s ease"},Object.defineProperty(ProgressBar.prototype,"progress",{get:function(){return this._progress},set:function(e){this._progress=e,this.elProgress.style.width=100*e+"%"}}),Object.defineProperty(ProgressBar.prototype,"message",{get:function(){return this._message},set:function(e){this._message=e,this.elProgressMessage.innerHTML=e}});n=function(e){e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(window.location.href);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null};Potree.View=class{constructor(){this.position=new THREE.Vector3(0,0,0),this.yaw=Math.PI/4,this._pitch=-Math.PI/4,this.radius=1,this.maxPitch=Math.PI/2,this.minPitch=-Math.PI/2,this.navigationMode=Potree.OrbitControls}clone(){let e=new Potree.View;return e.yaw=this.yaw,e._pitch=this.pitch,e.radius=this.radius,e.maxPitch=this.maxPitch,e.minPitch=this.minPitch,e.navigationMode=this.navigationMode,e}get pitch(){return this._pitch}set pitch(e){this._pitch=Math.max(Math.min(e,this.maxPitch),this.minPitch)}get direction(){let e=new THREE.Vector3(0,1,0);return e.applyAxisAngle(new THREE.Vector3(1,0,0),this.pitch),e.applyAxisAngle(new THREE.Vector3(0,0,1),this.yaw),e}set direction(e){let t=Math.atan2(e.y,e.x)-Math.PI/2,i=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y));this.yaw=t,this.pitch=i}lookAt(e){let t=(new THREE.Vector3).subVectors(e,this.position),i=t.length(),r=t.normalize();this.radius=i,this.direction=r}getPivot(){return(new THREE.Vector3).addVectors(this.position,this.direction.multiplyScalar(this.radius))}getSide(){let e=new THREE.Vector3(1,0,0);return e.applyAxisAngle(new THREE.Vector3(0,0,1),this.yaw),e}pan(e,t){let i=new THREE.Vector3(0,1,0);i.applyAxisAngle(new THREE.Vector3(1,0,0),this.pitch),i.applyAxisAngle(new THREE.Vector3(0,0,1),this.yaw);let r=this.getSide(),n=r.clone().cross(i),o=r.multiplyScalar(e).add(n.multiplyScalar(t));this.position=this.position.add(o)}translate(e,t,i){let r=new THREE.Vector3(0,1,0);r.applyAxisAngle(new THREE.Vector3(1,0,0),this.pitch),r.applyAxisAngle(new THREE.Vector3(0,0,1),this.yaw);let n=new THREE.Vector3(1,0,0);n.applyAxisAngle(new THREE.Vector3(0,0,1),this.yaw);let o=n.clone().cross(r),a=n.multiplyScalar(e).add(r.multiplyScalar(t)).add(o.multiplyScalar(i));this.position=this.position.add(a)}translateWorld(e,t,i){this.position.x+=e,this.position.y+=t,this.position.z+=i}},Potree.Scene=class extends THREE.EventDispatcher{constructor(){super(),this.annotations=[],this.scene=new THREE.Scene,this.scenePointCloud=new THREE.Scene,this.sceneBG=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(this.fov,1,.1,1e6),this.cameraBG=new THREE.Camera,this.pointclouds=[],this.referenceFrame,this.measurements=[],this.profiles=[],this.volumes=[],this.fpControls,this.orbitControls,this.earthControls,this.geoControls,this.inputHandler,this.view=new Potree.View,this.directionalLight=null,this.initialize()}addPointCloud(e){this.pointclouds.push(e),this.scenePointCloud.add(e),this.dispatchEvent({type:"pointcloud_added",pointcloud:e})}addVolume(e){this.volumes.push(e),this.dispatchEvent({type:"volume_added",scene:this,volume:e})}removeVolume(e){let t=this.volumes.indexOf(e);t>-1&&(this.volumes.splice(t,1),this.dispatchEvent({type:"volume_removed",scene:this,volume:e}))}addMeasurement(e){this.measurements.push(e),this.dispatchEvent({type:"measurement_added",scene:this,measurement:e})}removeMeasurement(e){let t=this.measurements.indexOf(e);t>-1&&(this.measurements.splice(t,1),this.dispatchEvent({type:"measurement_removed",scene:this,measurement:e}))}addProfile(e){this.profiles.push(e),this.dispatchEvent({type:"profile_added",scene:this,profile:e})}removeProfile(e){let t=this.profiles.indexOf(e);t>-1&&(this.profiles.splice(t,1),this.dispatchEvent({type:"profile_removed",scene:this,profile:e}))}removeAllMeasurements(){for(;this.measurements.length>0;)this.removeMeasurement(this.measurements[0]);for(;this.profiles.length>0;)this.removeProfile(this.profiles[0])}initialize(){this.referenceFrame=new THREE.Object3D,this.referenceFrame.matrixAutoUpdate=!1,this.scenePointCloud.add(this.referenceFrame),this.camera.up.set(0,0,1),this.camera.position.set(1e3,1e3,1e3),this.directionalLight=new THREE.DirectionalLight(16777215,.5),this.directionalLight.position.set(10,10,10),this.directionalLight.lookAt(new THREE.Vector3(0,0,0)),this.scenePointCloud.add(this.directionalLight);var e=new THREE.AmbientLight(5592405);this.scenePointCloud.add(e);let t=Potree.utils.createGrid(5,5,2);this.scene.add(t);{let e=Potree.utils.createBackgroundTexture(512,512);e.minFilter=e.magFilter=THREE.NearestFilter,e.minFilter=e.magFilter=THREE.LinearFilter;let t=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2,0),new THREE.MeshBasicMaterial({map:e}));t.material.depthTest=!1,t.material.depthWrite=!1,this.sceneBG.add(t)}{let e=new THREE.DirectionalLight(16777215);e.position.set(10,10,1),e.target.position.set(0,0,0),this.scene.add(e)}{let e=new THREE.DirectionalLight(16777215);e.position.set(-10,10,1),e.target.position.set(0,0,0),this.scene.add(e)}{let e=new THREE.DirectionalLight(16777215);e.position.set(0,-10,20),e.target.position.set(0,0,0),this.scene.add(e)}}addAnnotation(e,t={}){e instanceof Array?t.position=(new THREE.Vector3).fromArray(e):e instanceof THREE.Vector3&&(t.position=e),t.cameraTarget||(t.cameraTarget=e);var i=new Potree.Annotation(this,t);return this.annotations.push(i),this.dispatchEvent({type:"annotation_added",scene:this,annotation:i}),i}getAnnotations(){return this.annotations}};(Potree.Viewer=class extends THREE.EventDispatcher{constructor(e,t){super();var i=t||{};this.pointCloudLoadedCallback=i.onPointCloudLoaded||function(){},this.renderArea=e,this.fov=60,this.pointSize=1,this.minPointSize=1,this.maxPointSize=50,this.opacity=1,this.sizeType="Fixed",this.pointSizeType=Potree.PointSizeType.FIXED,this.pointColorType=null,this.clipMode=Potree.ClipMode.HIGHLIGHT_INSIDE,this.quality="Squares",this.isFlipYZ=!1,this.useDEMCollisions=!1,this.minNodeSize=100,this.directionalLight,this.edlStrength=1,this.edlRadius=1.4,this.useEDL=!1,this.intensityMax=null,this.heightMin=0,this.heightMax=1,this.materialTransition=.5,this.weightRGB=1,this.weightIntensity=0,this.weightElevation=0,this.weightClassification=0,this.weightReturnNumber=0,this.weightSourceID=0,this.intensityRange=[0,65e3],this.intensityGamma=1,this.intensityContrast=0,this.intensityBrightness=0,this.rgbGamma=1,this.rgbContrast=0,this.rgbBrightness=0,this.moveSpeed=10,this.showDebugInfos=!1,this.showStats=!1,this.showBoundingBox=!1,this.freeze=!1,this.mapView,this.progressBar=new ProgressBar,this.stats=new Stats,this.potreeRenderer=null,this.highQualityRenderer=null,this.edlRenderer=null,this.renderer=null,this.scene=null,this.inputHandler=null,this.measuringTool=null,this.profileTool=null,this.volumeTool=null,this.transformationTool=null,this.skybox=null,this.clock=new THREE.Clock,this.background=null,this.renderingStopped=!1,this.initThree();let r=new Potree.Scene(this.renderer);this.setScene(r);{this.inputHandler=new Potree.InputHandler(this),this.inputHandler.setScene(this.scene),this.measuringTool=new Potree.MeasuringTool(this),this.profileTool=new Potree.ProfileTool(this),this.volumeTool=new Potree.VolumeTool(this),this.transformationTool=new Potree.TransformationTool(this),this.createControls(),this.measuringTool.setScene(this.scene),this.profileTool.setScene(this.scene),this.volumeTool.setScene(this.scene);let e=e=>{if(this.updateHeightRange(),1===this.scene.pointclouds.length){let t=e.pointcloud.boundingBox.getSize().length();t/=5,this.setMoveSpeed(t)}};this.addEventListener("scene_changed",t=>{this.inputHandler.setScene(t.scene),this.measuringTool.setScene(t.scene),this.profileTool.setScene(t.scene),this.volumeTool.setScene(t.scene),this.updateHeightRange(),t.scene.hasEventListener("pointcloud_added",e)||t.scene.addEventListener("pointcloud_added",e)}),this.scene.addEventListener("pointcloud_added",e)}this.setPointSize(1),this.setFOV(60),this.setOpacity(1),this.setEDLEnabled(!1),this.setEDLRadius(1.4),this.setEDLStrength(1),this.setClipMode(Potree.ClipMode.HIGHLIGHT_INSIDE),this.setPointBudget(1e6),this.setShowBoundingBox(!1),this.setFreeze(!1),this.setNavigationMode(Potree.OrbitControls),this.setBackground("gradient"),this.scaleFactor=1,this.loadSettingsFromURL(),requestAnimationFrame(this.loop.bind(this))}setScene(e){if(e===this.scene)return;let t=e;this.scene=e,this.dispatchEvent({type:"scene_changed",oldScene:t,scene:e}),$(".annotation").detach();for(let e of this.scene.annotations)this.renderArea.appendChild(e.domElement);this.scene.addEventListener("annotation_added",e=>{e.scene===this.scene&&this.renderArea.appendChild(e.annotation.domElement),e.annotation.addEventListener("focusing_finished",e=>{let t=this.scene.view.position.distanceTo(this.scene.view.getPivot());this.setMoveSpeed(Math.pow(t,.4)),this.renderer.domElement.focus()})})}getControls(e){return e===Potree.OrbitControls?this.orbitControls:e===Potree.FirstPersonControls?this.fpControls:e===Potree.EarthControls?this.earthControls:null}getMinNodeSize(){return this.minNodeSize}setMinNodeSize(e){this.minNodeSize!==e&&(this.minNodeSize=e,this.dispatchEvent({type:"minnodesize_changed",viewer:this}))}getBackground(){return this.background}setBackground(e){this.background!==e&&(this.background=e,this.dispatchEvent({type:"background_changed",viewer:this}))}setDescription(e){$("#potree_description")[0].innerHTML=e}setNavigationMode(e){this.scene.view.navigationMode=e}setShowBoundingBox(e){this.showBoundingBox!==e&&(this.showBoundingBox=e,this.dispatchEvent({type:"show_boundingbox_changed",viewer:this}))}getShowBoundingBox(){return showBoundingBox}setMoveSpeed(e){this.moveSpeed!==e&&(this.moveSpeed=e,this.dispatchEvent({type:"move_speed_changed",viewer:this,speed:e}))}getMoveSpeed(){return this.moveSpeed}setHeightRange(e,t){this.heightMin===e&&this.heightMax===t||(this.heightMin=e||this.heightMin,this.heightMax=t||this.heightMax,this.dispatchEvent({type:"height_range_changed",viewer:this}))}getHeightRange(){return{min:this.heightMin,max:this.heightMax}}getElevationRange(){return this.getHeightRange()}setElevationRange(e,t){this.setHeightRange(e,t)}setIntensityRange(e,t){this.intensityRange[0]===e&&this.intensityRange[1]===t||(this.intensityRange[0]=e||this.intensityRange[0],this.intensityRange[1]=t||this.intensityRange[1],this.dispatchEvent({type:"intensity_range_changed",viewer:this}))}getIntensityRange(){return this.intensityRange}setIntensityGamma(e){this.intensityGamma!==e&&(this.intensityGamma=e,this.dispatchEvent({type:"intensity_gamma_changed",viewer:this}))}getIntensityGamma(){return this.intensityGamma}setIntensityContrast(e){this.intensityContrast!==e&&(this.intensityContrast=e,this.dispatchEvent({type:"intensity_contrast_changed",viewer:this}))}getIntensityContrast(){return this.intensityContrast}setIntensityBrightness(e){this.intensityBrightness!==e&&(this.intensityBrightness=e,this.dispatchEvent({type:"intensity_brightness_changed",viewer:this}))}getIntensityBrightness(){return this.intensityBrightness}setRGBGamma(e){this.rgbGamma!==e&&(this.rgbGamma=e,this.dispatchEvent({type:"rgb_gamma_changed",viewer:this}))}getRGBGamma(){return this.rgbGamma}setRGBContrast(e){this.rgbContrast!==e&&(this.rgbContrast=e,this.dispatchEvent({type:"rgb_contrast_changed",viewer:this}))}getRGBContrast(){return this.rgbContrast}setRGBBrightness(e){this.rgbBrightness!==e&&(this.rgbBrightness=e,this.dispatchEvent({type:"rgb_brightness_changed",viewer:this}))}getRGBBrightness(){return this.rgbBrightness}setMaterialTransition(e){this.materialTransition!==e&&(this.materialTransition=e,this.dispatchEvent({type:"material_transition_changed",viewer:this}))}getMaterialTransition(){return this.materialTransition}setWeightRGB(e){this.weightRGB!==e&&(this.weightRGB=e,this.dispatchEvent({type:"attribute_weights_changed",viewer:this}))}getWeightRGB(){return this.weightRGB}setWeightIntensity(e){this.weightIntensity!==e&&(this.weightIntensity=e,this.dispatchEvent({type:"attribute_weights_changed",viewer:this}))}getWeightIntensity(){return this.weightIntensity}setWeightElevation(e){this.weightElevation!==e&&(this.weightElevation=e,this.dispatchEvent({type:"attribute_weights_changed",viewer:this}))}getWeightElevation(){return this.weightElevation}setWeightClassification(e){this.weightClassification!==e&&(this.weightClassification=e,this.dispatchEvent({type:"attribute_weights_changed",viewer:this}))}getWeightClassification(){return this.weightClassification}setWeightReturnNumber(e){this.weightReturnNumber!==e&&(this.weightReturnNumber=e,this.dispatchEvent({type:"attribute_weights_changed",viewer:this}))}getWeightReturnNumber(){return this.weightReturnNumber}setWeightSourceID(e){this.weightSourceID!==e&&(this.weightSourceID=e,this.dispatchEvent({type:"attribute_weights_changed",viewer:this}))}getWeightSourceID(){return this.weightSourceID}setIntensityMax(e){this.intensityMax!==e&&(this.intensityMax=e,this.dispatchEvent({type:"intensity_max_changed",viewer:this}))}getIntensityMax(){return this.intensityMax}setFreeze(e){this.freeze!=e&&(this.freeze=e,this.dispatchEvent({type:"freeze_changed",viewer:this}))}getFreeze(){return this.freeze}setPointBudget(e){Potree.pointBudget!=e&&(Potree.pointBudget=parseInt(e),this.dispatchEvent({type:"point_budget_changed",viewer:this}))}getPointBudget(){return Potree.pointBudget}setClipMode(e){this.clipMode!=e&&(this.clipMode=e,this.dispatchEvent({type:"clip_mode_changed",viewer:this}))}getClipMode(){return this.clipMode}setDEMCollisionsEnabled(e){this.useDEMCollisions!==e&&(this.useDEMCollisions=e,this.dispatchEvent({type:"use_demcollisions_changed",viewer:this}))}getDEMCollisionsEnabled(){return this.useDEMCollisions}setEDLEnabled(e){this.useEDL!=e&&(this.useEDL=e,this.dispatchEvent({type:"use_edl_changed",viewer:this}))}getEDLEnabled(){return this.useEDL}setEDLRadius(e){this.edlRadius!==e&&(this.edlRadius=e,this.dispatchEvent({type:"edl_radius_changed",viewer:this}))}getEDLRadius(){return this.edlRadius}setEDLStrength(e){this.edlStrength!==e&&(this.edlStrength=e,this.dispatchEvent({type:"edl_strength_changed",viewer:this}))}getEDLStrength(){return this.edlStrength}setPointSize(e){this.pointSize!==e&&(this.pointSize=e,this.dispatchEvent({type:"point_size_changed",viewer:this}))}getPointSize(){return this.pointSize}setMinPointSize(e){this.minPointSize!==e&&(this.minPointSize=e,this.dispatchEvent({type:"min_point_size_changed",viewer:this}))}getMinPointSize(){return this.minPointSize}setMaxPointSize(e){this.maxPointSize!==e&&(this.maxPointSize=e,this.dispatchEvent({type:"max_point_size_changed",viewer:this}))}getMaxPointSize(){return this.maxPointSize}setFOV(e){this.fov!==e&&(this.fov=e,this.dispatchEvent({type:"fov_changed",viewer:this}))}getFOV(){return this.fov}setOpacity(e){this.opacity!==e&&(this.opacity=e,this.dispatchEvent({type:"opacity_changed",viewer:this}))}getOpacity(){return this.opacity}setPointSizing(e){this.sizeType!==e&&(this.sizeType=e,"Fixed"===e?this.pointSizeType=Potree.PointSizeType.FIXED:"Attenuated"===e?this.pointSizeType=Potree.PointSizeType.ATTENUATED:"Adaptive"===e&&(this.pointSizeType=Potree.PointSizeType.ADAPTIVE),this.dispatchEvent({type:"point_sizing_changed",viewer:this}))}getPointSizing(){return this.sizeType}setQuality(e){var t=this.quality;("Interpolation"!=e||Potree.Features.SHADER_INTERPOLATION.isSupported())&&("Splats"!=e||Potree.Features.SHADER_SPLATS.isSupported())?this.quality=e:this.quality="Squares",t!==this.quality&&this.dispatchEvent({type:"quality_changed",viewer:this})}getQuality(){return this.quality}disableAnnotations(){for(var e=0;e<this.scene.annotations.length;e++){this.scene.annotations[e].domElement.style.pointerEvents="none"}}enableAnnotations(){for(var e=0;e<this.scene.annotations.length;e++){this.scene.annotations[e].domElement.style.pointerEvents="auto"}}setClassificationVisibility(e,t){for(var i=!1,r=0;r<this.scene.pointclouds.length;r++){var n=this.scene.pointclouds[r],o=n.material.classification,a=o[e].w;o[e].w=t?1:0,a!==o[e].w&&(i=!0),n.material.classification=o}i&&this.dispatchEvent({type:"classification_visibility_changed",viewer:this})}setMaterial(e){this.pointColorType!==this.toMaterialID(e)&&(this.pointColorType=this.toMaterialID(e),this.dispatchEvent({type:"material_changed",viewer:this}))}setMaterialID(e){this.pointColorType!==e&&(this.pointColorType=e,this.dispatchEvent({type:"material_changed",viewer:this}))}getMaterial(){return this.pointColorType}getMaterialName(){return this.toMaterialName(this.pointColorType)}toMaterialID(e){return"RGB"===e?Potree.PointColorType.RGB:"Color"===e?Potree.PointColorType.COLOR:"Elevation"===e?Potree.PointColorType.HEIGHT:"Intensity"===e?Potree.PointColorType.INTENSITY:"Intensity Gradient"===e?Potree.PointColorType.INTENSITY_GRADIENT:"Classification"===e?Potree.PointColorType.CLASSIFICATION:"Return Number"===e?Potree.PointColorType.RETURN_NUMBER:"Source"===e?Potree.PointColorType.SOURCE:"Level of Detail"===e?Potree.PointColorType.LOD:"Point Index"===e?Potree.PointColorType.POINT_INDEX:"Normal"===e?Potree.PointColorType.NORMAL:"Phong"===e?Potree.PointColorType.PHONG:"RGB and Elevation"===e?Potree.PointColorType.RGB_HEIGHT:"Composite"===e?Potree.PointColorType.COMPOSITE:void 0}toMaterialName(e){return e===Potree.PointColorType.RGB?"RGB":e===Potree.PointColorType.COLOR?"Color":e===Potree.PointColorType.HEIGHT?"Elevation":e===Potree.PointColorType.INTENSITY?"Intensity":e===Potree.PointColorType.INTENSITY_GRADIENT?"Intensity Gradient":e===Potree.PointColorType.CLASSIFICATION?"Classification":e===Potree.PointColorType.RETURN_NUMBER?"Return Number":e===Potree.PointColorType.SOURCE?"Source":e===Potree.PointColorType.LOD?"Level of Detail":e===Potree.PointColorType.POINT_INDEX?"Point Index":e===Potree.PointColorType.NORMAL?"Normal":e===Potree.PointColorType.PHONG?"Phong":e===Potree.PointColorType.RGB_HEIGHT?"RGB and Elevation":e===Potree.PointColorType.COMPOSITE?"Composite":void 0}zoomTo(e,t){let i=this.scene.view,r=this.scene.camera.clone();r.position.copy(i.position),r.lookAt(i.getPivot()),r.updateMatrixWorld(),r.zoomTo(e,t);var n;n=(n=e.boundingSphere?e.boundingSphere:e.geometry&&e.geometry.boundingSphere?e.geometry.boundingSphere:e.boundingBox.getBoundingSphere()).clone().applyMatrix4(e.matrixWorld),i.position.copy(r.position),i.radius=i.position.distanceTo(n.center),this.dispatchEvent({type:"zoom_to",viewer:this})}showAbout(){$(function(){$("#about-panel").dialog()})}getBoundingBox(e){e=e||this.scene.pointclouds;var t=new THREE.Box3;this.scene.scenePointCloud.updateMatrixWorld(!0),this.scene.referenceFrame.updateMatrixWorld(!0);for(var i=0;i<this.scene.pointclouds.length;i++){var r=this.scene.pointclouds[i];r.updateMatrixWorld(!0);let e=r.pcoGeometry.tightBoundingBox?r.pcoGeometry.tightBoundingBox:r.boundingBox;var n=Potree.utils.computeTransformedBoundingBox(e,r.matrixWorld);t.union(n)}return t}fitToScreen(e=1){var t=this.getBoundingBox(this.scene.pointclouds),i=new THREE.Object3D;i.boundingBox=t,this.zoomTo(i,e)}setTopView(){this.scene.view.yaw=0,this.scene.view.pitch=-Math.PI/2,this.fitToScreen()}setFrontView(){this.scene.view.yaw=0,this.scene.view.pitch=0,this.fitToScreen()}setLeftView(){this.scene.view.yaw=-Math.PI/2,this.scene.view.pitch=0,this.fitToScreen()}setRightView(){this.scene.view.yaw=Math.PI/2,this.scene.view.pitch=0,this.fitToScreen()}flipYZ(){this.isFlipYZ=!this.isFlipYZ,console.log("TODO")}updateHeightRange(){var e=this.getBoundingBox();this.setHeightRange(e.min.z,e.max.z)}loadSettingsFromURL(){if(Potree.utils.getParameterByName("pointSize")&&this.setPointSize(parseFloat(Potree.utils.getParameterByName("pointSize"))),Potree.utils.getParameterByName("FOV")&&this.setFOV(parseFloat(Potree.utils.getParameterByName("FOV"))),Potree.utils.getParameterByName("opacity")&&this.setOpacity(parseFloat(Potree.utils.getParameterByName("opacity"))),Potree.utils.getParameterByName("edlEnabled")){var e="true"===Potree.utils.getParameterByName("edlEnabled");this.setEDLEnabled(e)}if(Potree.utils.getParameterByName("edlRadius")&&this.setEDLRadius(parseFloat(Potree.utils.getParameterByName("edlRadius"))),Potree.utils.getParameterByName("edlStrength")&&this.setEDLStrength(parseFloat(Potree.utils.getParameterByName("edlStrength"))),Potree.utils.getParameterByName("clipMode")){var t=Potree.utils.getParameterByName("clipMode");"HIGHLIGHT_INSIDE"===t?this.setClipMode(Potree.ClipMode.HIGHLIGHT_INSIDE):"CLIP_OUTSIDE"===t?this.setClipMode(Potree.ClipMode.CLIP_OUTSIDE):"DISABLED"===t&&this.setClipMode(Potree.ClipMode.DISABLED)}if(Potree.utils.getParameterByName("pointBudget")&&this.setPointBudget(parseFloat(Potree.utils.getParameterByName("pointBudget"))),Potree.utils.getParameterByName("showBoundingBox")){(e="true"===Potree.utils.getParameterByName("showBoundingBox"))?this.setShowBoundingBox(!0):this.setShowBoundingBox(!1)}if(Potree.utils.getParameterByName("material")){var i=Potree.utils.getParameterByName("material");this.setMaterial(i)}if(Potree.utils.getParameterByName("pointSizing")){var r=Potree.utils.getParameterByName("pointSizing");this.setPointSizing(r)}if(Potree.utils.getParameterByName("quality")){var n=Potree.utils.getParameterByName("quality");this.setQuality(n)}if(Potree.utils.getParameterByName("position")){let e=Potree.utils.getParameterByName("position"),t=(e=e.replace("[","").replace("]","")).split(";"),i=parseFloat(t[0]),r=parseFloat(t[1]),n=parseFloat(t[2]);this.scene.view.position.set(i,r,n)}if(Potree.utils.getParameterByName("target")){let e=Potree.utils.getParameterByName("target"),t=(e=e.replace("[","").replace("]","")).split(";"),i=parseFloat(t[0]),r=parseFloat(t[1]),n=parseFloat(t[2]);this.scene.view.lookAt(new THREE.Vector3(i,r,n))}if(Potree.utils.getParameterByName("background")){let e=Potree.utils.getParameterByName("background");this.setBackground(e)}}createControls(){this.fpControls=new Potree.FirstPersonControls(this),this.fpControls.enabled=!1,this.fpControls.addEventListener("start",this.disableAnnotations.bind(this)),this.fpControls.addEventListener("end",this.enableAnnotations.bind(this)),this.orbitControls=new Potree.OrbitControls(this),this.orbitControls.enabled=!1,this.orbitControls.addEventListener("start",this.disableAnnotations.bind(this)),this.orbitControls.addEventListener("end",this.enableAnnotations.bind(this)),this.earthControls=new Potree.EarthControls(this),this.earthControls.enabled=!1,this.earthControls.addEventListener("start",this.disableAnnotations.bind(this)),this.earthControls.addEventListener("end",this.enableAnnotations.bind(this))}toggleSidebar(){var e=$("#potree_render_area");$("#potree_sidebar_container");"0px"!==e.css("left")?e.css("left","0px"):e.css("left","300px")}toggleMap(){$("#potree_map").toggle(100)}loadGUI(e,t){var i=$("#potree_sidebar_container");t=t||Potree.scriptPath,i.load(new URL(Potree.scriptPath+"/sidebar.html").href,()=>{i.css("width","300px"),i.css("height","100%");var t=document.createElement("img");t.src=new URL(Potree.resourcePath+"/icons/menu_button.svg").href,t.onclick=this.toggleSidebar,t.classList.add("potree_menu_toggle");var r=document.createElement("img");r.src=new URL(Potree.resourcePath+"/icons/map_icon.png").href,r.style.display="none",r.onclick=this.toggleMap,r.id="potree_map_toggle",viewer.renderArea.insertBefore(r,viewer.renderArea.children[0]),viewer.renderArea.insertBefore(t,viewer.renderArea.children[0]),this.mapView=new Potree.MapView(this),this.mapView.init(),i18n.init({lng:"en",resGetPath:Potree.resourcePath+"/lang/__lng__/__ns__.json",preload:["en","fr","de"],getAsync:!0,debug:!1},function(e){$("body").i18n()}),$(function(){c()});let n=$("<div>").load(new URL(Potree.scriptPath+"/profile.html").href,()=>{$("#potree_render_area").append(n.children()),this._2dprofile=new Potree.Viewer.Profile(this,document.getElementById("profile_draw_container")),e&&$(e)})})}setLanguage(e){i18n.setLng(e),$("body").i18n()}initThree(){let e=this.renderArea.clientWidth,t=this.renderArea.clientHeight;this.renderer=new THREE.WebGLRenderer({premultipliedAlpha:!1}),this.renderer.setSize(e,t),this.renderer.autoClear=!1,this.renderArea.appendChild(this.renderer.domElement),this.renderer.domElement.tabIndex="2222",this.renderer.domElement.addEventListener("mousedown",function(){this.renderer.domElement.focus()}.bind(this)),this.skybox=Potree.utils.loadSkybox(new URL(Potree.resourcePath+"/textures/skybox2/").href),this.renderer.context.getExtension("EXT_frag_depth")}update(e,t){let i=this.scene,r=this.scene.camera;Potree.pointLoadLimit=2*Potree.pointBudget,this.scene.directionalLight.position.copy(r.position),this.scene.directionalLight.lookAt((new THREE.Vector3).addVectors(r.position,r.getWorldDirection()));for(var n=0;n<this.scene.pointclouds.length;n++){var o=this.scene.pointclouds[n];Potree.utils.computeTransformedBoundingBox(o.boundingBox,o.matrixWorld);if(!this.intensityMax){var a=o.pcoGeometry.root;if(null!=a&&a.loaded){var s=o.pcoGeometry.root.geometry.attributes;if(s.intensity){for(var l=s.intensity.array,c=[],u=0;u<l.length;u++)c.push(l[u]);c.sort();var h=c[parseInt(.75*(c.length-1))];this.intensityMax=h<=1?1:h<=256?255:h}}}o.material.clipMode=this.clipMode,o.material.heightMin=this.heightMin,o.material.heightMax=this.heightMax,o.material.uniforms.intensityRange.value=this.getIntensityRange(),o.material.uniforms.intensityGamma.value=this.getIntensityGamma(),o.material.uniforms.intensityContrast.value=this.getIntensityContrast(),o.material.uniforms.intensityBrightness.value=this.getIntensityBrightness(),o.material.uniforms.rgbGamma.value=this.getRGBGamma(),o.material.uniforms.rgbContrast.value=this.getRGBContrast(),o.material.uniforms.rgbBrightness.value=this.getRGBBrightness(),o.showBoundingBox=this.showBoundingBox,o.generateDEM=this.useDEMCollisions,o.minimumNodePixelSize=this.minNodeSize,o.material.uniforms.transition.value=this.materialTransition,o.material.uniforms.wRGB.value=this.getWeightRGB(),o.material.uniforms.wIntensity.value=this.getWeightIntensity(),o.material.uniforms.wElevation.value=this.getWeightElevation(),o.material.uniforms.wClassification.value=this.getWeightClassification(),o.material.uniforms.wReturnNumber.value=this.getWeightReturnNumber(),o.material.uniforms.wSourceID.value=this.getWeightSourceID(),o.numVisibleNodes,o.numVisiblePoints,o.progress}if(!this.freeze){var d=Potree.updatePointClouds(i.pointclouds,r,this.renderer);d.visibleNodes.length,d.numVisiblePoints,r.near=10*d.lowestSpacing,r.far=-this.getBoundingBox().applyMatrix4(r.matrixWorldInverse).min.z,r.far=Math.max(1.5*r.far,1e3)}r.fov=this.fov,this.getControls(i.view.navigationMode)!==this.controls&&(this.controls&&(this.controls.enabled=!1,this.inputHandler.removeInputListener(this.controls)),this.controls=this.getControls(i.view.navigationMode),this.controls.enabled=!0,this.inputHandler.addInputListener(this.controls)),null!==this.controls&&(this.controls.setScene(i),this.controls.update(e),r.position.copy(i.view.position),r.rotation.order="ZXY",r.rotation.x=Math.PI/2+this.scene.view.pitch,r.rotation.z=this.scene.view.yaw);{let e=this.scene.volumes.filter(e=>e.clip);for(let t of this.scene.profiles)e=e.concat(t.boxes);let t=e.map(e=>{e.updateMatrixWorld();return{inverse:(new THREE.Matrix4).getInverse(e.matrixWorld),position:e.getWorldPosition()}});for(let e of this.scene.pointclouds)e.material.setClipBoxes(t)}var p=[];for(let e of this.scene.annotations){var f=e.position.clone().project(this.scene.camera);f.x=this.renderArea.clientWidth*(f.x+1)/2,f.y=this.renderArea.clientHeight*(1-(f.y+1)/2),e.domElement.style.left=Math.floor(f.x-e.domElement.clientWidth/2)+"px",e.domElement.style.top=Math.floor(f.y-e.elOrdinal.clientHeight/2)+"px",p.push({annotation:e,distance:f.z}),-1>f.z||f.z>1?e.domElement.style.display="none":e.domElement.style.display="initial"}p.sort(function(e,t){return t.distance-e.distance});for(n=0;n<p.length;n++){var m=p[n].annotation;m.domElement.style.zIndex=""+n,m.descriptionVisible&&(m.domElement.style.zIndex+=100)}this.showDebugInfos&&this.infos.set("camera.position","camera.position: "+this.scene.camera.position.x.toFixed(2)+", "+this.scene.camera.position.y.toFixed(2)+", "+this.scene.camera.position.z.toFixed(2)),this.mapView&&(this.mapView.update(e,this.scene.camera),this.mapView.sceneProjection&&$("#potree_map_toggle").css("display","block")),TWEEN.update(t),this.dispatchEvent({type:"update",delta:e,timestamp:t})}loop(e){if(this.renderingStopped)return;requestAnimationFrame(this.loop.bind(this)),this.stats.begin(),this.update(this.clock.getDelta(),e);let t=Potree.startQuery("All",viewer.renderer.getContext());this.useEDL&&Potree.Features.SHADER_EDL.isSupported()?(this.edlRenderer||(this.edlRenderer=new class{constructor(e){this.viewer=e,this.edlMaterial=null,this.attributeMaterials=[],this.rtColor=null,this.gl=e.renderer.context}initEDL(){null==this.edlMaterial&&(this.edlMaterial=new Potree.EyeDomeLightingMaterial,this.rtColor=new THREE.WebGLRenderTarget(1024,1024,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType}),this.rtColor.depthTexture=new THREE.DepthTexture,this.rtColor.depthTexture.type=THREE.UnsignedIntType)}resize(){let e=viewer.scaleFactor*viewer.renderArea.clientWidth,t=viewer.scaleFactor*viewer.renderArea.clientHeight,i=e/t;var r=this.rtColor.width!=e||this.rtColor.height!=t;r&&this.rtColor.dispose(),viewer.scene.camera.aspect=i,viewer.scene.camera.updateProjectionMatrix(),viewer.renderer.setSize(e,t),this.rtColor.setSize(e,t)}render(){this.initEDL(),this.resize(),"skybox"===viewer.background?(viewer.renderer.clear(),viewer.skybox.camera.rotation.copy(viewer.scene.camera.rotation),viewer.skybox.camera.fov=viewer.scene.camera.fov,viewer.skybox.camera.aspect=viewer.scene.camera.aspect,viewer.skybox.camera.updateProjectionMatrix(),viewer.renderer.render(viewer.skybox.scene,viewer.skybox.camera)):"gradient"===viewer.background?(viewer.renderer.clear(),viewer.renderer.render(viewer.scene.sceneBG,viewer.scene.cameraBG)):"black"===viewer.background?(viewer.renderer.setClearColor(0,0),viewer.renderer.clear()):"white"===viewer.background&&(viewer.renderer.setClearColor(16777215,0),viewer.renderer.clear()),viewer.renderer.render(viewer.scene.scene,viewer.scene.camera),viewer.renderer.clearTarget(this.rtColor,!0,!0,!0);for(var e=[],t=0;t<viewer.scene.pointclouds.length;t++){var i=viewer.scene.pointclouds[t],r=viewer.renderArea.clientWidth,n=viewer.renderArea.clientHeight;if(this.attributeMaterials.length<=t){var o=new Potree.PointCloudMaterial;o.pointShape=Potree.PointShape.CIRCLE,o.interpolate="Interpolation"===viewer.quality,o.weighted=!1,o.minSize=viewer.minPointSize,o.maxSize=viewer.maxPointSize,o.useLogarithmicDepthBuffer=!1,o.useEDL=!0,this.attributeMaterials.push(o)}var o=this.attributeMaterials[t],a=i.pcoGeometry.boundingBox.getSize().x;e.push(i.material),(o=i.material).pointShape=Potree.PointShape.CIRCLE,o.interpolate="Interpolation"===viewer.quality,o.weighted=!1,o.minSize=viewer.minPointSize,o.maxSize=viewer.maxPointSize,o.useLogarithmicDepthBuffer=!1,o.useEDL=!0,o.size=viewer.pointSize,o.pointSizeType=viewer.pointSizeType,o.screenWidth=r,o.screenHeight=n,o.pointColorType=viewer.pointColorType,o.uniforms.visibleNodes.value=i.material.visibleNodesTexture,o.uniforms.octreeSize.value=a,o.fov=viewer.scene.camera.fov*(Math.PI/180),o.spacing=i.pcoGeometry.spacing*Math.max(i.scale.x,i.scale.y,i.scale.z),o.near=viewer.scene.camera.near,o.far=viewer.scene.camera.far,o.heightMin=viewer.heightMin,o.heightMax=viewer.heightMax,o.intensityMin=i.material.intensityMin,o.intensityMax=i.material.intensityMax,o.setClipBoxes(i.material.clipBoxes),o.clipMode=i.material.clipMode,o.bbSize=i.material.bbSize,o.treeType=i.material.treeType,o.uniforms.classificationLUT.value=i.material.uniforms.classificationLUT.value,i.material=o;for(var s=0;s<i.visibleNodes.length;s++){var l=i.visibleNodes[s];i instanceof Potree.PointCloudOctree?l.sceneNode.material=o:i instanceof Potree.PointCloudArena4D&&(l.material=o)}}viewer.renderer.render(viewer.scene.scenePointCloud,viewer.scene.camera,this.rtColor),viewer.renderer.render(viewer.scene.scene,viewer.scene.camera,this.rtColor);for(var t=0;t<viewer.scene.pointclouds.length;t++){var i=viewer.scene.pointclouds[t],c=e[t];i.material=c;for(var s=0;s<i.visibleNodes.length;s++){var l=i.visibleNodes[s];i instanceof Potree.PointCloudOctree?l.sceneNode.material=c:i instanceof Potree.PointCloudArena4D&&(l.material=c)}}viewer.volumeTool.update(),viewer.renderer.render(viewer.volumeTool.sceneVolume,viewer.scene.camera,this.rtColor),viewer.scene.pointclouds.length>0&&(this.edlMaterial.uniforms.screenWidth.value=r,this.edlMaterial.uniforms.screenHeight.value=n,this.edlMaterial.uniforms.colorMap.value=this.rtColor,this.edlMaterial.uniforms.edlStrength.value=viewer.edlStrength,this.edlMaterial.uniforms.radius.value=viewer.edlRadius,this.edlMaterial.uniforms.opacity.value=viewer.opacity,this.edlMaterial.depthTest=!0,this.edlMaterial.depthWrite=!0,this.edlMaterial.transparent=!0,Potree.utils.screenPass.render(viewer.renderer,this.edlMaterial),viewer.renderer.clearDepth(),viewer.renderer.render(viewer.controls.sceneControls,viewer.scene.camera),viewer.measuringTool.update(),viewer.profileTool.update(),viewer.transformationTool.update(),viewer.renderer.render(viewer.measuringTool.sceneMeasurement,viewer.scene.camera),viewer.renderer.render(viewer.profileTool.sceneProfile,viewer.scene.camera),viewer.renderer.render(viewer.transformationTool.sceneTransform,viewer.scene.camera))}}(this)),this.edlRenderer.render(this.renderer)):"Splats"===this.quality?(this.highQualityRenderer||(this.highQualityRenderer=new class{constructor(e){this.viewer=e,this.depthMaterial=null,this.attributeMaterial=null,this.normalizationMaterial=null,this.rtDepth,this.rtNormalize}initHQSPlats(){if(null==this.depthMaterial){this.depthMaterial=new Potree.PointCloudMaterial,this.attributeMaterial=new Potree.PointCloudMaterial,this.depthMaterial.pointColorType=Potree.PointColorType.DEPTH,this.depthMaterial.pointShape=Potree.PointShape.CIRCLE,this.depthMaterial.interpolate=!1,this.depthMaterial.weighted=!1,this.depthMaterial.minSize=viewer.minPointSize,this.depthMaterial.maxSize=viewer.maxPointSize,this.attributeMaterial.pointShape=Potree.PointShape.CIRCLE,this.attributeMaterial.interpolate=!1,this.attributeMaterial.weighted=!0,this.attributeMaterial.minSize=viewer.minPointSize,this.attributeMaterial.maxSize=viewer.maxPointSize,this.rtDepth=new THREE.WebGLRenderTarget(1024,1024,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType}),this.rtNormalize=new THREE.WebGLRenderTarget(1024,1024,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType});var e={depthMap:{type:"t",value:this.rtDepth},texture:{type:"t",value:this.rtNormalize}};this.normalizationMaterial=new THREE.ShaderMaterial({uniforms:e,vertexShader:Potree.Shaders["normalize.vs"],fragmentShader:Potree.Shaders["normalize.fs"]})}}resize(e,t){this.rtDepth.width==e&&this.rtDepth.height==t||(this.rtDepth.dispose(),this.rtNormalize.dispose(),viewer.scene.camera.aspect=e/t,viewer.scene.camera.updateProjectionMatrix(),viewer.renderer.setSize(e,t),this.rtDepth.setSize(e,t),this.rtNormalize.setSize(e,t))}render(e){var t=viewer.renderArea.clientWidth,i=viewer.renderArea.clientHeight;this.initHQSPlats(),this.resize(t,i),viewer.renderer.clear(),"skybox"===viewer.background?(viewer.renderer.clear(),viewer.skybox.camera.rotation.copy(viewer.scene.camera.rotation),viewer.skybox.camera.fov=viewer.scene.camera.fov,viewer.skybox.camera.aspect=viewer.scene.camera.aspect,viewer.skybox.camera.updateProjectionMatrix(),viewer.renderer.render(viewer.skybox.scene,viewer.skybox.camera)):"gradient"===viewer.background?(viewer.renderer.clear(),viewer.renderer.render(viewer.scene.sceneBG,viewer.scene.cameraBG)):"black"===viewer.background?(viewer.renderer.setClearColor(0,0),viewer.renderer.clear()):"white"===viewer.background&&(viewer.renderer.setClearColor(16777215,0),viewer.renderer.clear()),viewer.renderer.render(viewer.scene.scene,viewer.scene.camera);for(let e of viewer.scene.pointclouds){this.depthMaterial.uniforms.octreeSize.value=e.pcoGeometry.boundingBox.getSize().x,this.attributeMaterial.uniforms.octreeSize.value=e.pcoGeometry.boundingBox.getSize().x;let r=e.material;this.depthMaterial.size=viewer.pointSize,this.depthMaterial.pointSizeType=viewer.pointSizeType,this.depthMaterial.screenWidth=t,this.depthMaterial.screenHeight=i,this.depthMaterial.uniforms.visibleNodes.value=e.material.visibleNodesTexture,this.depthMaterial.uniforms.octreeSize.value=e.pcoGeometry.boundingBox.getSize().x,this.depthMaterial.fov=viewer.scene.camera.fov*(Math.PI/180),this.depthMaterial.spacing=e.pcoGeometry.spacing*Math.max(e.scale.x,e.scale.y,e.scale.z),this.depthMaterial.near=viewer.scene.camera.near,this.depthMaterial.far=viewer.scene.camera.far,this.depthMaterial.heightMin=viewer.heightMin,this.depthMaterial.heightMax=viewer.heightMax,this.depthMaterial.uniforms.visibleNodes.value=e.material.visibleNodesTexture,this.depthMaterial.uniforms.octreeSize.value=e.pcoGeometry.boundingBox.getSize().x,this.depthMaterial.bbSize=e.material.bbSize,this.depthMaterial.treeType=e.material.treeType,this.depthMaterial.uniforms.classificationLUT.value=e.material.uniforms.classificationLUT.value,viewer.scene.scenePointCloud.overrideMaterial=this.depthMaterial,viewer.renderer.clearTarget(this.rtDepth,!0,!0,!0),viewer.renderer.render(viewer.scene.scenePointCloud,viewer.scene.camera,this.rtDepth),viewer.scene.scenePointCloud.overrideMaterial=null,this.attributeMaterial.size=viewer.pointSize,this.attributeMaterial.pointSizeType=viewer.pointSizeType,this.attributeMaterial.screenWidth=t,this.attributeMaterial.screenHeight=i,this.attributeMaterial.pointColorType=viewer.pointColorType,this.attributeMaterial.depthMap=this.rtDepth,this.attributeMaterial.uniforms.visibleNodes.value=e.material.visibleNodesTexture,this.attributeMaterial.uniforms.octreeSize.value=e.pcoGeometry.boundingBox.getSize().x,this.attributeMaterial.fov=viewer.scene.camera.fov*(Math.PI/180),this.attributeMaterial.uniforms.blendHardness.value=e.material.uniforms.blendHardness.value,this.attributeMaterial.uniforms.blendDepthSupplement.value=e.material.uniforms.blendDepthSupplement.value,this.attributeMaterial.spacing=e.pcoGeometry.spacing*Math.max(e.scale.x,e.scale.y,e.scale.z),this.attributeMaterial.near=viewer.scene.camera.near,this.attributeMaterial.far=viewer.scene.camera.far,this.attributeMaterial.heightMin=viewer.heightMin,this.attributeMaterial.heightMax=viewer.heightMax,this.attributeMaterial.intensityMin=e.material.intensityMin,this.attributeMaterial.intensityMax=e.material.intensityMax,this.attributeMaterial.setClipBoxes(e.material.clipBoxes),this.attributeMaterial.clipMode=e.material.clipMode,this.attributeMaterial.bbSize=e.material.bbSize,this.attributeMaterial.treeType=e.material.treeType,this.attributeMaterial.uniforms.classificationLUT.value=e.material.uniforms.classificationLUT.value,viewer.scene.scenePointCloud.overrideMaterial=this.attributeMaterial,viewer.renderer.clearTarget(this.rtNormalize,!0,!0,!0),viewer.renderer.render(viewer.scene.scenePointCloud,viewer.scene.camera,this.rtNormalize),viewer.scene.scenePointCloud.overrideMaterial=null,e.material=r}viewer.scene.pointclouds.length>0&&(this.normalizationMaterial.uniforms.depthMap.value=this.rtDepth,this.normalizationMaterial.uniforms.texture.value=this.rtNormalize,Potree.utils.screenPass.render(viewer.renderer,this.normalizationMaterial),viewer.volumeTool.update(),viewer.renderer.render(viewer.volumeTool.sceneVolume,viewer.scene.camera),viewer.renderer.render(viewer.controls.sceneControls,viewer.scene.camera),viewer.renderer.clearDepth(),viewer.measuringTool.update(),viewer.profileTool.update(),viewer.transformationTool.update(),viewer.renderer.render(viewer.measuringTool.sceneMeasurement,viewer.scene.camera),viewer.renderer.render(viewer.profileTool.sceneProfile,viewer.scene.camera),viewer.renderer.render(viewer.transformationTool.sceneTransform,viewer.scene.camera))}}(this)),this.highQualityRenderer.render(this.renderer)):(this.potreeRenderer||(this.potreeRenderer=new class{constructor(e){this.viewer=e}render(){{let e=viewer.scaleFactor*viewer.renderArea.clientWidth,t=viewer.scaleFactor*viewer.renderArea.clientHeight,i=e/t;viewer.scene.camera.aspect=i,viewer.scene.camera.updateProjectionMatrix(),viewer.renderer.setSize(e,t)}"skybox"===viewer.background?(viewer.renderer.clear(!0,!0,!1),viewer.skybox.camera.rotation.copy(viewer.scene.camera.rotation),viewer.skybox.camera.fov=viewer.scene.camera.fov,viewer.skybox.camera.aspect=viewer.scene.camera.aspect,viewer.skybox.camera.updateProjectionMatrix(),viewer.renderer.render(viewer.skybox.scene,viewer.skybox.camera)):"gradient"===viewer.background?viewer.renderer.render(viewer.scene.sceneBG,viewer.scene.cameraBG):"black"===viewer.background?(viewer.renderer.setClearColor(0,1),viewer.renderer.clear(!0,!0,!1)):"white"===viewer.background&&(viewer.renderer.setClearColor(16777215,1),viewer.renderer.clear(!0,!0,!1));for(let e=0;e<viewer.scene.pointclouds.length;e++){let t=viewer.scene.pointclouds[e];t.originalMaterial&&(t.material=t.originalMaterial);Potree.utils.computeTransformedBoundingBox(t.boundingBox,t.matrixWorld);t.material.useEDL=!1,t.material.size=viewer.pointSize,t.material.minSize=viewer.minPointSize,t.material.maxSize=viewer.maxPointSize,t.material.opacity=viewer.opacity,t.material.pointColorType=viewer.pointColorType,t.material.pointSizeType=viewer.pointSizeType,t.material.pointShape="Circles"===viewer.quality?Potree.PointShape.CIRCLE:Potree.PointShape.SQUARE,t.material.interpolate="Interpolation"===viewer.quality,t.material.weighted=!1}viewer.renderer.render(viewer.scene.scenePointCloud,viewer.scene.camera),viewer.renderer.render(viewer.scene.scene,viewer.scene.camera),viewer.volumeTool.update(),viewer.renderer.render(viewer.volumeTool.sceneVolume,viewer.scene.camera),viewer.renderer.render(viewer.controls.sceneControls,viewer.scene.camera),viewer.renderer.clearDepth(),viewer.measuringTool.update(),viewer.profileTool.update(),viewer.transformationTool.update(),viewer.renderer.render(viewer.measuringTool.sceneMeasurement,viewer.scene.camera),viewer.renderer.render(viewer.profileTool.sceneProfile,viewer.scene.camera),viewer.renderer.render(viewer.transformationTool.sceneTransform,viewer.scene.camera)}}(this)),this.potreeRenderer.render()),Potree.endQuery(t,viewer.renderer.getContext()),Potree.resolveQueries(viewer.renderer.getContext()),this.stats.end(),Potree.framenumber++}stopRendering(){this.renderingStopped=!0}startRendering(){this.renderingStopped&&(this.renderingStopped=!1,requestAnimationFrame(this.loop.bind(this)))}}).Profile=class{constructor(e,t){this.viewer=e,this.enabled=!0,this.element=t,this.currentProfile=null,this.requests=[],this.pointsProcessed=0,this.margin={top:0,right:0,bottom:20,left:40},this.maximized=!1,this.threshold=2e4,this.scheduledDraw=null,$("#closeProfileContainer").click(()=>{this.hide(),this.enabled=!1}),$("#profile_toggle_size_button").click(()=>{this.maximized=!this.maximized,this.maximized?$("#profile_window").css("height","100%"):$("#profile_window").css("height","30%")}),this.redraw=(()=>{this.currentProfile&&this.draw(this.currentProfile)}),e.addEventListener("height_range_changed",this.redraw);let i=document.getElementById("profile_window").clientWidth,r=document.getElementById("profile_window").clientHeight,n=()=>{requestAnimationFrame(n);let e=document.getElementById("profile_window").clientWidth,t=document.getElementById("profile_window").clientHeight;e===i&&t===r||setTimeout(this.redraw,50,{profile:this.currentProfile}),i=e,r=t};requestAnimationFrame(n)}show(){$("#profile_window").fadeIn(),this.enabled=!0}hide(){$("#profile_window").fadeOut()}cancel(){for(let e of this.requests)e.cancel();this.requests=[]}preparePoints(e){let t=e.segments;if(0===t.length)return!1;let i=[],r=0,n=new THREE.Vector3(Math.max()),o=new THREE.Vector3(0),a=this.viewer.getHeightRange(),s=a.max-a.min,l=[],c=[],u=viewer.scene.pointclouds[0].material.gradient;for(let e=0;e<u.length;e++)c.push(a.min+s*u[e][0]),l.push("#"+u[e][1].getHexString());let h=d3.scale.linear().domain(c).range(l).clamp(!0);for(let e of t){let t=(new THREE.Vector3).subVectors(e.end,e.start).setZ(0).length(),a=e.points;for(let t=0;t<a.numPoints;t++){let s=a.position[t],l=(new THREE.Vector3).subVectors(s,e.start).setZ(0);n.min(s),o.max(s);let c={distance:r+l.length(),x:s.x,y:s.y,z:s.z,altitude:s.z,heightColor:h(s.z),color:a.color?a.color[t]:[0,0,0],intensity:a.intensity?a.intensity[t]:0,classification:a.classification?a.classification[t]:0,returnNumber:a.returnNumber?a.returnNumber[t]:0,numberOfReturns:a.numberOfReturns?a.numberOfReturns[t]:0,pointSourceID:a.pointSourceID?a.pointSourceID[t]:0};i.push(c)}r+=t}return{data:i,minX:n.x,minY:n.y,minZ:n.z,maxX:o.x,maxY:o.y,maxZ:o.z}}pointHighlight(e){let t=d3.select("svg#profileSVG"),i=this.points,r=this.scaleX,n=this.scaleY,o=e[0],a=e[1],s=[];for(let e=0;e<i.length;e++)r(i[e].distance)<o+6&&r(i[e].distance)>o-6&&n(i[e].altitude)<a+6&&n(i[e].altitude)>a-6&&s.push(i[e]);if(s.length>0){let e=s[0];this.hoveredPoint=s[0];let i,r;-1==navigator.userAgent.indexOf("Firefox")?(i=this.scaleX(e.distance)+this.margin.left,r=this.scaleY(e.altitude)+this.margin.top):(i=this.scaleX(e.distance),r=this.scaleY(e.altitude)),r-=3,d3.selectAll("rect").remove();t.append("rect").attr("x",i).attr("y",r).attr("id",e.id).attr("width",6).attr("height",6).style("fill","yellow");let n=$("#profile_selection_marker");n.css("display","initial"),n.css("left",i+"px"),n.css("top",r+"px"),n.css("width","6px"),n.css("height","6px"),n.css("background-color","yellow");let o="x: "+Math.round(10*e.x)/10+" y: "+Math.round(10*e.y)/10+" z: "+Math.round(10*e.altitude)/10+"  -  ";o+="offset: "+e.distance.toFixed(3)+"  -  ",o+="Classification: "+e.classification+"  -  ",o+="Intensity: "+e.intensity,$("#profileInfo").css("color","yellow"),$("#profileInfo").html(o)}else{d3.selectAll("rect").remove(),$("#profileInfo").html("");$("#profile_selection_marker").css("display","none")}}strokeColor(e){let t=this.viewer.getMaterial();if(t===Potree.PointColorType.RGB){let[t,i,r]=e.color.map(e=>parseInt(e));return`rgb( ${t}, ${i}, ${r})`}if(t===Potree.PointColorType.INTENSITY){let t=viewer.getIntensityRange(),i=parseInt(255*(e.intensity-t[0])/(t[1]-t[0]));return`rgb(${i}, ${i}, ${i})`}if(t===Potree.PointColorType.CLASSIFICATION){let t=this.viewer.scene.pointclouds[0].material.classification;if(void 0!==t[e.classification]){let i="rgb("+100*t[e.classification].x+"%,";return i+=100*t[e.classification].y+"%,",i+=100*t[e.classification].z+"%)"}return"rgb(255,255,255)"}return t===Potree.PointColorType.HEIGHT?e.heightColor:t===Potree.PointColorType.RETURN_NUMBER?1===e.numberOfReturns?"rgb(255, 255, 0)":1===e.returnNumber?"rgb(255, 0, 0)":e.returnNumber===e.numberOfReturns?"rgb(0, 0, 255)":"rgb(0, 255, 0)":e.color}draw(e){if(!this.enabled)return;if(!e)return;if(0===this.viewer.scene.pointclouds.length)return;let t=()=>{this.actuallyDraw(this.scheduledDraw),this.scheduledDraw=null};this.scheduledDraw||setTimeout(t,100),this.scheduledDraw=e}actuallyDraw(e){if(this.context){let e=this.element.clientWidth,t=this.element.clientHeight,i=e-(this.margin.left+this.margin.right),r=t-(this.margin.top+this.margin.bottom);this.context.clearRect(0,0,i,r)}this.currentProfile&&(this.currentProfile.removeEventListener("marker_moved",this.redraw),this.currentProfile.removeEventListener("marker_added",this.redraw),this.currentProfile.removeEventListener("marker_removed",this.redraw),this.currentProfile.removeEventListener("width_changed",this.redraw),viewer.removeEventListener("material_changed",this.redraw),viewer.removeEventListener("height_range_changed",this.redraw),viewer.removeEventListener("intensity_range_changed",this.redraw)),this.currentProfile=e,this.currentProfile.addEventListener("marker_moved",this.redraw),this.currentProfile.addEventListener("marker_added",this.redraw),this.currentProfile.addEventListener("marker_removed",this.redraw),this.currentProfile.addEventListener("width_changed",this.redraw),viewer.addEventListener("material_changed",this.redraw),viewer.addEventListener("height_range_changed",this.redraw),viewer.addEventListener("intensity_range_changed",this.redraw),this.__drawData||(this.__drawData={}),this.points=[],this.rangeX=[1/0,-1/0],this.rangeY=[1/0,-1/0],this.pointsProcessed=0;for(let e of this.requests)e.cancel();this.requests=[];let t=(t,i,r)=>{let n=0;for(let t=0;t<e.points.length;t++){let i=e.points[t];if(t>0){let r=e.points[t-1],o=i.x-r.x,a=i.y-r.y;n+=Math.sqrt(o*o+a*a)}let r=this.scaleX(n),o=this.context.canvas.clientHeight;this.context.beginPath(),this.context.arc(r,o,4,0,2*Math.PI,!1),this.context.fillStyle="#a22",this.context.fill()}let o,a,s,l=-1,c=t.length;for(;++l<c;)o=t[l],a=this.scaleX(o.distance),s=this.scaleY(o.altitude),this.context.beginPath(),this.context.moveTo(a,s),this.context.fillStyle=this.strokeColor(o),this.context.fillRect(a,s,2,2)},i=null,r=()=>{let e=this.element.clientWidth,i=this.element.clientHeight,r=e-(this.margin.left+this.margin.right),n=i-(this.margin.top+this.margin.bottom);this.scaleX=d3.scale.linear(),this.scaleY=d3.scale.linear();let o=this.rangeX[1]-this.rangeX[0],a=this.rangeY[1]-this.rangeY[0],s=o/a,l=r,c=l/n;if(s<c){let e=o*(n/a);this.scaleY.range([n,0]),this.scaleX.range([r/2-e/2,r/2+e/2]);let t=o*(c/s);this.axisScaleX=d3.scale.linear().domain([o/2-t/2,o/2+t/2]).range([0,r]),this.axisScaleY=d3.scale.linear().domain(this.rangeY).range([n,0])}else{let e=a*(l/o);this.scaleX.range([0,r]),this.scaleY.range([n/2+e/2,n/2-e/2]);let t=a*(s/c),i=(this.rangeY[1]+this.rangeY[0])/2;this.axisScaleX=d3.scale.linear().domain(this.rangeX).range([0,r]),this.axisScaleY=d3.scale.linear().domain([i-t/2,i+t/2]).range([n,0])}this.scaleX.domain(this.rangeX),this.scaleY.domain(this.rangeY),this.axisZoom=d3.behavior.zoom().x(this.axisScaleX).y(this.axisScaleY).scaleExtent([0,128]).size([r,n]),this.zoom=d3.behavior.zoom().x(this.scaleX).y(this.scaleY).scaleExtent([0,128]).size([r,n]).on("zoom",()=>{this.axisZoom.translate(this.zoom.translate()),this.axisZoom.scale(this.zoom.scale());let e=d3.select("svg#profileSVG");e.select(".x.axis").call(d),e.select(".y.axis").call(p),this.context.clearRect(0,0,r,n),t(this.points,this.rangeX,this.rangeY)}),this.context=d3.select("#profileCanvas").attr("width",r).attr("height",n).call(this.zoom).node().getContext("2d"),d3.select("svg#profileSVG").selectAll("*").remove();let u=d3.select("svg#profileSVG").call(this.zoom).attr("width",(r+this.margin.left+this.margin.right).toString()).attr("height",(n+this.margin.top+this.margin.bottom).toString()).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),h=this;d3.select("#profileCanvas").on("mousemove",function(){let e=d3.mouse(this);h.pointHighlight(e)});let d=d3.svg.axis().scale(this.axisScaleX).innerTickSize(-n).outerTickSize(5).orient("bottom").ticks(10,"m"),p=d3.svg.axis().scale(this.axisScaleY).innerTickSize(-r).outerTickSize(5).orient("left").ticks(10,"m");u.append("g").attr("class","x axis").call(d);u.append("g").attr("class","y axis").call(p),-1==navigator.userAgent.indexOf("Firefox")?(u.select(".y.axis").attr("transform","translate("+this.margin.left.toString()+","+this.margin.top.toString()+")"),u.select(".x.axis").attr("transform","translate("+this.margin.left.toString()+","+(n+this.margin.top).toString()+")")):u.select(".x.axis").attr("transform","translate( 0 ,"+n.toString()+")"),t(this.points,this.rangeX,this.rangeY),document.getElementById("profile_num_points").innerHTML=Potree.utils.addCommas(this.pointsProcessed)+" "};for(let t of this.viewer.scene.pointclouds.filter(e=>e.visible)){let n=t.getPointsInProfile(e,null,{onProgress:e=>{if(!this.enabled)return;i?i.union(e.points.projectedBoundingBox):i=e.points.projectedBoundingBox;let t=this.preparePoints(e.points),n=t.data;this.points=this.points.concat(n);let o=[d3.min(n,function(e){return e.distance}),d3.max(n,function(e){return e.distance})],a=[d3.min(n,function(e){return e.altitude}),d3.max(n,function(e){return e.altitude})];this.rangeX=[Math.min(this.rangeX[0],o[0]),Math.max(this.rangeX[1],o[1])],this.rangeY=[Math.min(this.rangeY[0],a[0]),Math.max(this.rangeY[1],a[1])],this.pointsProcessed+=t.data.length,r(),this.pointsProcessed>this.threshold&&this.cancel()},onFinish:e=>{this.enabled},onCancel:()=>{this.enabled}});this.requests.push(n)}}setThreshold(e){this.threshold=e,this.redraw()}getPointsInProfileAsCSV(){if(0===this.points.length)return"no points in profile";let e="",t=this.points.slice();t.sort((e,t)=>e.distance-t.distance);{let i="x, y";t[0].hasOwnProperty("color")&&(i+=", r, g, b"),t[0].hasOwnProperty("intensity")&&(i+=", intensity"),t[0].hasOwnProperty("classification")&&(i+=", classification"),t[0].hasOwnProperty("numberOfReturns")&&(i+=", numberOfReturns"),t[0].hasOwnProperty("pointSourceID")&&(i+=", pointSourceID"),t[0].hasOwnProperty("returnNumber")&&(i+=", returnNumber"),e+=i+"\n"}for(let i of t){let t=i.distance.toFixed(4)+", ";t+=i.altitude.toFixed(4)+", ",i.hasOwnProperty("color")&&(t+=i.color.join(", ")),i.hasOwnProperty("intensity")&&(t+=", "+i.intensity),i.hasOwnProperty("classification")&&(t+=", "+i.classification),i.hasOwnProperty("numberOfReturns")&&(t+=", "+i.numberOfReturns),i.hasOwnProperty("pointSourceID")&&(t+=", "+i.pointSourceID),i.hasOwnProperty("returnNumber")&&(t+=", "+i.returnNumber),e+=t+="\n"}return e}getPointsInProfileAsLas(){let e=this.points,t=new THREE.Box3;for(let i of e)t.expandByPoint(i);let i=t.min.clone(),r=t.min.distanceTo(t.max),n=new THREE.Vector3(.01,.01,.01);n=r>1e5?new THREE.Vector3(.01,.01,.01):new THREE.Vector3(.001,.001,.001);let o=function(e,t,i){let r=new Uint8Array(i);for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);r[t+i]=n}},a=new ArrayBuffer(227+28*e.length),s=new DataView(a),l=new Uint8Array(a);o("LASF",0,a),l[24]=1,l[25]=2,o("potree 1.4",58,a),s.setUint16(94,227,!0),s.setUint32(96,227,!0),l[104]=2,s.setUint16(105,28,!0),s.setUint32(107,e.length,!0),s.setFloat64(131,n.x,!0),s.setFloat64(139,n.y,!0),s.setFloat64(147,n.z,!0),s.setFloat64(155,i.x,!0),s.setFloat64(163,i.y,!0),s.setFloat64(171,i.z,!0);let c=227;for(let t=0;t<e.length;t++){let r=e[t],o=new THREE.Vector3(r.x,r.y,r.z),a=parseInt((o.x-i.x)/n.x),l=parseInt((o.y-i.y)/n.y),u=parseInt((o.z-i.z)/n.z);s.setUint32(c+0,a,!0),s.setUint32(c+4,l,!0),s.setUint32(c+8,u,!0),s.setUint16(c+12,r.intensity,!0);let h=r.returnNumber;h+=r.numberOfReturns<<3,s.setUint8(c+14,h),s.setUint8(c+15,r.classification),s.setUint16(c+18,r.pointSourceID),s.setUint16(c+20,255*r.color[0],!0),s.setUint16(c+22,255*r.color[1],!0),s.setUint16(c+24,255*r.color[2],!0),c+=28}return s.setFloat64(179,t.max.x,!0),s.setFloat64(187,t.min.x,!0),s.setFloat64(195,t.max.y,!0),s.setFloat64(203,t.min.y,!0),s.setFloat64(211,t.max.z,!0),s.setFloat64(219,t.min.z,!0),a}},proj4.defs("UTM10N","+proj=utm +zone=10 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"),Potree.MapView=class{constructor(e){this.viewer=e,this.webMapService="WMTS",this.mapProjectionName="EPSG:3857",this.mapProjection=proj4.defs(this.mapProjectionName),this.sceneProjection=null,this.extentsLayer=null,this.cameraLayer=null,this.toolLayer=null,this.sourcesLayer=null,this.sourcesLabelLayer=null}init(){$("#potree_map").draggable({handle:$("#potree_map_header")}),$("#potree_map").resizable();let e=this.getExtentsLayer(),t=this.getCameraLayer();this.getToolLayer(),this.getSourcesLayer(),this.getSourcesLabelLayer();var i=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(5),projection:"EPSG:4326",undefinedHTML:"&nbsp;"});let r=function(e){var t=e||{},i=document.createElement("button");i.innerHTML="T",i.addEventListener("click",()=>{var e=this.sourcesLayer.getVisible();this.sourcesLayer.setVisible(!e),this.sourcesLabelLayer.setVisible(!e)},!1),i.style.float="left",i.title="show / hide tiles";var r=document.createElement("a");r.href="#",r.download="list.txt",r.style.float="left";var n=document.createElement("button");n.innerHTML="D",r.appendChild(n);n.addEventListener("click",e=>{var t=o.getArray(),i=[location.protocol,"//",location.host,location.pathname].join("");if(0===t.length)return alert("No tiles were selected. Select area with ctrl + left mouse button!"),e.preventDefault(),e.stopImmediatePropagation(),!1;if(1===t.length){if((c=t[0]).source){var n=c.pointcloud.pcoGeometry.url,a=new URL(i+"/../"+n+"/../source/"+c.source.name);r.href=a.href,r.download=c.source.name}}else{for(var s="",l=0;l<t.length;l++){var c;(c=t[l]).source&&(n=c.pointcloud.pcoGeometry.url,s+=(a=new URL(i+"/../"+n+"/../source/"+c.source.name)).href+"\n")}var u="data:application/octet-stream;base64,"+btoa(s);r.href=u,r.download="list_of_files.txt"}},!1);var a=document.createElement("div");a.className="ol-unselectable ol-control",a.appendChild(r),a.appendChild(i),a.style.bottom="0.5em",a.style.left="0.5em",a.title="Download file or list of selected tiles. Select tile with left mouse button or area using ctrl + left mouse.",ol.control.Control.call(this,{element:a,target:t.target})};ol.inherits(r,ol.control.Control),this.map=new ol.Map({controls:ol.control.defaults({attributionOptions:{collapsible:!1}}).extend([new r,i]),layers:[new ol.layer.Tile({source:new ol.source.OSM}),this.toolLayer,this.sourcesLayer,this.sourcesLabelLayer,e,t],target:"potree_map_content",view:new ol.View({center:this.olCenter,zoom:9})}),this.dragBoxLayer=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(0, 0, 255, 1)",width:2})})}),this.map.addLayer(this.dragBoxLayer);var n=new ol.interaction.Select;this.map.addInteraction(n);var o=n.getFeatures(),a=new ol.interaction.DragBox({condition:ol.events.condition.platformModifierKeyOnly});this.map.addInteraction(a),a.on("boxend",e=>{var t=a.getGeometry().getExtent();this.sourcesLayer.getSource().forEachFeatureIntersectingExtent(t,e=>{o.push(e)})}),a.on("boxstart",e=>{o.clear()}),this.map.on("click",()=>{o.clear()}),this.viewer.addEventListener("scene_changed",e=>{this.setScene(e.scene)}),this.onPointcloudAdded=(e=>{this.load(e.pointcloud)}),this.setScene(this.viewer.scene)}setScene(e){if(this.scene!==e){this.scene&&this.scene.removeEventListener("pointcloud_added",this.onPointcloudAdded),this.scene=e,this.scene.addEventListener("pointcloud_added",this.onPointcloudAdded);for(var t=0;t<this.viewer.scene.pointclouds.length;t++)this.load(this.viewer.scene.pointclouds[t])}}getExtentsLayer(){if(this.extentsLayer)return this.extentsLayer;this.gExtent=new ol.geom.LineString([[0,0],[0,0]]);let e=new ol.Feature(this.gExtent),t=new ol.source.Vector({features:[e]});return this.extentsLayer=new ol.layer.Vector({source:t,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#0000ff",width:2}),image:new ol.style.Circle({radius:3,fill:new ol.style.Fill({color:"#0000ff"})})})}),this.extentsLayer}getCameraLayer(){if(this.cameraLayer)return this.cameraLayer;this.gCamera=new ol.geom.LineString([[0,0],[0,0],[0,0],[0,0]]);var e=new ol.Feature(this.gCamera),t=new ol.source.Vector({features:[e]});return this.cameraLayer=new ol.layer.Vector({source:t,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#0000ff",width:2})})}),this.cameraLayer}getToolLayer(){return this.toolLayer?this.toolLayer:(this.toolLayer=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 1)"}),stroke:new ol.style.Stroke({color:"rgba(255, 0, 0, 1)",width:2})})}),this.toolLayer)}getSourcesLayer(){return this.sourcesLayer?this.sourcesLayer:(this.sourcesLayer=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0, 0, 150, 0.1)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 150, 1)",width:1})})}),this.sourcesLayer)}getSourcesLabelLayer(){return this.sourcesLabelLayer?this.sourcesLabelLayer:(this.sourcesLabelLayer=new ol.layer.Vector({source:new ol.source.Vector({}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.1)"}),stroke:new ol.style.Stroke({color:"rgba(255, 0, 0, 1)",width:2})}),minResolution:.01,maxResolution:20}),this.sourcesLabelLayer)}setSceneProjection(e){this.sceneProjection=e,this.toMap=proj4(this.sceneProjection,this.mapProjection),this.toScene=proj4(this.mapProjection,this.sceneProjection)}getMapExtent(){var e=this.viewer.getBoundingBox();return{bottomLeft:this.toMap.forward([e.min.x,e.min.y]),bottomRight:this.toMap.forward([e.max.x,e.min.y]),topRight:this.toMap.forward([e.max.x,e.max.y]),topLeft:this.toMap.forward([e.min.x,e.max.y])}}getMapCenter(){var e=this.getMapExtent();return[(e.bottomLeft[0]+e.topRight[0])/2,(e.bottomLeft[1]+e.topRight[1])/2]}updateToolDrawings(){this.toolLayer.getSource().clear();for(var e=this.viewer.profileTool.profiles,t=0;t<e.length;t++){for(var i=e[t],r=[],n=0;n<i.points.length;n++){var o=i.points[n],a=this.toMap.forward([o.x,o.y]);r.push(a)}var s=new ol.geom.LineString(r),l=new ol.Feature(s);this.toolLayer.getSource().addFeature(l)}var c=this.viewer.measuringTool.measurements;for(t=0;t<c.length;t++){var u=c[t];for(r=[],n=0;n<u.points.length;n++){o=u.points[n].position,a=this.toMap.forward([o.x,o.y]);r.push(a)}u.closed&&u.points.length>0&&r.push(r[0]);s=new ol.geom.LineString(r),l=new ol.Feature(s);this.toolLayer.getSource().addFeature(l)}}load(e){if(!(e instanceof Potree.PointCloudOctree))return;if(!e.projection)return;this.sceneProjection||this.setSceneProjection(e.projection);var t=this.getMapExtent(),i=this.getMapCenter(),r=this.map.getView();r.setCenter(i),this.gExtent.setCoordinates([t.bottomLeft,t.bottomRight,t.topRight,t.topLeft,t.bottomLeft]),r.fit(this.gExtent,[300,300],{constrainResolution:!1});let n=e=>{return new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(100,50,200,0.5)"}),stroke:new ol.style.Stroke({color:"rgba(120,30,100,0.8)",width:3})}),text:new ol.style.Text({font:"12px helvetica,sans-serif",text:e,fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})})};var o=e.pcoGeometry.url+"/../sources.json";$.getJSON(o,t=>{for(var i=t.sources,r=0;r<i.length;r++){var o=i[r],a=o.name,s=(o.points,o.bounds),l={min:this.toMap.forward([s.min[0],s.min[1]]),max:this.toMap.forward([s.max[0],s.max[1]])},c=[(l.min[0]+l.max[0])/2,(l.min[1]+l.max[1])/2],u=this.toMap.forward([s.min[0],s.min[1]]),h=this.toMap.forward([s.max[0],s.min[1]]),d=this.toMap.forward([s.max[0],s.max[1]]),p=this.toMap.forward([s.min[0],s.max[1]]),f=new ol.Feature({geometry:new ol.geom.Polygon([[u,h,d,p,u]])});f.source=o,f.pointcloud=e,this.sourcesLayer.getSource().addFeature(f),(f=new ol.Feature({geometry:new ol.geom.Point(c),name:a})).setStyle(n(a)),this.sourcesLabelLayer.getSource().addFeature(f)}})}update(e){if(this.sceneProjection){var t=$("#potree_map");if(t.is(":visible")){var i=this.map.getSize();(t.width()!=i[0]||t.height()!=i[1])&&this.map.updateSize();var r=this.map.getView().getResolution(),n=this.viewer.scene.camera,o=n.position,a=n.getWorldDirection().clone().multiplyScalar(30*r).add(o),s=n.position,l=a,c=(new THREE.Vector2).fromArray(this.toMap.forward([s.x,s.y])),u=(new THREE.Vector2).fromArray(this.toMap.forward([l.x,l.y])),h=(new THREE.Vector2).subVectors(u,c).normalize();u=c.clone().add(h.clone().multiplyScalar(30*r));var d=c.distanceTo(u),p=new THREE.Vector2(-h.y,h.x),f=c.toArray(),m=u.clone().sub(p.clone().multiplyScalar(.3*d)).toArray(),g=u.clone().add(p.clone().multiplyScalar(.3*d)).toArray();this.gCamera.setCoordinates([f,m,g,f])}}}};var l=function(e,t,i){var r=document.createElement("img");return r.src=e,r.onclick=i,r.style.width="32px",r.style.height="32px",r.classList.add("button-icon"),r.setAttribute("data-i18n",t),r};initSettings=function(){$("#sldMinNodeSize").slider({value:viewer.getMinNodeSize(),min:0,max:1e3,step:.01,slide:function(e,t){viewer.setMinNodeSize(t.value)}}),viewer.addEventListener("minnodesize_changed",function(e){$("#lblMinNodeSize")[0].innerHTML=parseInt(viewer.getMinNodeSize()),$("#lblMinNodeSize").slider({value:viewer.getMinNodeSize()})});var e=function(e){return e===Potree.ClipMode.DISABLED?"No Clipping":e===Potree.ClipMode.HIGHLIGHT_INSIDE?"Highlight Inside":e===Potree.ClipMode.CLIP_OUTSIDE?"Clip Outside":void 0};$("#optClipMode").selectmenu(),$("#optClipMode").val(e(viewer.getClipMode())).selectmenu("refresh"),$("#optClipMode").selectmenu({change:function(e,t){viewer.setClipMode(function(e){return"No Clipping"===e?Potree.ClipMode.DISABLED:"Highlight Inside"===e?Potree.ClipMode.HIGHLIGHT_INSIDE:"Clip Outside"===e?Potree.ClipMode.CLIP_OUTSIDE:void 0}(t.item.value))}}),viewer.addEventListener("clip_mode_changed",t=>{let i=e(viewer.clipMode);$("#optClipMode").selectmenu().val(i).selectmenu("refresh")})};let c=function(){!function initAccordion(){$(".accordion > h3").each(function(){let e=$(this),t=$(this).next();e.addClass("accordion-header ui-widget"),t.addClass("accordion-content ui-widget"),t.hide(),e.click(function(){t.slideToggle()})})}(),function initAppearance(){$("#optPointSizing").selectmenu(),$("#optQuality").selectmenu(),$("#optPointSizing").val(viewer.getPointSizing()).selectmenu("refresh"),$("#optPointSizing").selectmenu({change:function(e,t){viewer.setPointSizing(t.item.value)}}),$("#optQuality").val(viewer.getQuality()).selectmenu("refresh"),$("#optQuality").selectmenu({change:function(e,t){viewer.setQuality(t.item.value)}}),$("#sldPointBudget").slider({value:viewer.getPointBudget(),min:1e5,max:5e6,step:1e3,slide:function(e,t){viewer.setPointBudget(t.value)}}),$("#sldPointSize").slider({value:viewer.getPointSize(),min:0,max:3,step:.01,slide:function(e,t){viewer.setPointSize(t.value)}}),$("#sldFOV").slider({value:viewer.getFOV(),min:20,max:100,step:1,slide:function(e,t){viewer.setFOV(t.value)}}),$("#sldOpacity").slider({value:viewer.getOpacity(),min:0,max:1,step:.01,slide:function(e,t){viewer.setOpacity(t.value)}}),$("#sldEDLRadius").slider({value:viewer.getEDLRadius(),min:1,max:4,step:.01,slide:function(e,t){viewer.setEDLRadius(t.value)}}),$("#sldEDLStrength").slider({value:viewer.getEDLStrength(),min:0,max:5,step:.01,slide:function(e,t){viewer.setEDLStrength(t.value)}}),viewer.addEventListener("point_budget_changed",function(e){$("#lblPointBudget")[0].innerHTML=Potree.utils.addCommas(viewer.getPointBudget()),$("#sldPointBudget").slider({value:viewer.getPointBudget()})}),viewer.addEventListener("point_size_changed",function(e){$("#lblPointSize")[0].innerHTML=viewer.getPointSize().toFixed(2),$("#sldPointSize").slider({value:viewer.getPointSize()})}),viewer.addEventListener("fov_changed",function(e){$("#lblFOV")[0].innerHTML=parseInt(viewer.getFOV()),$("#sldFOV").slider({value:viewer.getFOV()})}),viewer.addEventListener("opacity_changed",function(e){$("#lblOpacity")[0].innerHTML=viewer.getOpacity().toFixed(2),$("#sldOpacity").slider({value:viewer.getOpacity()})}),viewer.addEventListener("point_sizing_changed",e=>{let t=viewer.pointSizeType,i=new Map([[Potree.PointSizeType.FIXED,"Fixed"],[Potree.PointSizeType.ATTENUATED,"Attenuated"],[Potree.PointSizeType.ADAPTIVE,"Adaptive"]]).get(t);$("#optPointSizing").selectmenu().val(i).selectmenu("refresh")}),viewer.addEventListener("quality_changed",e=>{let t=viewer.quality;$("#optQuality").selectmenu().val(t).selectmenu("refresh")}),viewer.addEventListener("edl_radius_changed",function(e){$("#lblEDLRadius")[0].innerHTML=viewer.getEDLRadius().toFixed(1),$("#sldEDLRadius").slider({value:viewer.getEDLRadius()})}),viewer.addEventListener("edl_strength_changed",function(e){$("#lblEDLStrength")[0].innerHTML=viewer.getEDLStrength().toFixed(1),$("#sldEDLStrength").slider({value:viewer.getEDLStrength()})}),viewer.addEventListener("background_changed",function(e){$("input[name=background][value='"+viewer.getBackground()+"']").prop("checked",!0)}),$("#lblPointBudget")[0].innerHTML=Potree.utils.addCommas(viewer.getPointBudget()),$("#lblPointSize")[0].innerHTML=viewer.getPointSize().toFixed(2),$("#lblFOV")[0].innerHTML=parseInt(viewer.getFOV()),$("#lblOpacity")[0].innerHTML=viewer.getOpacity().toFixed(2),$("#lblEDLRadius")[0].innerHTML=viewer.getEDLRadius().toFixed(1),$("#lblEDLStrength")[0].innerHTML=viewer.getEDLStrength().toFixed(1),$("#chkEDLEnabled")[0].checked=viewer.getEDLEnabled(),$("input[name=background][value='"+viewer.getBackground()+"']").prop("checked",!0)}(),function initToolbar(){let e=document.getElementById("tools");e.appendChild(l(Potree.resourcePath+"/icons/angle.png","[title]tt.angle_measurement",function(){$("#menu_measurements").next().slideDown(),viewer.measuringTool.startInsertion({showDistances:!1,showAngles:!0,showArea:!1,closed:!0,maxMarkers:3})})),e.appendChild(l(Potree.resourcePath+"/icons/point.svg","[title]tt.angle_measurement",function(){$("#menu_measurements").next().slideDown(),viewer.measuringTool.startInsertion({showDistances:!1,showAngles:!1,showCoordinates:!0,showArea:!1,closed:!0,maxMarkers:1})})),e.appendChild(l(Potree.resourcePath+"/icons/distance.svg","[title]tt.distance_measurement",function(){$("#menu_measurements").next().slideDown(),viewer.measuringTool.startInsertion({showDistances:!0,showArea:!1,closed:!1})})),e.appendChild(l(Potree.resourcePath+"/icons/height.svg","[title]tt.height_measurement",function(){$("#menu_measurements").next().slideDown(),viewer.measuringTool.startInsertion({showDistances:!1,showHeight:!0,showArea:!1,closed:!1,maxMarkers:2})})),e.appendChild(l(Potree.resourcePath+"/icons/area.svg","[title]tt.area_measurement",function(){$("#menu_measurements").next().slideDown(),viewer.measuringTool.startInsertion({showDistances:!0,showArea:!0,closed:!0})})),e.appendChild(l(Potree.resourcePath+"/icons/volume.svg","[title]tt.volume_measurement",function(){viewer.volumeTool.startInsertion()})),e.appendChild(l(Potree.resourcePath+"/icons/profile.svg","[title]tt.height_profile",function(){$("#menu_measurements").next().slideDown(),viewer.profileTool.startInsertion()})),e.appendChild(l(Potree.resourcePath+"/icons/clip_volume.svg","[title]tt.clip_volume",function(){viewer.volumeTool.startInsertion({clip:!0})})),e.appendChild(l(Potree.resourcePath+"/icons/reset_tools.svg","[title]tt.remove_all_measurement",function(){viewer.scene.removeAllMeasurements()}))}(),initNavigation(),function initMaterials(){$("#optMaterial").selectmenu({style:"popup",position:{my:"top",at:"bottom",collision:"flip"}}),$("#sldHeightRange").slider({range:!0,min:0,max:1e3,values:[0,1e3],step:.01,slide:function(e,t){viewer.setHeightRange(t.values[0],t.values[1])}}),$("#sldTransition").slider({value:viewer.getMaterialTransition(),min:0,max:1,step:.01,slide:function(e,t){viewer.setMaterialTransition(t.value)}}),$("#sldIntensityRange").slider({range:!0,min:0,max:1,values:[0,1],step:.01,slide:function(e,t){let i=0==t.values[0]?0:parseInt(Math.pow(2,16*t.values[0])),r=parseInt(Math.pow(2,16*t.values[1]));viewer.setIntensityRange(i,r)}}),$("#sldIntensityGamma").slider({value:viewer.getIntensityGamma(),min:0,max:4,step:.01,slide:function(e,t){viewer.setIntensityGamma(t.value)}}),$("#sldIntensityContrast").slider({value:viewer.getIntensityContrast(),min:-1,max:1,step:.01,slide:function(e,t){viewer.setIntensityContrast(t.value)}}),$("#sldIntensityBrightness").slider({value:viewer.getIntensityBrightness(),min:-1,max:1,step:.01,slide:function(e,t){viewer.setIntensityBrightness(t.value)}}),$("#sldRGBGamma").slider({value:viewer.getRGBGamma(),min:0,max:4,step:.01,slide:function(e,t){viewer.setRGBGamma(t.value)}}),$("#sldRGBContrast").slider({value:viewer.getRGBContrast(),min:-1,max:1,step:.01,slide:function(e,t){viewer.setRGBContrast(t.value)}}),$("#sldRGBBrightness").slider({value:viewer.getRGBBrightness(),min:-1,max:1,step:.01,slide:function(e,t){viewer.setRGBBrightness(t.value)}}),$("#sldWeightRGB").slider({value:viewer.getWeightRGB(),min:0,max:1,step:.01,slide:function(e,t){viewer.setWeightRGB(t.value)}}),$("#sldWeightIntensity").slider({value:viewer.getWeightIntensity(),min:0,max:1,step:.01,slide:function(e,t){viewer.setWeightIntensity(t.value)}}),$("#sldWeightElevation").slider({value:viewer.getWeightElevation(),min:0,max:1,step:.01,slide:function(e,t){viewer.setWeightElevation(t.value)}}),$("#sldWeightClassification").slider({value:viewer.getWeightClassification(),min:0,max:1,step:.01,slide:function(e,t){viewer.setWeightClassification(t.value)}}),$("#sldWeightReturnNumber").slider({value:viewer.getWeightReturnNumber(),min:0,max:1,step:.01,slide:function(e,t){viewer.setWeightReturnNumber(t.value)}}),$("#sldWeightSourceID").slider({value:viewer.getWeightSourceID(),min:0,max:1,step:.01,slide:function(e,t){viewer.setWeightSourceID(t.value)}});var e=function(){let e=viewer.getBoundingBox(),t=e.max.z-e.min.z;bMin=e.min.z-.2*t,bMax=e.max.z+.2*t;let i=viewer.getHeightRange();i.max,i.min,$("#lblHeightRange")[0].innerHTML=i.min.toFixed(2)+" to "+i.max.toFixed(2),$("#sldHeightRange").slider({min:bMin,max:bMax,values:[i.min,i.max]})};let t=function(){let e=viewer.getIntensityRange(),t=Math.log2(e[0])/16,i=Math.log2(e[1])/16;$("#lblIntensityRange")[0].innerHTML=parseInt(viewer.getIntensityRange()[0])+" to "+parseInt(viewer.getIntensityRange()[1]),$("#sldIntensityRange").slider({values:[t,i]})};viewer.addEventListener("height_range_changed",e),viewer.addEventListener("intensity_range_changed",t),viewer.addEventListener("intensity_gamma_changed",function(e){let t=viewer.getIntensityGamma();$("#lblIntensityGamma")[0].innerHTML=t.toFixed(2),$("#sldIntensityGamma").slider({value:t})}),viewer.addEventListener("intensity_contrast_changed",function(e){let t=viewer.getIntensityContrast();$("#lblIntensityContrast")[0].innerHTML=t.toFixed(2),$("#sldIntensityContrast").slider({value:t})}),viewer.addEventListener("intensity_brightness_changed",function(e){let t=viewer.getIntensityBrightness();$("#lblIntensityBrightness")[0].innerHTML=t.toFixed(2),$("#sldIntensityBrightness").slider({value:t})}),viewer.addEventListener("rgb_gamma_changed",function(e){let t=viewer.getRGBGamma();$("#lblRGBGamma")[0].innerHTML=t.toFixed(2),$("#sldRGBGamma").slider({value:t})}),viewer.addEventListener("rgb_contrast_changed",function(e){let t=viewer.getRGBContrast();$("#lblRGBContrast")[0].innerHTML=t.toFixed(2),$("#sldRGBContrast").slider({value:t})}),viewer.addEventListener("rgb_brightness_changed",function(e){let t=viewer.getRGBBrightness();$("#lblRGBBrightness")[0].innerHTML=t.toFixed(2),$("#sldRGBBrightness").slider({value:t})}),viewer.addEventListener("pointcloud_loaded",e),e(),t(),$("#lblIntensityGamma")[0].innerHTML=viewer.getIntensityGamma().toFixed(2),$("#lblIntensityContrast")[0].innerHTML=viewer.getIntensityContrast().toFixed(2),$("#lblIntensityBrightness")[0].innerHTML=viewer.getIntensityBrightness().toFixed(2),$("#lblRGBGamma")[0].innerHTML=viewer.getRGBGamma().toFixed(2),$("#lblRGBContrast")[0].innerHTML=viewer.getRGBContrast().toFixed(2),$("#lblRGBBrightness")[0].innerHTML=viewer.getRGBBrightness().toFixed(2);for(var i=["RGB","RGB and Elevation","Color","Elevation","Intensity","Intensity Gradient","Classification","Return Number","Source","Phong","Level of Detail","Composite"],r=document.getElementById("optMaterial"),n=0;n<i.length;n++){var o=i[n],a=document.createElement("option");a.innerHTML=o,a.id="optMaterial_"+o,r.appendChild(a)}let s=function(e,t){let i=$("#optMaterial").selectmenu().val();viewer.setMaterial(i);let r=$("#materials\\.composite_weight_container"),n=$("#materials\\.elevation_container"),o=$("#materials\\.rgb_container"),a=$("#materials\\.intensity_container"),s=$("#materials\\.transition_container");a.css("display","none"),n.css("display","none"),o.css("display","none"),r.css("display","none"),s.css("display","none"),"Composite"===i&&(r.css("display","block"),n.css("display","block"),o.css("display","block"),a.css("display","block")),"Elevation"===i&&n.css("display","block"),"RGB and Elevation"===i&&(o.css("display","block"),n.css("display","block")),"RGB"===i&&o.css("display","block"),"Intensity"===i&&a.css("display","block"),"Intensity Gradient"===i&&a.css("display","block")};$("#optMaterial").selectmenu({change:s}),$("#optMaterial").val(viewer.getMaterialName()).selectmenu("refresh"),s(),viewer.addEventListener("material_changed",e=>{$("#optMaterial").val(viewer.getMaterialName()).selectmenu("refresh")})}(),function initClassificationList(){var e=function(e,t){var i=document.getElementById("classificationList"),r=document.createElement("li"),n=document.createElement("label"),o=document.createElement("input"),a=document.createTextNode(" "+t);o.id="chkClassification_"+e,o.type="checkbox",o.checked=!0,o.onclick=function(t){viewer.setClassificationVisibility(e,t.target.checked)},n.style.whiteSpace="nowrap",i.appendChild(r),r.appendChild(n),n.appendChild(o),n.appendChild(a)};e(0,"never classified"),e(1,"unclassified"),e(2,"ground"),e(3,"low vegetation"),e(4,"medium vegetation"),e(5,"high vegetation"),e(6,"building"),e(7,"low point(noise)"),e(8,"key-point"),e(9,"water"),e(12,"overlap")}(),function initAnnotationDetails(){let e=$("#annotation_details"),t=t=>{let i=document.createElement("li"),r=document.createElement("div"),n=document.createElement("span"),o=document.createElement("span");i.appendChild(r),r.append(n),n.append(o),e.append(i),r.classList.add("annotation-item"),n.style.display="flex",n.classList.add("annotation-main");let a=document.createTextNode(t.ordinal);o.appendChild(a),o.classList.add("annotation-label");let s=[];if(t.hasView()){let e={icon:Potree.resourcePath+"/icons/target.svg",onclick:e=>{t.moveHere(viewer.scene.camera)}};s.push(e)}for(let e of t.actions)s.push(e);if(s.length>0){let e=s[0],t=document.createElement("img");t.src=e.icon,t.classList.add("annotation-icon"),n.appendChild(t),n.onclick=(t=>{e.onclick(t)}),n.onmouseover=(e=>{t.style.opacity=1}),n.onmouseout=(e=>{t.style.opacity=.5}),s.splice(0,1)}for(let e of s){let t=document.createElement("img");t.src=e.icon,t.classList.add("annotation-icon"),t.onmouseover=(e=>{t.style.opacity=1}),t.onmouseout=(e=>{t.style.opacity=.5}),t.onclick=(t=>{e.onclick(t)}),r.appendChild(t)}r.onmouseover=(e=>{t.setHighlighted(!0)}),r.onmouseout=(e=>{t.setHighlighted(!1)}),t.setHighlighted(!1)},i=e=>{t(e.annotation)},r=r=>{if(e.empty(),r.oldScene&&r.oldScene.hasEventListener("annotation_added",i)&&r.oldScene.removeEventListener("annotation_added",i),r.scene){for(let e of r.scene.annotations)t(e);r.scene.addEventListener("annotation_added",i)}};r({scene:viewer.scene}),viewer.addEventListener("scene_changed",r)}(),function initMeasurementDetails(){var e=0;let t=new Map;var i=function(i,r){e++;let n={scene:i,measurement:r,untrack:null};t.set(r,n);var o=document.createElement("li"),a=document.createElement("div"),s=document.createElement("div"),l=document.createElement("div"),c=document.createElement("img"),u=document.createElement("span"),h=document.createElement("img");a.classList.add("potree-panel","panel-default"),s.classList.add("potree-panel-heading","pv-panel-heading"),r instanceof Potree.Measure?(!r.showDistances||r.showArea||r.showAngles?r.showDistances&&r.showArea&&!r.showAngles?(c.src=Potree.resourcePath+"/icons/area.svg",u.innerHTML="Area"):1===r.maxMarkers?(c.src=Potree.resourcePath+"/icons/point.svg",u.innerHTML="Coordinate"):r.showDistances||r.showArea||!r.showAngles?r.showHeight&&(c.src=Potree.resourcePath+"/icons/height.svg",u.innerHTML="Height"):(c.src=Potree.resourcePath+"/icons/angle.png",u.innerHTML="Angle"):(c.src=Potree.resourcePath+"/icons/distance.svg",u.innerHTML="Distance"),h.onclick=function(){i.removeMeasurement(r)}):r instanceof Potree.Profile?(c.src=Potree.resourcePath+"/icons/profile.svg",u.innerHTML="Profile",h.onclick=function(){i.removeProfile(r)}):r instanceof Potree.Volume&&(c.src=Potree.resourcePath+"/icons/volume.svg",u.innerHTML="Volume",h.onclick=function(){i.removeVolume(volume)}),c.style.width="16px",c.style.height="16px",u.style.flexGrow=1,u.style.textAlign="center",h.src=Potree.resourcePath+"/icons/remove.svg",h.style.width="16px",h.style.height="16px",l.classList.add("panel-body"),o.appendChild(a),a.appendChild(s),s.appendChild(c),s.appendChild(u),s.appendChild(h),a.appendChild(l),document.getElementById("measurement_details").appendChild(o);let d=null;var p=function(t){if($(l).empty(),r instanceof Potree.Profile){var i=$('<li style="margin-bottom: 5px">'),n=document.createTextNode("width: "),o=$('<span id="lblProfileWidth_'+e+'">'),a=$('<div id="sldProfileWidth_'+e+'">');a.slider({value:Math.pow(r.getWidth()/1e3,.25).toFixed(3),min:0,max:1,step:.01,slide:function(e,t){var i=1e3*Math.pow(t.value,4);r.setWidth(i)}}),r.getWidth()?o.html(Potree.utils.addCommas(r.getWidth().toFixed(3))):o.html("-"),null===d&&(d=function(e){var t=Math.pow(e.width/1e3,.25);o.html(Potree.utils.addCommas(e.width.toFixed(3))),a.slider({value:t})}),r.hasEventListener("width_changed",d)||r.addEventListener("width_changed",d),i.append(n),i.append(o),i.append(a),l.appendChild(i[0])}var s,c=[];if(r instanceof Potree.Measure){s=r.points;for(var u=0;u<s.length;u++)c.push(s[u].position)}else r instanceof Potree.Profile&&(c=r.points);if(r instanceof Potree.Measure&&r.showHeight){let e=r.points.slice().sort((e,t)=>e.position.z-t.position.z),t=e[0].position.clone(),i=e[e.length-1].position.clone(),n=t.z,o=(i.z-n).toFixed(3);var h=$("<div>").addClass("measurement-detail-node-marker");h.html(o),$(l).append(h)}for(u=0;u<c.length;u++){var p=w=c[u],f=p.x.toFixed(2)+", ";if(f+=p.y.toFixed(2)+", ",f+=p.z.toFixed(2),r&&!r.showHeight){var m=$("<div>").addClass("measurement-detail-node-marker");m.html(f),$(l).append(m)}if(u<c.length-1&&r&&r.showDistances){var g=$("<div>").addClass("measurement-detail-edge");$(l).append(g);var v=c[u+1].distanceTo(p),y=(f=Potree.utils.addCommas(v.toFixed(2)),$("<div>").addClass("measurement-detail-node-distance"));y.html(f),$(l).append(y)}if(r&&r.showAngles){g=$("<div>").addClass("measurement-detail-edge"),$(l).append(g);var b=r.getAngle(u),x=(f=Potree.utils.addCommas((b*(180/Math.PI)).toFixed(1))+"°",$("<div>").addClass("measurement-detail-node-angle"));x.html(f),$(l).append(x)}u<c.length-1&&(g=$("<div>").addClass("measurement-detail-edge"),$(l).append(g))}if(s&&1===s.length){var w=s[0],_=$("<table>").css("width","100%");if($(l).append(_),w.color){var E=w.color,M=$("<tr>"),A=$("<td>").css("padding","1px 5px"),T=$("<td>").css("width","100%").css("padding","1px 5px"),S=parseInt(E[0])+", "+parseInt(E[1])+", "+parseInt(E[2]);A.html("rgb"),T.html(S),_.append(M),M.append(A),M.append(T)}if(void 0!==w.intensity){var P=w.intensity;M=$("<tr>"),A=$("<td>").css("padding","1px 5px"),T=$("<td>").css("width","100%").css("padding","1px 5px"),A.html("intensity"),T.html(P),_.append(M),M.append(A),M.append(T)}if(void 0!==w.classification){var C=w.classification;M=$("<tr>"),A=$("<td>").css("padding","1px 5px"),T=$("<td>").css("width","100%").css("padding","1px 5px"),A.html("classification"),T.html(C),_.append(M),M.append(A),M.append(T)}if(void 0!==w.returnNumber){var R=w.returnNumber;M=$("<tr>"),A=$("<td>").css("padding","1px 5px"),T=$("<td>").css("width","100%").css("padding","1px 5px"),A.html("return nr."),T.html(R),_.append(M),M.append(A),M.append(T)}if(void 0!==w.pointSourceID){var L=w.pointSourceID;M=$("<tr>"),A=$("<td>").css("padding","1px 5px"),T=$("<td>").css("width","100%").css("padding","1px 5px"),A.html("source"),T.html(L),_.append(M),M.append(A),M.append(T)}}if(r&&r.showDistances&&r.points.length>1){f="Total: "+Potree.utils.addCommas(r.getTotalDistance().toFixed(3));var B=$("<div>").addClass("measurement-detail-node-distance");B.html(f),$(l).append(B)}if(r&&r.showArea){f=Potree.utils.addCommas(r.getArea().toFixed(1))+"²";var D=$("<div>").addClass("measurement-detail-node-area");D.html(f),$(l).append(D)}if(r instanceof Potree.Profile){var I=$('<input type="button" value="show 2d profile">').addClass("measurement-detail-button");I[0].onclick=function(){viewer._2dprofile.show(),viewer._2dprofile.draw(r)},$(l).append(I)}if(r.showDistances&&!r.showAngles){let e=$('<span style="display:flex">\n\t\t\t\t\t<span style="flex-grow: 1"></span>\n\t\t\t\t</span>');$(l).append(e);{let t=Potree.resourcePath+"/icons/file_geojson.svg",i=$(`<a href="#" download="measure.json" class="measurepanel_downloads"><img src="${t}"></img></a>`);i.click(function(e){let t=Potree.GeoJSONExporter.toString(r),n=window.URL.createObjectURL(new Blob([t],{type:"data:application/octet-stream"}));i.attr("href",n)}),e.append(i)}{let t=Potree.resourcePath+"/icons/file_dxf.svg",i=$(`<a href="#" download="measure.dxf" class="measurepanel_downloads"><img src="${t}"></img></a>`);i.click(function(e){let t=Potree.DXFExporter.toString(r),n=window.URL.createObjectURL(new Blob([t],{type:"data:application/octet-stream"}));i.attr("href",n)}),e.append(i)}}};if(p(),r instanceof Potree.Measure){let e=function(e){e.measurement===r&&$(o).remove()};r.addEventListener("marker_added",p),r.addEventListener("marker_removed",p),r.addEventListener("marker_moved",p),i.addEventListener("measurement_removed",e),n.stopTracking=(t=>{r.removeEventListener("marker_added",p),r.removeEventListener("marker_removed",p),r.removeEventListener("marker_moved",p),i.removeEventListener("measurement_added",e),i.removeEventListener("measurement_removed",e)})}else if(r instanceof Potree.Profile){let e=function(e){e.profile===r&&(i.removeEventListener("marker_added",p),i.removeEventListener("marker_removed",p),i.removeEventListener("marker_moved",p),$(o).remove())};r.addEventListener("marker_added",p),r.addEventListener("marker_removed",p),r.addEventListener("marker_moved",p),i.addEventListener("profile_removed",e),n.stopTracking=(t=>{r.removeEventListener("marker_added",p),r.removeEventListener("marker_removed",p),r.removeEventListener("marker_moved",p),i.removeEventListener("profile_added",e),i.removeEventListener("profile_removed",e)})}};let r=e=>{e.measurement?i(e.scene,e.measurement):e.profile&&(i(e.scene,e.profile),viewer._2dprofile.show(),viewer._2dprofile.draw(e.profile))},n=e=>{$("#measurement_details").empty(),t.forEach(function(e,t,i){e.stopTracking()});for(var n=0;n<e.measurements.length;n++)i(e,e.measurements[n]);for(n=0;n<e.profiles.length;n++)i(e,e.profiles[n]);e.hasEventListener("measurement_added",r)||e.addEventListener("measurement_added",r),e.hasEventListener("profile_added",r)||e.addEventListener("profile_added",r)};n(viewer.scene),viewer.addEventListener("scene_changed",e=>{n(e.scene)})}(),function initSceneList(){for(var e=$("#sceneList"),t=0,i=function(i){!function(i){var r=$("<li>"),n=$("<label>"),o=$('<input type="checkbox">');o[0].checked=i.visible,o[0].id="scene_list_item_pointcloud_"+t,n[0].id="scene_list_item_label_pointcloud_"+t,n[0].htmlFor="scene_list_item_pointcloud_"+t,n.addClass("menu-item"),o.click(function(e){i.visible=e.target.checked,viewer._2dprofile&&viewer._2dprofile.redraw()}),r.append(n),n.append(o);var a=" "+(i.name?i.name:"point cloud "+t),s=document.createTextNode(a);n.append(s),e.append(r),i.addEventListener("name_changed",function(e){e.name?s.textContent=" "+e.name:s.textContent=" point cloud "+t}),t++}(i)},r=0;r<viewer.scene.pointclouds.length;r++){var n=viewer.scene.pointclouds[r];i(n)}viewer.addEventListener("scene_changed",t=>{e.empty();let r=t.scene;for(var n=0;n<r.pointclouds.length;n++){var o=r.pointclouds[n];i(o)}}),viewer.addEventListener("pointcloud_loaded",function(e){i(e.pointcloud)});let o=new THREE.Vector3,a=new THREE.Vector3;viewer.addEventListener("update",e=>{let t=viewer.scene.view.position,i=viewer.scene.view.getPivot();if(t.equals(o)&&i.equals(a))return;o.copy(t),a.copy(i);let r="<br>"+[t.x,t.y,t.z].map(e=>e.toFixed(2)).join(", "),n="<br>"+[i.x,i.y,i.z].map(e=>e.toFixed(2)).join(", ");$("#lblCameraPosition").html(r),$("#lblCameraTarget").html(n)})}(),initSettings(),$("#potree_version_number").html(Potree.version.major+"."+Potree.version.minor+Potree.version.suffix),$(".perfect_scrollbar").perfectScrollbar()};class u{constructor(e,t){this.icon=e,this.callback=t,this.element=$(`\n\t\t\t<span class="hover_menu_item">\n\t\t\t\t<img src="${e}">\n\t\t\t</span>\n\t\t`),this.element.click(function(){t()})}}},818:function(e,t,i){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=new THREE.Geometry;r.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(-.5,-.5,-1),new THREE.Vector3(-.5,.5,-1),new THREE.Vector3(.5,.5,-1),new THREE.Vector3(.5,-.5,-1)],r.faces=[new THREE.Face3(0,2,1),new THREE.Face3(0,3,2),new THREE.Face3(0,4,3),new THREE.Face3(0,1,4),new THREE.Face3(1,2,3),new THREE.Face3(1,3,4)];var n=new THREE.Matrix4;n.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);var o=new THREE.MeshBasicMaterial({color:16777215,wireframe:!0,name:"camDefaultMaterial"}),a=new THREE.MeshBasicMaterial({color:16711680,wireframe:!0,name:"camSelectedMaterial"}),s=new THREE.Geometry;s.vertices=[new THREE.Vector3(-.5,-.5,-1),new THREE.Vector3(-.5,.5,-1),new THREE.Vector3(.5,.5,-1),new THREE.Vector3(.5,-.5,-1)],s.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3)],s.faceVertexUvs[0]=[[new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1)],[new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]],s.faces[0].materialIndex=0,s.faces[1].materialIndex=0;var l=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,opacity:1,transparent:!0}),c=new THREE.TextureLoader;c.crossOrigin="";var u=function(e){function Camera(e){var t;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Camera),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Camera.__proto__||Object.getPrototypeOf(Camera)).call(this,r,o));var i=e.camera3d.rotationMatrix[0],a=e.camera3d.rotationMatrix[1],s=e.camera3d.rotationMatrix[2],l=e.camera3d.translationMatrix,c=new THREE.Matrix4;c.set(parseFloat(i[0]),parseFloat(a[0]),parseFloat(s[0]),0,parseFloat(i[1]),parseFloat(a[1]),parseFloat(s[1]),0,parseFloat(i[2]),parseFloat(a[2]),parseFloat(s[2]),0,parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2]),1),c.transpose();var u=new THREE.Matrix4;u.getInverse(c),u.multiplyMatrices(n,u),t.name=e.camera3d.filepath,t.userData.mediaId=e._id,t.userData.url=e.url,t.userData.preview_url=e.preview_url,t.userData.thumbnail_url=e.url,t.applyMatrix(u);var h=1,d=3992,p=2953,f=function get_pyramid_sensor_scale(e){var t=e[0],i=1*h,r=i/t*d,n=i/t*p;return new THREE.Vector3(r,n,i)}([e.camera3d.f,e.camera3d.k1,e.camera3d.k2]);return t.scale.set(f.x,f.y,f.z),t.cam_scale=f,t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Camera,THREE.Mesh),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Camera,[{key:"loadMedia",value:function loadMedia(){var e=this;this.texture?this.setMediaPlanePositionAndTextureForThisCamera(this.texture):c.load(this.userData.url,function(t){e.texture=t,e.setMediaPlanePositionAndTextureForThisCamera(t)})}},{key:"setMediaPlanePositionAndTextureForThisCamera",value:function setMediaPlanePositionAndTextureForThisCamera(e){Camera.mediaPlane.material.map=e,Camera.mediaPlane.material.needsUpdate=!0,Camera.mediaPlane.matrix.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),Camera.mediaPlane.applyMatrix(this.matrix)}},{key:"toggleSelection",value:function toggleSelection(){"camSelectedMaterial"===this.material.name?this.material=o:this.material=a}}]),Camera}();t.default=u,u.mediaPlane=new THREE.Mesh(s,l)},819:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(261)),a=_interopRequireDefault(i(1)),s=i(12),l=_interopRequireDefault(i(820)),c=s.selectors.getViewportMediaCount,u=s.selectors.getMediasMinDate,h=s.selectors.getTimelineValue,d=s.actions.updateTimelineMedias,p=function(e){function Timeline(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Timeline),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Timeline.__proto__||Object.getPrototypeOf(Timeline)).call(this,e)),t.state={value:t.props.value,minDate:t.props.minDate,maxDate:Date.now()},t.handleSlideChange=t.handleSlideChange.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Timeline,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Timeline,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){this.setState({minDate:e.minDate,maxDate:Date.now()})}},{key:"handleSlideChange",value:function handleSlideChange(e){this.setState({value:e}),this.props.dispatch(d({value:parseInt(e)}))}},{key:"render",value:function render(){var e=new Date(this.state.value).toLocaleDateString();return r.default.createElement("div",{className:l.default.timeline},r.default.createElement("div",{className:l.default.timelineInfos},r.default.createElement("div",{className:l.default.timelineDate},e),r.default.createElement("div",{className:l.default.timelineCount},this.props.viewportMediaCount," media(s) in this zone")),r.default.createElement(o.default,{min:this.state.minDate,max:this.state.maxDate,value:this.state.value,onChange:this.handleSlideChange}))}}]),Timeline}();p.propTypes={dispatch:a.default.func.isRequired,minDate:a.default.number.isRequired,value:a.default.number.isRequired,viewportMediaCount:a.default.oneOfType([a.default.string,a.default.number]).isRequired};var f=(0,n.connect)(function(e){return{viewportMediaCount:c(e),value:h(e),minDate:u(e)}})(p);t.default=f},820:function(e,t,i){var r=i(821);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},821:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".timeline--timeline--20WzfSHG {\n\tz-index: 1;\n\theight: 70px;\n\tmin-width: 400px;\n\twidth: 30%;\n\tbackground-color: rgba(255, 255, 255, .5);\n\tpadding: 20px 25px;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: vertical;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: column;\n\t        flex-direction: column;\n\t-webkit-box-pack: justify;\n\t    -ms-flex-pack: justify;\n\t        justify-content: space-between;\n}\n\n.timeline--timelineInfos--1ekRj4MA {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-pack: justify;\n\t    -ms-flex-pack: justify;\n\t        justify-content: space-between;\n\tfont-size: 18px;\n}\n\n.timeline--timelineDate--nH9HcJfr {\n\tfont-weight: bold;\n}","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Medias/timeline.css"],names:[],mappings:"AAAA;CACC,WAAW;CACX,aAAa;CACb,iBAAiB;CACjB,WAAW;CACX,0CAAwC;CACxC,mBAAmB;CACnB,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,6BAAuB;CAAvB,8BAAuB;KAAvB,2BAAuB;SAAvB,uBAAuB;CACvB,0BAA+B;KAA/B,uBAA+B;SAA/B,+BAA+B;CAC/B;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,0BAA+B;KAA/B,uBAA+B;SAA/B,+BAA+B;CAC/B,gBAAgB;CAChB;;AAED;CACC,kBAAkB;CAClB",file:"timeline.css",sourcesContent:[".timeline {\n\tz-index: 1;\n\theight: 70px;\n\tmin-width: 400px;\n\twidth: 30%;\n\tbackground-color: rgba(255,255,255,0.5);\n\tpadding: 20px 25px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-between;\n}\n\n.timelineInfos {\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: space-between;\n\tfont-size: 18px;\n}\n\n.timelineDate {\n\tfont-weight: bold;\n}"],sourceRoot:""}]),t.locals={timeline:"timeline--timeline--20WzfSHG",timelineInfos:"timeline--timelineInfos--1ekRj4MA",timelineDate:"timeline--timelineDate--nH9HcJfr"}},822:function(e,t,i){var r=i(823);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},823:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".main--mainContainer--3rAk74bq {\n\tposition:absolute;\n\tz-index: 0;\n\ttop:0;\n\tbottom:0;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-pack: center;\n\t    -ms-flex-pack: center;\n\t        justify-content: center;\n\t-webkit-box-align: end;\n\t    -ms-flex-align: end;\n\t        align-items: flex-end;\n}\n\n.main--main--27Z-IqEs {\n\tposition:absolute;\n\tz-index: 0;\n\ttop:0;\n\tbottom:0;\n\twidth: 100%;\n\theight: 100%;\n}\n\n.main--timelineContainer--2C0JN1FM {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-pack: center;\n\t    -ms-flex-pack: center;\n\t        justify-content: center;\n\tmargin-bottom: 80px;\n}\n\n.main--dummyPreview--2sNqxlWs {\n\twidth: 250px;\n}\n\n.main--preview--TgP-8-GQ {\n\theight: 250px;\n\twidth: 250px;\n\tposition: absolute;\n\tbottom: 10px;\n\tleft: 10px;\n\tz-index: 1;\n\tborder: 1px solid rgb(140, 140, 140);\n}","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Main/main.css"],names:[],mappings:"AAAA;CACC,kBAAkB;CAClB,WAAW;CACX,MAAM;CACN,SAAS;CACT,YAAY;CACZ,aAAa;CACb,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,yBAAwB;KAAxB,sBAAwB;SAAxB,wBAAwB;CACxB,uBAAsB;KAAtB,oBAAsB;SAAtB,sBAAsB;CACtB;;AAED;CACC,kBAAkB;CAClB,WAAW;CACX,MAAM;CACN,SAAS;CACT,YAAY;CACZ,aAAa;CACb;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,yBAAwB;KAAxB,sBAAwB;SAAxB,wBAAwB;CACxB,oBAAoB;CACpB;;AAED;CACC,aAAa;CACb;;AAED;CACC,cAAc;CACd,aAAa;CACb,mBAAmB;CACnB,aAAa;CACb,WAAW;CACX,WAAW;CACX,qCAAqC;CACrC",file:"main.css",sourcesContent:[".mainContainer {\n\tposition:absolute;\n\tz-index: 0;\n\ttop:0;\n\tbottom:0;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: center;\n\talign-items: flex-end;\n}\n\n.main {\n\tposition:absolute;\n\tz-index: 0;\n\ttop:0;\n\tbottom:0;\n\twidth: 100%;\n\theight: 100%;\n}\n\n.timelineContainer {\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: center;\n\tmargin-bottom: 80px;\n}\n\n.dummyPreview {\n\twidth: 250px;\n}\n\n.preview {\n\theight: 250px;\n\twidth: 250px;\n\tposition: absolute;\n\tbottom: 10px;\n\tleft: 10px;\n\tz-index: 1;\n\tborder: 1px solid rgb(140, 140, 140);\n}"],sourceRoot:""}]),t.locals={mainContainer:"main--mainContainer--3rAk74bq",main:"main--main--27Z-IqEs",timelineContainer:"main--timelineContainer--2C0JN1FM",dummyPreview:"main--dummyPreview--2sNqxlWs",preview:"main--preview--TgP-8-GQ"}},824:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=i(225),a=_interopRequireDefault(i(1)),s=i(12),l=_interopRequireDefault(i(825)),c=_interopRequireDefault(i(828)),u=_interopRequireDefault(i(839)),h=_interopRequireDefault(i(842)),d=s.selectors.isAuthUserAdmin,p=function(e){function SidePanel(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SidePanel),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(SidePanel.__proto__||Object.getPrototypeOf(SidePanel)).call(this,e)),t.state={index:0},t.handleTabChange=t.handleTabChange.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(SidePanel,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(SidePanel,[{key:"handleTabChange",value:function handleTabChange(e){this.setState({index:e})}},{key:"render",value:function render(){return r.default.createElement("div",{className:h.default.pannel},r.default.createElement(o.Tabs,{className:h.default.pannelTabs,theme:{navigationContainer:h.default.pannelNavigationContainer,tab:h.default.pannelTab},index:this.state.index,onChange:this.handleTabChange},r.default.createElement(o.Tab,{label:"Medias"},r.default.createElement(c.default,null),this.props.isAdmin&&r.default.createElement(u.default,null)),r.default.createElement(o.Tab,{label:"Layers"},r.default.createElement(l.default,null))))}}]),SidePanel}();p.propTypes={dispatch:a.default.func,isAdmin:a.default.bool};var f=(0,n.connect)(function(e){return{isAdmin:d(e)}})(p);t.default=f},825:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=i(58),a=i(21),s=_interopRequireDefault(i(1)),l=i(12),c=_interopRequireDefault(i(826)),u=l.actions.toggleLayer,h=l.selectors.getRasterLayersInBounds,d=function(e){function Layers(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Layers),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Layers.__proto__||Object.getPrototypeOf(Layers)).call(this,e)),t.state={index:0},t.toggleLayer=t.toggleLayer.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Layers,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Layers,[{key:"toggleLayer",value:function toggleLayer(e){this.props.dispatch(u({layerId:e}))}},{key:"render",value:function render(){var e=this,t=[],i=[],n=[];return(0,o.forIn)(this.props.mediaLayers,function(i,n){var o="visibility_off";i.metadata.isLocked?o="lock":i.metadata.isShown&&(o="visibility"),t.push(r.default.createElement("div",{key:n,className:c.default.layer},r.default.createElement(a.IconButton,{disabled:i.metadata.isLocked,onClick:function onClick(){e.toggleLayer(n)},icon:o}),i.metadata.name))}),(0,o.forIn)(this.props.rasterLayers,function(t,n){var o="visibility_off";t.metadata.isLocked?o="lock":t.metadata.isShown&&(o="visibility"),i.push(r.default.createElement("div",{key:n,className:c.default.layer},r.default.createElement(a.IconButton,{disabled:t.metadata.isLocked,onClick:function onClick(){e.toggleLayer(n)},icon:o}),t.metadata.name))}),(0,o.forIn)(this.props.pointCloudLayers,function(t,i){var o="visibility_off";t.metadata.isLocked?o="lock":t.metadata.isShown&&(o="visibility"),n.push(r.default.createElement("div",{key:i,className:c.default.layer},r.default.createElement(a.IconButton,{disabled:t.metadata.isLocked,onClick:function onClick(){e.toggleLayer(i)},icon:o}),t.metadata.name))}),r.default.createElement("div",null,r.default.createElement("h3",null,"Medias"),r.default.createElement("div",null,t),n.length>0&&r.default.createElement("div",null,r.default.createElement("hr",null),r.default.createElement("h3",null,"Point clouds"),r.default.createElement("div",null,n)),i.length>0&&r.default.createElement("div",null,r.default.createElement("hr",null),r.default.createElement("h3",null,"Orthophotos"),r.default.createElement("div",null,i)))}}]),Layers}();d.propTypes={dispatch:s.default.func.isRequired,mediaLayers:s.default.object.isRequired,pointCloudLayers:s.default.object.isRequired,rasterLayers:s.default.object.isRequired};var p=(0,n.connect)(function(e){return{mediaLayers:e.medias.layers,rasterLayers:h(e),pointCloudLayers:e.potree.layers}})(d);t.default=p},826:function(e,t,i){var r=i(827);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},827:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".layers--layer--2B2kqxNq {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-align: center;\n\t    -ms-flex-align: center;\n\t        align-items: center;\n}","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Map/layers.css"],names:[],mappings:"AAAA;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,0BAAoB;KAApB,uBAAoB;SAApB,oBAAoB;CACpB",file:"layers.css",sourcesContent:[".layer {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n}"],sourceRoot:""}]),t.locals={layer:"layers--layer--2B2kqxNq"}},828:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=_interopRequireDefault(i(829)),a=_interopRequireDefault(i(831)),s=_interopRequireDefault(i(1)),l=i(12),c=_interopRequireDefault(i(108)),u=l.selectors.isAuthUserAdmin,h=l.selectors.getVisibleMedias,d=l.selectors.getSelectFilterPending,p=l.selectors.areMediasLocked,f=l.actions.clickMedias,m=function(e){function Carousel(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Carousel),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(Carousel.__proto__||Object.getPrototypeOf(Carousel)).call(this,e)),t.state={mediasSlice:[],hasMore:!0},t.loadMoreThumbnails=t.loadMoreThumbnails.bind(t),t.handleClick=t.handleClick.bind(t),t.handleLoadError=t.handleLoadError.bind(t),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Carousel,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(Carousel,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){if(!e.selectFilterPending&&this.props.selectFilterPending){var t=e.medias.slice(0,this.state.mediasSlice.length);this.setState({mediasSlice:t})}else e.medias.length!==this.props.medias.length&&this.setState({mediasSlice:[],hasMore:e.medias.length>0})}},{key:"loadMoreThumbnails",value:function loadMoreThumbnails(){var e=this.state.mediasSlice.length;if(this.state.hasMore){var t=this.props.medias.slice(e,e+10);this.setState({mediasSlice:this.state.mediasSlice.concat(t),hasMore:this.props.medias.length>e+10})}}},{key:"handleClick",value:function handleClick(e,t){if("IMG"!==e.tagName){var i=[];this.props.dispatch(f({features:i,ctrlKey:t}))}}},{key:"selectMedia",value:function selectMedia(e,t){var i=[e];this.props.dispatch(f({features:i,ctrlKey:t,isAdmin:this.props.isAdmin}))}},{key:"handleLoadError",value:function handleLoadError(e,t){e.target.src===t.properties.thumbnail_url&&(e.target.src=t.properties.url),this.setState({loading:!1})}},{key:"handleLoadComplete",value:function handleLoadComplete(e){e.target.style.display="block",this.setState({loading:!1})}},{key:"render",value:function render(){var e=this,t=[];return this.state.mediasSlice.map(function(i,n){var o=[c.default.thumbnail,c.default.thumbnailLoading];i.properties.selected&&o.push(c.default.thumbnailSelected),t.push(r.default.createElement("div",{className:c.default.thumbnailContainer,key:n,onClick:function onClick(t){e.selectMedia(i,t.ctrlKey)}},r.default.createElement(a.default,null,r.default.createElement("img",{className:o.join(" "),src:i.properties.thumbnail_url,onLoad:function onLoad(t){return e.handleLoadComplete(t)},onError:function onError(t){return e.handleLoadError(t,i)}}))))}),this.props.areMediasLocked?r.default.createElement("div",{className:c.default.mediasLockedMessage},r.default.createElement("div",null,"Please zoom in to view individual media.")):r.default.createElement("div",{className:c.default.infiniteScrollContainer,onClick:function onClick(t){e.handleClick(t.target,t.ctrlKey)}},r.default.createElement(o.default,{className:c.default.infiniteScroll,pageStart:0,loadMore:this.loadMoreThumbnails,hasMore:this.state.hasMore,useWindow:!1,loader:r.default.createElement("div",{className:"loader"},"Loading ...")},t))}}]),Carousel}();m.propTypes={areMediasLocked:s.default.bool.isRequired,dispatch:s.default.func.isRequired,isAdmin:s.default.bool,medias:s.default.arrayOf(s.default.object).isRequired,selectFilterPending:s.default.bool.isRequired};var g=(0,n.connect)(function(e){return{medias:h(e),selectFilterPending:d(e),areMediasLocked:p(e),isAdmin:u(e)}})(m);t.default=g},838:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".carousel--infiniteScrollContainer--1yOjvfVz {\n\tmin-height: 0;\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n\toverflow: auto;\n}\n\n.carousel--infiniteScroll--3HMjdFhg {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-ms-flex-wrap: wrap;\n\t    flex-wrap: wrap;\n\t-webkit-box-pack: center;\n\t    -ms-flex-pack: center;\n\t        justify-content: center;\n\t-webkit-box-align: start;\n\t    -ms-flex-align: start;\n\t        align-items: flex-start;\n}\n\n.carousel--thumbnailContainer--1r9nNNil {\n\tposition:relative;\n\theight: 100px;\n\twidth: 100px;\n\tmargin: 8px;\n}\n\n.carousel--thumbnail--ePzai0ko {\n\theight: 100%;\n\twidth: 100%;\n\t-o-object-fit: scale-down;\n\t   object-fit: scale-down;\n}\n\n.carousel--thumbnailLoading--3tEsrNnT {\n\tdisplay:none;\n}\n\n.carousel--thumbnailSelected--2LNDT5v5 {\n\tborder: 2px solid blue;\n}\n\n.carousel--mediasLockedMessage--3pdRzy6q {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: vertical;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: column;\n\t        flex-direction: column;\n\t-webkit-box-flex: 1;\n\t    -ms-flex-positive: 1;\n\t        flex-grow: 1;\n\tmin-height: 0;\n\t-webkit-box-align: center;\n\t    -ms-flex-align: center;\n\t        align-items: center;\n\t-webkit-box-pack: center;\n\t    -ms-flex-pack: center;\n\t        justify-content: center;\n\tfont-weight: bold;\n\tfont-size: 20px;\n\ttext-align: center;\n}\n\n.carousel--mediasActions--50Wg0sGH {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-pack: end;\n\t    -ms-flex-pack: end;\n\t        justify-content: flex-end;\n\t-ms-flex-negative: 0;\n\t    flex-shrink: 0;\n\tmargin: 16px 0;\n}\n\n.carousel--mediasUploader--cIcPkPqq {\n\tposition:relative;\n}\n\n.carousel--mediasUploader--cIcPkPqq input {\n\tposition:absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\topacity: 0;\n\tz-index: 0;\n}\n\n.carousel--mediasUploaderProgress--2L0XRHyM {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-align: center;\n\t    -ms-flex-align: center;\n\t        align-items: center;\n}\n\n.carousel--mediasUploaderProgress--2L0XRHyM div {\n\tmargin-right: 8px;\n}\n\n.carousel--mediasUploaderErrors--114xsUcb {\n\tcolor: red;\n\tfont-weight: bold;\n\tfont-size: 12px;\n}\n\n.carousel--mediasUploaderSuccess--2sRr_UGb {\n\tcolor: green;\n\tfont-weight: bold;\n\tfont-size: 12px;\n}\n\n.carousel--mediasUploaderErrorActions--3LR8tYsC {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: horizontal;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: row;\n\t        flex-direction: row;\n\t-webkit-box-pack: end;\n\t    -ms-flex-pack: end;\n\t        justify-content: flex-end;\n\t-webkit-box-align: center;\n\t    -ms-flex-align: center;\n\t        align-items: center;\n}","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Medias/carousel.css"],names:[],mappings:"AAAA;CACC,cAAc;CACd,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb,eAAe;CACf;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,oBAAgB;KAAhB,gBAAgB;CAChB,yBAAwB;KAAxB,sBAAwB;SAAxB,wBAAwB;CACxB,yBAAwB;KAAxB,sBAAwB;SAAxB,wBAAwB;CACxB;;AAED;CACC,kBAAkB;CAClB,cAAc;CACd,aAAa;CACb,YAAY;CACZ;;AAED;CACC,aAAa;CACb,YAAY;CACZ,0BAAuB;IAAvB,uBAAuB;CACvB;;AAED;CACC,aAAa;CACb;;AAED;CACC,uBAAuB;CACvB;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,6BAAuB;CAAvB,8BAAuB;KAAvB,2BAAuB;SAAvB,uBAAuB;CACvB,oBAAa;KAAb,qBAAa;SAAb,aAAa;CACb,cAAc;CACd,0BAAoB;KAApB,uBAAoB;SAApB,oBAAoB;CACpB,yBAAwB;KAAxB,sBAAwB;SAAxB,wBAAwB;CACxB,kBAAkB;CAClB,gBAAgB;CAChB,mBAAmB;CACnB;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,sBAA0B;KAA1B,mBAA0B;SAA1B,0BAA0B;CAC1B,qBAAe;KAAf,eAAe;CACf,eAAe;CACf;;AAED;CACC,kBAAkB;CAClB;;AAED;CACC,kBAAkB;CAClB,OAAO;CACP,QAAQ;CACR,YAAY;CACZ,aAAa;CACb,WAAW;CACX,WAAW;CACX;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,0BAAoB;KAApB,uBAAoB;SAApB,oBAAoB;CACpB;;AAED;CACC,kBAAkB;CAClB;;AAED;CACC,WAAW;CACX,kBAAkB;CAClB,gBAAgB;CAChB;;AAED;CACC,aAAa;CACb,kBAAkB;CAClB,gBAAgB;CAChB;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,+BAAoB;CAApB,8BAAoB;KAApB,wBAAoB;SAApB,oBAAoB;CACpB,sBAA0B;KAA1B,mBAA0B;SAA1B,0BAA0B;CAC1B,0BAAoB;KAApB,uBAAoB;SAApB,oBAAoB;CACpB",file:"carousel.css",sourcesContent:[".infiniteScrollContainer {\n\tmin-height: 0;\n\tflex-grow: 1;\n\toverflow: auto;\n}\n\n.infiniteScroll {\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-wrap: wrap;\n\tjustify-content: center;\n\talign-items: flex-start;\n}\n\n.thumbnailContainer {\n\tposition:relative;\n\theight: 100px;\n\twidth: 100px;\n\tmargin: 8px;\n}\n\n.thumbnail {\n\theight: 100%;\n\twidth: 100%;\n\tobject-fit: scale-down;\n}\n\n.thumbnailLoading {\n\tdisplay:none;\n}\n\n.thumbnailSelected {\n\tborder: 2px solid blue;\n}\n\n.mediasLockedMessage {\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 1;\n\tmin-height: 0;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-weight: bold;\n\tfont-size: 20px;\n\ttext-align: center;\n}\n\n.mediasActions {\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: flex-end;\n\tflex-shrink: 0;\n\tmargin: 16px 0;\n}\n\n.mediasUploader {\n\tposition:relative;\n}\n\n.mediasUploader input {\n\tposition:absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\topacity: 0;\n\tz-index: 0;\n}\n\n.mediasUploaderProgress {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n}\n\n.mediasUploaderProgress div {\n\tmargin-right: 8px;\n}\n\n.mediasUploaderErrors {\n\tcolor: red;\n\tfont-weight: bold;\n\tfont-size: 12px;\n}\n\n.mediasUploaderSuccess {\n\tcolor: green;\n\tfont-weight: bold;\n\tfont-size: 12px;\n}\n\n.mediasUploaderErrorActions {\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: flex-end;\n\talign-items: center;\n}"],sourceRoot:""}]),t.locals={infiniteScrollContainer:"carousel--infiniteScrollContainer--1yOjvfVz",infiniteScroll:"carousel--infiniteScroll--3HMjdFhg",thumbnailContainer:"carousel--thumbnailContainer--1r9nNNil",thumbnail:"carousel--thumbnail--ePzai0ko",thumbnailLoading:"carousel--thumbnailLoading--3tEsrNnT",thumbnailSelected:"carousel--thumbnailSelected--2LNDT5v5",mediasLockedMessage:"carousel--mediasLockedMessage--3pdRzy6q",mediasActions:"carousel--mediasActions--50Wg0sGH",mediasUploader:"carousel--mediasUploader--cIcPkPqq",mediasUploaderProgress:"carousel--mediasUploaderProgress--2L0XRHyM",mediasUploaderErrors:"carousel--mediasUploaderErrors--114xsUcb",mediasUploaderSuccess:"carousel--mediasUploaderSuccess--2sRr_UGb",mediasUploaderErrorActions:"carousel--mediasUploaderErrorActions--3LR8tYsC"}},839:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=_interopRequireDefault(i(840)),o=_interopRequireDefault(i(841)),a=_interopRequireDefault(i(108)),s=function(e){function MediasActions(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MediasActions),function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(MediasActions.__proto__||Object.getPrototypeOf(MediasActions)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(MediasActions,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(MediasActions,[{key:"render",value:function render(){return r.default.createElement("div",{className:a.default.mediasActions},r.default.createElement(n.default,null),r.default.createElement(o.default,null))}}]),MediasActions}();t.default=s},840:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=i(21),a=i(25),s=i(72),l=_interopRequireDefault(i(1)),c=i(12),u=_interopRequireDefault(i(108)),h=c.selectors.getUploadMediasState,d=c.actions.uploadMedias,p=c.actions.resetUploadMediasState,f=function(e){function MediasUploader(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MediasUploader),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(MediasUploader.__proto__||Object.getPrototypeOf(MediasUploader)).call(this,e)),t.handleFileUpload=t.handleFileUpload.bind(t),t.handleClick=t.handleClick.bind(t),t.cancel=t.cancel.bind(t),t.retry=t.retry.bind(t),t.state={uploadPending:!1,uploadFinished:!1,uploadFulfilled:!1,nbFiles:0},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(MediasUploader,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(MediasUploader,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){var t=!1!==e.uploadMediasState.pending,i=null!==e.uploadMediasState.data,r=i&&!e.uploadMediasState.error;i&&(this.input.value=""),r&&this.props.dispatch(p()),this.setState({uploadPending:t,uploadFinished:i,uploadFulfilled:r})}},{key:"handleFileUpload",value:function handleFileUpload(e){this.setState({nbFiles:e.target.files.length}),this.props.dispatch(d(e.target.files,this.props.position))}},{key:"handleClick",value:function handleClick(){this.input.click()}},{key:"cancel",value:function cancel(){var e=this;this.setState({uploadPending:!1,uploadFinished:!1,uploadFulfilled:!1,nbFiles:0},function(){e.props.dispatch(p())})}},{key:"retry",value:function retry(){var e=this.props.uploadMediasState.error.files;e.length>0&&(this.setState({nbFiles:e.length}),this.props.dispatch(d(e,this.props.position)))}},{key:"render",value:function render(){var e,t,i=this,n=this.props.uploadMediasState.pending,l=this.state.uploadPending||this.state.uploadFinished&&!this.state.uploadFulfilled;this.state.uploadPending?(e=parseInt(n/this.state.nbFiles*100),t="".concat(n,"/").concat(this.state.nbFiles)):this.state.uploadFinished&&(e=100,t="".concat(this.state.nbFiles,"/").concat(this.state.nbFiles));var c;this.state.uploadFinished&&this.props.uploadMediasState.data.length>0&&(c="Successfully uploaded ".concat(this.props.uploadMediasState.data.length,"/").concat(this.state.nbFiles," medias"));var h;return this.props.uploadMediasState.error&&(h=this.props.uploadMediasState.error.messages.map(function(e,t){return r.default.createElement("div",{key:"err-".concat(t)},e)})),r.default.createElement("div",null,r.default.createElement("div",{className:u.default.mediasUploader},r.default.createElement("input",{type:"file",onChange:this.handleFileUpload,multiple:!0,ref:function ref(e){i.input=e}}),r.default.createElement(o.Button,{primary:!0,onClick:this.handleClick},"Upload medias")),r.default.createElement(a.Dialog,{active:l,title:"Uploading medias"},r.default.createElement("div",{className:u.default.mediasUploaderProgress},r.default.createElement(s.ProgressBar,{type:"linear",mode:"determinate",value:e}),r.default.createElement("div",null,t)),r.default.createElement("div",{className:u.default.mediasUploaderSuccess},c),h&&r.default.createElement("div",{className:u.default.mediasUploaderErrors},h),this.state.uploadFinished&&!this.state.uploadFulfilled&&r.default.createElement("div",{className:u.default.mediasUploaderErrorActions},r.default.createElement(o.Button,{primary:!0,onClick:this.retry},"Retry"),r.default.createElement(o.Button,{onClick:this.cancel},"Cancel"))))}}]),MediasUploader}();f.propTypes={dispatch:l.default.func.isRequired,position:l.default.shape({lng:l.default.number.isRequired,lat:l.default.number.isRequired}).isRequired,uploadMediasState:l.default.shape({pending:l.default.oneOfType([l.default.number,l.default.bool]).isRequired,error:l.default.shape({files:l.default.arrayOf(l.default.object),messages:l.default.arrayOf(l.default.string)}),data:l.default.arrayOf(l.default.object)}).isRequired};var m=(0,n.connect)(function(e){return{position:{lng:e.world.lng,lat:e.world.lat},uploadMediasState:h(e)}})(f);t.default=m},841:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=_interopRequireDefault(i(1)),o=i(11),a=i(21),s=i(25),l=i(72),c=i(12),u=_interopRequireDefault(i(108)),h=c.selectors.getSelectedMedias,d=c.selectors.getDeleteMediasState,p=c.actions.deleteMedias,f=c.actions.resetDeleteMediasState,m=function(e){function MediasDeleter(e){var t;return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MediasDeleter),t=function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(MediasDeleter.__proto__||Object.getPrototypeOf(MediasDeleter)).call(this,e)),t.handleDeleteMedias=t.handleDeleteMedias.bind(t),t.cancel=t.cancel.bind(t),t.retry=t.retry.bind(t),t.state={deletePending:!1,deleteFinished:!1,deleteFulfilled:!1,nbMedias:0},t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(MediasDeleter,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(MediasDeleter,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){var t=!1!==e.deleteMediasState.pending,i=null!==e.deleteMediasState.data,r=i&&!e.deleteMediasState.error;r&&this.props.dispatch(f()),this.setState({deletePending:t,deleteFinished:i,deleteFulfilled:r})}},{key:"handleDeleteMedias",value:function handleDeleteMedias(){this.setState({nbMedias:this.props.selectedMedias.length}),this.props.dispatch(p(this.props.selectedMedias))}},{key:"cancel",value:function cancel(){var e=this;this.setState({deletePending:!1,deleteFinished:!1,deleteFulfilled:!1,nbMedias:0},function(){e.props.dispatch(f())})}},{key:"retry",value:function retry(){var e=this.props.deleteMediasState.error.medias;e.length>0&&(this.setState({nbMedias:e.length}),this.props.dispatch(p(e)))}},{key:"render",value:function render(){var e,t,i=this.props.deleteMediasState.pending,n=this.state.deletePending||this.state.deleteFinished&&!this.state.deleteFulfilled;this.state.deletePending?(e=parseInt(i/this.state.nbMedias*100),t="".concat(i,"/").concat(this.state.nbMedias)):this.state.deleteFinished&&(e=100,t="".concat(this.state.nbMedias,"/").concat(this.state.nbMedias));var o;this.state.deleteFinished&&this.props.deleteMediasState.data.length>0&&(o="Successfully deleted ".concat(this.props.deleteMediasState.data.length,"/").concat(this.state.nbMedias," medias"));var c;return this.props.deleteMediasState.error&&(c=this.props.deleteMediasState.error.messages.map(function(e,t){return r.default.createElement("div",{key:"err-".concat(t)},e)})),r.default.createElement("div",null,r.default.createElement("div",{className:u.default.mediasUploader},r.default.createElement(a.Button,{accent:!0,disabled:0===this.props.selectedMedias.length,onClick:this.handleDeleteMedias},"Delete Medias")),r.default.createElement(s.Dialog,{active:n,title:"Deleting medias"},r.default.createElement("div",{className:u.default.mediasUploaderProgress},r.default.createElement(l.ProgressBar,{type:"linear",mode:"determinate",value:e}),r.default.createElement("div",null,t)),r.default.createElement("div",{className:u.default.mediasUploaderSuccess},o),c&&r.default.createElement("div",{className:u.default.mediasUploaderErrors},c),this.state.deleteFinished&&!this.state.deleteFulfilled&&r.default.createElement("div",{className:u.default.mediasUploaderErrorActions},r.default.createElement(a.Button,{primary:!0,onClick:this.retry},"Retry"),r.default.createElement(a.Button,{onClick:this.cancel},"Cancel"))))}}]),MediasDeleter}();m.propTypes={deleteMediasState:n.default.shape({pending:n.default.oneOfType([n.default.number,n.default.bool]).isRequired,data:n.default.arrayOf(n.default.object),error:n.default.string}).isRequired,dispatch:n.default.func.isRequired,selectedMedias:n.default.arrayOf(n.default.object)};var g=(0,o.connect)(function(e){return{selectedMedias:h(e),deleteMediasState:d(e)}})(m);t.default=g},842:function(e,t,i){var r=i(843);"string"==typeof r&&(r=[[e.i,r,""]]);i(9)(r,{});r.locals&&(e.exports=r.locals)},843:function(e,t,i){(t=e.exports=i(8)()).push([e.i,".pannel--pannel--VKbGsvQI {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-orient: vertical;\n\t-webkit-box-direction: normal;\n\t    -ms-flex-direction: column;\n\t        flex-direction: column;\n\theight: 100%;\n\tmargin-left: -11px;\n}\n\n.pannel--pannelTabs--3Po2ybN7 {\n\theight: 100%;\n}\n\n.pannel--pannelTab--doY2AIfx {\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-webkit-box-flex:1;\n\t    -ms-flex-positive:1;\n\t        flex-grow:1;\n\tmin-height: 0;\n}\n\n.pannel--pannelTab--doY2AIfx:focus {\n\toutline: none;\n}\n\n.pannel--pannelNavigationContainer--3zTq768H {\n\t-ms-flex-negative: 0;\n\t    flex-shrink: 0;\n}","",{version:3,sources:["/opt/bitnami/apps/jenkins/jenkins_home/jobs/build-bump-npm-publish/workspace/src/frontend/components/Main/pannel.css"],names:[],mappings:"AAAA;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,6BAAuB;CAAvB,8BAAuB;KAAvB,2BAAuB;SAAvB,uBAAuB;CACvB,aAAa;CACb,mBAAmB;CACnB;;AAED;CACC,aAAa;CACb;;AAED;CACC,qBAAc;CAAd,qBAAc;CAAd,cAAc;CACd,mBAAY;KAAZ,oBAAY;SAAZ,YAAY;CACZ,cAAc;CACd;;AAED;CACC,cAAc;CACd;;AAED;CACC,qBAAe;KAAf,eAAe;CACf",file:"pannel.css",sourcesContent:[".pannel {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmargin-left: -11px;\n}\n\n.pannelTabs {\n\theight: 100%;\n}\n\n.pannelTab {\n\tdisplay: flex;\n\tflex-grow:1;\n\tmin-height: 0;\n}\n\n.pannelTab:focus {\n\toutline: none;\n}\n\n.pannelNavigationContainer {\n\tflex-shrink: 0;\n}"],sourceRoot:""}]),t.locals={pannel:"pannel--pannel--VKbGsvQI",pannelTabs:"pannel--pannelTabs--3Po2ybN7",pannelTab:"pannel--pannelTab--doY2AIfx",pannelNavigationContainer:"pannel--pannelNavigationContainer--3zTq768H"}},844:function(e,t,i){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=_interopRequireDefault(i(0)),n=i(11),o=i(161),a=_interopRequireDefault(i(1)),s=i(12),l=s.selectors.getSelectedMedias,c=s.actions.initSelectedMedia,u=function(e){function MediasRouter(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MediasRouter),function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(MediasRouter.__proto__||Object.getPrototypeOf(MediasRouter)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(MediasRouter,r.default.Component),function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(MediasRouter,[{key:"componentDidMount",value:function componentDidMount(){var e,t=this.props.location.pathname.split("/");t.length>3&&"medias"===t[2]&&t[3]&&(e=t[3],this.props.dispatch(c({mediaId:e}))),this.state={init:e}}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){var t="/"+this.props.location.pathname.split("/")[1],i=1===e.selectedMedias.length;if(this.state.init&&i)this.setState({init:!1});else if(i){var r=e.selectedMedias[0].properties._id;if(1!==this.props.selectedMedias.length||this.props.selectedMedias[0].properties._id!==r){var n=t+"/medias/"+e.selectedMedias[0].properties._id;this.props.history.push(n)}}else{1===this.props.selectedMedias.length&&this.props.history.push(t)}}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return!1}},{key:"render",value:function render(){return r.default.createElement("div",null)}}]),MediasRouter}();u.propTypes={dispatch:a.default.func.isRequired,history:a.default.object.isRequired,location:a.default.object,match:a.default.object.isRequired,selectedMedias:a.default.arrayOf(a.default.object)};var h=(0,n.connect)(function(e){return{selectedMedias:l(e)}})(u),d=(0,o.withRouter)(h);t.default=d}},[302]);
//# sourceMappingURL=app.40b2887bb698bebc2cd8.js.map